{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from 'react';\nimport { BrowserOAuthClient } from '@atproto/oauth-client-browser';\n\n// Initialize the OAuth client for development using loopback configuration\nconst oauthClient = new BrowserOAuthClient({\n  handleResolver: 'https://bsky.social',\n  // For development, we use undefined clientMetadata to enable loopback mode\n  clientMetadata: undefined,\n});\n\n// Initialize the Bluesky agent\n\nexport default function Home() {\n  const [isLoading, setIsLoading] = useState(false);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [userDid, setUserDid] = useState<string | null>(null);\n  const [handle, setHandle] = useState<string>('');\n\n  // Initialize OAuth client and check for existing session\n  useEffect(() => {\n    const initOAuth = async () => {\n      try {\n        // Ensure we're using the loopback IP instead of localhost\n        if (window.location.hostname === 'localhost') {\n          window.location.replace(window.location.href.replace('localhost', '127.0.0.1'));\n          return;\n        }\n\n        const result = await oauthClient.init();\n        if (result?.session) {\n          setIsAuthenticated(true);\n          setUserDid(result.session.sub);\n          console.log('Session initialized for:', result.session.sub);\n        }\n      } catch (error) {\n        console.error('OAuth initialization error:', error);\n        setError(error instanceof Error ? error.message : 'Failed to initialize OAuth');\n      }\n    };\n\n    initOAuth();\n  }, []);\n\n  const handleLogin = async () => {\n    if (!handle) {\n      setError('Please enter your Bluesky handle');\n      return;\n    }\n    \n    setIsLoading(true);\n    setError(null);\n    try {\n      await oauthClient.signIn(handle, {\n        state: Math.random().toString(36).substring(7),\n      });\n      // Note: This won't execute as signIn redirects the page\n    } catch (error) {\n      console.error('Login failed:', error);\n      setError(error instanceof Error ? error.message : 'Login failed');\n      setIsLoading(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      // Clear all browser storage\n      await window.indexedDB.deleteDatabase('atproto-oauth');\n      localStorage.clear();\n      sessionStorage.clear();\n\n      // Clear cookies\n      document.cookie.split(';').forEach(cookie => {\n        const [name] = cookie.split('=');\n        document.cookie = `${name.trim()}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`;\n      });\n\n      // Reset state\n      setIsAuthenticated(false);\n      setUserDid(null);\n      setHandle('');\n\n      // Force reload to clear any in-memory state\n      window.location.href = window.location.origin;\n    } catch (error) {\n      console.error('Logout failed:', error);\n      setError(error instanceof Error ? error.message : 'Failed to logout');\n    }\n  };\n\n  return (\n    <main className=\"flex min-h-screen flex-col items-center justify-between p-24\">\n      <div className=\"z-10 max-w-5xl w-full items-center justify-between font-mono text-sm lg:flex\">\n        <div className=\"fixed bottom-0 left-0 flex h-48 w-full items-end justify-center bg-gradient-to-t from-white via-white dark:from-black dark:via-black lg:static lg:h-auto lg:w-auto lg:bg-none\">\n          {!isAuthenticated ? (\n            <div className=\"flex flex-col items-center space-y-4\">\n              <input\n                type=\"text\"\n                placeholder=\"Your handle (e.g. you.bsky.social)\"\n                value={handle}\n                onChange={(e) => setHandle(e.target.value)}\n                className=\"w-64 px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n              {error && <p className=\"text-red-500 text-sm\">{error}</p>}\n              <button\n                onClick={handleLogin}\n                disabled={isLoading || !handle}\n                className=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isLoading ? 'Connecting...' : 'Login with Bluesky'}\n              </button>\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center space-y-4\">\n              <p>Logged in as: {userDid}</p>\n              <button\n                onClick={handleLogout}\n                className=\"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded\"\n              >\n                Logout\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"flex-1 w-full flex flex-col items-center justify-center\">\n        {isAuthenticated ? (\n          <p className=\"text-gray-600\">Successfully authenticated with Bluesky!</p>\n        ) : (\n          <p className=\"text-gray-600\">Please log in to continue</p>\n        )}\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 215, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}