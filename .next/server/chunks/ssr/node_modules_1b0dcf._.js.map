{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/next/src/server/route-modules/app-page/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n    } else if (process.env.TURBOPACK) {\n      module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n    } else {\n      module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n    } else if (process.env.TURBOPACK) {\n      module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n    } else {\n      module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":";AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,MAAQ;;AAEzC,OAAO;IACL,IAAIF,QAAQC,GAAG,CAACK,uBAA2B,EAAF;;IAQzC,OAAO;QACL,IAAIN,QAAQC,GAAG,CAACM,QAAQ,KAAK,WAAe;YAC1CJ,OAAOC,OAAO,GAAGC,QAAQ;QAC3B,OAAO,IAAIL,QAAQC,GAAG,CAACO,SAAS,EAAE;;QAIlC;IACF;AACF","ignoreList":[0]}},
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored[\n  'react-ssr'\n].ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,0HAAyBC,QAAQ,CACxD,YACD,CAACC,kBAAkB","ignoreList":[0]}},
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored['react-ssr'].React\n"],"names":["module","exports","require","vendored","React"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,0HAAyBC,QAAQ,CAAC,YAAY,CAACC,KAAK","ignoreList":[0]}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/disposable-polyfill/index.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/disposable-polyfill/index.ts"],"names":[],"mappings":";AAAA,yEAAyE;AACzE,6EAA6E;AAC7E,8EAA8E;AAC9E,+EAA+E;AAC/E,qBAAqB;AAErB,mBAAmB;AACnB,MAAM,CAAC,OAAO,IAAA,CAAd,MAAM,CAAC,OAAO,GAAK,MAAM,CAAC,WAAW,CAAC,EAAA;AACtC,mBAAmB;AACnB,MAAM,CAAC,YAAY,IAAA,CAAnB,MAAM,CAAC,YAAY,GAAK,MAAM,CAAC,gBAAgB,CAAC,EAAA","ignoreList":[0]}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/helpers/util.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getParsedType = exports.ZodParsedType = exports.objectUtil = exports.util = void 0;\nvar util;\n(function (util) {\n    util.assertEqual = (val) => val;\n    function assertIs(_arg) { }\n    util.assertIs = assertIs;\n    function assertNever(_x) {\n        throw new Error();\n    }\n    util.assertNever = assertNever;\n    util.arrayToEnum = (items) => {\n        const obj = {};\n        for (const item of items) {\n            obj[item] = item;\n        }\n        return obj;\n    };\n    util.getValidEnumValues = (obj) => {\n        const validKeys = util.objectKeys(obj).filter((k) => typeof obj[obj[k]] !== \"number\");\n        const filtered = {};\n        for (const k of validKeys) {\n            filtered[k] = obj[k];\n        }\n        return util.objectValues(filtered);\n    };\n    util.objectValues = (obj) => {\n        return util.objectKeys(obj).map(function (e) {\n            return obj[e];\n        });\n    };\n    util.objectKeys = typeof Object.keys === \"function\" // eslint-disable-line ban/ban\n        ? (obj) => Object.keys(obj) // eslint-disable-line ban/ban\n        : (object) => {\n            const keys = [];\n            for (const key in object) {\n                if (Object.prototype.hasOwnProperty.call(object, key)) {\n                    keys.push(key);\n                }\n            }\n            return keys;\n        };\n    util.find = (arr, checker) => {\n        for (const item of arr) {\n            if (checker(item))\n                return item;\n        }\n        return undefined;\n    };\n    util.isInteger = typeof Number.isInteger === \"function\"\n        ? (val) => Number.isInteger(val) // eslint-disable-line ban/ban\n        : (val) => typeof val === \"number\" && isFinite(val) && Math.floor(val) === val;\n    function joinValues(array, separator = \" | \") {\n        return array\n            .map((val) => (typeof val === \"string\" ? `'${val}'` : val))\n            .join(separator);\n    }\n    util.joinValues = joinValues;\n    util.jsonStringifyReplacer = (_, value) => {\n        if (typeof value === \"bigint\") {\n            return value.toString();\n        }\n        return value;\n    };\n})(util || (exports.util = util = {}));\nvar objectUtil;\n(function (objectUtil) {\n    objectUtil.mergeShapes = (first, second) => {\n        return {\n            ...first,\n            ...second, // second overwrites first\n        };\n    };\n})(objectUtil || (exports.objectUtil = objectUtil = {}));\nexports.ZodParsedType = util.arrayToEnum([\n    \"string\",\n    \"nan\",\n    \"number\",\n    \"integer\",\n    \"float\",\n    \"boolean\",\n    \"date\",\n    \"bigint\",\n    \"symbol\",\n    \"function\",\n    \"undefined\",\n    \"null\",\n    \"array\",\n    \"object\",\n    \"unknown\",\n    \"promise\",\n    \"void\",\n    \"never\",\n    \"map\",\n    \"set\",\n]);\nconst getParsedType = (data) => {\n    const t = typeof data;\n    switch (t) {\n        case \"undefined\":\n            return exports.ZodParsedType.undefined;\n        case \"string\":\n            return exports.ZodParsedType.string;\n        case \"number\":\n            return isNaN(data) ? exports.ZodParsedType.nan : exports.ZodParsedType.number;\n        case \"boolean\":\n            return exports.ZodParsedType.boolean;\n        case \"function\":\n            return exports.ZodParsedType.function;\n        case \"bigint\":\n            return exports.ZodParsedType.bigint;\n        case \"symbol\":\n            return exports.ZodParsedType.symbol;\n        case \"object\":\n            if (Array.isArray(data)) {\n                return exports.ZodParsedType.array;\n            }\n            if (data === null) {\n                return exports.ZodParsedType.null;\n            }\n            if (data.then &&\n                typeof data.then === \"function\" &&\n                data.catch &&\n                typeof data.catch === \"function\") {\n                return exports.ZodParsedType.promise;\n            }\n            if (typeof Map !== \"undefined\" && data instanceof Map) {\n                return exports.ZodParsedType.map;\n            }\n            if (typeof Set !== \"undefined\" && data instanceof Set) {\n                return exports.ZodParsedType.set;\n            }\n            if (typeof Date !== \"undefined\" && data instanceof Date) {\n                return exports.ZodParsedType.date;\n            }\n            return exports.ZodParsedType.object;\n        default:\n            return exports.ZodParsedType.unknown;\n    }\n};\nexports.getParsedType = getParsedType;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 191, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/ZodError.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ZodError = exports.quotelessJson = exports.ZodIssueCode = void 0;\nconst util_1 = require(\"./helpers/util\");\nexports.ZodIssueCode = util_1.util.arrayToEnum([\n    \"invalid_type\",\n    \"invalid_literal\",\n    \"custom\",\n    \"invalid_union\",\n    \"invalid_union_discriminator\",\n    \"invalid_enum_value\",\n    \"unrecognized_keys\",\n    \"invalid_arguments\",\n    \"invalid_return_type\",\n    \"invalid_date\",\n    \"invalid_string\",\n    \"too_small\",\n    \"too_big\",\n    \"invalid_intersection_types\",\n    \"not_multiple_of\",\n    \"not_finite\",\n]);\nconst quotelessJson = (obj) => {\n    const json = JSON.stringify(obj, null, 2);\n    return json.replace(/\"([^\"]+)\":/g, \"$1:\");\n};\nexports.quotelessJson = quotelessJson;\nclass ZodError extends Error {\n    get errors() {\n        return this.issues;\n    }\n    constructor(issues) {\n        super();\n        this.issues = [];\n        this.addIssue = (sub) => {\n            this.issues = [...this.issues, sub];\n        };\n        this.addIssues = (subs = []) => {\n            this.issues = [...this.issues, ...subs];\n        };\n        const actualProto = new.target.prototype;\n        if (Object.setPrototypeOf) {\n            // eslint-disable-next-line ban/ban\n            Object.setPrototypeOf(this, actualProto);\n        }\n        else {\n            this.__proto__ = actualProto;\n        }\n        this.name = \"ZodError\";\n        this.issues = issues;\n    }\n    format(_mapper) {\n        const mapper = _mapper ||\n            function (issue) {\n                return issue.message;\n            };\n        const fieldErrors = { _errors: [] };\n        const processError = (error) => {\n            for (const issue of error.issues) {\n                if (issue.code === \"invalid_union\") {\n                    issue.unionErrors.map(processError);\n                }\n                else if (issue.code === \"invalid_return_type\") {\n                    processError(issue.returnTypeError);\n                }\n                else if (issue.code === \"invalid_arguments\") {\n                    processError(issue.argumentsError);\n                }\n                else if (issue.path.length === 0) {\n                    fieldErrors._errors.push(mapper(issue));\n                }\n                else {\n                    let curr = fieldErrors;\n                    let i = 0;\n                    while (i < issue.path.length) {\n                        const el = issue.path[i];\n                        const terminal = i === issue.path.length - 1;\n                        if (!terminal) {\n                            curr[el] = curr[el] || { _errors: [] };\n                            // if (typeof el === \"string\") {\n                            //   curr[el] = curr[el] || { _errors: [] };\n                            // } else if (typeof el === \"number\") {\n                            //   const errorArray: any = [];\n                            //   errorArray._errors = [];\n                            //   curr[el] = curr[el] || errorArray;\n                            // }\n                        }\n                        else {\n                            curr[el] = curr[el] || { _errors: [] };\n                            curr[el]._errors.push(mapper(issue));\n                        }\n                        curr = curr[el];\n                        i++;\n                    }\n                }\n            }\n        };\n        processError(this);\n        return fieldErrors;\n    }\n    static assert(value) {\n        if (!(value instanceof ZodError)) {\n            throw new Error(`Not a ZodError: ${value}`);\n        }\n    }\n    toString() {\n        return this.message;\n    }\n    get message() {\n        return JSON.stringify(this.issues, util_1.util.jsonStringifyReplacer, 2);\n    }\n    get isEmpty() {\n        return this.issues.length === 0;\n    }\n    flatten(mapper = (issue) => issue.message) {\n        const fieldErrors = {};\n        const formErrors = [];\n        for (const sub of this.issues) {\n            if (sub.path.length > 0) {\n                fieldErrors[sub.path[0]] = fieldErrors[sub.path[0]] || [];\n                fieldErrors[sub.path[0]].push(mapper(sub));\n            }\n            else {\n                formErrors.push(mapper(sub));\n            }\n        }\n        return { formErrors, fieldErrors };\n    }\n    get formErrors() {\n        return this.flatten();\n    }\n}\nexports.ZodError = ZodError;\nZodError.create = (issues) => {\n    const error = new ZodError(issues);\n    return error;\n};\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 342, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/locales/en.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst util_1 = require(\"../helpers/util\");\nconst ZodError_1 = require(\"../ZodError\");\nconst errorMap = (issue, _ctx) => {\n    let message;\n    switch (issue.code) {\n        case ZodError_1.ZodIssueCode.invalid_type:\n            if (issue.received === util_1.ZodParsedType.undefined) {\n                message = \"Required\";\n            }\n            else {\n                message = `Expected ${issue.expected}, received ${issue.received}`;\n            }\n            break;\n        case ZodError_1.ZodIssueCode.invalid_literal:\n            message = `Invalid literal value, expected ${JSON.stringify(issue.expected, util_1.util.jsonStringifyReplacer)}`;\n            break;\n        case ZodError_1.ZodIssueCode.unrecognized_keys:\n            message = `Unrecognized key(s) in object: ${util_1.util.joinValues(issue.keys, \", \")}`;\n            break;\n        case ZodError_1.ZodIssueCode.invalid_union:\n            message = `Invalid input`;\n            break;\n        case ZodError_1.ZodIssueCode.invalid_union_discriminator:\n            message = `Invalid discriminator value. Expected ${util_1.util.joinValues(issue.options)}`;\n            break;\n        case ZodError_1.ZodIssueCode.invalid_enum_value:\n            message = `Invalid enum value. Expected ${util_1.util.joinValues(issue.options)}, received '${issue.received}'`;\n            break;\n        case ZodError_1.ZodIssueCode.invalid_arguments:\n            message = `Invalid function arguments`;\n            break;\n        case ZodError_1.ZodIssueCode.invalid_return_type:\n            message = `Invalid function return type`;\n            break;\n        case ZodError_1.ZodIssueCode.invalid_date:\n            message = `Invalid date`;\n            break;\n        case ZodError_1.ZodIssueCode.invalid_string:\n            if (typeof issue.validation === \"object\") {\n                if (\"includes\" in issue.validation) {\n                    message = `Invalid input: must include \"${issue.validation.includes}\"`;\n                    if (typeof issue.validation.position === \"number\") {\n                        message = `${message} at one or more positions greater than or equal to ${issue.validation.position}`;\n                    }\n                }\n                else if (\"startsWith\" in issue.validation) {\n                    message = `Invalid input: must start with \"${issue.validation.startsWith}\"`;\n                }\n                else if (\"endsWith\" in issue.validation) {\n                    message = `Invalid input: must end with \"${issue.validation.endsWith}\"`;\n                }\n                else {\n                    util_1.util.assertNever(issue.validation);\n                }\n            }\n            else if (issue.validation !== \"regex\") {\n                message = `Invalid ${issue.validation}`;\n            }\n            else {\n                message = \"Invalid\";\n            }\n            break;\n        case ZodError_1.ZodIssueCode.too_small:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `more than`} ${issue.minimum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `over`} ${issue.minimum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact\n                    ? `exactly equal to `\n                    : issue.inclusive\n                        ? `greater than or equal to `\n                        : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact\n                    ? `exactly equal to `\n                    : issue.inclusive\n                        ? `greater than or equal to `\n                        : `greater than `}${new Date(Number(issue.minimum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodError_1.ZodIssueCode.too_big:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `less than`} ${issue.maximum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `under`} ${issue.maximum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact\n                    ? `exactly`\n                    : issue.inclusive\n                        ? `less than or equal to`\n                        : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"bigint\")\n                message = `BigInt must be ${issue.exact\n                    ? `exactly`\n                    : issue.inclusive\n                        ? `less than or equal to`\n                        : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact\n                    ? `exactly`\n                    : issue.inclusive\n                        ? `smaller than or equal to`\n                        : `smaller than`} ${new Date(Number(issue.maximum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodError_1.ZodIssueCode.custom:\n            message = `Invalid input`;\n            break;\n        case ZodError_1.ZodIssueCode.invalid_intersection_types:\n            message = `Intersection results could not be merged`;\n            break;\n        case ZodError_1.ZodIssueCode.not_multiple_of:\n            message = `Number must be a multiple of ${issue.multipleOf}`;\n            break;\n        case ZodError_1.ZodIssueCode.not_finite:\n            message = \"Number must be finite\";\n            break;\n        default:\n            message = _ctx.defaultError;\n            util_1.util.assertNever(issue);\n    }\n    return { message };\n};\nexports.default = errorMap;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 443, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 448, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/errors.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getErrorMap = exports.setErrorMap = exports.defaultErrorMap = void 0;\nconst en_1 = __importDefault(require(\"./locales/en\"));\nexports.defaultErrorMap = en_1.default;\nlet overrideErrorMap = en_1.default;\nfunction setErrorMap(map) {\n    overrideErrorMap = map;\n}\nexports.setErrorMap = setErrorMap;\nfunction getErrorMap() {\n    return overrideErrorMap;\n}\nexports.getErrorMap = getErrorMap;\n"],"names":[],"mappings":"AAAA;AACA,IAAI,kBAAkB,AAAC,IAAI,IAAI,IAAI,CAAC,eAAe,IAAK,SAAU,GAAG;IACjE,OAAO,AAAC,OAAO,IAAI,UAAU,GAAI,MAAM;QAAE,WAAW;IAAI;AAC5D;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,WAAW,GAAG,QAAQ,WAAW,GAAG,QAAQ,eAAe,GAAG,KAAK;AAC3E,MAAM,OAAO;AACb,QAAQ,eAAe,GAAG,KAAK,OAAO;AACtC,IAAI,mBAAmB,KAAK,OAAO;AACnC,SAAS,YAAY,GAAG;IACpB,mBAAmB;AACvB;AACA,QAAQ,WAAW,GAAG;AACtB,SAAS;IACL,OAAO;AACX;AACA,QAAQ,WAAW,GAAG","ignoreList":[0]}},
    {"offset": {"line": 469, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 474, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/helpers/parseUtil.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isAsync = exports.isValid = exports.isDirty = exports.isAborted = exports.OK = exports.DIRTY = exports.INVALID = exports.ParseStatus = exports.addIssueToContext = exports.EMPTY_PATH = exports.makeIssue = void 0;\nconst errors_1 = require(\"../errors\");\nconst en_1 = __importDefault(require(\"../locales/en\"));\nconst makeIssue = (params) => {\n    const { data, path, errorMaps, issueData } = params;\n    const fullPath = [...path, ...(issueData.path || [])];\n    const fullIssue = {\n        ...issueData,\n        path: fullPath,\n    };\n    if (issueData.message !== undefined) {\n        return {\n            ...issueData,\n            path: fullPath,\n            message: issueData.message,\n        };\n    }\n    let errorMessage = \"\";\n    const maps = errorMaps\n        .filter((m) => !!m)\n        .slice()\n        .reverse();\n    for (const map of maps) {\n        errorMessage = map(fullIssue, { data, defaultError: errorMessage }).message;\n    }\n    return {\n        ...issueData,\n        path: fullPath,\n        message: errorMessage,\n    };\n};\nexports.makeIssue = makeIssue;\nexports.EMPTY_PATH = [];\nfunction addIssueToContext(ctx, issueData) {\n    const overrideMap = (0, errors_1.getErrorMap)();\n    const issue = (0, exports.makeIssue)({\n        issueData: issueData,\n        data: ctx.data,\n        path: ctx.path,\n        errorMaps: [\n            ctx.common.contextualErrorMap, // contextual error map is first priority\n            ctx.schemaErrorMap, // then schema-bound map if available\n            overrideMap, // then global override map\n            overrideMap === en_1.default ? undefined : en_1.default, // then global default map\n        ].filter((x) => !!x),\n    });\n    ctx.common.issues.push(issue);\n}\nexports.addIssueToContext = addIssueToContext;\nclass ParseStatus {\n    constructor() {\n        this.value = \"valid\";\n    }\n    dirty() {\n        if (this.value === \"valid\")\n            this.value = \"dirty\";\n    }\n    abort() {\n        if (this.value !== \"aborted\")\n            this.value = \"aborted\";\n    }\n    static mergeArray(status, results) {\n        const arrayValue = [];\n        for (const s of results) {\n            if (s.status === \"aborted\")\n                return exports.INVALID;\n            if (s.status === \"dirty\")\n                status.dirty();\n            arrayValue.push(s.value);\n        }\n        return { status: status.value, value: arrayValue };\n    }\n    static async mergeObjectAsync(status, pairs) {\n        const syncPairs = [];\n        for (const pair of pairs) {\n            const key = await pair.key;\n            const value = await pair.value;\n            syncPairs.push({\n                key,\n                value,\n            });\n        }\n        return ParseStatus.mergeObjectSync(status, syncPairs);\n    }\n    static mergeObjectSync(status, pairs) {\n        const finalObject = {};\n        for (const pair of pairs) {\n            const { key, value } = pair;\n            if (key.status === \"aborted\")\n                return exports.INVALID;\n            if (value.status === \"aborted\")\n                return exports.INVALID;\n            if (key.status === \"dirty\")\n                status.dirty();\n            if (value.status === \"dirty\")\n                status.dirty();\n            if (key.value !== \"__proto__\" &&\n                (typeof value.value !== \"undefined\" || pair.alwaysSet)) {\n                finalObject[key.value] = value.value;\n            }\n        }\n        return { status: status.value, value: finalObject };\n    }\n}\nexports.ParseStatus = ParseStatus;\nexports.INVALID = Object.freeze({\n    status: \"aborted\",\n});\nconst DIRTY = (value) => ({ status: \"dirty\", value });\nexports.DIRTY = DIRTY;\nconst OK = (value) => ({ status: \"valid\", value });\nexports.OK = OK;\nconst isAborted = (x) => x.status === \"aborted\";\nexports.isAborted = isAborted;\nconst isDirty = (x) => x.status === \"dirty\";\nexports.isDirty = isDirty;\nconst isValid = (x) => x.status === \"valid\";\nexports.isValid = isValid;\nconst isAsync = (x) => typeof Promise !== \"undefined\" && x instanceof Promise;\nexports.isAsync = isAsync;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 609, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 614, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/helpers/typeAliases.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK","ignoreList":[0]}},
    {"offset": {"line": 618, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 623, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/helpers/errorUtil.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.errorUtil = void 0;\nvar errorUtil;\n(function (errorUtil) {\n    errorUtil.errToObj = (message) => typeof message === \"string\" ? { message } : message || {};\n    errorUtil.toString = (message) => typeof message === \"string\" ? message : message === null || message === void 0 ? void 0 : message.message;\n})(errorUtil || (exports.errorUtil = errorUtil = {}));\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,SAAS,GAAG,KAAK;AACzB,IAAI;AACJ,CAAC,SAAU,SAAS;IAChB,UAAU,QAAQ,GAAG,CAAC,UAAY,OAAO,YAAY,WAAW;YAAE;QAAQ,IAAI,WAAW,CAAC;IAC1F,UAAU,QAAQ,GAAG,CAAC,UAAY,OAAO,YAAY,WAAW,UAAU,YAAY,QAAQ,YAAY,KAAK,IAAI,KAAK,IAAI,QAAQ,OAAO;AAC/I,CAAC,EAAE,aAAa,CAAC,QAAQ,SAAS,GAAG,YAAY,CAAC,CAAC","ignoreList":[0]}},
    {"offset": {"line": 635, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 640, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/types.js"],"sourcesContent":["\"use strict\";\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar _ZodEnum_cache, _ZodNativeEnum_cache;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.boolean = exports.bigint = exports.array = exports.any = exports.coerce = exports.ZodFirstPartyTypeKind = exports.late = exports.ZodSchema = exports.Schema = exports.custom = exports.ZodReadonly = exports.ZodPipeline = exports.ZodBranded = exports.BRAND = exports.ZodNaN = exports.ZodCatch = exports.ZodDefault = exports.ZodNullable = exports.ZodOptional = exports.ZodTransformer = exports.ZodEffects = exports.ZodPromise = exports.ZodNativeEnum = exports.ZodEnum = exports.ZodLiteral = exports.ZodLazy = exports.ZodFunction = exports.ZodSet = exports.ZodMap = exports.ZodRecord = exports.ZodTuple = exports.ZodIntersection = exports.ZodDiscriminatedUnion = exports.ZodUnion = exports.ZodObject = exports.ZodArray = exports.ZodVoid = exports.ZodNever = exports.ZodUnknown = exports.ZodAny = exports.ZodNull = exports.ZodUndefined = exports.ZodSymbol = exports.ZodDate = exports.ZodBoolean = exports.ZodBigInt = exports.ZodNumber = exports.ZodString = exports.datetimeRegex = exports.ZodType = void 0;\nexports.NEVER = exports.void = exports.unknown = exports.union = exports.undefined = exports.tuple = exports.transformer = exports.symbol = exports.string = exports.strictObject = exports.set = exports.record = exports.promise = exports.preprocess = exports.pipeline = exports.ostring = exports.optional = exports.onumber = exports.oboolean = exports.object = exports.number = exports.nullable = exports.null = exports.never = exports.nativeEnum = exports.nan = exports.map = exports.literal = exports.lazy = exports.intersection = exports.instanceof = exports.function = exports.enum = exports.effect = exports.discriminatedUnion = exports.date = void 0;\nconst errors_1 = require(\"./errors\");\nconst errorUtil_1 = require(\"./helpers/errorUtil\");\nconst parseUtil_1 = require(\"./helpers/parseUtil\");\nconst util_1 = require(\"./helpers/util\");\nconst ZodError_1 = require(\"./ZodError\");\nclass ParseInputLazyPath {\n    constructor(parent, value, path, key) {\n        this._cachedPath = [];\n        this.parent = parent;\n        this.data = value;\n        this._path = path;\n        this._key = key;\n    }\n    get path() {\n        if (!this._cachedPath.length) {\n            if (this._key instanceof Array) {\n                this._cachedPath.push(...this._path, ...this._key);\n            }\n            else {\n                this._cachedPath.push(...this._path, this._key);\n            }\n        }\n        return this._cachedPath;\n    }\n}\nconst handleResult = (ctx, result) => {\n    if ((0, parseUtil_1.isValid)(result)) {\n        return { success: true, data: result.value };\n    }\n    else {\n        if (!ctx.common.issues.length) {\n            throw new Error(\"Validation failed but no issues detected.\");\n        }\n        return {\n            success: false,\n            get error() {\n                if (this._error)\n                    return this._error;\n                const error = new ZodError_1.ZodError(ctx.common.issues);\n                this._error = error;\n                return this._error;\n            },\n        };\n    }\n};\nfunction processCreateParams(params) {\n    if (!params)\n        return {};\n    const { errorMap, invalid_type_error, required_error, description } = params;\n    if (errorMap && (invalid_type_error || required_error)) {\n        throw new Error(`Can't use \"invalid_type_error\" or \"required_error\" in conjunction with custom error map.`);\n    }\n    if (errorMap)\n        return { errorMap: errorMap, description };\n    const customMap = (iss, ctx) => {\n        var _a, _b;\n        const { message } = params;\n        if (iss.code === \"invalid_enum_value\") {\n            return { message: message !== null && message !== void 0 ? message : ctx.defaultError };\n        }\n        if (typeof ctx.data === \"undefined\") {\n            return { message: (_a = message !== null && message !== void 0 ? message : required_error) !== null && _a !== void 0 ? _a : ctx.defaultError };\n        }\n        if (iss.code !== \"invalid_type\")\n            return { message: ctx.defaultError };\n        return { message: (_b = message !== null && message !== void 0 ? message : invalid_type_error) !== null && _b !== void 0 ? _b : ctx.defaultError };\n    };\n    return { errorMap: customMap, description };\n}\nclass ZodType {\n    get description() {\n        return this._def.description;\n    }\n    _getType(input) {\n        return (0, util_1.getParsedType)(input.data);\n    }\n    _getOrReturnCtx(input, ctx) {\n        return (ctx || {\n            common: input.parent.common,\n            data: input.data,\n            parsedType: (0, util_1.getParsedType)(input.data),\n            schemaErrorMap: this._def.errorMap,\n            path: input.path,\n            parent: input.parent,\n        });\n    }\n    _processInputParams(input) {\n        return {\n            status: new parseUtil_1.ParseStatus(),\n            ctx: {\n                common: input.parent.common,\n                data: input.data,\n                parsedType: (0, util_1.getParsedType)(input.data),\n                schemaErrorMap: this._def.errorMap,\n                path: input.path,\n                parent: input.parent,\n            },\n        };\n    }\n    _parseSync(input) {\n        const result = this._parse(input);\n        if ((0, parseUtil_1.isAsync)(result)) {\n            throw new Error(\"Synchronous parse encountered promise.\");\n        }\n        return result;\n    }\n    _parseAsync(input) {\n        const result = this._parse(input);\n        return Promise.resolve(result);\n    }\n    parse(data, params) {\n        const result = this.safeParse(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    safeParse(data, params) {\n        var _a;\n        const ctx = {\n            common: {\n                issues: [],\n                async: (_a = params === null || params === void 0 ? void 0 : params.async) !== null && _a !== void 0 ? _a : false,\n                contextualErrorMap: params === null || params === void 0 ? void 0 : params.errorMap,\n            },\n            path: (params === null || params === void 0 ? void 0 : params.path) || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: (0, util_1.getParsedType)(data),\n        };\n        const result = this._parseSync({ data, path: ctx.path, parent: ctx });\n        return handleResult(ctx, result);\n    }\n    \"~validate\"(data) {\n        var _a, _b;\n        const ctx = {\n            common: {\n                issues: [],\n                async: !!this[\"~standard\"].async,\n            },\n            path: [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: (0, util_1.getParsedType)(data),\n        };\n        if (!this[\"~standard\"].async) {\n            try {\n                const result = this._parseSync({ data, path: [], parent: ctx });\n                return (0, parseUtil_1.isValid)(result)\n                    ? {\n                        value: result.value,\n                    }\n                    : {\n                        issues: ctx.common.issues,\n                    };\n            }\n            catch (err) {\n                if ((_b = (_a = err === null || err === void 0 ? void 0 : err.message) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === null || _b === void 0 ? void 0 : _b.includes(\"encountered\")) {\n                    this[\"~standard\"].async = true;\n                }\n                ctx.common = {\n                    issues: [],\n                    async: true,\n                };\n            }\n        }\n        return this._parseAsync({ data, path: [], parent: ctx }).then((result) => (0, parseUtil_1.isValid)(result)\n            ? {\n                value: result.value,\n            }\n            : {\n                issues: ctx.common.issues,\n            });\n    }\n    async parseAsync(data, params) {\n        const result = await this.safeParseAsync(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    async safeParseAsync(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                contextualErrorMap: params === null || params === void 0 ? void 0 : params.errorMap,\n                async: true,\n            },\n            path: (params === null || params === void 0 ? void 0 : params.path) || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: (0, util_1.getParsedType)(data),\n        };\n        const maybeAsyncResult = this._parse({ data, path: ctx.path, parent: ctx });\n        const result = await ((0, parseUtil_1.isAsync)(maybeAsyncResult)\n            ? maybeAsyncResult\n            : Promise.resolve(maybeAsyncResult));\n        return handleResult(ctx, result);\n    }\n    refine(check, message) {\n        const getIssueProperties = (val) => {\n            if (typeof message === \"string\" || typeof message === \"undefined\") {\n                return { message };\n            }\n            else if (typeof message === \"function\") {\n                return message(val);\n            }\n            else {\n                return message;\n            }\n        };\n        return this._refinement((val, ctx) => {\n            const result = check(val);\n            const setError = () => ctx.addIssue({\n                code: ZodError_1.ZodIssueCode.custom,\n                ...getIssueProperties(val),\n            });\n            if (typeof Promise !== \"undefined\" && result instanceof Promise) {\n                return result.then((data) => {\n                    if (!data) {\n                        setError();\n                        return false;\n                    }\n                    else {\n                        return true;\n                    }\n                });\n            }\n            if (!result) {\n                setError();\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    refinement(check, refinementData) {\n        return this._refinement((val, ctx) => {\n            if (!check(val)) {\n                ctx.addIssue(typeof refinementData === \"function\"\n                    ? refinementData(val, ctx)\n                    : refinementData);\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    _refinement(refinement) {\n        return new ZodEffects({\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"refinement\", refinement },\n        });\n    }\n    superRefine(refinement) {\n        return this._refinement(refinement);\n    }\n    constructor(def) {\n        /** Alias of safeParseAsync */\n        this.spa = this.safeParseAsync;\n        this._def = def;\n        this.parse = this.parse.bind(this);\n        this.safeParse = this.safeParse.bind(this);\n        this.parseAsync = this.parseAsync.bind(this);\n        this.safeParseAsync = this.safeParseAsync.bind(this);\n        this.spa = this.spa.bind(this);\n        this.refine = this.refine.bind(this);\n        this.refinement = this.refinement.bind(this);\n        this.superRefine = this.superRefine.bind(this);\n        this.optional = this.optional.bind(this);\n        this.nullable = this.nullable.bind(this);\n        this.nullish = this.nullish.bind(this);\n        this.array = this.array.bind(this);\n        this.promise = this.promise.bind(this);\n        this.or = this.or.bind(this);\n        this.and = this.and.bind(this);\n        this.transform = this.transform.bind(this);\n        this.brand = this.brand.bind(this);\n        this.default = this.default.bind(this);\n        this.catch = this.catch.bind(this);\n        this.describe = this.describe.bind(this);\n        this.pipe = this.pipe.bind(this);\n        this.readonly = this.readonly.bind(this);\n        this.isNullable = this.isNullable.bind(this);\n        this.isOptional = this.isOptional.bind(this);\n        this[\"~standard\"] = {\n            version: 1,\n            vendor: \"zod\",\n            validate: (data) => this[\"~validate\"](data),\n        };\n    }\n    optional() {\n        return ZodOptional.create(this, this._def);\n    }\n    nullable() {\n        return ZodNullable.create(this, this._def);\n    }\n    nullish() {\n        return this.nullable().optional();\n    }\n    array() {\n        return ZodArray.create(this);\n    }\n    promise() {\n        return ZodPromise.create(this, this._def);\n    }\n    or(option) {\n        return ZodUnion.create([this, option], this._def);\n    }\n    and(incoming) {\n        return ZodIntersection.create(this, incoming, this._def);\n    }\n    transform(transform) {\n        return new ZodEffects({\n            ...processCreateParams(this._def),\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"transform\", transform },\n        });\n    }\n    default(def) {\n        const defaultValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodDefault({\n            ...processCreateParams(this._def),\n            innerType: this,\n            defaultValue: defaultValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodDefault,\n        });\n    }\n    brand() {\n        return new ZodBranded({\n            typeName: ZodFirstPartyTypeKind.ZodBranded,\n            type: this,\n            ...processCreateParams(this._def),\n        });\n    }\n    catch(def) {\n        const catchValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodCatch({\n            ...processCreateParams(this._def),\n            innerType: this,\n            catchValue: catchValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodCatch,\n        });\n    }\n    describe(description) {\n        const This = this.constructor;\n        return new This({\n            ...this._def,\n            description,\n        });\n    }\n    pipe(target) {\n        return ZodPipeline.create(this, target);\n    }\n    readonly() {\n        return ZodReadonly.create(this);\n    }\n    isOptional() {\n        return this.safeParse(undefined).success;\n    }\n    isNullable() {\n        return this.safeParse(null).success;\n    }\n}\nexports.ZodType = ZodType;\nexports.Schema = ZodType;\nexports.ZodSchema = ZodType;\nconst cuidRegex = /^c[^\\s-]{8,}$/i;\nconst cuid2Regex = /^[0-9a-z]+$/;\nconst ulidRegex = /^[0-9A-HJKMNP-TV-Z]{26}$/i;\n// const uuidRegex =\n//   /^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i;\nconst uuidRegex = /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/i;\nconst nanoidRegex = /^[a-z0-9_-]{21}$/i;\nconst jwtRegex = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]*$/;\nconst durationRegex = /^[-+]?P(?!$)(?:(?:[-+]?\\d+Y)|(?:[-+]?\\d+[.,]\\d+Y$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:(?:[-+]?\\d+W)|(?:[-+]?\\d+[.,]\\d+W$))?(?:(?:[-+]?\\d+D)|(?:[-+]?\\d+[.,]\\d+D$))?(?:T(?=[\\d+-])(?:(?:[-+]?\\d+H)|(?:[-+]?\\d+[.,]\\d+H$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:[-+]?\\d+(?:[.,]\\d+)?S)?)??$/;\n// from https://stackoverflow.com/a/46181/1550155\n// old version: too slow, didn't support unicode\n// const emailRegex = /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i;\n//old email regex\n// const emailRegex = /^(([^<>()[\\].,;:\\s@\"]+(\\.[^<>()[\\].,;:\\s@\"]+)*)|(\".+\"))@((?!-)([^<>()[\\].,;:\\s@\"]+\\.)+[^<>()[\\].,;:\\s@\"]{1,})[^-<>()[\\].,;:\\s@\"]$/i;\n// eslint-disable-next-line\n// const emailRegex =\n//   /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$/;\n// const emailRegex =\n//   /^[a-zA-Z0-9\\.\\!\\#\\$\\%\\&\\'\\*\\+\\/\\=\\?\\^\\_\\`\\{\\|\\}\\~\\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n// const emailRegex =\n//   /^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])$/i;\nconst emailRegex = /^(?!\\.)(?!.*\\.\\.)([A-Z0-9_'+\\-\\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\\-]*\\.)+[A-Z]{2,}$/i;\n// const emailRegex =\n//   /^[a-z0-9.!#$%&*+/=?^_`{|}~-]+@[a-z0-9-]+(?:\\.[a-z0-9\\-]+)*$/i;\n// from https://thekevinscott.com/emojis-in-javascript/#writing-a-regular-expression\nconst _emojiRegex = `^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$`;\nlet emojiRegex;\n// faster, simpler, safer\nconst ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/;\nconst ipv4CidrRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/(3[0-2]|[12]?[0-9])$/;\n// const ipv6Regex =\n// /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;\nconst ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;\nconst ipv6CidrRegex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/;\n// https://stackoverflow.com/questions/7860392/determine-if-string-is-in-base64-using-javascript\nconst base64Regex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n// https://base64.guru/standards/base64url\nconst base64urlRegex = /^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/;\n// simple\n// const dateRegexSource = `\\\\d{4}-\\\\d{2}-\\\\d{2}`;\n// no leap year validation\n// const dateRegexSource = `\\\\d{4}-((0[13578]|10|12)-31|(0[13-9]|1[0-2])-30|(0[1-9]|1[0-2])-(0[1-9]|1\\\\d|2\\\\d))`;\n// with leap year validation\nconst dateRegexSource = `((\\\\d\\\\d[2468][048]|\\\\d\\\\d[13579][26]|\\\\d\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\\\d|30)|(02)-(0[1-9]|1\\\\d|2[0-8])))`;\nconst dateRegex = new RegExp(`^${dateRegexSource}$`);\nfunction timeRegexSource(args) {\n    // let regex = `\\\\d{2}:\\\\d{2}:\\\\d{2}`;\n    let regex = `([01]\\\\d|2[0-3]):[0-5]\\\\d:[0-5]\\\\d`;\n    if (args.precision) {\n        regex = `${regex}\\\\.\\\\d{${args.precision}}`;\n    }\n    else if (args.precision == null) {\n        regex = `${regex}(\\\\.\\\\d+)?`;\n    }\n    return regex;\n}\nfunction timeRegex(args) {\n    return new RegExp(`^${timeRegexSource(args)}$`);\n}\n// Adapted from https://stackoverflow.com/a/3143231\nfunction datetimeRegex(args) {\n    let regex = `${dateRegexSource}T${timeRegexSource(args)}`;\n    const opts = [];\n    opts.push(args.local ? `Z?` : `Z`);\n    if (args.offset)\n        opts.push(`([+-]\\\\d{2}:?\\\\d{2})`);\n    regex = `${regex}(${opts.join(\"|\")})`;\n    return new RegExp(`^${regex}$`);\n}\nexports.datetimeRegex = datetimeRegex;\nfunction isValidIP(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4Regex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6Regex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nfunction isValidJWT(jwt, alg) {\n    if (!jwtRegex.test(jwt))\n        return false;\n    try {\n        const [header] = jwt.split(\".\");\n        // Convert base64url to base64\n        const base64 = header\n            .replace(/-/g, \"+\")\n            .replace(/_/g, \"/\")\n            .padEnd(header.length + ((4 - (header.length % 4)) % 4), \"=\");\n        const decoded = JSON.parse(atob(base64));\n        if (typeof decoded !== \"object\" || decoded === null)\n            return false;\n        if (!decoded.typ || !decoded.alg)\n            return false;\n        if (alg && decoded.alg !== alg)\n            return false;\n        return true;\n    }\n    catch (_a) {\n        return false;\n    }\n}\nfunction isValidCidr(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4CidrRegex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6CidrRegex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nclass ZodString extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = String(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.string) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.string,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        const status = new parseUtil_1.ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.length < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.length > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"length\") {\n                const tooBig = input.data.length > check.value;\n                const tooSmall = input.data.length < check.value;\n                if (tooBig || tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    if (tooBig) {\n                        (0, parseUtil_1.addIssueToContext)(ctx, {\n                            code: ZodError_1.ZodIssueCode.too_big,\n                            maximum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    else if (tooSmall) {\n                        (0, parseUtil_1.addIssueToContext)(ctx, {\n                            code: ZodError_1.ZodIssueCode.too_small,\n                            minimum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"email\") {\n                if (!emailRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"email\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"emoji\") {\n                if (!emojiRegex) {\n                    emojiRegex = new RegExp(_emojiRegex, \"u\");\n                }\n                if (!emojiRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"emoji\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"uuid\") {\n                if (!uuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"uuid\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"nanoid\") {\n                if (!nanoidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"nanoid\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid\") {\n                if (!cuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"cuid\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid2\") {\n                if (!cuid2Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"cuid2\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ulid\") {\n                if (!ulidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"ulid\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"url\") {\n                try {\n                    new URL(input.data);\n                }\n                catch (_a) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"url\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"regex\") {\n                check.regex.lastIndex = 0;\n                const testResult = check.regex.test(input.data);\n                if (!testResult) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"regex\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"trim\") {\n                input.data = input.data.trim();\n            }\n            else if (check.kind === \"includes\") {\n                if (!input.data.includes(check.value, check.position)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        validation: { includes: check.value, position: check.position },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"toLowerCase\") {\n                input.data = input.data.toLowerCase();\n            }\n            else if (check.kind === \"toUpperCase\") {\n                input.data = input.data.toUpperCase();\n            }\n            else if (check.kind === \"startsWith\") {\n                if (!input.data.startsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        validation: { startsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"endsWith\") {\n                if (!input.data.endsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        validation: { endsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"datetime\") {\n                const regex = datetimeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        validation: \"datetime\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"date\") {\n                const regex = dateRegex;\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        validation: \"date\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"time\") {\n                const regex = timeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        validation: \"time\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"duration\") {\n                if (!durationRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"duration\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ip\") {\n                if (!isValidIP(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"ip\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"jwt\") {\n                if (!isValidJWT(input.data, check.alg)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"jwt\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cidr\") {\n                if (!isValidCidr(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"cidr\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64\") {\n                if (!base64Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"base64\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64url\") {\n                if (!base64urlRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        validation: \"base64url\",\n                        code: ZodError_1.ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util_1.util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _regex(regex, validation, message) {\n        return this.refinement((data) => regex.test(data), {\n            validation,\n            code: ZodError_1.ZodIssueCode.invalid_string,\n            ...errorUtil_1.errorUtil.errToObj(message),\n        });\n    }\n    _addCheck(check) {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    email(message) {\n        return this._addCheck({ kind: \"email\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    url(message) {\n        return this._addCheck({ kind: \"url\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    emoji(message) {\n        return this._addCheck({ kind: \"emoji\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    uuid(message) {\n        return this._addCheck({ kind: \"uuid\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    nanoid(message) {\n        return this._addCheck({ kind: \"nanoid\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    cuid(message) {\n        return this._addCheck({ kind: \"cuid\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    cuid2(message) {\n        return this._addCheck({ kind: \"cuid2\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    ulid(message) {\n        return this._addCheck({ kind: \"ulid\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    base64(message) {\n        return this._addCheck({ kind: \"base64\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    base64url(message) {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return this._addCheck({\n            kind: \"base64url\",\n            ...errorUtil_1.errorUtil.errToObj(message),\n        });\n    }\n    jwt(options) {\n        return this._addCheck({ kind: \"jwt\", ...errorUtil_1.errorUtil.errToObj(options) });\n    }\n    ip(options) {\n        return this._addCheck({ kind: \"ip\", ...errorUtil_1.errorUtil.errToObj(options) });\n    }\n    cidr(options) {\n        return this._addCheck({ kind: \"cidr\", ...errorUtil_1.errorUtil.errToObj(options) });\n    }\n    datetime(options) {\n        var _a, _b;\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"datetime\",\n                precision: null,\n                offset: false,\n                local: false,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"datetime\",\n            precision: typeof (options === null || options === void 0 ? void 0 : options.precision) === \"undefined\" ? null : options === null || options === void 0 ? void 0 : options.precision,\n            offset: (_a = options === null || options === void 0 ? void 0 : options.offset) !== null && _a !== void 0 ? _a : false,\n            local: (_b = options === null || options === void 0 ? void 0 : options.local) !== null && _b !== void 0 ? _b : false,\n            ...errorUtil_1.errorUtil.errToObj(options === null || options === void 0 ? void 0 : options.message),\n        });\n    }\n    date(message) {\n        return this._addCheck({ kind: \"date\", message });\n    }\n    time(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"time\",\n                precision: null,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"time\",\n            precision: typeof (options === null || options === void 0 ? void 0 : options.precision) === \"undefined\" ? null : options === null || options === void 0 ? void 0 : options.precision,\n            ...errorUtil_1.errorUtil.errToObj(options === null || options === void 0 ? void 0 : options.message),\n        });\n    }\n    duration(message) {\n        return this._addCheck({ kind: \"duration\", ...errorUtil_1.errorUtil.errToObj(message) });\n    }\n    regex(regex, message) {\n        return this._addCheck({\n            kind: \"regex\",\n            regex: regex,\n            ...errorUtil_1.errorUtil.errToObj(message),\n        });\n    }\n    includes(value, options) {\n        return this._addCheck({\n            kind: \"includes\",\n            value: value,\n            position: options === null || options === void 0 ? void 0 : options.position,\n            ...errorUtil_1.errorUtil.errToObj(options === null || options === void 0 ? void 0 : options.message),\n        });\n    }\n    startsWith(value, message) {\n        return this._addCheck({\n            kind: \"startsWith\",\n            value: value,\n            ...errorUtil_1.errorUtil.errToObj(message),\n        });\n    }\n    endsWith(value, message) {\n        return this._addCheck({\n            kind: \"endsWith\",\n            value: value,\n            ...errorUtil_1.errorUtil.errToObj(message),\n        });\n    }\n    min(minLength, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minLength,\n            ...errorUtil_1.errorUtil.errToObj(message),\n        });\n    }\n    max(maxLength, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxLength,\n            ...errorUtil_1.errorUtil.errToObj(message),\n        });\n    }\n    length(len, message) {\n        return this._addCheck({\n            kind: \"length\",\n            value: len,\n            ...errorUtil_1.errorUtil.errToObj(message),\n        });\n    }\n    /**\n     * Equivalent to `.min(1)`\n     */\n    nonempty(message) {\n        return this.min(1, errorUtil_1.errorUtil.errToObj(message));\n    }\n    trim() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"trim\" }],\n        });\n    }\n    toLowerCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toLowerCase\" }],\n        });\n    }\n    toUpperCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toUpperCase\" }],\n        });\n    }\n    get isDatetime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"datetime\");\n    }\n    get isDate() {\n        return !!this._def.checks.find((ch) => ch.kind === \"date\");\n    }\n    get isTime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"time\");\n    }\n    get isDuration() {\n        return !!this._def.checks.find((ch) => ch.kind === \"duration\");\n    }\n    get isEmail() {\n        return !!this._def.checks.find((ch) => ch.kind === \"email\");\n    }\n    get isURL() {\n        return !!this._def.checks.find((ch) => ch.kind === \"url\");\n    }\n    get isEmoji() {\n        return !!this._def.checks.find((ch) => ch.kind === \"emoji\");\n    }\n    get isUUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"uuid\");\n    }\n    get isNANOID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"nanoid\");\n    }\n    get isCUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid\");\n    }\n    get isCUID2() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid2\");\n    }\n    get isULID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ulid\");\n    }\n    get isIP() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ip\");\n    }\n    get isCIDR() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cidr\");\n    }\n    get isBase64() {\n        return !!this._def.checks.find((ch) => ch.kind === \"base64\");\n    }\n    get isBase64url() {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return !!this._def.checks.find((ch) => ch.kind === \"base64url\");\n    }\n    get minLength() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxLength() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nexports.ZodString = ZodString;\nZodString.create = (params) => {\n    var _a;\n    return new ZodString({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodString,\n        coerce: (_a = params === null || params === void 0 ? void 0 : params.coerce) !== null && _a !== void 0 ? _a : false,\n        ...processCreateParams(params),\n    });\n};\n// https://stackoverflow.com/questions/3966484/why-does-modulus-operator-return-fractional-number-in-javascript/31711034#31711034\nfunction floatSafeRemainder(val, step) {\n    const valDecCount = (val.toString().split(\".\")[1] || \"\").length;\n    const stepDecCount = (step.toString().split(\".\")[1] || \"\").length;\n    const decCount = valDecCount > stepDecCount ? valDecCount : stepDecCount;\n    const valInt = parseInt(val.toFixed(decCount).replace(\".\", \"\"));\n    const stepInt = parseInt(step.toFixed(decCount).replace(\".\", \"\"));\n    return (valInt % stepInt) / Math.pow(10, decCount);\n}\nclass ZodNumber extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n        this.step = this.multipleOf;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Number(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.number) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.number,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        let ctx = undefined;\n        const status = new parseUtil_1.ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"int\") {\n                if (!util_1.util.isInteger(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.invalid_type,\n                        expected: \"integer\",\n                        received: \"float\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"min\") {\n                const tooSmall = check.inclusive\n                    ? input.data < check.value\n                    : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive\n                    ? input.data > check.value\n                    : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (floatSafeRemainder(input.data, check.value) !== 0) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"finite\") {\n                if (!Number.isFinite(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.not_finite,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util_1.util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil_1.errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil_1.errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil_1.errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil_1.errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil_1.errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    int(message) {\n        return this._addCheck({\n            kind: \"int\",\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value: value,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    finite(message) {\n        return this._addCheck({\n            kind: \"finite\",\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    safe(message) {\n        return this._addCheck({\n            kind: \"min\",\n            inclusive: true,\n            value: Number.MIN_SAFE_INTEGER,\n            message: errorUtil_1.errorUtil.toString(message),\n        })._addCheck({\n            kind: \"max\",\n            inclusive: true,\n            value: Number.MAX_SAFE_INTEGER,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n    get isInt() {\n        return !!this._def.checks.find((ch) => ch.kind === \"int\" ||\n            (ch.kind === \"multipleOf\" && util_1.util.isInteger(ch.value)));\n    }\n    get isFinite() {\n        let max = null, min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"finite\" ||\n                ch.kind === \"int\" ||\n                ch.kind === \"multipleOf\") {\n                return true;\n            }\n            else if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n            else if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return Number.isFinite(min) && Number.isFinite(max);\n    }\n}\nexports.ZodNumber = ZodNumber;\nZodNumber.create = (params) => {\n    return new ZodNumber({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodNumber,\n        coerce: (params === null || params === void 0 ? void 0 : params.coerce) || false,\n        ...processCreateParams(params),\n    });\n};\nclass ZodBigInt extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            try {\n                input.data = BigInt(input.data);\n            }\n            catch (_a) {\n                return this._getInvalidInput(input);\n            }\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.bigint) {\n            return this._getInvalidInput(input);\n        }\n        let ctx = undefined;\n        const status = new parseUtil_1.ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                const tooSmall = check.inclusive\n                    ? input.data < check.value\n                    : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.too_small,\n                        type: \"bigint\",\n                        minimum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive\n                    ? input.data > check.value\n                    : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.too_big,\n                        type: \"bigint\",\n                        maximum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (input.data % check.value !== BigInt(0)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util_1.util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _getInvalidInput(input) {\n        const ctx = this._getOrReturnCtx(input);\n        (0, parseUtil_1.addIssueToContext)(ctx, {\n            code: ZodError_1.ZodIssueCode.invalid_type,\n            expected: util_1.ZodParsedType.bigint,\n            received: ctx.parsedType,\n        });\n        return parseUtil_1.INVALID;\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil_1.errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil_1.errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil_1.errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil_1.errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil_1.errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value,\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nexports.ZodBigInt = ZodBigInt;\nZodBigInt.create = (params) => {\n    var _a;\n    return new ZodBigInt({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodBigInt,\n        coerce: (_a = params === null || params === void 0 ? void 0 : params.coerce) !== null && _a !== void 0 ? _a : false,\n        ...processCreateParams(params),\n    });\n};\nclass ZodBoolean extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Boolean(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.boolean) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.boolean,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return (0, parseUtil_1.OK)(input.data);\n    }\n}\nexports.ZodBoolean = ZodBoolean;\nZodBoolean.create = (params) => {\n    return new ZodBoolean({\n        typeName: ZodFirstPartyTypeKind.ZodBoolean,\n        coerce: (params === null || params === void 0 ? void 0 : params.coerce) || false,\n        ...processCreateParams(params),\n    });\n};\nclass ZodDate extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = new Date(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.date) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.date,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        if (isNaN(input.data.getTime())) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_date,\n            });\n            return parseUtil_1.INVALID;\n        }\n        const status = new parseUtil_1.ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.getTime() < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.too_small,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        minimum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.getTime() > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.too_big,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        maximum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util_1.util.assertNever(check);\n            }\n        }\n        return {\n            status: status.value,\n            value: new Date(input.data.getTime()),\n        };\n    }\n    _addCheck(check) {\n        return new ZodDate({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    min(minDate, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minDate.getTime(),\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    max(maxDate, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxDate.getTime(),\n            message: errorUtil_1.errorUtil.toString(message),\n        });\n    }\n    get minDate() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min != null ? new Date(min) : null;\n    }\n    get maxDate() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max != null ? new Date(max) : null;\n    }\n}\nexports.ZodDate = ZodDate;\nZodDate.create = (params) => {\n    return new ZodDate({\n        checks: [],\n        coerce: (params === null || params === void 0 ? void 0 : params.coerce) || false,\n        typeName: ZodFirstPartyTypeKind.ZodDate,\n        ...processCreateParams(params),\n    });\n};\nclass ZodSymbol extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.symbol) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.symbol,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return (0, parseUtil_1.OK)(input.data);\n    }\n}\nexports.ZodSymbol = ZodSymbol;\nZodSymbol.create = (params) => {\n    return new ZodSymbol({\n        typeName: ZodFirstPartyTypeKind.ZodSymbol,\n        ...processCreateParams(params),\n    });\n};\nclass ZodUndefined extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.undefined,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return (0, parseUtil_1.OK)(input.data);\n    }\n}\nexports.ZodUndefined = ZodUndefined;\nZodUndefined.create = (params) => {\n    return new ZodUndefined({\n        typeName: ZodFirstPartyTypeKind.ZodUndefined,\n        ...processCreateParams(params),\n    });\n};\nclass ZodNull extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.null) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.null,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return (0, parseUtil_1.OK)(input.data);\n    }\n}\nexports.ZodNull = ZodNull;\nZodNull.create = (params) => {\n    return new ZodNull({\n        typeName: ZodFirstPartyTypeKind.ZodNull,\n        ...processCreateParams(params),\n    });\n};\nclass ZodAny extends ZodType {\n    constructor() {\n        super(...arguments);\n        // to prevent instances of other classes from extending ZodAny. this causes issues with catchall in ZodObject.\n        this._any = true;\n    }\n    _parse(input) {\n        return (0, parseUtil_1.OK)(input.data);\n    }\n}\nexports.ZodAny = ZodAny;\nZodAny.create = (params) => {\n    return new ZodAny({\n        typeName: ZodFirstPartyTypeKind.ZodAny,\n        ...processCreateParams(params),\n    });\n};\nclass ZodUnknown extends ZodType {\n    constructor() {\n        super(...arguments);\n        // required\n        this._unknown = true;\n    }\n    _parse(input) {\n        return (0, parseUtil_1.OK)(input.data);\n    }\n}\nexports.ZodUnknown = ZodUnknown;\nZodUnknown.create = (params) => {\n    return new ZodUnknown({\n        typeName: ZodFirstPartyTypeKind.ZodUnknown,\n        ...processCreateParams(params),\n    });\n};\nclass ZodNever extends ZodType {\n    _parse(input) {\n        const ctx = this._getOrReturnCtx(input);\n        (0, parseUtil_1.addIssueToContext)(ctx, {\n            code: ZodError_1.ZodIssueCode.invalid_type,\n            expected: util_1.ZodParsedType.never,\n            received: ctx.parsedType,\n        });\n        return parseUtil_1.INVALID;\n    }\n}\nexports.ZodNever = ZodNever;\nZodNever.create = (params) => {\n    return new ZodNever({\n        typeName: ZodFirstPartyTypeKind.ZodNever,\n        ...processCreateParams(params),\n    });\n};\nclass ZodVoid extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.void,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return (0, parseUtil_1.OK)(input.data);\n    }\n}\nexports.ZodVoid = ZodVoid;\nZodVoid.create = (params) => {\n    return new ZodVoid({\n        typeName: ZodFirstPartyTypeKind.ZodVoid,\n        ...processCreateParams(params),\n    });\n};\nclass ZodArray extends ZodType {\n    _parse(input) {\n        const { ctx, status } = this._processInputParams(input);\n        const def = this._def;\n        if (ctx.parsedType !== util_1.ZodParsedType.array) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        if (def.exactLength !== null) {\n            const tooBig = ctx.data.length > def.exactLength.value;\n            const tooSmall = ctx.data.length < def.exactLength.value;\n            if (tooBig || tooSmall) {\n                (0, parseUtil_1.addIssueToContext)(ctx, {\n                    code: tooBig ? ZodError_1.ZodIssueCode.too_big : ZodError_1.ZodIssueCode.too_small,\n                    minimum: (tooSmall ? def.exactLength.value : undefined),\n                    maximum: (tooBig ? def.exactLength.value : undefined),\n                    type: \"array\",\n                    inclusive: true,\n                    exact: true,\n                    message: def.exactLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.minLength !== null) {\n            if (ctx.data.length < def.minLength.value) {\n                (0, parseUtil_1.addIssueToContext)(ctx, {\n                    code: ZodError_1.ZodIssueCode.too_small,\n                    minimum: def.minLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxLength !== null) {\n            if (ctx.data.length > def.maxLength.value) {\n                (0, parseUtil_1.addIssueToContext)(ctx, {\n                    code: ZodError_1.ZodIssueCode.too_big,\n                    maximum: def.maxLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.all([...ctx.data].map((item, i) => {\n                return def.type._parseAsync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n            })).then((result) => {\n                return parseUtil_1.ParseStatus.mergeArray(status, result);\n            });\n        }\n        const result = [...ctx.data].map((item, i) => {\n            return def.type._parseSync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n        });\n        return parseUtil_1.ParseStatus.mergeArray(status, result);\n    }\n    get element() {\n        return this._def.type;\n    }\n    min(minLength, message) {\n        return new ZodArray({\n            ...this._def,\n            minLength: { value: minLength, message: errorUtil_1.errorUtil.toString(message) },\n        });\n    }\n    max(maxLength, message) {\n        return new ZodArray({\n            ...this._def,\n            maxLength: { value: maxLength, message: errorUtil_1.errorUtil.toString(message) },\n        });\n    }\n    length(len, message) {\n        return new ZodArray({\n            ...this._def,\n            exactLength: { value: len, message: errorUtil_1.errorUtil.toString(message) },\n        });\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nexports.ZodArray = ZodArray;\nZodArray.create = (schema, params) => {\n    return new ZodArray({\n        type: schema,\n        minLength: null,\n        maxLength: null,\n        exactLength: null,\n        typeName: ZodFirstPartyTypeKind.ZodArray,\n        ...processCreateParams(params),\n    });\n};\nfunction deepPartialify(schema) {\n    if (schema instanceof ZodObject) {\n        const newShape = {};\n        for (const key in schema.shape) {\n            const fieldSchema = schema.shape[key];\n            newShape[key] = ZodOptional.create(deepPartialify(fieldSchema));\n        }\n        return new ZodObject({\n            ...schema._def,\n            shape: () => newShape,\n        });\n    }\n    else if (schema instanceof ZodArray) {\n        return new ZodArray({\n            ...schema._def,\n            type: deepPartialify(schema.element),\n        });\n    }\n    else if (schema instanceof ZodOptional) {\n        return ZodOptional.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodNullable) {\n        return ZodNullable.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodTuple) {\n        return ZodTuple.create(schema.items.map((item) => deepPartialify(item)));\n    }\n    else {\n        return schema;\n    }\n}\nclass ZodObject extends ZodType {\n    constructor() {\n        super(...arguments);\n        this._cached = null;\n        /**\n         * @deprecated In most cases, this is no longer needed - unknown properties are now silently stripped.\n         * If you want to pass through unknown properties, use `.passthrough()` instead.\n         */\n        this.nonstrict = this.passthrough;\n        // extend<\n        //   Augmentation extends ZodRawShape,\n        //   NewOutput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_output\"]\n        //       : k extends keyof Output\n        //       ? Output[k]\n        //       : never;\n        //   }>,\n        //   NewInput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_input\"]\n        //       : k extends keyof Input\n        //       ? Input[k]\n        //       : never;\n        //   }>\n        // >(\n        //   augmentation: Augmentation\n        // ): ZodObject<\n        //   extendShape<T, Augmentation>,\n        //   UnknownKeys,\n        //   Catchall,\n        //   NewOutput,\n        //   NewInput\n        // > {\n        //   return new ZodObject({\n        //     ...this._def,\n        //     shape: () => ({\n        //       ...this._def.shape(),\n        //       ...augmentation,\n        //     }),\n        //   }) as any;\n        // }\n        /**\n         * @deprecated Use `.extend` instead\n         *  */\n        this.augment = this.extend;\n    }\n    _getCached() {\n        if (this._cached !== null)\n            return this._cached;\n        const shape = this._def.shape();\n        const keys = util_1.util.objectKeys(shape);\n        return (this._cached = { shape, keys });\n    }\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.object) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        const { status, ctx } = this._processInputParams(input);\n        const { shape, keys: shapeKeys } = this._getCached();\n        const extraKeys = [];\n        if (!(this._def.catchall instanceof ZodNever &&\n            this._def.unknownKeys === \"strip\")) {\n            for (const key in ctx.data) {\n                if (!shapeKeys.includes(key)) {\n                    extraKeys.push(key);\n                }\n            }\n        }\n        const pairs = [];\n        for (const key of shapeKeys) {\n            const keyValidator = shape[key];\n            const value = ctx.data[key];\n            pairs.push({\n                key: { status: \"valid\", value: key },\n                value: keyValidator._parse(new ParseInputLazyPath(ctx, value, ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (this._def.catchall instanceof ZodNever) {\n            const unknownKeys = this._def.unknownKeys;\n            if (unknownKeys === \"passthrough\") {\n                for (const key of extraKeys) {\n                    pairs.push({\n                        key: { status: \"valid\", value: key },\n                        value: { status: \"valid\", value: ctx.data[key] },\n                    });\n                }\n            }\n            else if (unknownKeys === \"strict\") {\n                if (extraKeys.length > 0) {\n                    (0, parseUtil_1.addIssueToContext)(ctx, {\n                        code: ZodError_1.ZodIssueCode.unrecognized_keys,\n                        keys: extraKeys,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (unknownKeys === \"strip\") {\n            }\n            else {\n                throw new Error(`Internal ZodObject error: invalid unknownKeys value.`);\n            }\n        }\n        else {\n            // run catchall validation\n            const catchall = this._def.catchall;\n            for (const key of extraKeys) {\n                const value = ctx.data[key];\n                pairs.push({\n                    key: { status: \"valid\", value: key },\n                    value: catchall._parse(new ParseInputLazyPath(ctx, value, ctx.path, key) //, ctx.child(key), value, getParsedType(value)\n                    ),\n                    alwaysSet: key in ctx.data,\n                });\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.resolve()\n                .then(async () => {\n                const syncPairs = [];\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    syncPairs.push({\n                        key,\n                        value,\n                        alwaysSet: pair.alwaysSet,\n                    });\n                }\n                return syncPairs;\n            })\n                .then((syncPairs) => {\n                return parseUtil_1.ParseStatus.mergeObjectSync(status, syncPairs);\n            });\n        }\n        else {\n            return parseUtil_1.ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get shape() {\n        return this._def.shape();\n    }\n    strict(message) {\n        errorUtil_1.errorUtil.errToObj;\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strict\",\n            ...(message !== undefined\n                ? {\n                    errorMap: (issue, ctx) => {\n                        var _a, _b, _c, _d;\n                        const defaultError = (_c = (_b = (_a = this._def).errorMap) === null || _b === void 0 ? void 0 : _b.call(_a, issue, ctx).message) !== null && _c !== void 0 ? _c : ctx.defaultError;\n                        if (issue.code === \"unrecognized_keys\")\n                            return {\n                                message: (_d = errorUtil_1.errorUtil.errToObj(message).message) !== null && _d !== void 0 ? _d : defaultError,\n                            };\n                        return {\n                            message: defaultError,\n                        };\n                    },\n                }\n                : {}),\n        });\n    }\n    strip() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strip\",\n        });\n    }\n    passthrough() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"passthrough\",\n        });\n    }\n    // const AugmentFactory =\n    //   <Def extends ZodObjectDef>(def: Def) =>\n    //   <Augmentation extends ZodRawShape>(\n    //     augmentation: Augmentation\n    //   ): ZodObject<\n    //     extendShape<ReturnType<Def[\"shape\"]>, Augmentation>,\n    //     Def[\"unknownKeys\"],\n    //     Def[\"catchall\"]\n    //   > => {\n    //     return new ZodObject({\n    //       ...def,\n    //       shape: () => ({\n    //         ...def.shape(),\n    //         ...augmentation,\n    //       }),\n    //     }) as any;\n    //   };\n    extend(augmentation) {\n        return new ZodObject({\n            ...this._def,\n            shape: () => ({\n                ...this._def.shape(),\n                ...augmentation,\n            }),\n        });\n    }\n    /**\n     * Prior to zod@1.0.12 there was a bug in the\n     * inferred type of merged objects. Please\n     * upgrade if you are experiencing issues.\n     */\n    merge(merging) {\n        const merged = new ZodObject({\n            unknownKeys: merging._def.unknownKeys,\n            catchall: merging._def.catchall,\n            shape: () => ({\n                ...this._def.shape(),\n                ...merging._def.shape(),\n            }),\n            typeName: ZodFirstPartyTypeKind.ZodObject,\n        });\n        return merged;\n    }\n    // merge<\n    //   Incoming extends AnyZodObject,\n    //   Augmentation extends Incoming[\"shape\"],\n    //   NewOutput extends {\n    //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_output\"]\n    //       : k extends keyof Output\n    //       ? Output[k]\n    //       : never;\n    //   },\n    //   NewInput extends {\n    //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_input\"]\n    //       : k extends keyof Input\n    //       ? Input[k]\n    //       : never;\n    //   }\n    // >(\n    //   merging: Incoming\n    // ): ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"],\n    //   NewOutput,\n    //   NewInput\n    // > {\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    setKey(key, schema) {\n        return this.augment({ [key]: schema });\n    }\n    // merge<Incoming extends AnyZodObject>(\n    //   merging: Incoming\n    // ): //ZodObject<T & Incoming[\"_shape\"], UnknownKeys, Catchall> = (merging) => {\n    // ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"]\n    // > {\n    //   // const mergedShape = objectUtil.mergeShapes(\n    //   //   this._def.shape(),\n    //   //   merging._def.shape()\n    //   // );\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    catchall(index) {\n        return new ZodObject({\n            ...this._def,\n            catchall: index,\n        });\n    }\n    pick(mask) {\n        const shape = {};\n        util_1.util.objectKeys(mask).forEach((key) => {\n            if (mask[key] && this.shape[key]) {\n                shape[key] = this.shape[key];\n            }\n        });\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    omit(mask) {\n        const shape = {};\n        util_1.util.objectKeys(this.shape).forEach((key) => {\n            if (!mask[key]) {\n                shape[key] = this.shape[key];\n            }\n        });\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    /**\n     * @deprecated\n     */\n    deepPartial() {\n        return deepPartialify(this);\n    }\n    partial(mask) {\n        const newShape = {};\n        util_1.util.objectKeys(this.shape).forEach((key) => {\n            const fieldSchema = this.shape[key];\n            if (mask && !mask[key]) {\n                newShape[key] = fieldSchema;\n            }\n            else {\n                newShape[key] = fieldSchema.optional();\n            }\n        });\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    required(mask) {\n        const newShape = {};\n        util_1.util.objectKeys(this.shape).forEach((key) => {\n            if (mask && !mask[key]) {\n                newShape[key] = this.shape[key];\n            }\n            else {\n                const fieldSchema = this.shape[key];\n                let newField = fieldSchema;\n                while (newField instanceof ZodOptional) {\n                    newField = newField._def.innerType;\n                }\n                newShape[key] = newField;\n            }\n        });\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    keyof() {\n        return createZodEnum(util_1.util.objectKeys(this.shape));\n    }\n}\nexports.ZodObject = ZodObject;\nZodObject.create = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.strictCreate = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strict\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.lazycreate = (shape, params) => {\n    return new ZodObject({\n        shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nclass ZodUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const options = this._def.options;\n        function handleResults(results) {\n            // return first issue-free validation if it exists\n            for (const result of results) {\n                if (result.result.status === \"valid\") {\n                    return result.result;\n                }\n            }\n            for (const result of results) {\n                if (result.result.status === \"dirty\") {\n                    // add issues from dirty option\n                    ctx.common.issues.push(...result.ctx.common.issues);\n                    return result.result;\n                }\n            }\n            // return invalid\n            const unionErrors = results.map((result) => new ZodError_1.ZodError(result.ctx.common.issues));\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return parseUtil_1.INVALID;\n        }\n        if (ctx.common.async) {\n            return Promise.all(options.map(async (option) => {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                return {\n                    result: await option._parseAsync({\n                        data: ctx.data,\n                        path: ctx.path,\n                        parent: childCtx,\n                    }),\n                    ctx: childCtx,\n                };\n            })).then(handleResults);\n        }\n        else {\n            let dirty = undefined;\n            const issues = [];\n            for (const option of options) {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                const result = option._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: childCtx,\n                });\n                if (result.status === \"valid\") {\n                    return result;\n                }\n                else if (result.status === \"dirty\" && !dirty) {\n                    dirty = { result, ctx: childCtx };\n                }\n                if (childCtx.common.issues.length) {\n                    issues.push(childCtx.common.issues);\n                }\n            }\n            if (dirty) {\n                ctx.common.issues.push(...dirty.ctx.common.issues);\n                return dirty.result;\n            }\n            const unionErrors = issues.map((issues) => new ZodError_1.ZodError(issues));\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return parseUtil_1.INVALID;\n        }\n    }\n    get options() {\n        return this._def.options;\n    }\n}\nexports.ZodUnion = ZodUnion;\nZodUnion.create = (types, params) => {\n    return new ZodUnion({\n        options: types,\n        typeName: ZodFirstPartyTypeKind.ZodUnion,\n        ...processCreateParams(params),\n    });\n};\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\n//////////                                 //////////\n//////////      ZodDiscriminatedUnion      //////////\n//////////                                 //////////\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\nconst getDiscriminator = (type) => {\n    if (type instanceof ZodLazy) {\n        return getDiscriminator(type.schema);\n    }\n    else if (type instanceof ZodEffects) {\n        return getDiscriminator(type.innerType());\n    }\n    else if (type instanceof ZodLiteral) {\n        return [type.value];\n    }\n    else if (type instanceof ZodEnum) {\n        return type.options;\n    }\n    else if (type instanceof ZodNativeEnum) {\n        // eslint-disable-next-line ban/ban\n        return util_1.util.objectValues(type.enum);\n    }\n    else if (type instanceof ZodDefault) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else if (type instanceof ZodUndefined) {\n        return [undefined];\n    }\n    else if (type instanceof ZodNull) {\n        return [null];\n    }\n    else if (type instanceof ZodOptional) {\n        return [undefined, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodNullable) {\n        return [null, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodBranded) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodReadonly) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodCatch) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else {\n        return [];\n    }\n};\nclass ZodDiscriminatedUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== util_1.ZodParsedType.object) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        const discriminator = this.discriminator;\n        const discriminatorValue = ctx.data[discriminator];\n        const option = this.optionsMap.get(discriminatorValue);\n        if (!option) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_union_discriminator,\n                options: Array.from(this.optionsMap.keys()),\n                path: [discriminator],\n            });\n            return parseUtil_1.INVALID;\n        }\n        if (ctx.common.async) {\n            return option._parseAsync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n        else {\n            return option._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n    }\n    get discriminator() {\n        return this._def.discriminator;\n    }\n    get options() {\n        return this._def.options;\n    }\n    get optionsMap() {\n        return this._def.optionsMap;\n    }\n    /**\n     * The constructor of the discriminated union schema. Its behaviour is very similar to that of the normal z.union() constructor.\n     * However, it only allows a union of objects, all of which need to share a discriminator property. This property must\n     * have a different value for each object in the union.\n     * @param discriminator the name of the discriminator property\n     * @param types an array of object schemas\n     * @param params\n     */\n    static create(discriminator, options, params) {\n        // Get all the valid discriminator values\n        const optionsMap = new Map();\n        // try {\n        for (const type of options) {\n            const discriminatorValues = getDiscriminator(type.shape[discriminator]);\n            if (!discriminatorValues.length) {\n                throw new Error(`A discriminator value for key \\`${discriminator}\\` could not be extracted from all schema options`);\n            }\n            for (const value of discriminatorValues) {\n                if (optionsMap.has(value)) {\n                    throw new Error(`Discriminator property ${String(discriminator)} has duplicate value ${String(value)}`);\n                }\n                optionsMap.set(value, type);\n            }\n        }\n        return new ZodDiscriminatedUnion({\n            typeName: ZodFirstPartyTypeKind.ZodDiscriminatedUnion,\n            discriminator,\n            options,\n            optionsMap,\n            ...processCreateParams(params),\n        });\n    }\n}\nexports.ZodDiscriminatedUnion = ZodDiscriminatedUnion;\nfunction mergeValues(a, b) {\n    const aType = (0, util_1.getParsedType)(a);\n    const bType = (0, util_1.getParsedType)(b);\n    if (a === b) {\n        return { valid: true, data: a };\n    }\n    else if (aType === util_1.ZodParsedType.object && bType === util_1.ZodParsedType.object) {\n        const bKeys = util_1.util.objectKeys(b);\n        const sharedKeys = util_1.util\n            .objectKeys(a)\n            .filter((key) => bKeys.indexOf(key) !== -1);\n        const newObj = { ...a, ...b };\n        for (const key of sharedKeys) {\n            const sharedValue = mergeValues(a[key], b[key]);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newObj[key] = sharedValue.data;\n        }\n        return { valid: true, data: newObj };\n    }\n    else if (aType === util_1.ZodParsedType.array && bType === util_1.ZodParsedType.array) {\n        if (a.length !== b.length) {\n            return { valid: false };\n        }\n        const newArray = [];\n        for (let index = 0; index < a.length; index++) {\n            const itemA = a[index];\n            const itemB = b[index];\n            const sharedValue = mergeValues(itemA, itemB);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newArray.push(sharedValue.data);\n        }\n        return { valid: true, data: newArray };\n    }\n    else if (aType === util_1.ZodParsedType.date &&\n        bType === util_1.ZodParsedType.date &&\n        +a === +b) {\n        return { valid: true, data: a };\n    }\n    else {\n        return { valid: false };\n    }\n}\nclass ZodIntersection extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const handleParsed = (parsedLeft, parsedRight) => {\n            if ((0, parseUtil_1.isAborted)(parsedLeft) || (0, parseUtil_1.isAborted)(parsedRight)) {\n                return parseUtil_1.INVALID;\n            }\n            const merged = mergeValues(parsedLeft.value, parsedRight.value);\n            if (!merged.valid) {\n                (0, parseUtil_1.addIssueToContext)(ctx, {\n                    code: ZodError_1.ZodIssueCode.invalid_intersection_types,\n                });\n                return parseUtil_1.INVALID;\n            }\n            if ((0, parseUtil_1.isDirty)(parsedLeft) || (0, parseUtil_1.isDirty)(parsedRight)) {\n                status.dirty();\n            }\n            return { status: status.value, value: merged.data };\n        };\n        if (ctx.common.async) {\n            return Promise.all([\n                this._def.left._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n                this._def.right._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n            ]).then(([left, right]) => handleParsed(left, right));\n        }\n        else {\n            return handleParsed(this._def.left._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }), this._def.right._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }));\n        }\n    }\n}\nexports.ZodIntersection = ZodIntersection;\nZodIntersection.create = (left, right, params) => {\n    return new ZodIntersection({\n        left: left,\n        right: right,\n        typeName: ZodFirstPartyTypeKind.ZodIntersection,\n        ...processCreateParams(params),\n    });\n};\nclass ZodTuple extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== util_1.ZodParsedType.array) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        if (ctx.data.length < this._def.items.length) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.too_small,\n                minimum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            return parseUtil_1.INVALID;\n        }\n        const rest = this._def.rest;\n        if (!rest && ctx.data.length > this._def.items.length) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.too_big,\n                maximum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            status.dirty();\n        }\n        const items = [...ctx.data]\n            .map((item, itemIndex) => {\n            const schema = this._def.items[itemIndex] || this._def.rest;\n            if (!schema)\n                return null;\n            return schema._parse(new ParseInputLazyPath(ctx, item, ctx.path, itemIndex));\n        })\n            .filter((x) => !!x); // filter nulls\n        if (ctx.common.async) {\n            return Promise.all(items).then((results) => {\n                return parseUtil_1.ParseStatus.mergeArray(status, results);\n            });\n        }\n        else {\n            return parseUtil_1.ParseStatus.mergeArray(status, items);\n        }\n    }\n    get items() {\n        return this._def.items;\n    }\n    rest(rest) {\n        return new ZodTuple({\n            ...this._def,\n            rest,\n        });\n    }\n}\nexports.ZodTuple = ZodTuple;\nZodTuple.create = (schemas, params) => {\n    if (!Array.isArray(schemas)) {\n        throw new Error(\"You must pass an array of schemas to z.tuple([ ... ])\");\n    }\n    return new ZodTuple({\n        items: schemas,\n        typeName: ZodFirstPartyTypeKind.ZodTuple,\n        rest: null,\n        ...processCreateParams(params),\n    });\n};\nclass ZodRecord extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== util_1.ZodParsedType.object) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        const pairs = [];\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        for (const key in ctx.data) {\n            pairs.push({\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, key)),\n                value: valueType._parse(new ParseInputLazyPath(ctx, ctx.data[key], ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (ctx.common.async) {\n            return parseUtil_1.ParseStatus.mergeObjectAsync(status, pairs);\n        }\n        else {\n            return parseUtil_1.ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get element() {\n        return this._def.valueType;\n    }\n    static create(first, second, third) {\n        if (second instanceof ZodType) {\n            return new ZodRecord({\n                keyType: first,\n                valueType: second,\n                typeName: ZodFirstPartyTypeKind.ZodRecord,\n                ...processCreateParams(third),\n            });\n        }\n        return new ZodRecord({\n            keyType: ZodString.create(),\n            valueType: first,\n            typeName: ZodFirstPartyTypeKind.ZodRecord,\n            ...processCreateParams(second),\n        });\n    }\n}\nexports.ZodRecord = ZodRecord;\nclass ZodMap extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== util_1.ZodParsedType.map) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.map,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        const pairs = [...ctx.data.entries()].map(([key, value], index) => {\n            return {\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, [index, \"key\"])),\n                value: valueType._parse(new ParseInputLazyPath(ctx, value, ctx.path, [index, \"value\"])),\n            };\n        });\n        if (ctx.common.async) {\n            const finalMap = new Map();\n            return Promise.resolve().then(async () => {\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    if (key.status === \"aborted\" || value.status === \"aborted\") {\n                        return parseUtil_1.INVALID;\n                    }\n                    if (key.status === \"dirty\" || value.status === \"dirty\") {\n                        status.dirty();\n                    }\n                    finalMap.set(key.value, value.value);\n                }\n                return { status: status.value, value: finalMap };\n            });\n        }\n        else {\n            const finalMap = new Map();\n            for (const pair of pairs) {\n                const key = pair.key;\n                const value = pair.value;\n                if (key.status === \"aborted\" || value.status === \"aborted\") {\n                    return parseUtil_1.INVALID;\n                }\n                if (key.status === \"dirty\" || value.status === \"dirty\") {\n                    status.dirty();\n                }\n                finalMap.set(key.value, value.value);\n            }\n            return { status: status.value, value: finalMap };\n        }\n    }\n}\nexports.ZodMap = ZodMap;\nZodMap.create = (keyType, valueType, params) => {\n    return new ZodMap({\n        valueType,\n        keyType,\n        typeName: ZodFirstPartyTypeKind.ZodMap,\n        ...processCreateParams(params),\n    });\n};\nclass ZodSet extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== util_1.ZodParsedType.set) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.set,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        const def = this._def;\n        if (def.minSize !== null) {\n            if (ctx.data.size < def.minSize.value) {\n                (0, parseUtil_1.addIssueToContext)(ctx, {\n                    code: ZodError_1.ZodIssueCode.too_small,\n                    minimum: def.minSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minSize.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxSize !== null) {\n            if (ctx.data.size > def.maxSize.value) {\n                (0, parseUtil_1.addIssueToContext)(ctx, {\n                    code: ZodError_1.ZodIssueCode.too_big,\n                    maximum: def.maxSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxSize.message,\n                });\n                status.dirty();\n            }\n        }\n        const valueType = this._def.valueType;\n        function finalizeSet(elements) {\n            const parsedSet = new Set();\n            for (const element of elements) {\n                if (element.status === \"aborted\")\n                    return parseUtil_1.INVALID;\n                if (element.status === \"dirty\")\n                    status.dirty();\n                parsedSet.add(element.value);\n            }\n            return { status: status.value, value: parsedSet };\n        }\n        const elements = [...ctx.data.values()].map((item, i) => valueType._parse(new ParseInputLazyPath(ctx, item, ctx.path, i)));\n        if (ctx.common.async) {\n            return Promise.all(elements).then((elements) => finalizeSet(elements));\n        }\n        else {\n            return finalizeSet(elements);\n        }\n    }\n    min(minSize, message) {\n        return new ZodSet({\n            ...this._def,\n            minSize: { value: minSize, message: errorUtil_1.errorUtil.toString(message) },\n        });\n    }\n    max(maxSize, message) {\n        return new ZodSet({\n            ...this._def,\n            maxSize: { value: maxSize, message: errorUtil_1.errorUtil.toString(message) },\n        });\n    }\n    size(size, message) {\n        return this.min(size, message).max(size, message);\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nexports.ZodSet = ZodSet;\nZodSet.create = (valueType, params) => {\n    return new ZodSet({\n        valueType,\n        minSize: null,\n        maxSize: null,\n        typeName: ZodFirstPartyTypeKind.ZodSet,\n        ...processCreateParams(params),\n    });\n};\nclass ZodFunction extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.validate = this.implement;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== util_1.ZodParsedType.function) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.function,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        function makeArgsIssue(args, error) {\n            return (0, parseUtil_1.makeIssue)({\n                data: args,\n                path: ctx.path,\n                errorMaps: [\n                    ctx.common.contextualErrorMap,\n                    ctx.schemaErrorMap,\n                    (0, errors_1.getErrorMap)(),\n                    errors_1.defaultErrorMap,\n                ].filter((x) => !!x),\n                issueData: {\n                    code: ZodError_1.ZodIssueCode.invalid_arguments,\n                    argumentsError: error,\n                },\n            });\n        }\n        function makeReturnsIssue(returns, error) {\n            return (0, parseUtil_1.makeIssue)({\n                data: returns,\n                path: ctx.path,\n                errorMaps: [\n                    ctx.common.contextualErrorMap,\n                    ctx.schemaErrorMap,\n                    (0, errors_1.getErrorMap)(),\n                    errors_1.defaultErrorMap,\n                ].filter((x) => !!x),\n                issueData: {\n                    code: ZodError_1.ZodIssueCode.invalid_return_type,\n                    returnTypeError: error,\n                },\n            });\n        }\n        const params = { errorMap: ctx.common.contextualErrorMap };\n        const fn = ctx.data;\n        if (this._def.returns instanceof ZodPromise) {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return (0, parseUtil_1.OK)(async function (...args) {\n                const error = new ZodError_1.ZodError([]);\n                const parsedArgs = await me._def.args\n                    .parseAsync(args, params)\n                    .catch((e) => {\n                    error.addIssue(makeArgsIssue(args, e));\n                    throw error;\n                });\n                const result = await Reflect.apply(fn, this, parsedArgs);\n                const parsedReturns = await me._def.returns._def.type\n                    .parseAsync(result, params)\n                    .catch((e) => {\n                    error.addIssue(makeReturnsIssue(result, e));\n                    throw error;\n                });\n                return parsedReturns;\n            });\n        }\n        else {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return (0, parseUtil_1.OK)(function (...args) {\n                const parsedArgs = me._def.args.safeParse(args, params);\n                if (!parsedArgs.success) {\n                    throw new ZodError_1.ZodError([makeArgsIssue(args, parsedArgs.error)]);\n                }\n                const result = Reflect.apply(fn, this, parsedArgs.data);\n                const parsedReturns = me._def.returns.safeParse(result, params);\n                if (!parsedReturns.success) {\n                    throw new ZodError_1.ZodError([makeReturnsIssue(result, parsedReturns.error)]);\n                }\n                return parsedReturns.data;\n            });\n        }\n    }\n    parameters() {\n        return this._def.args;\n    }\n    returnType() {\n        return this._def.returns;\n    }\n    args(...items) {\n        return new ZodFunction({\n            ...this._def,\n            args: ZodTuple.create(items).rest(ZodUnknown.create()),\n        });\n    }\n    returns(returnType) {\n        return new ZodFunction({\n            ...this._def,\n            returns: returnType,\n        });\n    }\n    implement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    strictImplement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    static create(args, returns, params) {\n        return new ZodFunction({\n            args: (args\n                ? args\n                : ZodTuple.create([]).rest(ZodUnknown.create())),\n            returns: returns || ZodUnknown.create(),\n            typeName: ZodFirstPartyTypeKind.ZodFunction,\n            ...processCreateParams(params),\n        });\n    }\n}\nexports.ZodFunction = ZodFunction;\nclass ZodLazy extends ZodType {\n    get schema() {\n        return this._def.getter();\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const lazySchema = this._def.getter();\n        return lazySchema._parse({ data: ctx.data, path: ctx.path, parent: ctx });\n    }\n}\nexports.ZodLazy = ZodLazy;\nZodLazy.create = (getter, params) => {\n    return new ZodLazy({\n        getter: getter,\n        typeName: ZodFirstPartyTypeKind.ZodLazy,\n        ...processCreateParams(params),\n    });\n};\nclass ZodLiteral extends ZodType {\n    _parse(input) {\n        if (input.data !== this._def.value) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                received: ctx.data,\n                code: ZodError_1.ZodIssueCode.invalid_literal,\n                expected: this._def.value,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n    get value() {\n        return this._def.value;\n    }\n}\nexports.ZodLiteral = ZodLiteral;\nZodLiteral.create = (value, params) => {\n    return new ZodLiteral({\n        value: value,\n        typeName: ZodFirstPartyTypeKind.ZodLiteral,\n        ...processCreateParams(params),\n    });\n};\nfunction createZodEnum(values, params) {\n    return new ZodEnum({\n        values,\n        typeName: ZodFirstPartyTypeKind.ZodEnum,\n        ...processCreateParams(params),\n    });\n}\nclass ZodEnum extends ZodType {\n    constructor() {\n        super(...arguments);\n        _ZodEnum_cache.set(this, void 0);\n    }\n    _parse(input) {\n        if (typeof input.data !== \"string\") {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                expected: util_1.util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodError_1.ZodIssueCode.invalid_type,\n            });\n            return parseUtil_1.INVALID;\n        }\n        if (!__classPrivateFieldGet(this, _ZodEnum_cache, \"f\")) {\n            __classPrivateFieldSet(this, _ZodEnum_cache, new Set(this._def.values), \"f\");\n        }\n        if (!__classPrivateFieldGet(this, _ZodEnum_cache, \"f\").has(input.data)) {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                received: ctx.data,\n                code: ZodError_1.ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return (0, parseUtil_1.OK)(input.data);\n    }\n    get options() {\n        return this._def.values;\n    }\n    get enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Values() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    extract(values, newDef = this._def) {\n        return ZodEnum.create(values, {\n            ...this._def,\n            ...newDef,\n        });\n    }\n    exclude(values, newDef = this._def) {\n        return ZodEnum.create(this.options.filter((opt) => !values.includes(opt)), {\n            ...this._def,\n            ...newDef,\n        });\n    }\n}\nexports.ZodEnum = ZodEnum;\n_ZodEnum_cache = new WeakMap();\nZodEnum.create = createZodEnum;\nclass ZodNativeEnum extends ZodType {\n    constructor() {\n        super(...arguments);\n        _ZodNativeEnum_cache.set(this, void 0);\n    }\n    _parse(input) {\n        const nativeEnumValues = util_1.util.getValidEnumValues(this._def.values);\n        const ctx = this._getOrReturnCtx(input);\n        if (ctx.parsedType !== util_1.ZodParsedType.string &&\n            ctx.parsedType !== util_1.ZodParsedType.number) {\n            const expectedValues = util_1.util.objectValues(nativeEnumValues);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                expected: util_1.util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodError_1.ZodIssueCode.invalid_type,\n            });\n            return parseUtil_1.INVALID;\n        }\n        if (!__classPrivateFieldGet(this, _ZodNativeEnum_cache, \"f\")) {\n            __classPrivateFieldSet(this, _ZodNativeEnum_cache, new Set(util_1.util.getValidEnumValues(this._def.values)), \"f\");\n        }\n        if (!__classPrivateFieldGet(this, _ZodNativeEnum_cache, \"f\").has(input.data)) {\n            const expectedValues = util_1.util.objectValues(nativeEnumValues);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                received: ctx.data,\n                code: ZodError_1.ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return (0, parseUtil_1.OK)(input.data);\n    }\n    get enum() {\n        return this._def.values;\n    }\n}\nexports.ZodNativeEnum = ZodNativeEnum;\n_ZodNativeEnum_cache = new WeakMap();\nZodNativeEnum.create = (values, params) => {\n    return new ZodNativeEnum({\n        values: values,\n        typeName: ZodFirstPartyTypeKind.ZodNativeEnum,\n        ...processCreateParams(params),\n    });\n};\nclass ZodPromise extends ZodType {\n    unwrap() {\n        return this._def.type;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== util_1.ZodParsedType.promise &&\n            ctx.common.async === false) {\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.promise,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        const promisified = ctx.parsedType === util_1.ZodParsedType.promise\n            ? ctx.data\n            : Promise.resolve(ctx.data);\n        return (0, parseUtil_1.OK)(promisified.then((data) => {\n            return this._def.type.parseAsync(data, {\n                path: ctx.path,\n                errorMap: ctx.common.contextualErrorMap,\n            });\n        }));\n    }\n}\nexports.ZodPromise = ZodPromise;\nZodPromise.create = (schema, params) => {\n    return new ZodPromise({\n        type: schema,\n        typeName: ZodFirstPartyTypeKind.ZodPromise,\n        ...processCreateParams(params),\n    });\n};\nclass ZodEffects extends ZodType {\n    innerType() {\n        return this._def.schema;\n    }\n    sourceType() {\n        return this._def.schema._def.typeName === ZodFirstPartyTypeKind.ZodEffects\n            ? this._def.schema.sourceType()\n            : this._def.schema;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const effect = this._def.effect || null;\n        const checkCtx = {\n            addIssue: (arg) => {\n                (0, parseUtil_1.addIssueToContext)(ctx, arg);\n                if (arg.fatal) {\n                    status.abort();\n                }\n                else {\n                    status.dirty();\n                }\n            },\n            get path() {\n                return ctx.path;\n            },\n        };\n        checkCtx.addIssue = checkCtx.addIssue.bind(checkCtx);\n        if (effect.type === \"preprocess\") {\n            const processed = effect.transform(ctx.data, checkCtx);\n            if (ctx.common.async) {\n                return Promise.resolve(processed).then(async (processed) => {\n                    if (status.value === \"aborted\")\n                        return parseUtil_1.INVALID;\n                    const result = await this._def.schema._parseAsync({\n                        data: processed,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                    if (result.status === \"aborted\")\n                        return parseUtil_1.INVALID;\n                    if (result.status === \"dirty\")\n                        return (0, parseUtil_1.DIRTY)(result.value);\n                    if (status.value === \"dirty\")\n                        return (0, parseUtil_1.DIRTY)(result.value);\n                    return result;\n                });\n            }\n            else {\n                if (status.value === \"aborted\")\n                    return parseUtil_1.INVALID;\n                const result = this._def.schema._parseSync({\n                    data: processed,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (result.status === \"aborted\")\n                    return parseUtil_1.INVALID;\n                if (result.status === \"dirty\")\n                    return (0, parseUtil_1.DIRTY)(result.value);\n                if (status.value === \"dirty\")\n                    return (0, parseUtil_1.DIRTY)(result.value);\n                return result;\n            }\n        }\n        if (effect.type === \"refinement\") {\n            const executeRefinement = (acc) => {\n                const result = effect.refinement(acc, checkCtx);\n                if (ctx.common.async) {\n                    return Promise.resolve(result);\n                }\n                if (result instanceof Promise) {\n                    throw new Error(\"Async refinement encountered during synchronous parse operation. Use .parseAsync instead.\");\n                }\n                return acc;\n            };\n            if (ctx.common.async === false) {\n                const inner = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inner.status === \"aborted\")\n                    return parseUtil_1.INVALID;\n                if (inner.status === \"dirty\")\n                    status.dirty();\n                // return value is ignored\n                executeRefinement(inner.value);\n                return { status: status.value, value: inner.value };\n            }\n            else {\n                return this._def.schema\n                    ._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx })\n                    .then((inner) => {\n                    if (inner.status === \"aborted\")\n                        return parseUtil_1.INVALID;\n                    if (inner.status === \"dirty\")\n                        status.dirty();\n                    return executeRefinement(inner.value).then(() => {\n                        return { status: status.value, value: inner.value };\n                    });\n                });\n            }\n        }\n        if (effect.type === \"transform\") {\n            if (ctx.common.async === false) {\n                const base = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (!(0, parseUtil_1.isValid)(base))\n                    return base;\n                const result = effect.transform(base.value, checkCtx);\n                if (result instanceof Promise) {\n                    throw new Error(`Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.`);\n                }\n                return { status: status.value, value: result };\n            }\n            else {\n                return this._def.schema\n                    ._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx })\n                    .then((base) => {\n                    if (!(0, parseUtil_1.isValid)(base))\n                        return base;\n                    return Promise.resolve(effect.transform(base.value, checkCtx)).then((result) => ({ status: status.value, value: result }));\n                });\n            }\n        }\n        util_1.util.assertNever(effect);\n    }\n}\nexports.ZodEffects = ZodEffects;\nexports.ZodTransformer = ZodEffects;\nZodEffects.create = (schema, effect, params) => {\n    return new ZodEffects({\n        schema,\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        effect,\n        ...processCreateParams(params),\n    });\n};\nZodEffects.createWithPreprocess = (preprocess, schema, params) => {\n    return new ZodEffects({\n        schema,\n        effect: { type: \"preprocess\", transform: preprocess },\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        ...processCreateParams(params),\n    });\n};\nclass ZodOptional extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === util_1.ZodParsedType.undefined) {\n            return (0, parseUtil_1.OK)(undefined);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nexports.ZodOptional = ZodOptional;\nZodOptional.create = (type, params) => {\n    return new ZodOptional({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodOptional,\n        ...processCreateParams(params),\n    });\n};\nclass ZodNullable extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === util_1.ZodParsedType.null) {\n            return (0, parseUtil_1.OK)(null);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nexports.ZodNullable = ZodNullable;\nZodNullable.create = (type, params) => {\n    return new ZodNullable({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodNullable,\n        ...processCreateParams(params),\n    });\n};\nclass ZodDefault extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        let data = ctx.data;\n        if (ctx.parsedType === util_1.ZodParsedType.undefined) {\n            data = this._def.defaultValue();\n        }\n        return this._def.innerType._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    removeDefault() {\n        return this._def.innerType;\n    }\n}\nexports.ZodDefault = ZodDefault;\nZodDefault.create = (type, params) => {\n    return new ZodDefault({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodDefault,\n        defaultValue: typeof params.default === \"function\"\n            ? params.default\n            : () => params.default,\n        ...processCreateParams(params),\n    });\n};\nclass ZodCatch extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        // newCtx is used to not collect issues from inner types in ctx\n        const newCtx = {\n            ...ctx,\n            common: {\n                ...ctx.common,\n                issues: [],\n            },\n        };\n        const result = this._def.innerType._parse({\n            data: newCtx.data,\n            path: newCtx.path,\n            parent: {\n                ...newCtx,\n            },\n        });\n        if ((0, parseUtil_1.isAsync)(result)) {\n            return result.then((result) => {\n                return {\n                    status: \"valid\",\n                    value: result.status === \"valid\"\n                        ? result.value\n                        : this._def.catchValue({\n                            get error() {\n                                return new ZodError_1.ZodError(newCtx.common.issues);\n                            },\n                            input: newCtx.data,\n                        }),\n                };\n            });\n        }\n        else {\n            return {\n                status: \"valid\",\n                value: result.status === \"valid\"\n                    ? result.value\n                    : this._def.catchValue({\n                        get error() {\n                            return new ZodError_1.ZodError(newCtx.common.issues);\n                        },\n                        input: newCtx.data,\n                    }),\n            };\n        }\n    }\n    removeCatch() {\n        return this._def.innerType;\n    }\n}\nexports.ZodCatch = ZodCatch;\nZodCatch.create = (type, params) => {\n    return new ZodCatch({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodCatch,\n        catchValue: typeof params.catch === \"function\" ? params.catch : () => params.catch,\n        ...processCreateParams(params),\n    });\n};\nclass ZodNaN extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== util_1.ZodParsedType.nan) {\n            const ctx = this._getOrReturnCtx(input);\n            (0, parseUtil_1.addIssueToContext)(ctx, {\n                code: ZodError_1.ZodIssueCode.invalid_type,\n                expected: util_1.ZodParsedType.nan,\n                received: ctx.parsedType,\n            });\n            return parseUtil_1.INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n}\nexports.ZodNaN = ZodNaN;\nZodNaN.create = (params) => {\n    return new ZodNaN({\n        typeName: ZodFirstPartyTypeKind.ZodNaN,\n        ...processCreateParams(params),\n    });\n};\nexports.BRAND = Symbol(\"zod_brand\");\nclass ZodBranded extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const data = ctx.data;\n        return this._def.type._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    unwrap() {\n        return this._def.type;\n    }\n}\nexports.ZodBranded = ZodBranded;\nclass ZodPipeline extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.common.async) {\n            const handleAsync = async () => {\n                const inResult = await this._def.in._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inResult.status === \"aborted\")\n                    return parseUtil_1.INVALID;\n                if (inResult.status === \"dirty\") {\n                    status.dirty();\n                    return (0, parseUtil_1.DIRTY)(inResult.value);\n                }\n                else {\n                    return this._def.out._parseAsync({\n                        data: inResult.value,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                }\n            };\n            return handleAsync();\n        }\n        else {\n            const inResult = this._def.in._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n            if (inResult.status === \"aborted\")\n                return parseUtil_1.INVALID;\n            if (inResult.status === \"dirty\") {\n                status.dirty();\n                return {\n                    status: \"dirty\",\n                    value: inResult.value,\n                };\n            }\n            else {\n                return this._def.out._parseSync({\n                    data: inResult.value,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n            }\n        }\n    }\n    static create(a, b) {\n        return new ZodPipeline({\n            in: a,\n            out: b,\n            typeName: ZodFirstPartyTypeKind.ZodPipeline,\n        });\n    }\n}\nexports.ZodPipeline = ZodPipeline;\nclass ZodReadonly extends ZodType {\n    _parse(input) {\n        const result = this._def.innerType._parse(input);\n        const freeze = (data) => {\n            if ((0, parseUtil_1.isValid)(data)) {\n                data.value = Object.freeze(data.value);\n            }\n            return data;\n        };\n        return (0, parseUtil_1.isAsync)(result)\n            ? result.then((data) => freeze(data))\n            : freeze(result);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nexports.ZodReadonly = ZodReadonly;\nZodReadonly.create = (type, params) => {\n    return new ZodReadonly({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodReadonly,\n        ...processCreateParams(params),\n    });\n};\nfunction custom(check, params = {}, \n/**\n * @deprecated\n *\n * Pass `fatal` into the params object instead:\n *\n * ```ts\n * z.string().custom((val) => val.length > 5, { fatal: false })\n * ```\n *\n */\nfatal) {\n    if (check)\n        return ZodAny.create().superRefine((data, ctx) => {\n            var _a, _b;\n            if (!check(data)) {\n                const p = typeof params === \"function\"\n                    ? params(data)\n                    : typeof params === \"string\"\n                        ? { message: params }\n                        : params;\n                const _fatal = (_b = (_a = p.fatal) !== null && _a !== void 0 ? _a : fatal) !== null && _b !== void 0 ? _b : true;\n                const p2 = typeof p === \"string\" ? { message: p } : p;\n                ctx.addIssue({ code: \"custom\", ...p2, fatal: _fatal });\n            }\n        });\n    return ZodAny.create();\n}\nexports.custom = custom;\nexports.late = {\n    object: ZodObject.lazycreate,\n};\nvar ZodFirstPartyTypeKind;\n(function (ZodFirstPartyTypeKind) {\n    ZodFirstPartyTypeKind[\"ZodString\"] = \"ZodString\";\n    ZodFirstPartyTypeKind[\"ZodNumber\"] = \"ZodNumber\";\n    ZodFirstPartyTypeKind[\"ZodNaN\"] = \"ZodNaN\";\n    ZodFirstPartyTypeKind[\"ZodBigInt\"] = \"ZodBigInt\";\n    ZodFirstPartyTypeKind[\"ZodBoolean\"] = \"ZodBoolean\";\n    ZodFirstPartyTypeKind[\"ZodDate\"] = \"ZodDate\";\n    ZodFirstPartyTypeKind[\"ZodSymbol\"] = \"ZodSymbol\";\n    ZodFirstPartyTypeKind[\"ZodUndefined\"] = \"ZodUndefined\";\n    ZodFirstPartyTypeKind[\"ZodNull\"] = \"ZodNull\";\n    ZodFirstPartyTypeKind[\"ZodAny\"] = \"ZodAny\";\n    ZodFirstPartyTypeKind[\"ZodUnknown\"] = \"ZodUnknown\";\n    ZodFirstPartyTypeKind[\"ZodNever\"] = \"ZodNever\";\n    ZodFirstPartyTypeKind[\"ZodVoid\"] = \"ZodVoid\";\n    ZodFirstPartyTypeKind[\"ZodArray\"] = \"ZodArray\";\n    ZodFirstPartyTypeKind[\"ZodObject\"] = \"ZodObject\";\n    ZodFirstPartyTypeKind[\"ZodUnion\"] = \"ZodUnion\";\n    ZodFirstPartyTypeKind[\"ZodDiscriminatedUnion\"] = \"ZodDiscriminatedUnion\";\n    ZodFirstPartyTypeKind[\"ZodIntersection\"] = \"ZodIntersection\";\n    ZodFirstPartyTypeKind[\"ZodTuple\"] = \"ZodTuple\";\n    ZodFirstPartyTypeKind[\"ZodRecord\"] = \"ZodRecord\";\n    ZodFirstPartyTypeKind[\"ZodMap\"] = \"ZodMap\";\n    ZodFirstPartyTypeKind[\"ZodSet\"] = \"ZodSet\";\n    ZodFirstPartyTypeKind[\"ZodFunction\"] = \"ZodFunction\";\n    ZodFirstPartyTypeKind[\"ZodLazy\"] = \"ZodLazy\";\n    ZodFirstPartyTypeKind[\"ZodLiteral\"] = \"ZodLiteral\";\n    ZodFirstPartyTypeKind[\"ZodEnum\"] = \"ZodEnum\";\n    ZodFirstPartyTypeKind[\"ZodEffects\"] = \"ZodEffects\";\n    ZodFirstPartyTypeKind[\"ZodNativeEnum\"] = \"ZodNativeEnum\";\n    ZodFirstPartyTypeKind[\"ZodOptional\"] = \"ZodOptional\";\n    ZodFirstPartyTypeKind[\"ZodNullable\"] = \"ZodNullable\";\n    ZodFirstPartyTypeKind[\"ZodDefault\"] = \"ZodDefault\";\n    ZodFirstPartyTypeKind[\"ZodCatch\"] = \"ZodCatch\";\n    ZodFirstPartyTypeKind[\"ZodPromise\"] = \"ZodPromise\";\n    ZodFirstPartyTypeKind[\"ZodBranded\"] = \"ZodBranded\";\n    ZodFirstPartyTypeKind[\"ZodPipeline\"] = \"ZodPipeline\";\n    ZodFirstPartyTypeKind[\"ZodReadonly\"] = \"ZodReadonly\";\n})(ZodFirstPartyTypeKind || (exports.ZodFirstPartyTypeKind = ZodFirstPartyTypeKind = {}));\n// requires TS 4.4+\nclass Class {\n    constructor(..._) { }\n}\nconst instanceOfType = (\n// const instanceOfType = <T extends new (...args: any[]) => any>(\ncls, params = {\n    message: `Input not instance of ${cls.name}`,\n}) => custom((data) => data instanceof cls, params);\nexports.instanceof = instanceOfType;\nconst stringType = ZodString.create;\nexports.string = stringType;\nconst numberType = ZodNumber.create;\nexports.number = numberType;\nconst nanType = ZodNaN.create;\nexports.nan = nanType;\nconst bigIntType = ZodBigInt.create;\nexports.bigint = bigIntType;\nconst booleanType = ZodBoolean.create;\nexports.boolean = booleanType;\nconst dateType = ZodDate.create;\nexports.date = dateType;\nconst symbolType = ZodSymbol.create;\nexports.symbol = symbolType;\nconst undefinedType = ZodUndefined.create;\nexports.undefined = undefinedType;\nconst nullType = ZodNull.create;\nexports.null = nullType;\nconst anyType = ZodAny.create;\nexports.any = anyType;\nconst unknownType = ZodUnknown.create;\nexports.unknown = unknownType;\nconst neverType = ZodNever.create;\nexports.never = neverType;\nconst voidType = ZodVoid.create;\nexports.void = voidType;\nconst arrayType = ZodArray.create;\nexports.array = arrayType;\nconst objectType = ZodObject.create;\nexports.object = objectType;\nconst strictObjectType = ZodObject.strictCreate;\nexports.strictObject = strictObjectType;\nconst unionType = ZodUnion.create;\nexports.union = unionType;\nconst discriminatedUnionType = ZodDiscriminatedUnion.create;\nexports.discriminatedUnion = discriminatedUnionType;\nconst intersectionType = ZodIntersection.create;\nexports.intersection = intersectionType;\nconst tupleType = ZodTuple.create;\nexports.tuple = tupleType;\nconst recordType = ZodRecord.create;\nexports.record = recordType;\nconst mapType = ZodMap.create;\nexports.map = mapType;\nconst setType = ZodSet.create;\nexports.set = setType;\nconst functionType = ZodFunction.create;\nexports.function = functionType;\nconst lazyType = ZodLazy.create;\nexports.lazy = lazyType;\nconst literalType = ZodLiteral.create;\nexports.literal = literalType;\nconst enumType = ZodEnum.create;\nexports.enum = enumType;\nconst nativeEnumType = ZodNativeEnum.create;\nexports.nativeEnum = nativeEnumType;\nconst promiseType = ZodPromise.create;\nexports.promise = promiseType;\nconst effectsType = ZodEffects.create;\nexports.effect = effectsType;\nexports.transformer = effectsType;\nconst optionalType = ZodOptional.create;\nexports.optional = optionalType;\nconst nullableType = ZodNullable.create;\nexports.nullable = nullableType;\nconst preprocessType = ZodEffects.createWithPreprocess;\nexports.preprocess = preprocessType;\nconst pipelineType = ZodPipeline.create;\nexports.pipeline = pipelineType;\nconst ostring = () => stringType().optional();\nexports.ostring = ostring;\nconst onumber = () => numberType().optional();\nexports.onumber = onumber;\nconst oboolean = () => booleanType().optional();\nexports.oboolean = oboolean;\nexports.coerce = {\n    string: ((arg) => ZodString.create({ ...arg, coerce: true })),\n    number: ((arg) => ZodNumber.create({ ...arg, coerce: true })),\n    boolean: ((arg) => ZodBoolean.create({\n        ...arg,\n        coerce: true,\n    })),\n    bigint: ((arg) => ZodBigInt.create({ ...arg, coerce: true })),\n    date: ((arg) => ZodDate.create({ ...arg, coerce: true })),\n};\nexports.NEVER = parseUtil_1.INVALID;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4540, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4545, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/external.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./errors\"), exports);\n__exportStar(require(\"./helpers/parseUtil\"), exports);\n__exportStar(require(\"./helpers/typeAliases\"), exports);\n__exportStar(require(\"./helpers/util\"), exports);\n__exportStar(require(\"./types\"), exports);\n__exportStar(require(\"./ZodError\"), exports);\n"],"names":[],"mappings":"AAAA;AACA,IAAI,kBAAkB,AAAC,IAAI,IAAI,IAAI,CAAC,eAAe,IAAK,CAAC,OAAO,MAAM,GAAI,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IAC1F,IAAI,OAAO,WAAW,KAAK;IAC3B,IAAI,OAAO,OAAO,wBAAwB,CAAC,GAAG;IAC9C,IAAI,CAAC,QAAQ,CAAC,SAAS,OAAO,CAAC,EAAE,UAAU,GAAG,KAAK,QAAQ,IAAI,KAAK,YAAY,GAAG;QACjF,OAAO;YAAE,YAAY;YAAM,KAAK;gBAAa,OAAO,CAAC,CAAC,EAAE;YAAE;QAAE;IAC9D;IACA,OAAO,cAAc,CAAC,GAAG,IAAI;AACjC,IAAM,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IACtB,IAAI,OAAO,WAAW,KAAK;IAC3B,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE;AAChB,CAAE;AACF,IAAI,eAAe,AAAC,IAAI,IAAI,IAAI,CAAC,YAAY,IAAK,SAAS,CAAC,EAAE,QAAO;IACjE,IAAK,IAAI,KAAK,EAAG,IAAI,MAAM,aAAa,CAAC,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAS,IAAI,gBAAgB,UAAS,GAAG;AAC3H;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,uGAAkC;AAClC,kHAA6C;AAC7C,oHAA+C;AAC/C,6GAAwC;AACxC,sGAAiC;AACjC,yGAAoC","ignoreList":[0]}},
    {"offset": {"line": 4574, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4579, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/zod/lib/index.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.z = void 0;\nconst z = __importStar(require(\"./external\"));\nexports.z = z;\n__exportStar(require(\"./external\"), exports);\nexports.default = z;\n"],"names":[],"mappings":"AAAA;AACA,IAAI,kBAAkB,AAAC,IAAI,IAAI,IAAI,CAAC,eAAe,IAAK,CAAC,OAAO,MAAM,GAAI,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IAC1F,IAAI,OAAO,WAAW,KAAK;IAC3B,IAAI,OAAO,OAAO,wBAAwB,CAAC,GAAG;IAC9C,IAAI,CAAC,QAAQ,CAAC,SAAS,OAAO,CAAC,EAAE,UAAU,GAAG,KAAK,QAAQ,IAAI,KAAK,YAAY,GAAG;QACjF,OAAO;YAAE,YAAY;YAAM,KAAK;gBAAa,OAAO,CAAC,CAAC,EAAE;YAAE;QAAE;IAC9D;IACA,OAAO,cAAc,CAAC,GAAG,IAAI;AACjC,IAAM,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IACtB,IAAI,OAAO,WAAW,KAAK;IAC3B,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE;AAChB,CAAE;AACF,IAAI,qBAAqB,AAAC,IAAI,IAAI,IAAI,CAAC,kBAAkB,IAAK,CAAC,OAAO,MAAM,GAAI,SAAS,CAAC,EAAE,CAAC;IACzF,OAAO,cAAc,CAAC,GAAG,WAAW;QAAE,YAAY;QAAM,OAAO;IAAE;AACrE,IAAK,SAAS,CAAC,EAAE,CAAC;IACd,CAAC,CAAC,UAAU,GAAG;AACnB,CAAC;AACD,IAAI,eAAe,AAAC,IAAI,IAAI,IAAI,CAAC,YAAY,IAAK,SAAU,GAAG;IAC3D,IAAI,OAAO,IAAI,UAAU,EAAE,OAAO;IAClC,IAAI,SAAS,CAAC;IACd,IAAI,OAAO,MAAM;QAAA,IAAK,IAAI,KAAK,IAAK,IAAI,MAAM,aAAa,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,IAAI,gBAAgB,QAAQ,KAAK;IAAE;IACxI,mBAAmB,QAAQ;IAC3B,OAAO;AACX;AACA,IAAI,eAAe,AAAC,IAAI,IAAI,IAAI,CAAC,YAAY,IAAK,SAAS,CAAC,EAAE,QAAO;IACjE,IAAK,IAAI,KAAK,EAAG,IAAI,MAAM,aAAa,CAAC,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAS,IAAI,gBAAgB,UAAS,GAAG;AAC3H;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,CAAC,GAAG,KAAK;AACjB,MAAM,IAAI;AACV,QAAQ,CAAC,GAAG;AACZ,yGAAoC;AACpC,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4624, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4629, "column": 0}, "map": {"version":3,"file":"errors.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/errors.ts"],"sourcesContent":["export type ErrorOptions = { cause?: unknown }\n\nexport const ERR_JWKS_NO_MATCHING_KEY = 'ERR_JWKS_NO_MATCHING_KEY'\nexport const ERR_JWK_INVALID = 'ERR_JWK_INVALID'\nexport const ERR_JWK_NOT_FOUND = 'ERR_JWK_NOT_FOUND'\nexport const ERR_JWT_INVALID = 'ERR_JWT_INVALID'\nexport const ERR_JWT_CREATE = 'ERR_JWT_CREATE'\nexport const ERR_JWT_VERIFY = 'ERR_JWT_VERIFY'\n\nexport class JwkError extends TypeError {\n  constructor(\n    message = 'JWK error',\n    public readonly code = ERR_JWK_INVALID,\n    options?: ErrorOptions,\n  ) {\n    super(message, options)\n  }\n}\n\nexport class JwtCreateError extends Error {\n  constructor(\n    message = 'Unable to create JWT',\n    public readonly code = ERR_JWT_CREATE,\n    options?: ErrorOptions,\n  ) {\n    super(message, options)\n  }\n\n  static from(cause: unknown, code?: string, message?: string): JwtCreateError {\n    if (cause instanceof JwtCreateError) return cause\n    if (cause instanceof JwkError) {\n      return new JwtCreateError(message, cause.code, { cause })\n    }\n\n    return new JwtCreateError(message, code, { cause })\n  }\n}\n\nexport class JwtVerifyError extends Error {\n  constructor(\n    message = 'Invalid JWT',\n    public readonly code = ERR_JWT_VERIFY,\n    options?: ErrorOptions,\n  ) {\n    super(message, options)\n  }\n\n  static from(cause: unknown, code?: string, message?: string): JwtVerifyError {\n    if (cause instanceof JwtVerifyError) return cause\n    if (cause instanceof JwkError) {\n      return new JwtVerifyError(message, cause.code, { cause })\n    }\n\n    return new JwtVerifyError(message, code, { cause })\n  }\n}\n"],"names":[],"mappings":";;;;;AAEa,QAAA,wBAAwB,GAAG,0BAA0B,CAAA;AACrD,QAAA,eAAe,GAAG,iBAAiB,CAAA;AACnC,QAAA,iBAAiB,GAAG,mBAAmB,CAAA;AACvC,QAAA,eAAe,GAAG,iBAAiB,CAAA;AACnC,QAAA,cAAc,GAAG,gBAAgB,CAAA;AACjC,QAAA,cAAc,GAAG,gBAAgB,CAAA;AAE9C,MAAa,QAAS,SAAQ,SAAS;IACrC,YACE,OAAO,GAAG,WAAW,EACL,OAAO,QAAA,eAAe,EACtC,OAAsB,CAAA;QAEtB,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QAHvB,OAAA,cAAA,CAAA,IAAA,EAAA,QAAA;;;;mBAAgB,IAAI;WAAkB;IAIxC,CAAC;CACF;AARD,QAAA,QAAA,GAAA,SAQC;AAED,MAAa,cAAe,SAAQ,KAAK;IACvC,YACE,OAAO,GAAG,sBAAsB,EAChB,OAAO,QAAA,cAAc,EACrC,OAAsB,CAAA;QAEtB,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QAHvB,OAAA,cAAA,CAAA,IAAA,EAAA,QAAA;;;;mBAAgB,IAAI;WAAiB;IAIvC,CAAC;IAED,MAAM,CAAC,IAAI,CAAC,KAAc,EAAE,IAAa,EAAE,OAAgB,EAAA;QACzD,IAAI,KAAK,YAAY,cAAc,EAAE,OAAO,KAAK,CAAA;QACjD,IAAI,KAAK,YAAY,QAAQ,EAAE,CAAC;YAC9B,OAAO,IAAI,cAAc,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,EAAE;gBAAE,KAAK;YAAA,CAAE,CAAC,CAAA;QAC3D,CAAC;QAED,OAAO,IAAI,cAAc,CAAC,OAAO,EAAE,IAAI,EAAE;YAAE,KAAK;QAAA,CAAE,CAAC,CAAA;IACrD,CAAC;CACF;AAjBD,QAAA,cAAA,GAAA,eAiBC;AAED,MAAa,cAAe,SAAQ,KAAK;IACvC,YACE,OAAO,GAAG,aAAa,EACP,OAAO,QAAA,cAAc,EACrC,OAAsB,CAAA;QAEtB,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QAHvB,OAAA,cAAA,CAAA,IAAA,EAAA,QAAA;;;;mBAAgB,IAAI;WAAiB;IAIvC,CAAC;IAED,MAAM,CAAC,IAAI,CAAC,KAAc,EAAE,IAAa,EAAE,OAAgB,EAAA;QACzD,IAAI,KAAK,YAAY,cAAc,EAAE,OAAO,KAAK,CAAA;QACjD,IAAI,KAAK,YAAY,QAAQ,EAAE,CAAC;YAC9B,OAAO,IAAI,cAAc,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,EAAE;gBAAE,KAAK;YAAA,CAAE,CAAC,CAAA;QAC3D,CAAC;QAED,OAAO,IAAI,cAAc,CAAC,OAAO,EAAE,IAAI,EAAE;YAAE,KAAK;QAAA,CAAE,CAAC,CAAA;IACrD,CAAC;CACF;AAjBD,QAAA,cAAA,GAAA,eAiBC","ignoreList":[0]}},
    {"offset": {"line": 4698, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4703, "column": 0}, "map": {"version":3,"file":"alg.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/alg.ts"],"sourcesContent":["import { JwkError } from './errors.js'\nimport { Jwk } from './jwk.js'\n\n// Copy variable to prevent bundlers from automatically polyfilling \"process\" (e.g. parcel)\nconst { process } = globalThis\nconst IS_NODE_RUNTIME =\n  typeof process !== 'undefined' && typeof process?.versions?.node === 'string'\n\nexport function* jwkAlgorithms(jwk: Jwk): Generator<string> {\n  // Ed25519, Ed448, and secp256k1 always have \"alg\"\n  // OKP always has \"use\"\n  if (jwk.alg) {\n    yield jwk.alg\n    return\n  }\n\n  switch (jwk.kty) {\n    case 'EC': {\n      if (jwk.use === 'enc' || jwk.use === undefined) {\n        yield 'ECDH-ES'\n        yield 'ECDH-ES+A128KW'\n        yield 'ECDH-ES+A192KW'\n        yield 'ECDH-ES+A256KW'\n      }\n\n      if (jwk.use === 'sig' || jwk.use === undefined) {\n        const crv = 'crv' in jwk ? jwk.crv : undefined\n        switch (crv) {\n          case 'P-256':\n          case 'P-384':\n            yield `ES${crv.slice(-3)}`\n            break\n          case 'P-521':\n            yield 'ES512'\n            break\n          case 'secp256k1':\n            if (IS_NODE_RUNTIME) yield 'ES256K'\n            break\n          default:\n            throw new JwkError(`Unsupported crv \"${crv}\"`)\n        }\n      }\n\n      return\n    }\n\n    case 'OKP': {\n      if (!jwk.use) throw new JwkError('Missing \"use\" Parameter value')\n      yield 'ECDH-ES'\n      yield 'ECDH-ES+A128KW'\n      yield 'ECDH-ES+A192KW'\n      yield 'ECDH-ES+A256KW'\n      return\n    }\n\n    case 'RSA': {\n      if (jwk.use === 'enc' || jwk.use === undefined) {\n        yield 'RSA-OAEP'\n        yield 'RSA-OAEP-256'\n        yield 'RSA-OAEP-384'\n        yield 'RSA-OAEP-512'\n        if (IS_NODE_RUNTIME) yield 'RSA1_5'\n      }\n\n      if (jwk.use === 'sig' || jwk.use === undefined) {\n        yield 'PS256'\n        yield 'PS384'\n        yield 'PS512'\n        yield 'RS256'\n        yield 'RS384'\n        yield 'RS512'\n      }\n\n      return\n    }\n\n    case 'oct': {\n      if (jwk.use === 'enc' || jwk.use === undefined) {\n        yield 'A128GCMKW'\n        yield 'A192GCMKW'\n        yield 'A256GCMKW'\n        yield 'A128KW'\n        yield 'A192KW'\n        yield 'A256KW'\n      }\n\n      if (jwk.use === 'sig' || jwk.use === undefined) {\n        yield 'HS256'\n        yield 'HS384'\n        yield 'HS512'\n      }\n\n      return\n    }\n\n    default:\n      throw new JwkError(`Unsupported kty \"${jwk.kty}\"`)\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4796, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4801, "column": 0}, "map": {"version":3,"file":"jwk.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/jwk.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const keyUsageSchema = z.enum([\n  'sign',\n  'verify',\n  'encrypt',\n  'decrypt',\n  'wrapKey',\n  'unwrapKey',\n  'deriveKey',\n  'deriveBits',\n])\n\nexport type KeyUsage = z.infer<typeof keyUsageSchema>\n\n/**\n * The \"use\" and \"key_ops\" JWK members SHOULD NOT be used together;\n * however, if both are used, the information they convey MUST be\n * consistent.  Applications should specify which of these members they\n * use, if either is to be used by the application.\n *\n * @todo Actually check that \"use\" and \"key_ops\" are consistent when both are present.\n * @see {@link https://datatracker.ietf.org/doc/html/rfc7517#section-4.3}\n */\nexport const jwkBaseSchema = z.object({\n  kty: z.string().min(1),\n  alg: z.string().min(1).optional(),\n  kid: z.string().min(1).optional(),\n  ext: z.boolean().optional(),\n  use: z.enum(['sig', 'enc']).optional(),\n  key_ops: z.array(keyUsageSchema).optional(),\n\n  x5c: z.array(z.string()).optional(), // X.509 Certificate Chain\n  x5t: z.string().min(1).optional(), // X.509 Certificate SHA-1 Thumbprint\n  'x5t#S256': z.string().min(1).optional(), // X.509 Certificate SHA-256 Thumbprint\n  x5u: z.string().url().optional(), // X.509 URL\n})\n\n/**\n * @todo: properly implement this\n */\nexport const jwkRsaKeySchema = jwkBaseSchema.extend({\n  kty: z.literal('RSA'),\n  alg: z\n    .enum(['RS256', 'RS384', 'RS512', 'PS256', 'PS384', 'PS512'])\n    .optional(),\n\n  n: z.string().min(1), // Modulus\n  e: z.string().min(1), // Exponent\n\n  d: z.string().min(1).optional(), // Private Exponent\n  p: z.string().min(1).optional(), // First Prime Factor\n  q: z.string().min(1).optional(), // Second Prime Factor\n  dp: z.string().min(1).optional(), // First Factor CRT Exponent\n  dq: z.string().min(1).optional(), // Second Factor CRT Exponent\n  qi: z.string().min(1).optional(), // First CRT Coefficient\n  oth: z\n    .array(\n      z.object({\n        r: z.string().optional(),\n        d: z.string().optional(),\n        t: z.string().optional(),\n      }),\n    )\n    .nonempty()\n\n    .optional(), // Other Primes Info\n})\n\nexport const jwkEcKeySchema = jwkBaseSchema.extend({\n  kty: z.literal('EC'),\n  alg: z.enum(['ES256', 'ES384', 'ES512']).optional(),\n  crv: z.enum(['P-256', 'P-384', 'P-521']),\n\n  x: z.string().min(1),\n  y: z.string().min(1),\n\n  d: z.string().min(1).optional(), // ECC Private Key\n})\n\nexport const jwkEcSecp256k1KeySchema = jwkBaseSchema.extend({\n  kty: z.literal('EC'),\n  alg: z.enum(['ES256K']).optional(),\n  crv: z.enum(['secp256k1']),\n\n  x: z.string().min(1),\n  y: z.string().min(1),\n\n  d: z.string().min(1).optional(), // ECC Private Key\n})\n\nexport const jwkOkpKeySchema = jwkBaseSchema.extend({\n  kty: z.literal('OKP'),\n  alg: z.enum(['EdDSA']).optional(),\n  crv: z.enum(['Ed25519', 'Ed448']),\n\n  x: z.string().min(1),\n  d: z.string().min(1).optional(), // ECC Private Key\n})\n\nexport const jwkSymKeySchema = jwkBaseSchema.extend({\n  kty: z.literal('oct'), // Octet Sequence (used to represent symmetric keys)\n  alg: z.enum(['HS256', 'HS384', 'HS512']).optional(),\n\n  k: z.string(), // Key Value (base64url encoded)\n})\n\nexport const jwkUnknownKeySchema = jwkBaseSchema.extend({\n  kty: z\n    .string()\n    .refine((v) => v !== 'RSA' && v !== 'EC' && v !== 'OKP' && v !== 'oct'),\n})\n\nexport const jwkSchema = z.union([\n  jwkUnknownKeySchema,\n  jwkRsaKeySchema,\n  jwkEcKeySchema,\n  jwkEcSecp256k1KeySchema,\n  jwkOkpKeySchema,\n  jwkSymKeySchema,\n])\n\nexport type Jwk = z.infer<typeof jwkSchema>\n\nexport const jwkValidator = jwkSchema\n  .refine((k) => k.use != null || k.key_ops != null, 'use or key_ops required')\n  .refine(\n    (k) =>\n      !k.use ||\n      !k.key_ops ||\n      k.key_ops.every((o) =>\n        k.use === 'sig'\n          ? o === 'sign' || o === 'verify'\n          : o === 'encrypt' || o === 'decrypt',\n      ),\n    'use and key_ops must be consistent',\n  )\n\nexport const jwkPubSchema = jwkValidator\n  .refine((k) => k.kid != null, 'kid is required')\n  .refine((k) => !('k' in k) && !('d' in k), 'private key not allowed')\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4928, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4933, "column": 0}, "map": {"version":3,"file":"jwks.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/jwks.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { jwkPubSchema, jwkSchema } from './jwk.js'\n\nexport const jwksSchema = z.object({\n  keys: z.array(jwkSchema),\n})\n\nexport type Jwks = z.infer<typeof jwksSchema>\n\nexport const jwksPubSchema = z.object({\n  keys: z.array(jwkPubSchema),\n})\n\nexport type JwksPub = z.infer<typeof jwksPubSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB,MAAA,+BAAkD;AAErC,QAAA,UAAU,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACjC,IAAI,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,SAAA,SAAS,CAAC;CACzB,CAAC,CAAA;AAIW,QAAA,aAAa,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACpC,IAAI,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,SAAA,YAAY,CAAC;CAC5B,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 4946, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4951, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/multiformats/cjs/vendor/base-x.js"],"sourcesContent":["'use strict';\n\nfunction base(ALPHABET, name) {\n  if (ALPHABET.length >= 255) {\n    throw new TypeError('Alphabet too long');\n  }\n  var BASE_MAP = new Uint8Array(256);\n  for (var j = 0; j < BASE_MAP.length; j++) {\n    BASE_MAP[j] = 255;\n  }\n  for (var i = 0; i < ALPHABET.length; i++) {\n    var x = ALPHABET.charAt(i);\n    var xc = x.charCodeAt(0);\n    if (BASE_MAP[xc] !== 255) {\n      throw new TypeError(x + ' is ambiguous');\n    }\n    BASE_MAP[xc] = i;\n  }\n  var BASE = ALPHABET.length;\n  var LEADER = ALPHABET.charAt(0);\n  var FACTOR = Math.log(BASE) / Math.log(256);\n  var iFACTOR = Math.log(256) / Math.log(BASE);\n  function encode(source) {\n    if (source instanceof Uint8Array);\n    else if (ArrayBuffer.isView(source)) {\n      source = new Uint8Array(source.buffer, source.byteOffset, source.byteLength);\n    } else if (Array.isArray(source)) {\n      source = Uint8Array.from(source);\n    }\n    if (!(source instanceof Uint8Array)) {\n      throw new TypeError('Expected Uint8Array');\n    }\n    if (source.length === 0) {\n      return '';\n    }\n    var zeroes = 0;\n    var length = 0;\n    var pbegin = 0;\n    var pend = source.length;\n    while (pbegin !== pend && source[pbegin] === 0) {\n      pbegin++;\n      zeroes++;\n    }\n    var size = (pend - pbegin) * iFACTOR + 1 >>> 0;\n    var b58 = new Uint8Array(size);\n    while (pbegin !== pend) {\n      var carry = source[pbegin];\n      var i = 0;\n      for (var it1 = size - 1; (carry !== 0 || i < length) && it1 !== -1; it1--, i++) {\n        carry += 256 * b58[it1] >>> 0;\n        b58[it1] = carry % BASE >>> 0;\n        carry = carry / BASE >>> 0;\n      }\n      if (carry !== 0) {\n        throw new Error('Non-zero carry');\n      }\n      length = i;\n      pbegin++;\n    }\n    var it2 = size - length;\n    while (it2 !== size && b58[it2] === 0) {\n      it2++;\n    }\n    var str = LEADER.repeat(zeroes);\n    for (; it2 < size; ++it2) {\n      str += ALPHABET.charAt(b58[it2]);\n    }\n    return str;\n  }\n  function decodeUnsafe(source) {\n    if (typeof source !== 'string') {\n      throw new TypeError('Expected String');\n    }\n    if (source.length === 0) {\n      return new Uint8Array();\n    }\n    var psz = 0;\n    if (source[psz] === ' ') {\n      return;\n    }\n    var zeroes = 0;\n    var length = 0;\n    while (source[psz] === LEADER) {\n      zeroes++;\n      psz++;\n    }\n    var size = (source.length - psz) * FACTOR + 1 >>> 0;\n    var b256 = new Uint8Array(size);\n    while (source[psz]) {\n      var carry = BASE_MAP[source.charCodeAt(psz)];\n      if (carry === 255) {\n        return;\n      }\n      var i = 0;\n      for (var it3 = size - 1; (carry !== 0 || i < length) && it3 !== -1; it3--, i++) {\n        carry += BASE * b256[it3] >>> 0;\n        b256[it3] = carry % 256 >>> 0;\n        carry = carry / 256 >>> 0;\n      }\n      if (carry !== 0) {\n        throw new Error('Non-zero carry');\n      }\n      length = i;\n      psz++;\n    }\n    if (source[psz] === ' ') {\n      return;\n    }\n    var it4 = size - length;\n    while (it4 !== size && b256[it4] === 0) {\n      it4++;\n    }\n    var vch = new Uint8Array(zeroes + (size - it4));\n    var j = zeroes;\n    while (it4 !== size) {\n      vch[j++] = b256[it4++];\n    }\n    return vch;\n  }\n  function decode(string) {\n    var buffer = decodeUnsafe(string);\n    if (buffer) {\n      return buffer;\n    }\n    throw new Error(`Non-${ name } character`);\n  }\n  return {\n    encode: encode,\n    decodeUnsafe: decodeUnsafe,\n    decode: decode\n  };\n}\nvar src = base;\nvar _brrp__multiformats_scope_baseX = src;\n\nmodule.exports = _brrp__multiformats_scope_baseX;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 5085, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5090, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/multiformats/cjs/src/bytes.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nconst empty = new Uint8Array(0);\nconst toHex = d => d.reduce((hex, byte) => hex + byte.toString(16).padStart(2, '0'), '');\nconst fromHex = hex => {\n  const hexes = hex.match(/../g);\n  return hexes ? new Uint8Array(hexes.map(b => parseInt(b, 16))) : empty;\n};\nconst equals = (aa, bb) => {\n  if (aa === bb)\n    return true;\n  if (aa.byteLength !== bb.byteLength) {\n    return false;\n  }\n  for (let ii = 0; ii < aa.byteLength; ii++) {\n    if (aa[ii] !== bb[ii]) {\n      return false;\n    }\n  }\n  return true;\n};\nconst coerce = o => {\n  if (o instanceof Uint8Array && o.constructor.name === 'Uint8Array')\n    return o;\n  if (o instanceof ArrayBuffer)\n    return new Uint8Array(o);\n  if (ArrayBuffer.isView(o)) {\n    return new Uint8Array(o.buffer, o.byteOffset, o.byteLength);\n  }\n  throw new Error('Unknown type, must be binary type');\n};\nconst isBinary = o => o instanceof ArrayBuffer || ArrayBuffer.isView(o);\nconst fromString = str => new TextEncoder().encode(str);\nconst toString = b => new TextDecoder().decode(b);\n\nexports.coerce = coerce;\nexports.empty = empty;\nexports.equals = equals;\nexports.fromHex = fromHex;\nexports.fromString = fromString;\nexports.isBinary = isBinary;\nexports.toHex = toHex;\nexports.toString = toString;\n"],"names":[],"mappings":"AAAA;AAEA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAE3D,MAAM,QAAQ,IAAI,WAAW;AAC7B,MAAM,QAAQ,CAAA,IAAK,EAAE,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM;AACrF,MAAM,UAAU,CAAA;IACd,MAAM,QAAQ,IAAI,KAAK,CAAC;IACxB,OAAO,QAAQ,IAAI,WAAW,MAAM,GAAG,CAAC,CAAA,IAAK,SAAS,GAAG,QAAQ;AACnE;AACA,MAAM,SAAS,CAAC,IAAI;IAClB,IAAI,OAAO,IACT,OAAO;IACT,IAAI,GAAG,UAAU,KAAK,GAAG,UAAU,EAAE;QACnC,OAAO;IACT;IACA,IAAK,IAAI,KAAK,GAAG,KAAK,GAAG,UAAU,EAAE,KAAM;QACzC,IAAI,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,EAAE;YACrB,OAAO;QACT;IACF;IACA,OAAO;AACT;AACA,MAAM,SAAS,CAAA;IACb,IAAI,aAAa,cAAc,EAAE,WAAW,CAAC,IAAI,KAAK,cACpD,OAAO;IACT,IAAI,aAAa,aACf,OAAO,IAAI,WAAW;IACxB,IAAI,YAAY,MAAM,CAAC,IAAI;QACzB,OAAO,IAAI,WAAW,EAAE,MAAM,EAAE,EAAE,UAAU,EAAE,EAAE,UAAU;IAC5D;IACA,MAAM,IAAI,MAAM;AAClB;AACA,MAAM,WAAW,CAAA,IAAK,aAAa,eAAe,YAAY,MAAM,CAAC;AACrE,MAAM,aAAa,CAAA,MAAO,IAAI,cAAc,MAAM,CAAC;AACnD,MAAM,WAAW,CAAA,IAAK,IAAI,cAAc,MAAM,CAAC;AAE/C,QAAQ,MAAM,GAAG;AACjB,QAAQ,KAAK,GAAG;AAChB,QAAQ,MAAM,GAAG;AACjB,QAAQ,OAAO,GAAG;AAClB,QAAQ,UAAU,GAAG;AACrB,QAAQ,QAAQ,GAAG;AACnB,QAAQ,KAAK,GAAG;AAChB,QAAQ,QAAQ,GAAG","ignoreList":[0]}},
    {"offset": {"line": 5131, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5136, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/multiformats/cjs/src/bases/base.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar baseX$1 = require('../../vendor/base-x.js');\nvar bytes = require('../bytes.js');\n\nclass Encoder {\n  constructor(name, prefix, baseEncode) {\n    this.name = name;\n    this.prefix = prefix;\n    this.baseEncode = baseEncode;\n  }\n  encode(bytes) {\n    if (bytes instanceof Uint8Array) {\n      return `${ this.prefix }${ this.baseEncode(bytes) }`;\n    } else {\n      throw Error('Unknown type, must be binary type');\n    }\n  }\n}\nclass Decoder {\n  constructor(name, prefix, baseDecode) {\n    this.name = name;\n    this.prefix = prefix;\n    if (prefix.codePointAt(0) === undefined) {\n      throw new Error('Invalid prefix character');\n    }\n    this.prefixCodePoint = prefix.codePointAt(0);\n    this.baseDecode = baseDecode;\n  }\n  decode(text) {\n    if (typeof text === 'string') {\n      if (text.codePointAt(0) !== this.prefixCodePoint) {\n        throw Error(`Unable to decode multibase string ${ JSON.stringify(text) }, ${ this.name } decoder only supports inputs prefixed with ${ this.prefix }`);\n      }\n      return this.baseDecode(text.slice(this.prefix.length));\n    } else {\n      throw Error('Can only multibase decode strings');\n    }\n  }\n  or(decoder) {\n    return or(this, decoder);\n  }\n}\nclass ComposedDecoder {\n  constructor(decoders) {\n    this.decoders = decoders;\n  }\n  or(decoder) {\n    return or(this, decoder);\n  }\n  decode(input) {\n    const prefix = input[0];\n    const decoder = this.decoders[prefix];\n    if (decoder) {\n      return decoder.decode(input);\n    } else {\n      throw RangeError(`Unable to decode multibase string ${ JSON.stringify(input) }, only inputs prefixed with ${ Object.keys(this.decoders) } are supported`);\n    }\n  }\n}\nconst or = (left, right) => new ComposedDecoder({\n  ...left.decoders || { [left.prefix]: left },\n  ...right.decoders || { [right.prefix]: right }\n});\nclass Codec {\n  constructor(name, prefix, baseEncode, baseDecode) {\n    this.name = name;\n    this.prefix = prefix;\n    this.baseEncode = baseEncode;\n    this.baseDecode = baseDecode;\n    this.encoder = new Encoder(name, prefix, baseEncode);\n    this.decoder = new Decoder(name, prefix, baseDecode);\n  }\n  encode(input) {\n    return this.encoder.encode(input);\n  }\n  decode(input) {\n    return this.decoder.decode(input);\n  }\n}\nconst from = ({name, prefix, encode, decode}) => new Codec(name, prefix, encode, decode);\nconst baseX = ({prefix, name, alphabet}) => {\n  const {encode, decode} = baseX$1(alphabet, name);\n  return from({\n    prefix,\n    name,\n    encode,\n    decode: text => bytes.coerce(decode(text))\n  });\n};\nconst decode = (string, alphabet, bitsPerChar, name) => {\n  const codes = {};\n  for (let i = 0; i < alphabet.length; ++i) {\n    codes[alphabet[i]] = i;\n  }\n  let end = string.length;\n  while (string[end - 1] === '=') {\n    --end;\n  }\n  const out = new Uint8Array(end * bitsPerChar / 8 | 0);\n  let bits = 0;\n  let buffer = 0;\n  let written = 0;\n  for (let i = 0; i < end; ++i) {\n    const value = codes[string[i]];\n    if (value === undefined) {\n      throw new SyntaxError(`Non-${ name } character`);\n    }\n    buffer = buffer << bitsPerChar | value;\n    bits += bitsPerChar;\n    if (bits >= 8) {\n      bits -= 8;\n      out[written++] = 255 & buffer >> bits;\n    }\n  }\n  if (bits >= bitsPerChar || 255 & buffer << 8 - bits) {\n    throw new SyntaxError('Unexpected end of data');\n  }\n  return out;\n};\nconst encode = (data, alphabet, bitsPerChar) => {\n  const pad = alphabet[alphabet.length - 1] === '=';\n  const mask = (1 << bitsPerChar) - 1;\n  let out = '';\n  let bits = 0;\n  let buffer = 0;\n  for (let i = 0; i < data.length; ++i) {\n    buffer = buffer << 8 | data[i];\n    bits += 8;\n    while (bits > bitsPerChar) {\n      bits -= bitsPerChar;\n      out += alphabet[mask & buffer >> bits];\n    }\n  }\n  if (bits) {\n    out += alphabet[mask & buffer << bitsPerChar - bits];\n  }\n  if (pad) {\n    while (out.length * bitsPerChar & 7) {\n      out += '=';\n    }\n  }\n  return out;\n};\nconst rfc4648 = ({name, prefix, bitsPerChar, alphabet}) => {\n  return from({\n    prefix,\n    name,\n    encode(input) {\n      return encode(input, alphabet, bitsPerChar);\n    },\n    decode(input) {\n      return decode(input, alphabet, bitsPerChar, name);\n    }\n  });\n};\n\nexports.Codec = Codec;\nexports.baseX = baseX;\nexports.from = from;\nexports.or = or;\nexports.rfc4648 = rfc4648;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 5302, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5307, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/multiformats/cjs/src/bases/base64.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar base = require('./base.js');\n\nconst base64 = base.rfc4648({\n  prefix: 'm',\n  name: 'base64',\n  alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',\n  bitsPerChar: 6\n});\nconst base64pad = base.rfc4648({\n  prefix: 'M',\n  name: 'base64pad',\n  alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\n  bitsPerChar: 6\n});\nconst base64url = base.rfc4648({\n  prefix: 'u',\n  name: 'base64url',\n  alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_',\n  bitsPerChar: 6\n});\nconst base64urlpad = base.rfc4648({\n  prefix: 'U',\n  name: 'base64urlpad',\n  alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=',\n  bitsPerChar: 6\n});\n\nexports.base64 = base64;\nexports.base64pad = base64pad;\nexports.base64url = base64url;\nexports.base64urlpad = base64urlpad;\n"],"names":[],"mappings":"AAAA;AAEA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAE3D,IAAI;AAEJ,MAAM,SAAS,KAAK,OAAO,CAAC;IAC1B,QAAQ;IACR,MAAM;IACN,UAAU;IACV,aAAa;AACf;AACA,MAAM,YAAY,KAAK,OAAO,CAAC;IAC7B,QAAQ;IACR,MAAM;IACN,UAAU;IACV,aAAa;AACf;AACA,MAAM,YAAY,KAAK,OAAO,CAAC;IAC7B,QAAQ;IACR,MAAM;IACN,UAAU;IACV,aAAa;AACf;AACA,MAAM,eAAe,KAAK,OAAO,CAAC;IAChC,QAAQ;IACR,MAAM;IACN,UAAU;IACV,aAAa;AACf;AAEA,QAAQ,MAAM,GAAG;AACjB,QAAQ,SAAS,GAAG;AACpB,QAAQ,SAAS,GAAG;AACpB,QAAQ,YAAY,GAAG","ignoreList":[0]}},
    {"offset": {"line": 5340, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5345, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/util.ts"],"sourcesContent":["import { base64url } from 'multiformats/bases/base64'\nimport { RefinementCtx, ZodIssueCode } from 'zod'\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type Simplify<T> = { [K in keyof T]: T[K] } & {}\nexport type Override<T, V> = Simplify<V & Omit<T, keyof V>>\n\nexport type RequiredKey<T, K extends keyof T = never> = Simplify<\n  T & {\n    [L in K]-?: unknown extends T[L]\n      ? NonNullable<unknown> | null\n      : Exclude<T[L], undefined>\n  }\n>\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type DeepReadonly<T> = T extends Function\n  ? T\n  : T extends object\n    ? { readonly [K in keyof T]: DeepReadonly<T[K]> }\n    : T extends readonly (infer U)[]\n      ? readonly DeepReadonly<U>[]\n      : T\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type UnReadonly<T> = T extends Function\n  ? T\n  : T extends object\n    ? { -readonly [K in keyof T]: UnReadonly<T[K]> }\n    : T extends readonly (infer U)[]\n      ? UnReadonly<U>[]\n      : T\n\nexport const isDefined = <T>(i: T | undefined): i is T => i !== undefined\n\nexport const preferredOrderCmp =\n  <T>(order: readonly T[]) =>\n  (a: T, b: T) => {\n    const aIdx = order.indexOf(a)\n    const bIdx = order.indexOf(b)\n    if (aIdx === bIdx) return 0\n    if (aIdx === -1) return 1\n    if (bIdx === -1) return -1\n    return aIdx - bIdx\n  }\n\nexport function matchesAny<T extends string | number | symbol | boolean>(\n  value: null | undefined | T | readonly T[],\n): (v: unknown) => v is T {\n  return value == null\n    ? (v): v is T => true\n    : Array.isArray(value)\n      ? (v): v is T => value.includes(v)\n      : (v): v is T => v === value\n}\n\n/**\n * Decorator to cache the result of a getter on a class instance.\n */\nexport const cachedGetter = <T extends object, V>(\n  target: (this: T) => V,\n  _context: ClassGetterDecoratorContext<T, V>,\n) => {\n  return function (this: T) {\n    const value = target.call(this)\n    Object.defineProperty(this, target.name, {\n      get: () => value,\n      enumerable: true,\n      configurable: true,\n    })\n    return value\n  }\n}\n\nconst decoder = new TextDecoder()\nexport function parseB64uJson(input: string): unknown {\n  const inputBytes = base64url.baseDecode(input)\n  const json = decoder.decode(inputBytes)\n  return JSON.parse(json)\n}\n\n/**\n * @example\n * ```ts\n * // jwtSchema will only allow base64url chars & \".\" (dot)\n * const jwtSchema = z.string().superRefine(jwtCharsRefinement)\n * ```\n */\nexport const jwtCharsRefinement = (data: string, ctx: RefinementCtx): void => {\n  // Note: this is a hot path, let's avoid using a RegExp\n  let char\n\n  for (let i = 0; i < data.length; i++) {\n    char = data.charCodeAt(i)\n\n    if (\n      // Base64 URL encoding (most frequent)\n      (65 <= char && char <= 90) || // A-Z\n      (97 <= char && char <= 122) || // a-z\n      (48 <= char && char <= 57) || // 0-9\n      char === 45 || // -\n      char === 95 || // _\n      // Boundary (least frequent, check last)\n      char === 46 // .\n    ) {\n      // continue\n    } else {\n      // Invalid char might be a surrogate pair\n      const invalidChar = String.fromCodePoint(data.codePointAt(i)!)\n      return ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: `Invalid character \"${invalidChar}\" in JWT at position ${i}`,\n      })\n    }\n  }\n}\n\n/**\n * @example\n * ```ts\n * type SegmentedString3 = SegmentedString<3> // `${string}.${string}.${string}`\n * type SegmentedString4 = SegmentedString<4> // `${string}.${string}.${string}.${string}`\n * ```\n *\n * @note\n * This utility only provides one way type safety (A SegmentedString<4> can be\n * assigned to SegmentedString<3> but not vice versa). The purpose of this\n * utility is to improve DX by avoiding as many potential errors as build time.\n * DO NOT rely on this to enforce security or data integrity.\n */\ntype SegmentedString<\n  C extends number,\n  Acc extends string[] = [string],\n> = Acc['length'] extends C\n  ? `${Acc[0]}`\n  : `${Acc[0]}.${SegmentedString<C, [string, ...Acc]>}`\n\n/**\n * @example\n * ```ts\n * const jwtSchema = z.string().superRefine(segmentedStringRefinementFactory(3))\n * type Jwt = z.infer<typeof jwtSchema> // `${string}.${string}.${string}`\n * ```\n */\nexport const segmentedStringRefinementFactory = <C extends number>(\n  count: C,\n  minPartLength = 2,\n) => {\n  if (!Number.isFinite(count) || count < 1 || (count | 0) !== count) {\n    throw new TypeError(`Count must be a natural number (got ${count})`)\n  }\n\n  const minTotalLength = count * minPartLength + (count - 1)\n  const errorPrefix = `Invalid JWT format`\n\n  return (data: string, ctx: RefinementCtx): data is SegmentedString<C> => {\n    if (data.length < minTotalLength) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: `${errorPrefix}: too short`,\n      })\n      return false\n    }\n    let currentStart = 0\n    for (let i = 0; i < count - 1; i++) {\n      const nextDot = data.indexOf('.', currentStart)\n      if (nextDot === -1) {\n        ctx.addIssue({\n          code: ZodIssueCode.custom,\n          message: `${errorPrefix}: expected ${count} segments, got ${i + 1}`,\n        })\n        return false\n      }\n      if (nextDot - currentStart < minPartLength) {\n        ctx.addIssue({\n          code: ZodIssueCode.custom,\n          message: `${errorPrefix}: segment ${i + 1} is too short`,\n        })\n        return false\n      }\n      currentStart = nextDot + 1\n    }\n    if (data.indexOf('.', currentStart) !== -1) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: `${errorPrefix}: too many segments`,\n      })\n      return false\n    }\n    if (data.length - currentStart < minPartLength) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: `${errorPrefix}: last segment is too short`,\n      })\n      return false\n    }\n    return true\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 5475, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5480, "column": 0}, "map": {"version":3,"file":"jwt.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/jwt.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { jwkPubSchema } from './jwk.js'\nimport { jwtCharsRefinement, segmentedStringRefinementFactory } from './util.js'\n\nexport const signedJwtSchema = z\n  .string()\n  .superRefine(jwtCharsRefinement)\n  .superRefine(segmentedStringRefinementFactory(3))\n\nexport type SignedJwt = z.infer<typeof signedJwtSchema>\nexport const isSignedJwt = (data: unknown): data is SignedJwt =>\n  signedJwtSchema.safeParse(data).success\n\nexport const unsignedJwtSchema = z\n  .string()\n  .superRefine(jwtCharsRefinement)\n  .superRefine(segmentedStringRefinementFactory(2))\n\nexport type UnsignedJwt = z.infer<typeof unsignedJwtSchema>\nexport const isUnsignedJwt = (data: unknown): data is UnsignedJwt =>\n  unsignedJwtSchema.safeParse(data).success\n\n/**\n * @see {@link https://www.rfc-editor.org/rfc/rfc7515.html#section-4}\n */\nexport const jwtHeaderSchema = z\n  .object({\n    /** \"alg\" (Algorithm) Header Parameter */\n    alg: z.string(),\n    /** \"jku\" (JWK Set URL) Header Parameter */\n    jku: z.string().url().optional(),\n    /** \"jwk\" (JSON Web Key) Header Parameter */\n    jwk: z\n      .object({\n        kty: z.string(),\n        crv: z.string().optional(),\n        x: z.string().optional(),\n        y: z.string().optional(),\n        e: z.string().optional(),\n        n: z.string().optional(),\n      })\n      .optional(),\n    /** \"kid\" (Key ID) Header Parameter */\n    kid: z.string().optional(),\n    /** \"x5u\" (X.509 URL) Header Parameter */\n    x5u: z.string().optional(),\n    /** \"x5c\" (X.509 Certificate Chain) Header Parameter */\n    x5c: z.array(z.string()).optional(),\n    /** \"x5t\" (X.509 Certificate SHA-1 Thumbprint) Header Parameter */\n    x5t: z.string().optional(),\n    /** \"x5t#S256\" (X.509 Certificate SHA-256 Thumbprint) Header Parameter */\n    'x5t#S256': z.string().optional(),\n    /** \"typ\" (Type) Header Parameter */\n    typ: z.string().optional(),\n    /** \"cty\" (Content Type) Header Parameter */\n    cty: z.string().optional(),\n    /** \"crit\" (Critical) Header Parameter */\n    crit: z.array(z.string()).optional(),\n  })\n  .passthrough()\n\nexport type JwtHeader = z.infer<typeof jwtHeaderSchema>\n\n// https://www.iana.org/assignments/jwt/jwt.xhtml\nexport const jwtPayloadSchema = z\n  .object({\n    iss: z.string().optional(),\n    aud: z.union([z.string(), z.array(z.string()).nonempty()]).optional(),\n    sub: z.string().optional(),\n    exp: z.number().int().optional(),\n    nbf: z.number().int().optional(),\n    iat: z.number().int().optional(),\n    jti: z.string().optional(),\n    htm: z.string().optional(),\n    htu: z.string().optional(),\n    ath: z.string().optional(),\n    acr: z.string().optional(),\n    azp: z.string().optional(),\n    amr: z.array(z.string()).optional(),\n    // https://datatracker.ietf.org/doc/html/rfc7800\n    cnf: z\n      .object({\n        kid: z.string().optional(), // Key ID\n        jwk: jwkPubSchema.optional(), // JWK\n        jwe: z.string().optional(), // Encrypted key\n        jku: z.string().url().optional(), // JWK Set URI (\"kid\" should also be provided)\n\n        // https://datatracker.ietf.org/doc/html/rfc9449#section-6.1\n        jkt: z.string().optional(),\n\n        // https://datatracker.ietf.org/doc/html/rfc8705\n        'x5t#S256': z.string().optional(), // X.509 Certificate SHA-256 Thumbprint\n\n        // https://datatracker.ietf.org/doc/html/rfc9203\n        osc: z.string().optional(), // OSCORE_Input_Material carrying the parameters for using OSCORE per-message security with implicit key confirmation\n      })\n      .optional(),\n\n    client_id: z.string().optional(),\n\n    scope: z.string().optional(),\n    nonce: z.string().optional(),\n\n    at_hash: z.string().optional(),\n    c_hash: z.string().optional(),\n    s_hash: z.string().optional(),\n    auth_time: z.number().int().optional(),\n\n    // https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims\n\n    // OpenID: \"profile\" scope\n    name: z.string().optional(),\n    family_name: z.string().optional(),\n    given_name: z.string().optional(),\n    middle_name: z.string().optional(),\n    nickname: z.string().optional(),\n    preferred_username: z.string().optional(),\n    gender: z.string().optional(), // OpenID only defines \"male\" and \"female\" without forbidding other values\n    picture: z.string().url().optional(),\n    profile: z.string().url().optional(),\n    website: z.string().url().optional(),\n    birthdate: z\n      .string()\n      .regex(/\\d{4}-\\d{2}-\\d{2}/) // YYYY-MM-DD\n      .optional(),\n    zoneinfo: z\n      .string()\n      .regex(/^[A-Za-z0-9_/]+$/)\n      .optional(),\n    locale: z\n      .string()\n      .regex(/^[a-z]{2}(-[A-Z]{2})?$/)\n      .optional(),\n    updated_at: z.number().int().optional(),\n\n    // OpenID: \"email\" scope\n    email: z.string().optional(),\n    email_verified: z.boolean().optional(),\n\n    // OpenID: \"phone\" scope\n    phone_number: z.string().optional(),\n    phone_number_verified: z.boolean().optional(),\n\n    // OpenID: \"address\" scope\n    // https://openid.net/specs/openid-connect-core-1_0.html#AddressClaim\n    address: z\n      .object({\n        formatted: z.string().optional(),\n        street_address: z.string().optional(),\n        locality: z.string().optional(),\n        region: z.string().optional(),\n        postal_code: z.string().optional(),\n        country: z.string().optional(),\n      })\n      .optional(),\n\n    // https://datatracker.ietf.org/doc/html/rfc9396#section-14.2\n    authorization_details: z\n      .array(\n        z\n          .object({\n            type: z.string(),\n            // https://datatracker.ietf.org/doc/html/rfc9396#section-2.2\n            locations: z.array(z.string()).optional(),\n            actions: z.array(z.string()).optional(),\n            datatypes: z.array(z.string()).optional(),\n            identifier: z.string().optional(),\n            privileges: z.array(z.string()).optional(),\n          })\n          .passthrough(),\n      )\n      .optional(),\n  })\n  .passthrough()\n\nexport type JwtPayload = z.infer<typeof jwtPayloadSchema>\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 5598, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5603, "column": 0}, "map": {"version":3,"file":"jwt-decode.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/jwt-decode.ts"],"sourcesContent":["import { ERR_JWT_INVALID, JwtVerifyError } from './errors.js'\nimport {\n  JwtHeader,\n  JwtPayload,\n  jwtHeaderSchema,\n  jwtPayloadSchema,\n} from './jwt.js'\nimport { parseB64uJson } from './util.js'\n\nexport function unsafeDecodeJwt(jwt: string): {\n  header: JwtHeader\n  payload: JwtPayload\n} {\n  const { 0: headerEnc, 1: payloadEnc, length } = jwt.split('.')\n  if (length > 3 || length < 2) {\n    throw new JwtVerifyError(undefined, ERR_JWT_INVALID)\n  }\n\n  const header = jwtHeaderSchema.parse(parseB64uJson(headerEnc!))\n  if (length === 2 && header?.alg !== 'none') {\n    throw new JwtVerifyError(undefined, ERR_JWT_INVALID)\n  }\n\n  const payload = jwtPayloadSchema.parse(parseB64uJson(payloadEnc!))\n\n  return { header, payload }\n}\n"],"names":[],"mappings":";;;;AASA,QAAA,eAAA,GAAA,gBAiBC;AA1BD,MAAA,qCAA6D;AAC7D,MAAA,+BAKiB;AACjB,MAAA,iCAAyC;AAEzC,SAAgB,eAAe,CAAC,GAAW;IAIzC,MAAM,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,UAAU,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;IAC9D,IAAI,MAAM,GAAG,CAAC,IAAI,MAAM,GAAG,CAAC,EAAE,CAAC;QAC7B,MAAM,IAAI,YAAA,cAAc,CAAC,SAAS,EAAE,YAAA,eAAe,CAAC,CAAA;IACtD,CAAC;IAED,MAAM,MAAM,GAAG,SAAA,eAAe,CAAC,KAAK,CAAC,CAAA,GAAA,UAAA,aAAa,EAAC,SAAU,CAAC,CAAC,CAAA;IAC/D,IAAI,MAAM,KAAK,CAAC,IAAI,MAAM,EAAE,GAAG,KAAK,MAAM,EAAE,CAAC;QAC3C,MAAM,IAAI,YAAA,cAAc,CAAC,SAAS,EAAE,YAAA,eAAe,CAAC,CAAA;IACtD,CAAC;IAED,MAAM,OAAO,GAAG,SAAA,gBAAgB,CAAC,KAAK,CAAC,CAAA,GAAA,UAAA,aAAa,EAAC,UAAW,CAAC,CAAC,CAAA;IAElE,OAAO;QAAE,MAAM;QAAE,OAAO;IAAA,CAAE,CAAA;AAC5B,CAAC","ignoreList":[0]}},
    {"offset": {"line": 5626, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5631, "column": 0}, "map": {"version":3,"file":"jwt-verify.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/jwt-verify.ts"],"sourcesContent":["import { JwtHeader, JwtPayload } from './jwt.js'\nimport { RequiredKey } from './util.js'\n\nexport type VerifyOptions<C extends string = never> = {\n  audience?: string | readonly string[]\n  /** in seconds */\n  clockTolerance?: number\n  issuer?: string | readonly string[]\n  /** in seconds */\n  maxTokenAge?: number\n  subject?: string\n  typ?: string\n  currentDate?: Date\n  requiredClaims?: readonly C[]\n}\n\nexport type VerifyResult<C extends string = never> = {\n  payload: RequiredKey<JwtPayload, C>\n  protectedHeader: JwtHeader\n}\n"],"names":[],"mappings":"","ignoreList":[0]}},
    {"offset": {"line": 5635, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5640, "column": 0}, "map": {"version":3,"file":"key.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/key.ts"],"sourcesContent":["import { jwkAlgorithms } from './alg.js'\nimport { JwkError } from './errors.js'\nimport { Jwk, jwkSchema } from './jwk.js'\nimport { VerifyOptions, VerifyResult } from './jwt-verify.js'\nimport { JwtHeader, JwtPayload, SignedJwt } from './jwt.js'\nimport { cachedGetter } from './util.js'\n\nconst jwkSchemaReadonly = jwkSchema.readonly()\n\nexport abstract class Key<J extends Jwk = Jwk> {\n  constructor(protected readonly jwk: Readonly<J>) {\n    // A key should always be used either for signing or encryption.\n    if (!jwk.use) throw new JwkError('Missing \"use\" Parameter value')\n  }\n\n  get isPrivate(): boolean {\n    const { jwk } = this\n    if ('d' in jwk && jwk.d !== undefined) return true\n    if ('k' in jwk && jwk.k !== undefined) return true\n    return false\n  }\n\n  get isSymetric(): boolean {\n    const { jwk } = this\n    if ('k' in jwk && jwk.k !== undefined) return true\n    return false\n  }\n\n  get privateJwk(): Readonly<J> | undefined {\n    return this.isPrivate ? this.jwk : undefined\n  }\n\n  @cachedGetter\n  get publicJwk():\n    | Readonly<Exclude<J, { kty: 'oct' }> & { d?: never }>\n    | undefined {\n    if (this.isSymetric) return undefined\n\n    return jwkSchemaReadonly.parse({\n      ...this.jwk,\n      d: undefined,\n      k: undefined,\n    }) as Exclude<J, { kty: 'oct' }> & { d?: never }\n  }\n\n  @cachedGetter\n  get bareJwk(): Readonly<Jwk> | undefined {\n    if (this.isSymetric) return undefined\n    const { kty, crv, e, n, x, y } = this.jwk as any\n    return jwkSchemaReadonly.parse({ crv, e, kty, n, x, y })\n  }\n\n  get use() {\n    return this.jwk.use!\n  }\n\n  /**\n   * The (forced) algorithm to use. If not provided, the key will be usable with\n   * any of the algorithms in {@link algorithms}.\n   *\n   * @see {@link https://datatracker.ietf.org/doc/html/rfc7518#section-3.1 | \"alg\" (Algorithm) Header Parameter Values for JWS}\n   */\n  get alg() {\n    return this.jwk.alg\n  }\n\n  get kid() {\n    return this.jwk.kid\n  }\n\n  get crv() {\n    return (this.jwk as { crv: undefined } | Extract<J, { crv: unknown }>).crv\n  }\n\n  /**\n   * All the algorithms that this key can be used with. If `alg` is provided,\n   * this set will only contain that algorithm.\n   */\n  @cachedGetter\n  get algorithms(): readonly string[] {\n    return Object.freeze(Array.from(jwkAlgorithms(this.jwk)))\n  }\n\n  /**\n   * Create a signed JWT\n   */\n  abstract createJwt(header: JwtHeader, payload: JwtPayload): Promise<SignedJwt>\n\n  /**\n   * Verify the signature, headers and payload of a JWT\n   *\n   * @throws {JwtVerifyError} if the JWT is invalid\n   */\n  abstract verifyJwt<C extends string = never>(\n    token: SignedJwt,\n    options?: VerifyOptions<C>,\n  ): Promise<VerifyResult<C>>\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 5819, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5824, "column": 0}, "map": {"version":3,"file":"keyset.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/keyset.ts"],"sourcesContent":["import {\n  ERR_JWKS_NO_MATCHING_KEY,\n  ERR_JWK_NOT_FOUND,\n  ERR_JWT_INVALID,\n  JwkError,\n  JwtCreateError,\n  JwtVerifyError,\n} from './errors.js'\nimport { Jwk } from './jwk.js'\nimport { Jwks, JwksPub } from './jwks.js'\nimport { unsafeDecodeJwt } from './jwt-decode.js'\nimport { VerifyOptions, VerifyResult } from './jwt-verify.js'\nimport { JwtHeader, JwtPayload, SignedJwt } from './jwt.js'\nimport { Key } from './key.js'\nimport {\n  DeepReadonly,\n  Override,\n  UnReadonly,\n  cachedGetter,\n  isDefined,\n  matchesAny,\n  preferredOrderCmp,\n} from './util.js'\n\nexport type JwtSignHeader = Override<JwtHeader, Pick<KeySearch, 'alg' | 'kid'>>\n\nexport type JwtPayloadGetter<P = JwtPayload> = (\n  header: JwtHeader,\n  key: Key,\n) => P | PromiseLike<P>\n\nexport type KeySearch = {\n  use?: 'sig' | 'enc'\n  kid?: string | string[]\n  alg?: string | string[]\n}\n\nconst extractPrivateJwk = (key: Key): Jwk | undefined => key.privateJwk\nconst extractPublicJwk = (key: Key): Jwk | undefined => key.publicJwk\n\nexport class Keyset<K extends Key = Key> implements Iterable<K> {\n  private readonly keys: readonly K[]\n\n  constructor(\n    iterable: Iterable<K | null | undefined | false>,\n    /**\n     * The preferred algorithms to use when signing a JWT using this keyset.\n     *\n     * @see {@link https://datatracker.ietf.org/doc/html/rfc7518#section-3.1}\n     */\n    public readonly preferredSigningAlgorithms: readonly string[] = iterable instanceof\n    Keyset\n      ? [...iterable.preferredSigningAlgorithms]\n      : [\n          // Prefer elliptic curve algorithms\n          'EdDSA',\n          'ES256K',\n          'ES256',\n          // https://datatracker.ietf.org/doc/html/rfc7518#section-3.5\n          'PS256',\n          'PS384',\n          'PS512',\n          'HS256',\n          'HS384',\n          'HS512',\n        ],\n  ) {\n    const keys: K[] = []\n\n    const kids = new Set<string>()\n    for (const key of iterable) {\n      if (!key) continue\n\n      keys.push(key)\n\n      if (key.kid) {\n        if (kids.has(key.kid)) throw new JwkError(`Duplicate key: ${key.kid}`)\n        else kids.add(key.kid)\n      }\n    }\n\n    this.keys = Object.freeze(keys)\n  }\n\n  get size(): number {\n    return this.keys.length\n  }\n\n  @cachedGetter\n  get signAlgorithms(): readonly string[] {\n    const algorithms = new Set<string>()\n    for (const key of this) {\n      if (key.use !== 'sig') continue\n      for (const alg of key.algorithms) {\n        algorithms.add(alg)\n      }\n    }\n    return Object.freeze(\n      [...algorithms].sort(preferredOrderCmp(this.preferredSigningAlgorithms)),\n    )\n  }\n\n  @cachedGetter\n  get publicJwks(): DeepReadonly<JwksPub> {\n    return {\n      keys: Array.from(this, extractPublicJwk).filter(isDefined),\n    }\n  }\n\n  @cachedGetter\n  get privateJwks(): DeepReadonly<Jwks> {\n    return {\n      keys: Array.from(this, extractPrivateJwk).filter(isDefined),\n    }\n  }\n\n  has(kid: string): boolean {\n    return this.keys.some((key) => key.kid === kid)\n  }\n\n  get(search: KeySearch): K {\n    for (const key of this.list(search)) {\n      return key\n    }\n\n    throw new JwkError(\n      `Key not found ${search.kid || search.alg || '<unknown>'}`,\n      ERR_JWK_NOT_FOUND,\n    )\n  }\n\n  *list(search: KeySearch): Generator<K> {\n    // Optimization: Empty string or empty array will not match any key\n    if (search.kid?.length === 0) return\n    if (search.alg?.length === 0) return\n\n    for (const key of this) {\n      if (search.use && key.use !== search.use) continue\n\n      if (Array.isArray(search.kid)) {\n        if (!key.kid || !search.kid.includes(key.kid)) continue\n      } else if (search.kid) {\n        if (key.kid !== search.kid) continue\n      }\n\n      if (Array.isArray(search.alg)) {\n        if (!search.alg.some((a) => key.algorithms.includes(a))) continue\n      } else if (typeof search.alg === 'string') {\n        if (!key.algorithms.includes(search.alg)) continue\n      }\n\n      yield key\n    }\n  }\n\n  findKey({ kid, alg, use }: KeySearch): [key: Key, alg: string] {\n    const matchingKeys: Key[] = []\n\n    for (const key of this.list({ kid, alg, use })) {\n      // Not a signing key\n      if (!key.isPrivate) continue\n\n      // Skip negotiation if a specific \"alg\" was provided\n      if (typeof alg === 'string') return [key, alg]\n\n      matchingKeys.push(key)\n    }\n\n    const isAllowedAlg = matchesAny(alg)\n    const candidates = matchingKeys.map(\n      (key) => [key, key.algorithms.filter(isAllowedAlg)] as const,\n    )\n\n    // Return the first candidates that matches the preferred algorithms\n    for (const prefAlg of this.preferredSigningAlgorithms) {\n      for (const [matchingKey, matchingAlgs] of candidates) {\n        if (matchingAlgs.includes(prefAlg)) return [matchingKey, prefAlg]\n      }\n    }\n\n    // Return any candidate\n    for (const [matchingKey, matchingAlgs] of candidates) {\n      for (const alg of matchingAlgs) {\n        return [matchingKey, alg]\n      }\n    }\n\n    throw new JwkError(\n      `No singing key found for ${kid || alg || use || '<unknown>'}`,\n      ERR_JWK_NOT_FOUND,\n    )\n  }\n\n  [Symbol.iterator](): IterableIterator<K> {\n    return this.keys.values()\n  }\n\n  async createJwt(\n    { alg: sAlg, kid: sKid, ...header }: JwtSignHeader,\n    payload: JwtPayload | JwtPayloadGetter,\n  ): Promise<SignedJwt> {\n    try {\n      const [key, alg] = this.findKey({ alg: sAlg, kid: sKid, use: 'sig' })\n      const protectedHeader = { ...header, alg, kid: key.kid }\n\n      if (typeof payload === 'function') {\n        payload = await payload(protectedHeader, key)\n      }\n\n      return await key.createJwt(protectedHeader, payload)\n    } catch (err) {\n      throw JwtCreateError.from(err)\n    }\n  }\n\n  async verifyJwt<C extends string = never>(\n    token: SignedJwt,\n    options?: VerifyOptions<C>,\n  ): Promise<VerifyResult<C> & { key: K }> {\n    const { header } = unsafeDecodeJwt(token)\n    const { kid, alg } = header\n\n    const errors: unknown[] = []\n\n    for (const key of this.list({ kid, alg })) {\n      try {\n        const result = await key.verifyJwt<C>(token, options)\n        return { ...result, key }\n      } catch (err) {\n        errors.push(err)\n      }\n    }\n\n    switch (errors.length) {\n      case 0:\n        throw new JwtVerifyError('No key matched', ERR_JWKS_NO_MATCHING_KEY)\n      case 1:\n        throw JwtVerifyError.from(errors[0], ERR_JWT_INVALID)\n      default:\n        throw JwtVerifyError.from(errors, ERR_JWT_INVALID)\n    }\n  }\n\n  toJSON(): JwksPub {\n    // Make a copy to prevent mutation of the original keyset\n    return structuredClone(this.publicJwks) as UnReadonly<JwksPub>\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 6124, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6129, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk/src/index.ts"],"sourcesContent":["// Since we expose zod schemas, let's expose ZodError (under a generic name) so\n// that dependents can catch schema parsing errors without requiring an explicit\n// dependency on zod, or risking a conflict in case of mismatching zob versions.\nexport { ZodError as ValidationError } from 'zod'\n\nexport * from './alg.js'\nexport * from './errors.js'\nexport * from './jwk.js'\nexport * from './jwks.js'\nexport * from './jwt-decode.js'\nexport * from './jwt-verify.js'\nexport * from './jwt.js'\nexport * from './key.js'\nexport * from './keyset.js'\nexport * from './util.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,+EAA+E;AAC/E,gFAAgF;AAChF,gFAAgF;AAChF,IAAA,uBAAiD;AAAxC,OAAA,cAAA,CAAA,SAAA,mBAAA;IAAA,YAAA;IAAA,KAAA;QAAA,OAAA,MAAA,QAAQ;IAAA;AAAA,GAAmB;AAEpC,8GAAA,SAAwB;AACxB,iHAAA,SAA2B;AAC3B,8GAAA,SAAwB;AACxB,+GAAA,SAAyB;AACzB,qHAAA,SAA+B;AAC/B,qHAAA,SAA+B;AAC/B,8GAAA,SAAwB;AACxB,8GAAA,SAAwB;AACxB,iHAAA,SAA2B;AAC3B,+GAAA,SAAyB","ignoreList":[0]}},
    {"offset": {"line": 6173, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6178, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/digest.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst node_crypto_1 = require(\"node:crypto\");\nconst digest = (algorithm, data) => (0, node_crypto_1.createHash)(algorithm).update(data).digest();\nexports.default = digest;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM,SAAS,CAAC,WAAW,OAAS,CAAC,GAAG,cAAc,UAAU,EAAE,WAAW,MAAM,CAAC,MAAM,MAAM;AAChG,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 6185, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6190, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/buffer_utils.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decoder = exports.encoder = void 0;\nexports.concat = concat;\nexports.p2s = p2s;\nexports.uint64be = uint64be;\nexports.uint32be = uint32be;\nexports.lengthAndInput = lengthAndInput;\nexports.concatKdf = concatKdf;\nconst digest_js_1 = require(\"../runtime/digest.js\");\nexports.encoder = new TextEncoder();\nexports.decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nfunction concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    for (const buffer of buffers) {\n        buf.set(buffer, i);\n        i += buffer.length;\n    }\n    return buf;\n}\nfunction p2s(alg, p2sInput) {\n    return concat(exports.encoder.encode(alg), new Uint8Array([0]), p2sInput);\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nfunction uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nfunction uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nfunction lengthAndInput(input) {\n    return concat(uint32be(input.length), input);\n}\nasync function concatKdf(secret, bits, value) {\n    const iterations = Math.ceil((bits >> 3) / 32);\n    const res = new Uint8Array(iterations * 32);\n    for (let iter = 0; iter < iterations; iter++) {\n        const buf = new Uint8Array(4 + secret.length + value.length);\n        buf.set(uint32be(iter + 1));\n        buf.set(secret, 4);\n        buf.set(value, 4 + secret.length);\n        res.set(await (0, digest_js_1.default)('sha256', buf), iter * 32);\n    }\n    return res.slice(0, bits >> 3);\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG,QAAQ,OAAO,GAAG,KAAK;AACzC,QAAQ,MAAM,GAAG;AACjB,QAAQ,GAAG,GAAG;AACd,QAAQ,QAAQ,GAAG;AACnB,QAAQ,QAAQ,GAAG;AACnB,QAAQ,cAAc,GAAG;AACzB,QAAQ,SAAS,GAAG;AACpB,MAAM;AACN,QAAQ,OAAO,GAAG,IAAI;AACtB,QAAQ,OAAO,GAAG,IAAI;AACtB,MAAM,YAAY,KAAK;AACvB,SAAS,OAAO,GAAG,OAAO;IACtB,MAAM,OAAO,QAAQ,MAAM,CAAC,CAAC,KAAK,EAAE,MAAM,EAAE,GAAK,MAAM,QAAQ;IAC/D,MAAM,MAAM,IAAI,WAAW;IAC3B,IAAI,IAAI;IACR,KAAK,MAAM,UAAU,QAAS;QAC1B,IAAI,GAAG,CAAC,QAAQ;QAChB,KAAK,OAAO,MAAM;IACtB;IACA,OAAO;AACX;AACA,SAAS,IAAI,GAAG,EAAE,QAAQ;IACtB,OAAO,OAAO,QAAQ,OAAO,CAAC,MAAM,CAAC,MAAM,IAAI,WAAW;QAAC;KAAE,GAAG;AACpE;AACA,SAAS,cAAc,GAAG,EAAE,KAAK,EAAE,MAAM;IACrC,IAAI,QAAQ,KAAK,SAAS,WAAW;QACjC,MAAM,IAAI,WAAW,CAAC,0BAA0B,EAAE,YAAY,EAAE,WAAW,EAAE,OAAO;IACxF;IACA,IAAI,GAAG,CAAC;QAAC,UAAU;QAAI,UAAU;QAAI,UAAU;QAAG,QAAQ;KAAK,EAAE;AACrE;AACA,SAAS,SAAS,KAAK;IACnB,MAAM,OAAO,KAAK,KAAK,CAAC,QAAQ;IAChC,MAAM,MAAM,QAAQ;IACpB,MAAM,MAAM,IAAI,WAAW;IAC3B,cAAc,KAAK,MAAM;IACzB,cAAc,KAAK,KAAK;IACxB,OAAO;AACX;AACA,SAAS,SAAS,KAAK;IACnB,MAAM,MAAM,IAAI,WAAW;IAC3B,cAAc,KAAK;IACnB,OAAO;AACX;AACA,SAAS,eAAe,KAAK;IACzB,OAAO,OAAO,SAAS,MAAM,MAAM,GAAG;AAC1C;AACA,eAAe,UAAU,MAAM,EAAE,IAAI,EAAE,KAAK;IACxC,MAAM,aAAa,KAAK,IAAI,CAAC,CAAC,QAAQ,CAAC,IAAI;IAC3C,MAAM,MAAM,IAAI,WAAW,aAAa;IACxC,IAAK,IAAI,OAAO,GAAG,OAAO,YAAY,OAAQ;QAC1C,MAAM,MAAM,IAAI,WAAW,IAAI,OAAO,MAAM,GAAG,MAAM,MAAM;QAC3D,IAAI,GAAG,CAAC,SAAS,OAAO;QACxB,IAAI,GAAG,CAAC,QAAQ;QAChB,IAAI,GAAG,CAAC,OAAO,IAAI,OAAO,MAAM;QAChC,IAAI,GAAG,CAAC,MAAM,CAAC,GAAG,YAAY,OAAO,EAAE,UAAU,MAAM,OAAO;IAClE;IACA,OAAO,IAAI,KAAK,CAAC,GAAG,QAAQ;AAChC","ignoreList":[0]}},
    {"offset": {"line": 6259, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6264, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/base64url.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decode = exports.encode = exports.encodeBase64 = exports.decodeBase64 = void 0;\nconst node_buffer_1 = require(\"node:buffer\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nfunction normalize(input) {\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = buffer_utils_js_1.decoder.decode(encoded);\n    }\n    return encoded;\n}\nconst encode = (input) => node_buffer_1.Buffer.from(input).toString('base64url');\nexports.encode = encode;\nconst decodeBase64 = (input) => new Uint8Array(node_buffer_1.Buffer.from(input, 'base64'));\nexports.decodeBase64 = decodeBase64;\nconst encodeBase64 = (input) => node_buffer_1.Buffer.from(input).toString('base64');\nexports.encodeBase64 = encodeBase64;\nconst decode = (input) => new Uint8Array(node_buffer_1.Buffer.from(normalize(input), 'base64url'));\nexports.decode = decode;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,MAAM,GAAG,QAAQ,MAAM,GAAG,QAAQ,YAAY,GAAG,QAAQ,YAAY,GAAG,KAAK;AACrF,MAAM;AACN,MAAM;AACN,SAAS,UAAU,KAAK;IACpB,IAAI,UAAU;IACd,IAAI,mBAAmB,YAAY;QAC/B,UAAU,kBAAkB,OAAO,CAAC,MAAM,CAAC;IAC/C;IACA,OAAO;AACX;AACA,MAAM,SAAS,CAAC,QAAU,cAAc,MAAM,CAAC,IAAI,CAAC,OAAO,QAAQ,CAAC;AACpE,QAAQ,MAAM,GAAG;AACjB,MAAM,eAAe,CAAC,QAAU,IAAI,WAAW,cAAc,MAAM,CAAC,IAAI,CAAC,OAAO;AAChF,QAAQ,YAAY,GAAG;AACvB,MAAM,eAAe,CAAC,QAAU,cAAc,MAAM,CAAC,IAAI,CAAC,OAAO,QAAQ,CAAC;AAC1E,QAAQ,YAAY,GAAG;AACvB,MAAM,SAAS,CAAC,QAAU,IAAI,WAAW,cAAc,MAAM,CAAC,IAAI,CAAC,UAAU,QAAQ;AACrF,QAAQ,MAAM,GAAG","ignoreList":[0]}},
    {"offset": {"line": 6286, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6291, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/util/errors.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.JWSSignatureVerificationFailed = exports.JWKSTimeout = exports.JWKSMultipleMatchingKeys = exports.JWKSNoMatchingKey = exports.JWKSInvalid = exports.JWKInvalid = exports.JWTInvalid = exports.JWSInvalid = exports.JWEInvalid = exports.JWEDecryptionFailed = exports.JOSENotSupported = exports.JOSEAlgNotAllowed = exports.JWTExpired = exports.JWTClaimValidationFailed = exports.JOSEError = void 0;\nclass JOSEError extends Error {\n    static code = 'ERR_JOSE_GENERIC';\n    code = 'ERR_JOSE_GENERIC';\n    constructor(message, options) {\n        super(message, options);\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nexports.JOSEError = JOSEError;\nclass JWTClaimValidationFailed extends JOSEError {\n    static code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n    code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n    claim;\n    reason;\n    payload;\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nexports.JWTClaimValidationFailed = JWTClaimValidationFailed;\nclass JWTExpired extends JOSEError {\n    static code = 'ERR_JWT_EXPIRED';\n    code = 'ERR_JWT_EXPIRED';\n    claim;\n    reason;\n    payload;\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nexports.JWTExpired = JWTExpired;\nclass JOSEAlgNotAllowed extends JOSEError {\n    static code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n}\nexports.JOSEAlgNotAllowed = JOSEAlgNotAllowed;\nclass JOSENotSupported extends JOSEError {\n    static code = 'ERR_JOSE_NOT_SUPPORTED';\n    code = 'ERR_JOSE_NOT_SUPPORTED';\n}\nexports.JOSENotSupported = JOSENotSupported;\nclass JWEDecryptionFailed extends JOSEError {\n    static code = 'ERR_JWE_DECRYPTION_FAILED';\n    code = 'ERR_JWE_DECRYPTION_FAILED';\n    constructor(message = 'decryption operation failed', options) {\n        super(message, options);\n    }\n}\nexports.JWEDecryptionFailed = JWEDecryptionFailed;\nclass JWEInvalid extends JOSEError {\n    static code = 'ERR_JWE_INVALID';\n    code = 'ERR_JWE_INVALID';\n}\nexports.JWEInvalid = JWEInvalid;\nclass JWSInvalid extends JOSEError {\n    static code = 'ERR_JWS_INVALID';\n    code = 'ERR_JWS_INVALID';\n}\nexports.JWSInvalid = JWSInvalid;\nclass JWTInvalid extends JOSEError {\n    static code = 'ERR_JWT_INVALID';\n    code = 'ERR_JWT_INVALID';\n}\nexports.JWTInvalid = JWTInvalid;\nclass JWKInvalid extends JOSEError {\n    static code = 'ERR_JWK_INVALID';\n    code = 'ERR_JWK_INVALID';\n}\nexports.JWKInvalid = JWKInvalid;\nclass JWKSInvalid extends JOSEError {\n    static code = 'ERR_JWKS_INVALID';\n    code = 'ERR_JWKS_INVALID';\n}\nexports.JWKSInvalid = JWKSInvalid;\nclass JWKSNoMatchingKey extends JOSEError {\n    static code = 'ERR_JWKS_NO_MATCHING_KEY';\n    code = 'ERR_JWKS_NO_MATCHING_KEY';\n    constructor(message = 'no applicable key found in the JSON Web Key Set', options) {\n        super(message, options);\n    }\n}\nexports.JWKSNoMatchingKey = JWKSNoMatchingKey;\nclass JWKSMultipleMatchingKeys extends JOSEError {\n    [Symbol.asyncIterator];\n    static code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    constructor(message = 'multiple matching keys found in the JSON Web Key Set', options) {\n        super(message, options);\n    }\n}\nexports.JWKSMultipleMatchingKeys = JWKSMultipleMatchingKeys;\nclass JWKSTimeout extends JOSEError {\n    static code = 'ERR_JWKS_TIMEOUT';\n    code = 'ERR_JWKS_TIMEOUT';\n    constructor(message = 'request timed out', options) {\n        super(message, options);\n    }\n}\nexports.JWKSTimeout = JWKSTimeout;\nclass JWSSignatureVerificationFailed extends JOSEError {\n    static code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    constructor(message = 'signature verification failed', options) {\n        super(message, options);\n    }\n}\nexports.JWSSignatureVerificationFailed = JWSSignatureVerificationFailed;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 6422, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6427, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/random.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = void 0;\nvar node_crypto_1 = require(\"node:crypto\");\nObject.defineProperty(exports, \"default\", { enumerable: true, get: function () { return node_crypto_1.randomFillSync; } });\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG,KAAK;AACvB,IAAI;AACJ,OAAO,cAAc,CAAC,SAAS,WAAW;IAAE,YAAY;IAAM,KAAK;QAAc,OAAO,cAAc,cAAc;IAAE;AAAE","ignoreList":[0]}},
    {"offset": {"line": 6439, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6444, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/iv.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.bitLength = bitLength;\nconst errors_js_1 = require(\"../util/errors.js\");\nconst random_js_1 = require(\"../runtime/random.js\");\nfunction bitLength(alg) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A128GCMKW':\n        case 'A192GCM':\n        case 'A192GCMKW':\n        case 'A256GCM':\n        case 'A256GCMKW':\n            return 96;\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            return 128;\n        default:\n            throw new errors_js_1.JOSENotSupported(`Unsupported JWE Algorithm: ${alg}`);\n    }\n}\nexports.default = (alg) => (0, random_js_1.default)(new Uint8Array(bitLength(alg) >> 3));\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,SAAS,GAAG;AACpB,MAAM;AACN,MAAM;AACN,SAAS,UAAU,GAAG;IAClB,OAAQ;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACD,OAAO;QACX,KAAK;QACL,KAAK;QACL,KAAK;YACD,OAAO;QACX;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,2BAA2B,EAAE,KAAK;IAClF;AACJ;AACA,QAAQ,OAAO,GAAG,CAAC,MAAQ,CAAC,GAAG,YAAY,OAAO,EAAE,IAAI,WAAW,UAAU,QAAQ","ignoreList":[0]}},
    {"offset": {"line": 6469, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6474, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/check_iv_length.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst errors_js_1 = require(\"../util/errors.js\");\nconst iv_js_1 = require(\"./iv.js\");\nconst checkIvLength = (enc, iv) => {\n    if (iv.length << 3 !== (0, iv_js_1.bitLength)(enc)) {\n        throw new errors_js_1.JWEInvalid('Invalid Initialization Vector length');\n    }\n};\nexports.default = checkIvLength;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM;AACN,MAAM,gBAAgB,CAAC,KAAK;IACxB,IAAI,GAAG,MAAM,IAAI,MAAM,CAAC,GAAG,QAAQ,SAAS,EAAE,MAAM;QAChD,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;AACJ;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 6486, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6491, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/is_key_object.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst util = require(\"node:util\");\nexports.default = (obj) => util.types.isKeyObject(obj);\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,QAAQ,OAAO,GAAG,CAAC,MAAQ,KAAK,KAAK,CAAC,WAAW,CAAC","ignoreList":[0]}},
    {"offset": {"line": 6497, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6502, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/check_cek_length.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst errors_js_1 = require(\"../util/errors.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst checkCekLength = (enc, cek) => {\n    let expected;\n    switch (enc) {\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            expected = parseInt(enc.slice(-3), 10);\n            break;\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            expected = parseInt(enc.slice(1, 4), 10);\n            break;\n        default:\n            throw new errors_js_1.JOSENotSupported(`Content Encryption Algorithm ${enc} is not supported either by JOSE or your javascript runtime`);\n    }\n    if (cek instanceof Uint8Array) {\n        const actual = cek.byteLength << 3;\n        if (actual !== expected) {\n            throw new errors_js_1.JWEInvalid(`Invalid Content Encryption Key length. Expected ${expected} bits, got ${actual} bits`);\n        }\n        return;\n    }\n    if ((0, is_key_object_js_1.default)(cek) && cek.type === 'secret') {\n        const actual = cek.symmetricKeySize << 3;\n        if (actual !== expected) {\n            throw new errors_js_1.JWEInvalid(`Invalid Content Encryption Key length. Expected ${expected} bits, got ${actual} bits`);\n        }\n        return;\n    }\n    throw new TypeError('Invalid Content Encryption Key type');\n};\nexports.default = checkCekLength;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM;AACN,MAAM,iBAAiB,CAAC,KAAK;IACzB,IAAI;IACJ,OAAQ;QACJ,KAAK;QACL,KAAK;QACL,KAAK;YACD,WAAW,SAAS,IAAI,KAAK,CAAC,CAAC,IAAI;YACnC;QACJ,KAAK;QACL,KAAK;QACL,KAAK;YACD,WAAW,SAAS,IAAI,KAAK,CAAC,GAAG,IAAI;YACrC;QACJ;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,6BAA6B,EAAE,IAAI,2DAA2D,CAAC;IAC/I;IACA,IAAI,eAAe,YAAY;QAC3B,MAAM,SAAS,IAAI,UAAU,IAAI;QACjC,IAAI,WAAW,UAAU;YACrB,MAAM,IAAI,YAAY,UAAU,CAAC,CAAC,gDAAgD,EAAE,SAAS,WAAW,EAAE,OAAO,KAAK,CAAC;QAC3H;QACA;IACJ;IACA,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,QAAQ,IAAI,IAAI,KAAK,UAAU;QAC/D,MAAM,SAAS,IAAI,gBAAgB,IAAI;QACvC,IAAI,WAAW,UAAU;YACrB,MAAM,IAAI,YAAY,UAAU,CAAC,CAAC,gDAAgD,EAAE,SAAS,WAAW,EAAE,OAAO,KAAK,CAAC;QAC3H;QACA;IACJ;IACA,MAAM,IAAI,UAAU;AACxB;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 6541, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6546, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/timing_safe_equal.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst node_crypto_1 = require(\"node:crypto\");\nconst timingSafeEqual = node_crypto_1.timingSafeEqual;\nexports.default = timingSafeEqual;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM,kBAAkB,cAAc,eAAe;AACrD,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 6553, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6558, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/cbc_tag.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = cbcTag;\nconst node_crypto_1 = require(\"node:crypto\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nfunction cbcTag(aad, iv, ciphertext, macSize, macKey, keySize) {\n    const macData = (0, buffer_utils_js_1.concat)(aad, iv, ciphertext, (0, buffer_utils_js_1.uint64be)(aad.length << 3));\n    const hmac = (0, node_crypto_1.createHmac)(`sha${macSize}`, macKey);\n    hmac.update(macData);\n    return hmac.digest().slice(0, keySize >> 3);\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG;AAClB,MAAM;AACN,MAAM;AACN,SAAS,OAAO,GAAG,EAAE,EAAE,EAAE,UAAU,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO;IACzD,MAAM,UAAU,CAAC,GAAG,kBAAkB,MAAM,EAAE,KAAK,IAAI,YAAY,CAAC,GAAG,kBAAkB,QAAQ,EAAE,IAAI,MAAM,IAAI;IACjH,MAAM,OAAO,CAAC,GAAG,cAAc,UAAU,EAAE,CAAC,GAAG,EAAE,SAAS,EAAE;IAC5D,KAAK,MAAM,CAAC;IACZ,OAAO,KAAK,MAAM,GAAG,KAAK,CAAC,GAAG,WAAW;AAC7C","ignoreList":[0]}},
    {"offset": {"line": 6571, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6576, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/webcrypto.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isCryptoKey = void 0;\nconst crypto = require(\"node:crypto\");\nconst util = require(\"node:util\");\nconst webcrypto = crypto.webcrypto;\nexports.default = webcrypto;\nconst isCryptoKey = (key) => util.types.isCryptoKey(key);\nexports.isCryptoKey = isCryptoKey;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,WAAW,GAAG,KAAK;AAC3B,MAAM;AACN,MAAM;AACN,MAAM,YAAY,OAAO,SAAS;AAClC,QAAQ,OAAO,GAAG;AAClB,MAAM,cAAc,CAAC,MAAQ,KAAK,KAAK,CAAC,WAAW,CAAC;AACpD,QAAQ,WAAW,GAAG","ignoreList":[0]}},
    {"offset": {"line": 6587, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6592, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/crypto_key.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.checkSigCryptoKey = checkSigCryptoKey;\nexports.checkEncCryptoKey = checkEncCryptoKey;\nfunction unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nfunction checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'EdDSA': {\n            if (key.algorithm.name !== 'Ed25519' && key.algorithm.name !== 'Ed448') {\n                throw unusable('Ed25519 or Ed448');\n            }\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nfunction checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                case 'X448':\n                    break;\n                default:\n                    throw unusable('ECDH, X25519, or X448');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 6742, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6747, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/invalid_key_input.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.withAlg = withAlg;\nfunction message(msg, actual, ...types) {\n    types = types.filter(Boolean);\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor?.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n}\nexports.default = (actual, ...types) => {\n    return message('Key must be ', actual, ...types);\n};\nfunction withAlg(alg, actual, ...types) {\n    return message(`Key for the ${alg} algorithm must be `, actual, ...types);\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG;AAClB,SAAS,QAAQ,GAAG,EAAE,MAAM,EAAE,GAAG,KAAK;IAClC,QAAQ,MAAM,MAAM,CAAC;IACrB,IAAI,MAAM,MAAM,GAAG,GAAG;QAClB,MAAM,OAAO,MAAM,GAAG;QACtB,OAAO,CAAC,YAAY,EAAE,MAAM,IAAI,CAAC,MAAM,KAAK,EAAE,KAAK,CAAC,CAAC;IACzD,OACK,IAAI,MAAM,MAAM,KAAK,GAAG;QACzB,OAAO,CAAC,YAAY,EAAE,KAAK,CAAC,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC;IACpD,OACK;QACD,OAAO,CAAC,QAAQ,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC;IACjC;IACA,IAAI,UAAU,MAAM;QAChB,OAAO,CAAC,UAAU,EAAE,QAAQ;IAChC,OACK,IAAI,OAAO,WAAW,cAAc,OAAO,IAAI,EAAE;QAClD,OAAO,CAAC,mBAAmB,EAAE,OAAO,IAAI,EAAE;IAC9C,OACK,IAAI,OAAO,WAAW,YAAY,UAAU,MAAM;QACnD,IAAI,OAAO,WAAW,EAAE,MAAM;YAC1B,OAAO,CAAC,yBAAyB,EAAE,OAAO,WAAW,CAAC,IAAI,EAAE;QAChE;IACJ;IACA,OAAO;AACX;AACA,QAAQ,OAAO,GAAG,CAAC,QAAQ,GAAG;IAC1B,OAAO,QAAQ,gBAAgB,WAAW;AAC9C;AACA,SAAS,QAAQ,GAAG,EAAE,MAAM,EAAE,GAAG,KAAK;IAClC,OAAO,QAAQ,CAAC,YAAY,EAAE,IAAI,mBAAmB,CAAC,EAAE,WAAW;AACvE","ignoreList":[0]}},
    {"offset": {"line": 6779, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6784, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/ciphers.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst node_crypto_1 = require(\"node:crypto\");\nlet ciphers;\nexports.default = (algorithm) => {\n    ciphers ||= new Set((0, node_crypto_1.getCiphers)());\n    return ciphers.has(algorithm);\n};\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,IAAI;AACJ,QAAQ,OAAO,GAAG,CAAC;IACf,YAAY,IAAI,IAAI,CAAC,GAAG,cAAc,UAAU;IAChD,OAAO,QAAQ,GAAG,CAAC;AACvB","ignoreList":[0]}},
    {"offset": {"line": 6794, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6799, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/is_key_like.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.types = void 0;\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nexports.default = (key) => (0, is_key_object_js_1.default)(key) || (0, webcrypto_js_1.isCryptoKey)(key);\nconst types = ['KeyObject'];\nexports.types = types;\nif (globalThis.CryptoKey || webcrypto_js_1.default?.CryptoKey) {\n    types.push('CryptoKey');\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,KAAK,GAAG,KAAK;AACrB,MAAM;AACN,MAAM;AACN,QAAQ,OAAO,GAAG,CAAC,MAAQ,CAAC,GAAG,mBAAmB,OAAO,EAAE,QAAQ,CAAC,GAAG,eAAe,WAAW,EAAE;AACnG,MAAM,QAAQ;IAAC;CAAY;AAC3B,QAAQ,KAAK,GAAG;AAChB,IAAI,WAAW,SAAS,IAAI,eAAe,OAAO,EAAE,WAAW;IAC3D,MAAM,IAAI,CAAC;AACf","ignoreList":[0]}},
    {"offset": {"line": 6814, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6819, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/decrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst node_crypto_1 = require(\"node:crypto\");\nconst check_iv_length_js_1 = require(\"../lib/check_iv_length.js\");\nconst check_cek_length_js_1 = require(\"./check_cek_length.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst timing_safe_equal_js_1 = require(\"./timing_safe_equal.js\");\nconst cbc_tag_js_1 = require(\"./cbc_tag.js\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst crypto_key_js_1 = require(\"../lib/crypto_key.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst ciphers_js_1 = require(\"./ciphers.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nfunction cbcDecrypt(enc, cek, ciphertext, iv, tag, aad) {\n    const keySize = parseInt(enc.slice(1, 4), 10);\n    if ((0, is_key_object_js_1.default)(cek)) {\n        cek = cek.export();\n    }\n    const encKey = cek.subarray(keySize >> 3);\n    const macKey = cek.subarray(0, keySize >> 3);\n    const macSize = parseInt(enc.slice(-3), 10);\n    const algorithm = `aes-${keySize}-cbc`;\n    if (!(0, ciphers_js_1.default)(algorithm)) {\n        throw new errors_js_1.JOSENotSupported(`alg ${enc} is not supported by your javascript runtime`);\n    }\n    const expectedTag = (0, cbc_tag_js_1.default)(aad, iv, ciphertext, macSize, macKey, keySize);\n    let macCheckPassed;\n    try {\n        macCheckPassed = (0, timing_safe_equal_js_1.default)(tag, expectedTag);\n    }\n    catch {\n    }\n    if (!macCheckPassed) {\n        throw new errors_js_1.JWEDecryptionFailed();\n    }\n    let plaintext;\n    try {\n        const decipher = (0, node_crypto_1.createDecipheriv)(algorithm, encKey, iv);\n        plaintext = (0, buffer_utils_js_1.concat)(decipher.update(ciphertext), decipher.final());\n    }\n    catch {\n    }\n    if (!plaintext) {\n        throw new errors_js_1.JWEDecryptionFailed();\n    }\n    return plaintext;\n}\nfunction gcmDecrypt(enc, cek, ciphertext, iv, tag, aad) {\n    const keySize = parseInt(enc.slice(1, 4), 10);\n    const algorithm = `aes-${keySize}-gcm`;\n    if (!(0, ciphers_js_1.default)(algorithm)) {\n        throw new errors_js_1.JOSENotSupported(`alg ${enc} is not supported by your javascript runtime`);\n    }\n    try {\n        const decipher = (0, node_crypto_1.createDecipheriv)(algorithm, cek, iv, { authTagLength: 16 });\n        decipher.setAuthTag(tag);\n        if (aad.byteLength) {\n            decipher.setAAD(aad, { plaintextLength: ciphertext.length });\n        }\n        const plaintext = decipher.update(ciphertext);\n        decipher.final();\n        return plaintext;\n    }\n    catch {\n        throw new errors_js_1.JWEDecryptionFailed();\n    }\n}\nconst decrypt = (enc, cek, ciphertext, iv, tag, aad) => {\n    let key;\n    if ((0, webcrypto_js_1.isCryptoKey)(cek)) {\n        (0, crypto_key_js_1.checkEncCryptoKey)(cek, enc, 'decrypt');\n        key = node_crypto_1.KeyObject.from(cek);\n    }\n    else if (cek instanceof Uint8Array || (0, is_key_object_js_1.default)(cek)) {\n        key = cek;\n    }\n    else {\n        throw new TypeError((0, invalid_key_input_js_1.default)(cek, ...is_key_like_js_1.types, 'Uint8Array'));\n    }\n    if (!iv) {\n        throw new errors_js_1.JWEInvalid('JWE Initialization Vector missing');\n    }\n    if (!tag) {\n        throw new errors_js_1.JWEInvalid('JWE Authentication Tag missing');\n    }\n    (0, check_cek_length_js_1.default)(enc, key);\n    (0, check_iv_length_js_1.default)(enc, iv);\n    switch (enc) {\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            return cbcDecrypt(enc, key, ciphertext, iv, tag, aad);\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            return gcmDecrypt(enc, key, ciphertext, iv, tag, aad);\n        default:\n            throw new errors_js_1.JOSENotSupported('Unsupported JWE Content Encryption Algorithm');\n    }\n};\nexports.default = decrypt;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 6921, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6926, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/is_disjoint.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst isDisjoint = (...headers) => {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n};\nexports.default = isDisjoint;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM,aAAa,CAAC,GAAG;IACnB,MAAM,UAAU,QAAQ,MAAM,CAAC;IAC/B,IAAI,QAAQ,MAAM,KAAK,KAAK,QAAQ,MAAM,KAAK,GAAG;QAC9C,OAAO;IACX;IACA,IAAI;IACJ,KAAK,MAAM,UAAU,QAAS;QAC1B,MAAM,aAAa,OAAO,IAAI,CAAC;QAC/B,IAAI,CAAC,OAAO,IAAI,IAAI,KAAK,GAAG;YACxB,MAAM,IAAI,IAAI;YACd;QACJ;QACA,KAAK,MAAM,aAAa,WAAY;YAChC,IAAI,IAAI,GAAG,CAAC,YAAY;gBACpB,OAAO;YACX;YACA,IAAI,GAAG,CAAC;QACZ;IACJ;IACA,OAAO;AACX;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 6952, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6957, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/is_object.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = isObject;\nfunction isObjectLike(value) {\n    return typeof value === 'object' && value !== null;\n}\nfunction isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG;AAClB,SAAS,aAAa,KAAK;IACvB,OAAO,OAAO,UAAU,YAAY,UAAU;AAClD;AACA,SAAS,SAAS,KAAK;IACnB,IAAI,CAAC,aAAa,UAAU,OAAO,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,mBAAmB;QACrF,OAAO;IACX;IACA,IAAI,OAAO,cAAc,CAAC,WAAW,MAAM;QACvC,OAAO;IACX;IACA,IAAI,QAAQ;IACZ,MAAO,OAAO,cAAc,CAAC,WAAW,KAAM;QAC1C,QAAQ,OAAO,cAAc,CAAC;IAClC;IACA,OAAO,OAAO,cAAc,CAAC,WAAW;AAC5C","ignoreList":[0]}},
    {"offset": {"line": 6978, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 6983, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/aeskw.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.unwrap = exports.wrap = void 0;\nconst node_buffer_1 = require(\"node:buffer\");\nconst node_crypto_1 = require(\"node:crypto\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst crypto_key_js_1 = require(\"../lib/crypto_key.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst ciphers_js_1 = require(\"./ciphers.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nfunction checkKeySize(key, alg) {\n    if (key.symmetricKeySize << 3 !== parseInt(alg.slice(1, 4), 10)) {\n        throw new TypeError(`Invalid key size for alg: ${alg}`);\n    }\n}\nfunction ensureKeyObject(key, alg, usage) {\n    if ((0, is_key_object_js_1.default)(key)) {\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        return (0, node_crypto_1.createSecretKey)(key);\n    }\n    if ((0, webcrypto_js_1.isCryptoKey)(key)) {\n        (0, crypto_key_js_1.checkEncCryptoKey)(key, alg, usage);\n        return node_crypto_1.KeyObject.from(key);\n    }\n    throw new TypeError((0, invalid_key_input_js_1.default)(key, ...is_key_like_js_1.types, 'Uint8Array'));\n}\nconst wrap = (alg, key, cek) => {\n    const size = parseInt(alg.slice(1, 4), 10);\n    const algorithm = `aes${size}-wrap`;\n    if (!(0, ciphers_js_1.default)(algorithm)) {\n        throw new errors_js_1.JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n    const keyObject = ensureKeyObject(key, alg, 'wrapKey');\n    checkKeySize(keyObject, alg);\n    const cipher = (0, node_crypto_1.createCipheriv)(algorithm, keyObject, node_buffer_1.Buffer.alloc(8, 0xa6));\n    return (0, buffer_utils_js_1.concat)(cipher.update(cek), cipher.final());\n};\nexports.wrap = wrap;\nconst unwrap = (alg, key, encryptedKey) => {\n    const size = parseInt(alg.slice(1, 4), 10);\n    const algorithm = `aes${size}-wrap`;\n    if (!(0, ciphers_js_1.default)(algorithm)) {\n        throw new errors_js_1.JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n    const keyObject = ensureKeyObject(key, alg, 'unwrapKey');\n    checkKeySize(keyObject, alg);\n    const cipher = (0, node_crypto_1.createDecipheriv)(algorithm, keyObject, node_buffer_1.Buffer.alloc(8, 0xa6));\n    return (0, buffer_utils_js_1.concat)(cipher.update(encryptedKey), cipher.final());\n};\nexports.unwrap = unwrap;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,MAAM,GAAG,QAAQ,IAAI,GAAG,KAAK;AACrC,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,SAAS,aAAa,GAAG,EAAE,GAAG;IAC1B,IAAI,IAAI,gBAAgB,IAAI,MAAM,SAAS,IAAI,KAAK,CAAC,GAAG,IAAI,KAAK;QAC7D,MAAM,IAAI,UAAU,CAAC,0BAA0B,EAAE,KAAK;IAC1D;AACJ;AACA,SAAS,gBAAgB,GAAG,EAAE,GAAG,EAAE,KAAK;IACpC,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,MAAM;QACtC,OAAO;IACX;IACA,IAAI,eAAe,YAAY;QAC3B,OAAO,CAAC,GAAG,cAAc,eAAe,EAAE;IAC9C;IACA,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,MAAM;QACtC,CAAC,GAAG,gBAAgB,iBAAiB,EAAE,KAAK,KAAK;QACjD,OAAO,cAAc,SAAS,CAAC,IAAI,CAAC;IACxC;IACA,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK,EAAE;AAC5F;AACA,MAAM,OAAO,CAAC,KAAK,KAAK;IACpB,MAAM,OAAO,SAAS,IAAI,KAAK,CAAC,GAAG,IAAI;IACvC,MAAM,YAAY,CAAC,GAAG,EAAE,KAAK,KAAK,CAAC;IACnC,IAAI,CAAC,CAAC,GAAG,aAAa,OAAO,EAAE,YAAY;QACvC,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,IAAI,EAAE,IAAI,2DAA2D,CAAC;IAClH;IACA,MAAM,YAAY,gBAAgB,KAAK,KAAK;IAC5C,aAAa,WAAW;IACxB,MAAM,SAAS,CAAC,GAAG,cAAc,cAAc,EAAE,WAAW,WAAW,cAAc,MAAM,CAAC,KAAK,CAAC,GAAG;IACrG,OAAO,CAAC,GAAG,kBAAkB,MAAM,EAAE,OAAO,MAAM,CAAC,MAAM,OAAO,KAAK;AACzE;AACA,QAAQ,IAAI,GAAG;AACf,MAAM,SAAS,CAAC,KAAK,KAAK;IACtB,MAAM,OAAO,SAAS,IAAI,KAAK,CAAC,GAAG,IAAI;IACvC,MAAM,YAAY,CAAC,GAAG,EAAE,KAAK,KAAK,CAAC;IACnC,IAAI,CAAC,CAAC,GAAG,aAAa,OAAO,EAAE,YAAY;QACvC,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,IAAI,EAAE,IAAI,2DAA2D,CAAC;IAClH;IACA,MAAM,YAAY,gBAAgB,KAAK,KAAK;IAC5C,aAAa,WAAW;IACxB,MAAM,SAAS,CAAC,GAAG,cAAc,gBAAgB,EAAE,WAAW,WAAW,cAAc,MAAM,CAAC,KAAK,CAAC,GAAG;IACvG,OAAO,CAAC,GAAG,kBAAkB,MAAM,EAAE,OAAO,MAAM,CAAC,eAAe,OAAO,KAAK;AAClF;AACA,QAAQ,MAAM,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7040, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7045, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/is_jwk.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isJWK = isJWK;\nexports.isPrivateJWK = isPrivateJWK;\nexports.isPublicJWK = isPublicJWK;\nexports.isSecretJWK = isSecretJWK;\nconst is_object_js_1 = require(\"./is_object.js\");\nfunction isJWK(key) {\n    return (0, is_object_js_1.default)(key) && typeof key.kty === 'string';\n}\nfunction isPrivateJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'string';\n}\nfunction isPublicJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'undefined';\n}\nfunction isSecretJWK(key) {\n    return isJWK(key) && key.kty === 'oct' && typeof key.k === 'string';\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,KAAK,GAAG;AAChB,QAAQ,YAAY,GAAG;AACvB,QAAQ,WAAW,GAAG;AACtB,QAAQ,WAAW,GAAG;AACtB,MAAM;AACN,SAAS,MAAM,GAAG;IACd,OAAO,CAAC,GAAG,eAAe,OAAO,EAAE,QAAQ,OAAO,IAAI,GAAG,KAAK;AAClE;AACA,SAAS,aAAa,GAAG;IACrB,OAAO,IAAI,GAAG,KAAK,SAAS,OAAO,IAAI,CAAC,KAAK;AACjD;AACA,SAAS,YAAY,GAAG;IACpB,OAAO,IAAI,GAAG,KAAK,SAAS,OAAO,IAAI,CAAC,KAAK;AACjD;AACA,SAAS,YAAY,GAAG;IACpB,OAAO,MAAM,QAAQ,IAAI,GAAG,KAAK,SAAS,OAAO,IAAI,CAAC,KAAK;AAC/D","ignoreList":[0]}},
    {"offset": {"line": 7066, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7071, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/get_named_curve.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.weakMap = void 0;\nconst node_crypto_1 = require(\"node:crypto\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nconst is_jwk_js_1 = require(\"../lib/is_jwk.js\");\nexports.weakMap = new WeakMap();\nconst namedCurveToJOSE = (namedCurve) => {\n    switch (namedCurve) {\n        case 'prime256v1':\n            return 'P-256';\n        case 'secp384r1':\n            return 'P-384';\n        case 'secp521r1':\n            return 'P-521';\n        case 'secp256k1':\n            return 'secp256k1';\n        default:\n            throw new errors_js_1.JOSENotSupported('Unsupported key curve for this operation');\n    }\n};\nconst getNamedCurve = (kee, raw) => {\n    let key;\n    if ((0, webcrypto_js_1.isCryptoKey)(kee)) {\n        key = node_crypto_1.KeyObject.from(kee);\n    }\n    else if ((0, is_key_object_js_1.default)(kee)) {\n        key = kee;\n    }\n    else if ((0, is_jwk_js_1.isJWK)(kee)) {\n        return kee.crv;\n    }\n    else {\n        throw new TypeError((0, invalid_key_input_js_1.default)(kee, ...is_key_like_js_1.types));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError('only \"private\" or \"public\" type keys can be used for this operation');\n    }\n    switch (key.asymmetricKeyType) {\n        case 'ed25519':\n        case 'ed448':\n            return `Ed${key.asymmetricKeyType.slice(2)}`;\n        case 'x25519':\n        case 'x448':\n            return `X${key.asymmetricKeyType.slice(1)}`;\n        case 'ec': {\n            const namedCurve = key.asymmetricKeyDetails.namedCurve;\n            if (raw) {\n                return namedCurve;\n            }\n            return namedCurveToJOSE(namedCurve);\n        }\n        default:\n            throw new TypeError('Invalid asymmetric key type for this operation');\n    }\n};\nexports.default = getNamedCurve;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG,KAAK;AACvB,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,QAAQ,OAAO,GAAG,IAAI;AACtB,MAAM,mBAAmB,CAAC;IACtB,OAAQ;QACJ,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC;IAC/C;AACJ;AACA,MAAM,gBAAgB,CAAC,KAAK;IACxB,IAAI;IACJ,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,MAAM;QACtC,MAAM,cAAc,SAAS,CAAC,IAAI,CAAC;IACvC,OACK,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,MAAM;QAC3C,MAAM;IACV,OACK,IAAI,CAAC,GAAG,YAAY,KAAK,EAAE,MAAM;QAClC,OAAO,IAAI,GAAG;IAClB,OACK;QACD,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK;IAC1F;IACA,IAAI,IAAI,IAAI,KAAK,UAAU;QACvB,MAAM,IAAI,UAAU;IACxB;IACA,OAAQ,IAAI,iBAAiB;QACzB,KAAK;QACL,KAAK;YACD,OAAO,CAAC,EAAE,EAAE,IAAI,iBAAiB,CAAC,KAAK,CAAC,IAAI;QAChD,KAAK;QACL,KAAK;YACD,OAAO,CAAC,CAAC,EAAE,IAAI,iBAAiB,CAAC,KAAK,CAAC,IAAI;QAC/C,KAAK;YAAM;gBACP,MAAM,aAAa,IAAI,oBAAoB,CAAC,UAAU;gBACtD,IAAI,KAAK;oBACL,OAAO;gBACX;gBACA,OAAO,iBAAiB;YAC5B;QACA;YACI,MAAM,IAAI,UAAU;IAC5B;AACJ;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7132, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7137, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/ecdhes.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ecdhAllowed = void 0;\nexports.deriveKey = deriveKey;\nexports.generateEpk = generateEpk;\nconst node_crypto_1 = require(\"node:crypto\");\nconst node_util_1 = require(\"node:util\");\nconst get_named_curve_js_1 = require(\"./get_named_curve.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst crypto_key_js_1 = require(\"../lib/crypto_key.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nconst generateKeyPair = (0, node_util_1.promisify)(node_crypto_1.generateKeyPair);\nasync function deriveKey(publicKee, privateKee, algorithm, keyLength, apu = new Uint8Array(0), apv = new Uint8Array(0)) {\n    let publicKey;\n    if ((0, webcrypto_js_1.isCryptoKey)(publicKee)) {\n        (0, crypto_key_js_1.checkEncCryptoKey)(publicKee, 'ECDH');\n        publicKey = node_crypto_1.KeyObject.from(publicKee);\n    }\n    else if ((0, is_key_object_js_1.default)(publicKee)) {\n        publicKey = publicKee;\n    }\n    else {\n        throw new TypeError((0, invalid_key_input_js_1.default)(publicKee, ...is_key_like_js_1.types));\n    }\n    let privateKey;\n    if ((0, webcrypto_js_1.isCryptoKey)(privateKee)) {\n        (0, crypto_key_js_1.checkEncCryptoKey)(privateKee, 'ECDH', 'deriveBits');\n        privateKey = node_crypto_1.KeyObject.from(privateKee);\n    }\n    else if ((0, is_key_object_js_1.default)(privateKee)) {\n        privateKey = privateKee;\n    }\n    else {\n        throw new TypeError((0, invalid_key_input_js_1.default)(privateKee, ...is_key_like_js_1.types));\n    }\n    const value = (0, buffer_utils_js_1.concat)((0, buffer_utils_js_1.lengthAndInput)(buffer_utils_js_1.encoder.encode(algorithm)), (0, buffer_utils_js_1.lengthAndInput)(apu), (0, buffer_utils_js_1.lengthAndInput)(apv), (0, buffer_utils_js_1.uint32be)(keyLength));\n    const sharedSecret = (0, node_crypto_1.diffieHellman)({ privateKey, publicKey });\n    return (0, buffer_utils_js_1.concatKdf)(sharedSecret, keyLength, value);\n}\nasync function generateEpk(kee) {\n    let key;\n    if ((0, webcrypto_js_1.isCryptoKey)(kee)) {\n        key = node_crypto_1.KeyObject.from(kee);\n    }\n    else if ((0, is_key_object_js_1.default)(kee)) {\n        key = kee;\n    }\n    else {\n        throw new TypeError((0, invalid_key_input_js_1.default)(kee, ...is_key_like_js_1.types));\n    }\n    switch (key.asymmetricKeyType) {\n        case 'x25519':\n            return generateKeyPair('x25519');\n        case 'x448': {\n            return generateKeyPair('x448');\n        }\n        case 'ec': {\n            const namedCurve = (0, get_named_curve_js_1.default)(key);\n            return generateKeyPair('ec', { namedCurve });\n        }\n        default:\n            throw new errors_js_1.JOSENotSupported('Invalid or unsupported EPK');\n    }\n}\nconst ecdhAllowed = (key) => ['P-256', 'P-384', 'P-521', 'X25519', 'X448'].includes((0, get_named_curve_js_1.default)(key));\nexports.ecdhAllowed = ecdhAllowed;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,WAAW,GAAG,KAAK;AAC3B,QAAQ,SAAS,GAAG;AACpB,QAAQ,WAAW,GAAG;AACtB,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,kBAAkB,CAAC,GAAG,YAAY,SAAS,EAAE,cAAc,eAAe;AAChF,eAAe,UAAU,SAAS,EAAE,UAAU,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,IAAI,WAAW,EAAE,EAAE,MAAM,IAAI,WAAW,EAAE;IAClH,IAAI;IACJ,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,YAAY;QAC5C,CAAC,GAAG,gBAAgB,iBAAiB,EAAE,WAAW;QAClD,YAAY,cAAc,SAAS,CAAC,IAAI,CAAC;IAC7C,OACK,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,YAAY;QACjD,YAAY;IAChB,OACK;QACD,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,cAAc,iBAAiB,KAAK;IAChG;IACA,IAAI;IACJ,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,aAAa;QAC7C,CAAC,GAAG,gBAAgB,iBAAiB,EAAE,YAAY,QAAQ;QAC3D,aAAa,cAAc,SAAS,CAAC,IAAI,CAAC;IAC9C,OACK,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,aAAa;QAClD,aAAa;IACjB,OACK;QACD,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,eAAe,iBAAiB,KAAK;IACjG;IACA,MAAM,QAAQ,CAAC,GAAG,kBAAkB,MAAM,EAAE,CAAC,GAAG,kBAAkB,cAAc,EAAE,kBAAkB,OAAO,CAAC,MAAM,CAAC,aAAa,CAAC,GAAG,kBAAkB,cAAc,EAAE,MAAM,CAAC,GAAG,kBAAkB,cAAc,EAAE,MAAM,CAAC,GAAG,kBAAkB,QAAQ,EAAE;IACxP,MAAM,eAAe,CAAC,GAAG,cAAc,aAAa,EAAE;QAAE;QAAY;IAAU;IAC9E,OAAO,CAAC,GAAG,kBAAkB,SAAS,EAAE,cAAc,WAAW;AACrE;AACA,eAAe,YAAY,GAAG;IAC1B,IAAI;IACJ,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,MAAM;QACtC,MAAM,cAAc,SAAS,CAAC,IAAI,CAAC;IACvC,OACK,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,MAAM;QAC3C,MAAM;IACV,OACK;QACD,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK;IAC1F;IACA,OAAQ,IAAI,iBAAiB;QACzB,KAAK;YACD,OAAO,gBAAgB;QAC3B,KAAK;YAAQ;gBACT,OAAO,gBAAgB;YAC3B;QACA,KAAK;YAAM;gBACP,MAAM,aAAa,CAAC,GAAG,qBAAqB,OAAO,EAAE;gBACrD,OAAO,gBAAgB,MAAM;oBAAE;gBAAW;YAC9C;QACA;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC;IAC/C;AACJ;AACA,MAAM,cAAc,CAAC,MAAQ;QAAC;QAAS;QAAS;QAAS;QAAU;KAAO,CAAC,QAAQ,CAAC,CAAC,GAAG,qBAAqB,OAAO,EAAE;AACtH,QAAQ,WAAW,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7216, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7221, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/check_p2s.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = checkP2s;\nconst errors_js_1 = require(\"../util/errors.js\");\nfunction checkP2s(p2s) {\n    if (!(p2s instanceof Uint8Array) || p2s.length < 8) {\n        throw new errors_js_1.JWEInvalid('PBES2 Salt Input must be 8 or more octets');\n    }\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG;AAClB,MAAM;AACN,SAAS,SAAS,GAAG;IACjB,IAAI,CAAC,CAAC,eAAe,UAAU,KAAK,IAAI,MAAM,GAAG,GAAG;QAChD,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;AACJ","ignoreList":[0]}},
    {"offset": {"line": 7232, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7237, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/pbes2kw.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decrypt = exports.encrypt = void 0;\nconst node_util_1 = require(\"node:util\");\nconst node_crypto_1 = require(\"node:crypto\");\nconst random_js_1 = require(\"./random.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst base64url_js_1 = require(\"./base64url.js\");\nconst aeskw_js_1 = require(\"./aeskw.js\");\nconst check_p2s_js_1 = require(\"../lib/check_p2s.js\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst crypto_key_js_1 = require(\"../lib/crypto_key.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nconst pbkdf2 = (0, node_util_1.promisify)(node_crypto_1.pbkdf2);\nfunction getPassword(key, alg) {\n    if ((0, is_key_object_js_1.default)(key)) {\n        return key.export();\n    }\n    if (key instanceof Uint8Array) {\n        return key;\n    }\n    if ((0, webcrypto_js_1.isCryptoKey)(key)) {\n        (0, crypto_key_js_1.checkEncCryptoKey)(key, alg, 'deriveBits', 'deriveKey');\n        return node_crypto_1.KeyObject.from(key).export();\n    }\n    throw new TypeError((0, invalid_key_input_js_1.default)(key, ...is_key_like_js_1.types, 'Uint8Array'));\n}\nconst encrypt = async (alg, key, cek, p2c = 2048, p2s = (0, random_js_1.default)(new Uint8Array(16))) => {\n    (0, check_p2s_js_1.default)(p2s);\n    const salt = (0, buffer_utils_js_1.p2s)(alg, p2s);\n    const keylen = parseInt(alg.slice(13, 16), 10) >> 3;\n    const password = getPassword(key, alg);\n    const derivedKey = await pbkdf2(password, salt, p2c, keylen, `sha${alg.slice(8, 11)}`);\n    const encryptedKey = await (0, aeskw_js_1.wrap)(alg.slice(-6), derivedKey, cek);\n    return { encryptedKey, p2c, p2s: (0, base64url_js_1.encode)(p2s) };\n};\nexports.encrypt = encrypt;\nconst decrypt = async (alg, key, encryptedKey, p2c, p2s) => {\n    (0, check_p2s_js_1.default)(p2s);\n    const salt = (0, buffer_utils_js_1.p2s)(alg, p2s);\n    const keylen = parseInt(alg.slice(13, 16), 10) >> 3;\n    const password = getPassword(key, alg);\n    const derivedKey = await pbkdf2(password, salt, p2c, keylen, `sha${alg.slice(8, 11)}`);\n    return (0, aeskw_js_1.unwrap)(alg.slice(-6), derivedKey, encryptedKey);\n};\nexports.decrypt = decrypt;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG,QAAQ,OAAO,GAAG,KAAK;AACzC,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,SAAS,CAAC,GAAG,YAAY,SAAS,EAAE,cAAc,MAAM;AAC9D,SAAS,YAAY,GAAG,EAAE,GAAG;IACzB,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,MAAM;QACtC,OAAO,IAAI,MAAM;IACrB;IACA,IAAI,eAAe,YAAY;QAC3B,OAAO;IACX;IACA,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,MAAM;QACtC,CAAC,GAAG,gBAAgB,iBAAiB,EAAE,KAAK,KAAK,cAAc;QAC/D,OAAO,cAAc,SAAS,CAAC,IAAI,CAAC,KAAK,MAAM;IACnD;IACA,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK,EAAE;AAC5F;AACA,MAAM,UAAU,OAAO,KAAK,KAAK,KAAK,MAAM,IAAI,EAAE,MAAM,CAAC,GAAG,YAAY,OAAO,EAAE,IAAI,WAAW,IAAI;IAChG,CAAC,GAAG,eAAe,OAAO,EAAE;IAC5B,MAAM,OAAO,CAAC,GAAG,kBAAkB,GAAG,EAAE,KAAK;IAC7C,MAAM,SAAS,SAAS,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO;IAClD,MAAM,WAAW,YAAY,KAAK;IAClC,MAAM,aAAa,MAAM,OAAO,UAAU,MAAM,KAAK,QAAQ,CAAC,GAAG,EAAE,IAAI,KAAK,CAAC,GAAG,KAAK;IACrF,MAAM,eAAe,MAAM,CAAC,GAAG,WAAW,IAAI,EAAE,IAAI,KAAK,CAAC,CAAC,IAAI,YAAY;IAC3E,OAAO;QAAE;QAAc;QAAK,KAAK,CAAC,GAAG,eAAe,MAAM,EAAE;IAAK;AACrE;AACA,QAAQ,OAAO,GAAG;AAClB,MAAM,UAAU,OAAO,KAAK,KAAK,cAAc,KAAK;IAChD,CAAC,GAAG,eAAe,OAAO,EAAE;IAC5B,MAAM,OAAO,CAAC,GAAG,kBAAkB,GAAG,EAAE,KAAK;IAC7C,MAAM,SAAS,SAAS,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO;IAClD,MAAM,WAAW,YAAY,KAAK;IAClC,MAAM,aAAa,MAAM,OAAO,UAAU,MAAM,KAAK,QAAQ,CAAC,GAAG,EAAE,IAAI,KAAK,CAAC,GAAG,KAAK;IACrF,OAAO,CAAC,GAAG,WAAW,MAAM,EAAE,IAAI,KAAK,CAAC,CAAC,IAAI,YAAY;AAC7D;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7291, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7296, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/check_key_length.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst node_crypto_1 = require(\"node:crypto\");\nexports.default = (key, alg) => {\n    let modulusLength;\n    try {\n        if (key instanceof node_crypto_1.KeyObject) {\n            modulusLength = key.asymmetricKeyDetails?.modulusLength;\n        }\n        else {\n            modulusLength = Buffer.from(key.n, 'base64url').byteLength << 3;\n        }\n    }\n    catch { }\n    if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n        throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n    }\n};\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,QAAQ,OAAO,GAAG,CAAC,KAAK;IACpB,IAAI;IACJ,IAAI;QACA,IAAI,eAAe,cAAc,SAAS,EAAE;YACxC,gBAAgB,IAAI,oBAAoB,EAAE;QAC9C,OACK;YACD,gBAAgB,OAAO,IAAI,CAAC,IAAI,CAAC,EAAE,aAAa,UAAU,IAAI;QAClE;IACJ,EACA,OAAM,CAAE;IACR,IAAI,OAAO,kBAAkB,YAAY,gBAAgB,MAAM;QAC3D,MAAM,IAAI,UAAU,GAAG,IAAI,qDAAqD,CAAC;IACrF;AACJ","ignoreList":[0]}},
    {"offset": {"line": 7314, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7319, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/rsaes.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decrypt = exports.encrypt = void 0;\nconst node_crypto_1 = require(\"node:crypto\");\nconst node_util_1 = require(\"node:util\");\nconst check_key_length_js_1 = require(\"./check_key_length.js\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst crypto_key_js_1 = require(\"../lib/crypto_key.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nconst checkKey = (key, alg) => {\n    if (key.asymmetricKeyType !== 'rsa') {\n        throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be rsa');\n    }\n    (0, check_key_length_js_1.default)(key, alg);\n};\nconst RSA1_5 = (0, node_util_1.deprecate)(() => node_crypto_1.constants.RSA_PKCS1_PADDING, 'The RSA1_5 \"alg\" (JWE Algorithm) is deprecated and will be removed in the next major revision.');\nconst resolvePadding = (alg) => {\n    switch (alg) {\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            return node_crypto_1.constants.RSA_PKCS1_OAEP_PADDING;\n        case 'RSA1_5':\n            return RSA1_5();\n        default:\n            return undefined;\n    }\n};\nconst resolveOaepHash = (alg) => {\n    switch (alg) {\n        case 'RSA-OAEP':\n            return 'sha1';\n        case 'RSA-OAEP-256':\n            return 'sha256';\n        case 'RSA-OAEP-384':\n            return 'sha384';\n        case 'RSA-OAEP-512':\n            return 'sha512';\n        default:\n            return undefined;\n    }\n};\nfunction ensureKeyObject(key, alg, ...usages) {\n    if ((0, is_key_object_js_1.default)(key)) {\n        return key;\n    }\n    if ((0, webcrypto_js_1.isCryptoKey)(key)) {\n        (0, crypto_key_js_1.checkEncCryptoKey)(key, alg, ...usages);\n        return node_crypto_1.KeyObject.from(key);\n    }\n    throw new TypeError((0, invalid_key_input_js_1.default)(key, ...is_key_like_js_1.types));\n}\nconst encrypt = (alg, key, cek) => {\n    const padding = resolvePadding(alg);\n    const oaepHash = resolveOaepHash(alg);\n    const keyObject = ensureKeyObject(key, alg, 'wrapKey', 'encrypt');\n    checkKey(keyObject, alg);\n    return (0, node_crypto_1.publicEncrypt)({ key: keyObject, oaepHash, padding }, cek);\n};\nexports.encrypt = encrypt;\nconst decrypt = (alg, key, encryptedKey) => {\n    const padding = resolvePadding(alg);\n    const oaepHash = resolveOaepHash(alg);\n    const keyObject = ensureKeyObject(key, alg, 'unwrapKey', 'decrypt');\n    checkKey(keyObject, alg);\n    return (0, node_crypto_1.privateDecrypt)({ key: keyObject, oaepHash, padding }, encryptedKey);\n};\nexports.decrypt = decrypt;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG,QAAQ,OAAO,GAAG,KAAK;AACzC,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,WAAW,CAAC,KAAK;IACnB,IAAI,IAAI,iBAAiB,KAAK,OAAO;QACjC,MAAM,IAAI,UAAU;IACxB;IACA,CAAC,GAAG,sBAAsB,OAAO,EAAE,KAAK;AAC5C;AACA,MAAM,SAAS,CAAC,GAAG,YAAY,SAAS,EAAE,IAAM,cAAc,SAAS,CAAC,iBAAiB,EAAE;AAC3F,MAAM,iBAAiB,CAAC;IACpB,OAAQ;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACD,OAAO,cAAc,SAAS,CAAC,sBAAsB;QACzD,KAAK;YACD,OAAO;QACX;YACI,OAAO;IACf;AACJ;AACA,MAAM,kBAAkB,CAAC;IACrB,OAAQ;QACJ,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX;YACI,OAAO;IACf;AACJ;AACA,SAAS,gBAAgB,GAAG,EAAE,GAAG,EAAE,GAAG,MAAM;IACxC,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,MAAM;QACtC,OAAO;IACX;IACA,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,MAAM;QACtC,CAAC,GAAG,gBAAgB,iBAAiB,EAAE,KAAK,QAAQ;QACpD,OAAO,cAAc,SAAS,CAAC,IAAI,CAAC;IACxC;IACA,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK;AAC1F;AACA,MAAM,UAAU,CAAC,KAAK,KAAK;IACvB,MAAM,UAAU,eAAe;IAC/B,MAAM,WAAW,gBAAgB;IACjC,MAAM,YAAY,gBAAgB,KAAK,KAAK,WAAW;IACvD,SAAS,WAAW;IACpB,OAAO,CAAC,GAAG,cAAc,aAAa,EAAE;QAAE,KAAK;QAAW;QAAU;IAAQ,GAAG;AACnF;AACA,QAAQ,OAAO,GAAG;AAClB,MAAM,UAAU,CAAC,KAAK,KAAK;IACvB,MAAM,UAAU,eAAe;IAC/B,MAAM,WAAW,gBAAgB;IACjC,MAAM,YAAY,gBAAgB,KAAK,KAAK,aAAa;IACzD,SAAS,WAAW;IACpB,OAAO,CAAC,GAAG,cAAc,cAAc,EAAE;QAAE,KAAK;QAAW;QAAU;IAAQ,GAAG;AACpF;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7400, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7405, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/normalize_key.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = {};\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG,CAAC","ignoreList":[0]}},
    {"offset": {"line": 7410, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7415, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/cek.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.bitLength = bitLength;\nconst errors_js_1 = require(\"../util/errors.js\");\nconst random_js_1 = require(\"../runtime/random.js\");\nfunction bitLength(alg) {\n    switch (alg) {\n        case 'A128GCM':\n            return 128;\n        case 'A192GCM':\n            return 192;\n        case 'A256GCM':\n        case 'A128CBC-HS256':\n            return 256;\n        case 'A192CBC-HS384':\n            return 384;\n        case 'A256CBC-HS512':\n            return 512;\n        default:\n            throw new errors_js_1.JOSENotSupported(`Unsupported JWE Algorithm: ${alg}`);\n    }\n}\nexports.default = (alg) => (0, random_js_1.default)(new Uint8Array(bitLength(alg) >> 3));\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,SAAS,GAAG;AACpB,MAAM;AACN,MAAM;AACN,SAAS,UAAU,GAAG;IAClB,OAAQ;QACJ,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;QACL,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,2BAA2B,EAAE,KAAK;IAClF;AACJ;AACA,QAAQ,OAAO,GAAG,CAAC,MAAQ,CAAC,GAAG,YAAY,OAAO,EAAE,IAAI,WAAW,UAAU,QAAQ","ignoreList":[0]}},
    {"offset": {"line": 7440, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7445, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/asn1.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fromX509 = exports.fromSPKI = exports.fromPKCS8 = exports.toPKCS8 = exports.toSPKI = void 0;\nconst node_crypto_1 = require(\"node:crypto\");\nconst node_buffer_1 = require(\"node:buffer\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nconst genericExport = (keyType, keyFormat, key) => {\n    let keyObject;\n    if ((0, webcrypto_js_1.isCryptoKey)(key)) {\n        if (!key.extractable) {\n            throw new TypeError('CryptoKey is not extractable');\n        }\n        keyObject = node_crypto_1.KeyObject.from(key);\n    }\n    else if ((0, is_key_object_js_1.default)(key)) {\n        keyObject = key;\n    }\n    else {\n        throw new TypeError((0, invalid_key_input_js_1.default)(key, ...is_key_like_js_1.types));\n    }\n    if (keyObject.type !== keyType) {\n        throw new TypeError(`key is not a ${keyType} key`);\n    }\n    return keyObject.export({ format: 'pem', type: keyFormat });\n};\nconst toSPKI = (key) => {\n    return genericExport('public', 'spki', key);\n};\nexports.toSPKI = toSPKI;\nconst toPKCS8 = (key) => {\n    return genericExport('private', 'pkcs8', key);\n};\nexports.toPKCS8 = toPKCS8;\nconst fromPKCS8 = (pem) => (0, node_crypto_1.createPrivateKey)({\n    key: node_buffer_1.Buffer.from(pem.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\\s)/g, ''), 'base64'),\n    type: 'pkcs8',\n    format: 'der',\n});\nexports.fromPKCS8 = fromPKCS8;\nconst fromSPKI = (pem) => (0, node_crypto_1.createPublicKey)({\n    key: node_buffer_1.Buffer.from(pem.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\\s)/g, ''), 'base64'),\n    type: 'spki',\n    format: 'der',\n});\nexports.fromSPKI = fromSPKI;\nconst fromX509 = (pem) => (0, node_crypto_1.createPublicKey)({\n    key: pem,\n    type: 'spki',\n    format: 'pem',\n});\nexports.fromX509 = fromX509;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,QAAQ,GAAG,QAAQ,QAAQ,GAAG,QAAQ,SAAS,GAAG,QAAQ,OAAO,GAAG,QAAQ,MAAM,GAAG,KAAK;AAClG,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,gBAAgB,CAAC,SAAS,WAAW;IACvC,IAAI;IACJ,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,MAAM;QACtC,IAAI,CAAC,IAAI,WAAW,EAAE;YAClB,MAAM,IAAI,UAAU;QACxB;QACA,YAAY,cAAc,SAAS,CAAC,IAAI,CAAC;IAC7C,OACK,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,MAAM;QAC3C,YAAY;IAChB,OACK;QACD,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK;IAC1F;IACA,IAAI,UAAU,IAAI,KAAK,SAAS;QAC5B,MAAM,IAAI,UAAU,CAAC,aAAa,EAAE,QAAQ,IAAI,CAAC;IACrD;IACA,OAAO,UAAU,MAAM,CAAC;QAAE,QAAQ;QAAO,MAAM;IAAU;AAC7D;AACA,MAAM,SAAS,CAAC;IACZ,OAAO,cAAc,UAAU,QAAQ;AAC3C;AACA,QAAQ,MAAM,GAAG;AACjB,MAAM,UAAU,CAAC;IACb,OAAO,cAAc,WAAW,SAAS;AAC7C;AACA,QAAQ,OAAO,GAAG;AAClB,MAAM,YAAY,CAAC,MAAQ,CAAC,GAAG,cAAc,gBAAgB,EAAE;QAC3D,KAAK,cAAc,MAAM,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,+CAA+C,KAAK;QAC/F,MAAM;QACN,QAAQ;IACZ;AACA,QAAQ,SAAS,GAAG;AACpB,MAAM,WAAW,CAAC,MAAQ,CAAC,GAAG,cAAc,eAAe,EAAE;QACzD,KAAK,cAAc,MAAM,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,8CAA8C,KAAK;QAC9F,MAAM;QACN,QAAQ;IACZ;AACA,QAAQ,QAAQ,GAAG;AACnB,MAAM,WAAW,CAAC,MAAQ,CAAC,GAAG,cAAc,eAAe,EAAE;QACzD,KAAK;QACL,MAAM;QACN,QAAQ;IACZ;AACA,QAAQ,QAAQ,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7502, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7507, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/jwk_to_key.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst node_crypto_1 = require(\"node:crypto\");\nconst parse = (key) => {\n    if (key.d) {\n        return (0, node_crypto_1.createPrivateKey)({ format: 'jwk', key });\n    }\n    return (0, node_crypto_1.createPublicKey)({ format: 'jwk', key });\n};\nexports.default = parse;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM,QAAQ,CAAC;IACX,IAAI,IAAI,CAAC,EAAE;QACP,OAAO,CAAC,GAAG,cAAc,gBAAgB,EAAE;YAAE,QAAQ;YAAO;QAAI;IACpE;IACA,OAAO,CAAC,GAAG,cAAc,eAAe,EAAE;QAAE,QAAQ;QAAO;IAAI;AACnE;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7525, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7530, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/key/import.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.importSPKI = importSPKI;\nexports.importX509 = importX509;\nexports.importPKCS8 = importPKCS8;\nexports.importJWK = importJWK;\nconst base64url_js_1 = require(\"../runtime/base64url.js\");\nconst asn1_js_1 = require(\"../runtime/asn1.js\");\nconst jwk_to_key_js_1 = require(\"../runtime/jwk_to_key.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst is_object_js_1 = require(\"../lib/is_object.js\");\nasync function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return (0, asn1_js_1.fromSPKI)(spki, alg, options);\n}\nasync function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    return (0, asn1_js_1.fromX509)(x509, alg, options);\n}\nasync function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PKCS#8 formatted string');\n    }\n    return (0, asn1_js_1.fromPKCS8)(pkcs8, alg, options);\n}\nasync function importJWK(jwk, alg) {\n    if (!(0, is_object_js_1.default)(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    alg ||= jwk.alg;\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            return (0, base64url_js_1.decode)(jwk.k);\n        case 'RSA':\n            if (jwk.oth !== undefined) {\n                throw new errors_js_1.JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n        case 'EC':\n        case 'OKP':\n            return (0, jwk_to_key_js_1.default)({ ...jwk, alg });\n        default:\n            throw new errors_js_1.JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,UAAU,GAAG;AACrB,QAAQ,UAAU,GAAG;AACrB,QAAQ,WAAW,GAAG;AACtB,QAAQ,SAAS,GAAG;AACpB,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,WAAW,IAAI,EAAE,GAAG,EAAE,OAAO;IACxC,IAAI,OAAO,SAAS,YAAY,KAAK,OAAO,CAAC,kCAAkC,GAAG;QAC9E,MAAM,IAAI,UAAU;IACxB;IACA,OAAO,CAAC,GAAG,UAAU,QAAQ,EAAE,MAAM,KAAK;AAC9C;AACA,eAAe,WAAW,IAAI,EAAE,GAAG,EAAE,OAAO;IACxC,IAAI,OAAO,SAAS,YAAY,KAAK,OAAO,CAAC,mCAAmC,GAAG;QAC/E,MAAM,IAAI,UAAU;IACxB;IACA,OAAO,CAAC,GAAG,UAAU,QAAQ,EAAE,MAAM,KAAK;AAC9C;AACA,eAAe,YAAY,KAAK,EAAE,GAAG,EAAE,OAAO;IAC1C,IAAI,OAAO,UAAU,YAAY,MAAM,OAAO,CAAC,mCAAmC,GAAG;QACjF,MAAM,IAAI,UAAU;IACxB;IACA,OAAO,CAAC,GAAG,UAAU,SAAS,EAAE,OAAO,KAAK;AAChD;AACA,eAAe,UAAU,GAAG,EAAE,GAAG;IAC7B,IAAI,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,MAAM;QACnC,MAAM,IAAI,UAAU;IACxB;IACA,QAAQ,IAAI,GAAG;IACf,OAAQ,IAAI,GAAG;QACX,KAAK;YACD,IAAI,OAAO,IAAI,CAAC,KAAK,YAAY,CAAC,IAAI,CAAC,EAAE;gBACrC,MAAM,IAAI,UAAU;YACxB;YACA,OAAO,CAAC,GAAG,eAAe,MAAM,EAAE,IAAI,CAAC;QAC3C,KAAK;YACD,IAAI,IAAI,GAAG,KAAK,WAAW;gBACvB,MAAM,IAAI,YAAY,gBAAgB,CAAC;YAC3C;QACJ,KAAK;QACL,KAAK;YACD,OAAO,CAAC,GAAG,gBAAgB,OAAO,EAAE;gBAAE,GAAG,GAAG;gBAAE;YAAI;QACtD;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC;IAC/C;AACJ","ignoreList":[0]}},
    {"offset": {"line": 7586, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7591, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/check_key_type.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.checkKeyTypeWithJwk = void 0;\nconst invalid_key_input_js_1 = require(\"./invalid_key_input.js\");\nconst is_key_like_js_1 = require(\"../runtime/is_key_like.js\");\nconst jwk = require(\"./is_jwk.js\");\nconst tag = (key) => key?.[Symbol.toStringTag];\nconst jwkMatchesOp = (alg, key, usage) => {\n    if (key.use !== undefined && key.use !== 'sig') {\n        throw new TypeError('Invalid key for this operation, when present its use must be sig');\n    }\n    if (key.key_ops !== undefined && key.key_ops.includes?.(usage) !== true) {\n        throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${usage}`);\n    }\n    if (key.alg !== undefined && key.alg !== alg) {\n        throw new TypeError(`Invalid key for this operation, when present its alg must be ${alg}`);\n    }\n    return true;\n};\nconst symmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (allowJwk && jwk.isJWK(key)) {\n        if (jwk.isSecretJWK(key) && jwkMatchesOp(alg, key, usage))\n            return;\n        throw new TypeError(`JSON Web Key for symmetric algorithms must have JWK \"kty\" (Key Type) equal to \"oct\" and the JWK \"k\" (Key Value) present`);\n    }\n    if (!(0, is_key_like_js_1.default)(key)) {\n        throw new TypeError((0, invalid_key_input_js_1.withAlg)(alg, key, ...is_key_like_js_1.types, 'Uint8Array', allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${tag(key)} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (allowJwk && jwk.isJWK(key)) {\n        switch (usage) {\n            case 'sign':\n                if (jwk.isPrivateJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a private JWK`);\n            case 'verify':\n                if (jwk.isPublicJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a public JWK`);\n        }\n    }\n    if (!(0, is_key_like_js_1.default)(key)) {\n        throw new TypeError((0, invalid_key_input_js_1.withAlg)(alg, key, ...is_key_like_js_1.types, allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (usage === 'sign' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm signing must be of type \"private\"`);\n    }\n    if (usage === 'decrypt' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm decryption must be of type \"private\"`);\n    }\n    if (key.algorithm && usage === 'verify' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm verifying must be of type \"public\"`);\n    }\n    if (key.algorithm && usage === 'encrypt' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm encryption must be of type \"public\"`);\n    }\n};\nfunction checkKeyType(allowJwk, alg, key, usage) {\n    const symmetric = alg.startsWith('HS') ||\n        alg === 'dir' ||\n        alg.startsWith('PBES2') ||\n        /^A\\d{3}(?:GCM)?KW$/.test(alg);\n    if (symmetric) {\n        symmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n    else {\n        asymmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n}\nexports.default = checkKeyType.bind(undefined, false);\nexports.checkKeyTypeWithJwk = checkKeyType.bind(undefined, true);\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 7665, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7670, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/encrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst node_crypto_1 = require(\"node:crypto\");\nconst check_iv_length_js_1 = require(\"../lib/check_iv_length.js\");\nconst check_cek_length_js_1 = require(\"./check_cek_length.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst cbc_tag_js_1 = require(\"./cbc_tag.js\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst crypto_key_js_1 = require(\"../lib/crypto_key.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst iv_js_1 = require(\"../lib/iv.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst ciphers_js_1 = require(\"./ciphers.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nfunction cbcEncrypt(enc, plaintext, cek, iv, aad) {\n    const keySize = parseInt(enc.slice(1, 4), 10);\n    if ((0, is_key_object_js_1.default)(cek)) {\n        cek = cek.export();\n    }\n    const encKey = cek.subarray(keySize >> 3);\n    const macKey = cek.subarray(0, keySize >> 3);\n    const algorithm = `aes-${keySize}-cbc`;\n    if (!(0, ciphers_js_1.default)(algorithm)) {\n        throw new errors_js_1.JOSENotSupported(`alg ${enc} is not supported by your javascript runtime`);\n    }\n    const cipher = (0, node_crypto_1.createCipheriv)(algorithm, encKey, iv);\n    const ciphertext = (0, buffer_utils_js_1.concat)(cipher.update(plaintext), cipher.final());\n    const macSize = parseInt(enc.slice(-3), 10);\n    const tag = (0, cbc_tag_js_1.default)(aad, iv, ciphertext, macSize, macKey, keySize);\n    return { ciphertext, tag, iv };\n}\nfunction gcmEncrypt(enc, plaintext, cek, iv, aad) {\n    const keySize = parseInt(enc.slice(1, 4), 10);\n    const algorithm = `aes-${keySize}-gcm`;\n    if (!(0, ciphers_js_1.default)(algorithm)) {\n        throw new errors_js_1.JOSENotSupported(`alg ${enc} is not supported by your javascript runtime`);\n    }\n    const cipher = (0, node_crypto_1.createCipheriv)(algorithm, cek, iv, { authTagLength: 16 });\n    if (aad.byteLength) {\n        cipher.setAAD(aad, { plaintextLength: plaintext.length });\n    }\n    const ciphertext = cipher.update(plaintext);\n    cipher.final();\n    const tag = cipher.getAuthTag();\n    return { ciphertext, tag, iv };\n}\nconst encrypt = (enc, plaintext, cek, iv, aad) => {\n    let key;\n    if ((0, webcrypto_js_1.isCryptoKey)(cek)) {\n        (0, crypto_key_js_1.checkEncCryptoKey)(cek, enc, 'encrypt');\n        key = node_crypto_1.KeyObject.from(cek);\n    }\n    else if (cek instanceof Uint8Array || (0, is_key_object_js_1.default)(cek)) {\n        key = cek;\n    }\n    else {\n        throw new TypeError((0, invalid_key_input_js_1.default)(cek, ...is_key_like_js_1.types, 'Uint8Array'));\n    }\n    (0, check_cek_length_js_1.default)(enc, key);\n    if (iv) {\n        (0, check_iv_length_js_1.default)(enc, iv);\n    }\n    else {\n        iv = (0, iv_js_1.default)(enc);\n    }\n    switch (enc) {\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            return cbcEncrypt(enc, plaintext, key, iv, aad);\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            return gcmEncrypt(enc, plaintext, key, iv, aad);\n        default:\n            throw new errors_js_1.JOSENotSupported('Unsupported JWE Content Encryption Algorithm');\n    }\n};\nexports.default = encrypt;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 7761, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7766, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/aesgcmkw.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.wrap = wrap;\nexports.unwrap = unwrap;\nconst encrypt_js_1 = require(\"../runtime/encrypt.js\");\nconst decrypt_js_1 = require(\"../runtime/decrypt.js\");\nconst base64url_js_1 = require(\"../runtime/base64url.js\");\nasync function wrap(alg, key, cek, iv) {\n    const jweAlgorithm = alg.slice(0, 7);\n    const wrapped = await (0, encrypt_js_1.default)(jweAlgorithm, cek, key, iv, new Uint8Array(0));\n    return {\n        encryptedKey: wrapped.ciphertext,\n        iv: (0, base64url_js_1.encode)(wrapped.iv),\n        tag: (0, base64url_js_1.encode)(wrapped.tag),\n    };\n}\nasync function unwrap(alg, key, encryptedKey, iv, tag) {\n    const jweAlgorithm = alg.slice(0, 7);\n    return (0, decrypt_js_1.default)(jweAlgorithm, key, encryptedKey, iv, tag, new Uint8Array(0));\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,IAAI,GAAG;AACf,QAAQ,MAAM,GAAG;AACjB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,KAAK,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE;IACjC,MAAM,eAAe,IAAI,KAAK,CAAC,GAAG;IAClC,MAAM,UAAU,MAAM,CAAC,GAAG,aAAa,OAAO,EAAE,cAAc,KAAK,KAAK,IAAI,IAAI,WAAW;IAC3F,OAAO;QACH,cAAc,QAAQ,UAAU;QAChC,IAAI,CAAC,GAAG,eAAe,MAAM,EAAE,QAAQ,EAAE;QACzC,KAAK,CAAC,GAAG,eAAe,MAAM,EAAE,QAAQ,GAAG;IAC/C;AACJ;AACA,eAAe,OAAO,GAAG,EAAE,GAAG,EAAE,YAAY,EAAE,EAAE,EAAE,GAAG;IACjD,MAAM,eAAe,IAAI,KAAK,CAAC,GAAG;IAClC,OAAO,CAAC,GAAG,aAAa,OAAO,EAAE,cAAc,KAAK,cAAc,IAAI,KAAK,IAAI,WAAW;AAC9F","ignoreList":[0]}},
    {"offset": {"line": 7788, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7793, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/decrypt_key_management.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst aeskw_js_1 = require(\"../runtime/aeskw.js\");\nconst ECDH = require(\"../runtime/ecdhes.js\");\nconst pbes2kw_js_1 = require(\"../runtime/pbes2kw.js\");\nconst rsaes_js_1 = require(\"../runtime/rsaes.js\");\nconst base64url_js_1 = require(\"../runtime/base64url.js\");\nconst normalize_key_js_1 = require(\"../runtime/normalize_key.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst cek_js_1 = require(\"../lib/cek.js\");\nconst import_js_1 = require(\"../key/import.js\");\nconst check_key_type_js_1 = require(\"./check_key_type.js\");\nconst is_object_js_1 = require(\"./is_object.js\");\nconst aesgcmkw_js_1 = require(\"./aesgcmkw.js\");\nasync function decryptKeyManagement(alg, key, encryptedKey, joseHeader, options) {\n    (0, check_key_type_js_1.default)(alg, key, 'decrypt');\n    key = (await normalize_key_js_1.default.normalizePrivateKey?.(key, alg)) || key;\n    switch (alg) {\n        case 'dir': {\n            if (encryptedKey !== undefined)\n                throw new errors_js_1.JWEInvalid('Encountered unexpected JWE Encrypted Key');\n            return key;\n        }\n        case 'ECDH-ES':\n            if (encryptedKey !== undefined)\n                throw new errors_js_1.JWEInvalid('Encountered unexpected JWE Encrypted Key');\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!(0, is_object_js_1.default)(joseHeader.epk))\n                throw new errors_js_1.JWEInvalid(`JOSE Header \"epk\" (Ephemeral Public Key) missing or invalid`);\n            if (!ECDH.ecdhAllowed(key))\n                throw new errors_js_1.JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n            const epk = await (0, import_js_1.importJWK)(joseHeader.epk, alg);\n            let partyUInfo;\n            let partyVInfo;\n            if (joseHeader.apu !== undefined) {\n                if (typeof joseHeader.apu !== 'string')\n                    throw new errors_js_1.JWEInvalid(`JOSE Header \"apu\" (Agreement PartyUInfo) invalid`);\n                try {\n                    partyUInfo = (0, base64url_js_1.decode)(joseHeader.apu);\n                }\n                catch {\n                    throw new errors_js_1.JWEInvalid('Failed to base64url decode the apu');\n                }\n            }\n            if (joseHeader.apv !== undefined) {\n                if (typeof joseHeader.apv !== 'string')\n                    throw new errors_js_1.JWEInvalid(`JOSE Header \"apv\" (Agreement PartyVInfo) invalid`);\n                try {\n                    partyVInfo = (0, base64url_js_1.decode)(joseHeader.apv);\n                }\n                catch {\n                    throw new errors_js_1.JWEInvalid('Failed to base64url decode the apv');\n                }\n            }\n            const sharedSecret = await ECDH.deriveKey(epk, key, alg === 'ECDH-ES' ? joseHeader.enc : alg, alg === 'ECDH-ES' ? (0, cek_js_1.bitLength)(joseHeader.enc) : parseInt(alg.slice(-5, -2), 10), partyUInfo, partyVInfo);\n            if (alg === 'ECDH-ES')\n                return sharedSecret;\n            if (encryptedKey === undefined)\n                throw new errors_js_1.JWEInvalid('JWE Encrypted Key missing');\n            return (0, aeskw_js_1.unwrap)(alg.slice(-6), sharedSecret, encryptedKey);\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (encryptedKey === undefined)\n                throw new errors_js_1.JWEInvalid('JWE Encrypted Key missing');\n            return (0, rsaes_js_1.decrypt)(alg, key, encryptedKey);\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            if (encryptedKey === undefined)\n                throw new errors_js_1.JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.p2c !== 'number')\n                throw new errors_js_1.JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) missing or invalid`);\n            const p2cLimit = options?.maxPBES2Count || 10_000;\n            if (joseHeader.p2c > p2cLimit)\n                throw new errors_js_1.JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) out is of acceptable bounds`);\n            if (typeof joseHeader.p2s !== 'string')\n                throw new errors_js_1.JWEInvalid(`JOSE Header \"p2s\" (PBES2 Salt) missing or invalid`);\n            let p2s;\n            try {\n                p2s = (0, base64url_js_1.decode)(joseHeader.p2s);\n            }\n            catch {\n                throw new errors_js_1.JWEInvalid('Failed to base64url decode the p2s');\n            }\n            return (0, pbes2kw_js_1.decrypt)(alg, key, encryptedKey, joseHeader.p2c, p2s);\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (encryptedKey === undefined)\n                throw new errors_js_1.JWEInvalid('JWE Encrypted Key missing');\n            return (0, aeskw_js_1.unwrap)(alg, key, encryptedKey);\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            if (encryptedKey === undefined)\n                throw new errors_js_1.JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.iv !== 'string')\n                throw new errors_js_1.JWEInvalid(`JOSE Header \"iv\" (Initialization Vector) missing or invalid`);\n            if (typeof joseHeader.tag !== 'string')\n                throw new errors_js_1.JWEInvalid(`JOSE Header \"tag\" (Authentication Tag) missing or invalid`);\n            let iv;\n            try {\n                iv = (0, base64url_js_1.decode)(joseHeader.iv);\n            }\n            catch {\n                throw new errors_js_1.JWEInvalid('Failed to base64url decode the iv');\n            }\n            let tag;\n            try {\n                tag = (0, base64url_js_1.decode)(joseHeader.tag);\n            }\n            catch {\n                throw new errors_js_1.JWEInvalid('Failed to base64url decode the tag');\n            }\n            return (0, aesgcmkw_js_1.unwrap)(alg, key, encryptedKey, iv, tag);\n        }\n        default: {\n            throw new errors_js_1.JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n}\nexports.default = decryptKeyManagement;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 7911, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7916, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/validate_crit.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst errors_js_1 = require(\"../util/errors.js\");\nfunction validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader?.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new errors_js_1.JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\nexports.default = validateCrit;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,SAAS,aAAa,GAAG,EAAE,iBAAiB,EAAE,gBAAgB,EAAE,eAAe,EAAE,UAAU;IACvF,IAAI,WAAW,IAAI,KAAK,aAAa,iBAAiB,SAAS,WAAW;QACtE,MAAM,IAAI,IAAI;IAClB;IACA,IAAI,CAAC,mBAAmB,gBAAgB,IAAI,KAAK,WAAW;QACxD,OAAO,IAAI;IACf;IACA,IAAI,CAAC,MAAM,OAAO,CAAC,gBAAgB,IAAI,KACnC,gBAAgB,IAAI,CAAC,MAAM,KAAK,KAChC,gBAAgB,IAAI,CAAC,IAAI,CAAC,CAAC,QAAU,OAAO,UAAU,YAAY,MAAM,MAAM,KAAK,IAAI;QACvF,MAAM,IAAI,IAAI;IAClB;IACA,IAAI;IACJ,IAAI,qBAAqB,WAAW;QAChC,aAAa,IAAI,IAAI;eAAI,OAAO,OAAO,CAAC;eAAsB,kBAAkB,OAAO;SAAG;IAC9F,OACK;QACD,aAAa;IACjB;IACA,KAAK,MAAM,aAAa,gBAAgB,IAAI,CAAE;QAC1C,IAAI,CAAC,WAAW,GAAG,CAAC,YAAY;YAC5B,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,4BAA4B,EAAE,UAAU,mBAAmB,CAAC;QACxG;QACA,IAAI,UAAU,CAAC,UAAU,KAAK,WAAW;YACrC,MAAM,IAAI,IAAI,CAAC,4BAA4B,EAAE,UAAU,YAAY,CAAC;QACxE;QACA,IAAI,WAAW,GAAG,CAAC,cAAc,eAAe,CAAC,UAAU,KAAK,WAAW;YACvE,MAAM,IAAI,IAAI,CAAC,4BAA4B,EAAE,UAAU,6BAA6B,CAAC;QACzF;IACJ;IACA,OAAO,IAAI,IAAI,gBAAgB,IAAI;AACvC;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7954, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7959, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/validate_algorithms.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst validateAlgorithms = (option, algorithms) => {\n    if (algorithms !== undefined &&\n        (!Array.isArray(algorithms) || algorithms.some((s) => typeof s !== 'string'))) {\n        throw new TypeError(`\"${option}\" option must be an array of strings`);\n    }\n    if (!algorithms) {\n        return undefined;\n    }\n    return new Set(algorithms);\n};\nexports.default = validateAlgorithms;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM,qBAAqB,CAAC,QAAQ;IAChC,IAAI,eAAe,aACf,CAAC,CAAC,MAAM,OAAO,CAAC,eAAe,WAAW,IAAI,CAAC,CAAC,IAAM,OAAO,MAAM,SAAS,GAAG;QAC/E,MAAM,IAAI,UAAU,CAAC,CAAC,EAAE,OAAO,oCAAoC,CAAC;IACxE;IACA,IAAI,CAAC,YAAY;QACb,OAAO;IACX;IACA,OAAO,IAAI,IAAI;AACnB;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 7973, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7978, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwe/flattened/decrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.flattenedDecrypt = flattenedDecrypt;\nconst base64url_js_1 = require(\"../../runtime/base64url.js\");\nconst decrypt_js_1 = require(\"../../runtime/decrypt.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst is_disjoint_js_1 = require(\"../../lib/is_disjoint.js\");\nconst is_object_js_1 = require(\"../../lib/is_object.js\");\nconst decrypt_key_management_js_1 = require(\"../../lib/decrypt_key_management.js\");\nconst buffer_utils_js_1 = require(\"../../lib/buffer_utils.js\");\nconst cek_js_1 = require(\"../../lib/cek.js\");\nconst validate_crit_js_1 = require(\"../../lib/validate_crit.js\");\nconst validate_algorithms_js_1 = require(\"../../lib/validate_algorithms.js\");\nasync function flattenedDecrypt(jwe, key, options) {\n    if (!(0, is_object_js_1.default)(jwe)) {\n        throw new errors_js_1.JWEInvalid('Flattened JWE must be an object');\n    }\n    if (jwe.protected === undefined && jwe.header === undefined && jwe.unprotected === undefined) {\n        throw new errors_js_1.JWEInvalid('JOSE Header missing');\n    }\n    if (jwe.iv !== undefined && typeof jwe.iv !== 'string') {\n        throw new errors_js_1.JWEInvalid('JWE Initialization Vector incorrect type');\n    }\n    if (typeof jwe.ciphertext !== 'string') {\n        throw new errors_js_1.JWEInvalid('JWE Ciphertext missing or incorrect type');\n    }\n    if (jwe.tag !== undefined && typeof jwe.tag !== 'string') {\n        throw new errors_js_1.JWEInvalid('JWE Authentication Tag incorrect type');\n    }\n    if (jwe.protected !== undefined && typeof jwe.protected !== 'string') {\n        throw new errors_js_1.JWEInvalid('JWE Protected Header incorrect type');\n    }\n    if (jwe.encrypted_key !== undefined && typeof jwe.encrypted_key !== 'string') {\n        throw new errors_js_1.JWEInvalid('JWE Encrypted Key incorrect type');\n    }\n    if (jwe.aad !== undefined && typeof jwe.aad !== 'string') {\n        throw new errors_js_1.JWEInvalid('JWE AAD incorrect type');\n    }\n    if (jwe.header !== undefined && !(0, is_object_js_1.default)(jwe.header)) {\n        throw new errors_js_1.JWEInvalid('JWE Shared Unprotected Header incorrect type');\n    }\n    if (jwe.unprotected !== undefined && !(0, is_object_js_1.default)(jwe.unprotected)) {\n        throw new errors_js_1.JWEInvalid('JWE Per-Recipient Unprotected Header incorrect type');\n    }\n    let parsedProt;\n    if (jwe.protected) {\n        try {\n            const protectedHeader = (0, base64url_js_1.decode)(jwe.protected);\n            parsedProt = JSON.parse(buffer_utils_js_1.decoder.decode(protectedHeader));\n        }\n        catch {\n            throw new errors_js_1.JWEInvalid('JWE Protected Header is invalid');\n        }\n    }\n    if (!(0, is_disjoint_js_1.default)(parsedProt, jwe.header, jwe.unprotected)) {\n        throw new errors_js_1.JWEInvalid('JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jwe.header,\n        ...jwe.unprotected,\n    };\n    (0, validate_crit_js_1.default)(errors_js_1.JWEInvalid, new Map(), options?.crit, parsedProt, joseHeader);\n    if (joseHeader.zip !== undefined) {\n        throw new errors_js_1.JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported.');\n    }\n    const { alg, enc } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new errors_js_1.JWEInvalid('missing JWE Algorithm (alg) in JWE Header');\n    }\n    if (typeof enc !== 'string' || !enc) {\n        throw new errors_js_1.JWEInvalid('missing JWE Encryption Algorithm (enc) in JWE Header');\n    }\n    const keyManagementAlgorithms = options && (0, validate_algorithms_js_1.default)('keyManagementAlgorithms', options.keyManagementAlgorithms);\n    const contentEncryptionAlgorithms = options &&\n        (0, validate_algorithms_js_1.default)('contentEncryptionAlgorithms', options.contentEncryptionAlgorithms);\n    if ((keyManagementAlgorithms && !keyManagementAlgorithms.has(alg)) ||\n        (!keyManagementAlgorithms && alg.startsWith('PBES2'))) {\n        throw new errors_js_1.JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter value not allowed');\n    }\n    if (contentEncryptionAlgorithms && !contentEncryptionAlgorithms.has(enc)) {\n        throw new errors_js_1.JOSEAlgNotAllowed('\"enc\" (Encryption Algorithm) Header Parameter value not allowed');\n    }\n    let encryptedKey;\n    if (jwe.encrypted_key !== undefined) {\n        try {\n            encryptedKey = (0, base64url_js_1.decode)(jwe.encrypted_key);\n        }\n        catch {\n            throw new errors_js_1.JWEInvalid('Failed to base64url decode the encrypted_key');\n        }\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jwe);\n        resolvedKey = true;\n    }\n    let cek;\n    try {\n        cek = await (0, decrypt_key_management_js_1.default)(alg, key, encryptedKey, joseHeader, options);\n    }\n    catch (err) {\n        if (err instanceof TypeError || err instanceof errors_js_1.JWEInvalid || err instanceof errors_js_1.JOSENotSupported) {\n            throw err;\n        }\n        cek = (0, cek_js_1.default)(enc);\n    }\n    let iv;\n    let tag;\n    if (jwe.iv !== undefined) {\n        try {\n            iv = (0, base64url_js_1.decode)(jwe.iv);\n        }\n        catch {\n            throw new errors_js_1.JWEInvalid('Failed to base64url decode the iv');\n        }\n    }\n    if (jwe.tag !== undefined) {\n        try {\n            tag = (0, base64url_js_1.decode)(jwe.tag);\n        }\n        catch {\n            throw new errors_js_1.JWEInvalid('Failed to base64url decode the tag');\n        }\n    }\n    const protectedHeader = buffer_utils_js_1.encoder.encode(jwe.protected ?? '');\n    let additionalData;\n    if (jwe.aad !== undefined) {\n        additionalData = (0, buffer_utils_js_1.concat)(protectedHeader, buffer_utils_js_1.encoder.encode('.'), buffer_utils_js_1.encoder.encode(jwe.aad));\n    }\n    else {\n        additionalData = protectedHeader;\n    }\n    let ciphertext;\n    try {\n        ciphertext = (0, base64url_js_1.decode)(jwe.ciphertext);\n    }\n    catch {\n        throw new errors_js_1.JWEInvalid('Failed to base64url decode the ciphertext');\n    }\n    const plaintext = await (0, decrypt_js_1.default)(enc, cek, ciphertext, iv, tag, additionalData);\n    const result = { plaintext };\n    if (jwe.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jwe.aad !== undefined) {\n        try {\n            result.additionalAuthenticatedData = (0, base64url_js_1.decode)(jwe.aad);\n        }\n        catch {\n            throw new errors_js_1.JWEInvalid('Failed to base64url decode the aad');\n        }\n    }\n    if (jwe.unprotected !== undefined) {\n        result.sharedUnprotectedHeader = jwe.unprotected;\n    }\n    if (jwe.header !== undefined) {\n        result.unprotectedHeader = jwe.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key };\n    }\n    return result;\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 8139, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8144, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwe/compact/decrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.compactDecrypt = compactDecrypt;\nconst decrypt_js_1 = require(\"../flattened/decrypt.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst buffer_utils_js_1 = require(\"../../lib/buffer_utils.js\");\nasync function compactDecrypt(jwe, key, options) {\n    if (jwe instanceof Uint8Array) {\n        jwe = buffer_utils_js_1.decoder.decode(jwe);\n    }\n    if (typeof jwe !== 'string') {\n        throw new errors_js_1.JWEInvalid('Compact JWE must be a string or Uint8Array');\n    }\n    const { 0: protectedHeader, 1: encryptedKey, 2: iv, 3: ciphertext, 4: tag, length, } = jwe.split('.');\n    if (length !== 5) {\n        throw new errors_js_1.JWEInvalid('Invalid Compact JWE');\n    }\n    const decrypted = await (0, decrypt_js_1.flattenedDecrypt)({\n        ciphertext,\n        iv: iv || undefined,\n        protected: protectedHeader,\n        tag: tag || undefined,\n        encrypted_key: encryptedKey || undefined,\n    }, key, options);\n    const result = { plaintext: decrypted.plaintext, protectedHeader: decrypted.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: decrypted.key };\n    }\n    return result;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,cAAc,GAAG;AACzB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,eAAe,GAAG,EAAE,GAAG,EAAE,OAAO;IAC3C,IAAI,eAAe,YAAY;QAC3B,MAAM,kBAAkB,OAAO,CAAC,MAAM,CAAC;IAC3C;IACA,IAAI,OAAO,QAAQ,UAAU;QACzB,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,EAAE,GAAG,eAAe,EAAE,GAAG,YAAY,EAAE,GAAG,EAAE,EAAE,GAAG,UAAU,EAAE,GAAG,GAAG,EAAE,MAAM,EAAG,GAAG,IAAI,KAAK,CAAC;IACjG,IAAI,WAAW,GAAG;QACd,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,YAAY,MAAM,CAAC,GAAG,aAAa,gBAAgB,EAAE;QACvD;QACA,IAAI,MAAM;QACV,WAAW;QACX,KAAK,OAAO;QACZ,eAAe,gBAAgB;IACnC,GAAG,KAAK;IACR,MAAM,SAAS;QAAE,WAAW,UAAU,SAAS;QAAE,iBAAiB,UAAU,eAAe;IAAC;IAC5F,IAAI,OAAO,QAAQ,YAAY;QAC3B,OAAO;YAAE,GAAG,MAAM;YAAE,KAAK,UAAU,GAAG;QAAC;IAC3C;IACA,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 8182, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8187, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwe/general/decrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generalDecrypt = generalDecrypt;\nconst decrypt_js_1 = require(\"../flattened/decrypt.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst is_object_js_1 = require(\"../../lib/is_object.js\");\nasync function generalDecrypt(jwe, key, options) {\n    if (!(0, is_object_js_1.default)(jwe)) {\n        throw new errors_js_1.JWEInvalid('General JWE must be an object');\n    }\n    if (!Array.isArray(jwe.recipients) || !jwe.recipients.every(is_object_js_1.default)) {\n        throw new errors_js_1.JWEInvalid('JWE Recipients missing or incorrect type');\n    }\n    if (!jwe.recipients.length) {\n        throw new errors_js_1.JWEInvalid('JWE Recipients has no members');\n    }\n    for (const recipient of jwe.recipients) {\n        try {\n            return await (0, decrypt_js_1.flattenedDecrypt)({\n                aad: jwe.aad,\n                ciphertext: jwe.ciphertext,\n                encrypted_key: recipient.encrypted_key,\n                header: recipient.header,\n                iv: jwe.iv,\n                protected: jwe.protected,\n                tag: jwe.tag,\n                unprotected: jwe.unprotected,\n            }, key, options);\n        }\n        catch {\n        }\n    }\n    throw new errors_js_1.JWEDecryptionFailed();\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,cAAc,GAAG;AACzB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,eAAe,GAAG,EAAE,GAAG,EAAE,OAAO;IAC3C,IAAI,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,MAAM;QACnC,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,CAAC,MAAM,OAAO,CAAC,IAAI,UAAU,KAAK,CAAC,IAAI,UAAU,CAAC,KAAK,CAAC,eAAe,OAAO,GAAG;QACjF,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,CAAC,IAAI,UAAU,CAAC,MAAM,EAAE;QACxB,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,KAAK,MAAM,aAAa,IAAI,UAAU,CAAE;QACpC,IAAI;YACA,OAAO,MAAM,CAAC,GAAG,aAAa,gBAAgB,EAAE;gBAC5C,KAAK,IAAI,GAAG;gBACZ,YAAY,IAAI,UAAU;gBAC1B,eAAe,UAAU,aAAa;gBACtC,QAAQ,UAAU,MAAM;gBACxB,IAAI,IAAI,EAAE;gBACV,WAAW,IAAI,SAAS;gBACxB,KAAK,IAAI,GAAG;gBACZ,aAAa,IAAI,WAAW;YAChC,GAAG,KAAK;QACZ,EACA,OAAM,CACN;IACJ;IACA,MAAM,IAAI,YAAY,mBAAmB;AAC7C","ignoreList":[0]}},
    {"offset": {"line": 8221, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8226, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/private_symbols.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.unprotected = void 0;\nexports.unprotected = Symbol();\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,WAAW,GAAG,KAAK;AAC3B,QAAQ,WAAW,GAAG","ignoreList":[0]}},
    {"offset": {"line": 8232, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8237, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/key_to_jwk.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst node_crypto_1 = require(\"node:crypto\");\nconst base64url_js_1 = require(\"./base64url.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst is_key_object_js_1 = require(\"./is_key_object.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nconst keyToJWK = (key) => {\n    let keyObject;\n    if ((0, webcrypto_js_1.isCryptoKey)(key)) {\n        if (!key.extractable) {\n            throw new TypeError('CryptoKey is not extractable');\n        }\n        keyObject = node_crypto_1.KeyObject.from(key);\n    }\n    else if ((0, is_key_object_js_1.default)(key)) {\n        keyObject = key;\n    }\n    else if (key instanceof Uint8Array) {\n        return {\n            kty: 'oct',\n            k: (0, base64url_js_1.encode)(key),\n        };\n    }\n    else {\n        throw new TypeError((0, invalid_key_input_js_1.default)(key, ...is_key_like_js_1.types, 'Uint8Array'));\n    }\n    if (keyObject.type !== 'secret' &&\n        !['rsa', 'ec', 'ed25519', 'x25519', 'ed448', 'x448'].includes(keyObject.asymmetricKeyType)) {\n        throw new errors_js_1.JOSENotSupported('Unsupported key asymmetricKeyType');\n    }\n    return keyObject.export({ format: 'jwk' });\n};\nexports.default = keyToJWK;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,WAAW,CAAC;IACd,IAAI;IACJ,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,MAAM;QACtC,IAAI,CAAC,IAAI,WAAW,EAAE;YAClB,MAAM,IAAI,UAAU;QACxB;QACA,YAAY,cAAc,SAAS,CAAC,IAAI,CAAC;IAC7C,OACK,IAAI,CAAC,GAAG,mBAAmB,OAAO,EAAE,MAAM;QAC3C,YAAY;IAChB,OACK,IAAI,eAAe,YAAY;QAChC,OAAO;YACH,KAAK;YACL,GAAG,CAAC,GAAG,eAAe,MAAM,EAAE;QAClC;IACJ,OACK;QACD,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK,EAAE;IAC5F;IACA,IAAI,UAAU,IAAI,KAAK,YACnB,CAAC;QAAC;QAAO;QAAM;QAAW;QAAU;QAAS;KAAO,CAAC,QAAQ,CAAC,UAAU,iBAAiB,GAAG;QAC5F,MAAM,IAAI,YAAY,gBAAgB,CAAC;IAC3C;IACA,OAAO,UAAU,MAAM,CAAC;QAAE,QAAQ;IAAM;AAC5C;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 8280, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8285, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/key/export.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.exportSPKI = exportSPKI;\nexports.exportPKCS8 = exportPKCS8;\nexports.exportJWK = exportJWK;\nconst asn1_js_1 = require(\"../runtime/asn1.js\");\nconst asn1_js_2 = require(\"../runtime/asn1.js\");\nconst key_to_jwk_js_1 = require(\"../runtime/key_to_jwk.js\");\nasync function exportSPKI(key) {\n    return (0, asn1_js_1.toSPKI)(key);\n}\nasync function exportPKCS8(key) {\n    return (0, asn1_js_2.toPKCS8)(key);\n}\nasync function exportJWK(key) {\n    return (0, key_to_jwk_js_1.default)(key);\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,UAAU,GAAG;AACrB,QAAQ,WAAW,GAAG;AACtB,QAAQ,SAAS,GAAG;AACpB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,WAAW,GAAG;IACzB,OAAO,CAAC,GAAG,UAAU,MAAM,EAAE;AACjC;AACA,eAAe,YAAY,GAAG;IAC1B,OAAO,CAAC,GAAG,UAAU,OAAO,EAAE;AAClC;AACA,eAAe,UAAU,GAAG;IACxB,OAAO,CAAC,GAAG,gBAAgB,OAAO,EAAE;AACxC","ignoreList":[0]}},
    {"offset": {"line": 8304, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8309, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/encrypt_key_management.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst aeskw_js_1 = require(\"../runtime/aeskw.js\");\nconst ECDH = require(\"../runtime/ecdhes.js\");\nconst pbes2kw_js_1 = require(\"../runtime/pbes2kw.js\");\nconst rsaes_js_1 = require(\"../runtime/rsaes.js\");\nconst base64url_js_1 = require(\"../runtime/base64url.js\");\nconst normalize_key_js_1 = require(\"../runtime/normalize_key.js\");\nconst cek_js_1 = require(\"../lib/cek.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst export_js_1 = require(\"../key/export.js\");\nconst check_key_type_js_1 = require(\"./check_key_type.js\");\nconst aesgcmkw_js_1 = require(\"./aesgcmkw.js\");\nasync function encryptKeyManagement(alg, enc, key, providedCek, providedParameters = {}) {\n    let encryptedKey;\n    let parameters;\n    let cek;\n    (0, check_key_type_js_1.default)(alg, key, 'encrypt');\n    key = (await normalize_key_js_1.default.normalizePublicKey?.(key, alg)) || key;\n    switch (alg) {\n        case 'dir': {\n            cek = key;\n            break;\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!ECDH.ecdhAllowed(key)) {\n                throw new errors_js_1.JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n            }\n            const { apu, apv } = providedParameters;\n            let { epk: ephemeralKey } = providedParameters;\n            ephemeralKey ||= (await ECDH.generateEpk(key)).privateKey;\n            const { x, y, crv, kty } = await (0, export_js_1.exportJWK)(ephemeralKey);\n            const sharedSecret = await ECDH.deriveKey(key, ephemeralKey, alg === 'ECDH-ES' ? enc : alg, alg === 'ECDH-ES' ? (0, cek_js_1.bitLength)(enc) : parseInt(alg.slice(-5, -2), 10), apu, apv);\n            parameters = { epk: { x, crv, kty } };\n            if (kty === 'EC')\n                parameters.epk.y = y;\n            if (apu)\n                parameters.apu = (0, base64url_js_1.encode)(apu);\n            if (apv)\n                parameters.apv = (0, base64url_js_1.encode)(apv);\n            if (alg === 'ECDH-ES') {\n                cek = sharedSecret;\n                break;\n            }\n            cek = providedCek || (0, cek_js_1.default)(enc);\n            const kwAlg = alg.slice(-6);\n            encryptedKey = await (0, aeskw_js_1.wrap)(kwAlg, sharedSecret, cek);\n            break;\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            cek = providedCek || (0, cek_js_1.default)(enc);\n            encryptedKey = await (0, rsaes_js_1.encrypt)(alg, key, cek);\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            cek = providedCek || (0, cek_js_1.default)(enc);\n            const { p2c, p2s } = providedParameters;\n            ({ encryptedKey, ...parameters } = await (0, pbes2kw_js_1.encrypt)(alg, key, cek, p2c, p2s));\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            cek = providedCek || (0, cek_js_1.default)(enc);\n            encryptedKey = await (0, aeskw_js_1.wrap)(alg, key, cek);\n            break;\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            cek = providedCek || (0, cek_js_1.default)(enc);\n            const { iv } = providedParameters;\n            ({ encryptedKey, ...parameters } = await (0, aesgcmkw_js_1.wrap)(alg, key, cek, iv));\n            break;\n        }\n        default: {\n            throw new errors_js_1.JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n    return { cek, encryptedKey, parameters };\n}\nexports.default = encryptKeyManagement;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 8416, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8421, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwe/flattened/encrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FlattenedEncrypt = void 0;\nconst base64url_js_1 = require(\"../../runtime/base64url.js\");\nconst private_symbols_js_1 = require(\"../../lib/private_symbols.js\");\nconst encrypt_js_1 = require(\"../../runtime/encrypt.js\");\nconst encrypt_key_management_js_1 = require(\"../../lib/encrypt_key_management.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst is_disjoint_js_1 = require(\"../../lib/is_disjoint.js\");\nconst buffer_utils_js_1 = require(\"../../lib/buffer_utils.js\");\nconst validate_crit_js_1 = require(\"../../lib/validate_crit.js\");\nclass FlattenedEncrypt {\n    _plaintext;\n    _protectedHeader;\n    _sharedUnprotectedHeader;\n    _unprotectedHeader;\n    _aad;\n    _cek;\n    _iv;\n    _keyManagementParameters;\n    constructor(plaintext) {\n        if (!(plaintext instanceof Uint8Array)) {\n            throw new TypeError('plaintext must be an instance of Uint8Array');\n        }\n        this._plaintext = plaintext;\n    }\n    setKeyManagementParameters(parameters) {\n        if (this._keyManagementParameters) {\n            throw new TypeError('setKeyManagementParameters can only be called once');\n        }\n        this._keyManagementParameters = parameters;\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setSharedUnprotectedHeader(sharedUnprotectedHeader) {\n        if (this._sharedUnprotectedHeader) {\n            throw new TypeError('setSharedUnprotectedHeader can only be called once');\n        }\n        this._sharedUnprotectedHeader = sharedUnprotectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    setAdditionalAuthenticatedData(aad) {\n        this._aad = aad;\n        return this;\n    }\n    setContentEncryptionKey(cek) {\n        if (this._cek) {\n            throw new TypeError('setContentEncryptionKey can only be called once');\n        }\n        this._cek = cek;\n        return this;\n    }\n    setInitializationVector(iv) {\n        if (this._iv) {\n            throw new TypeError('setInitializationVector can only be called once');\n        }\n        this._iv = iv;\n        return this;\n    }\n    async encrypt(key, options) {\n        if (!this._protectedHeader && !this._unprotectedHeader && !this._sharedUnprotectedHeader) {\n            throw new errors_js_1.JWEInvalid('either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()');\n        }\n        if (!(0, is_disjoint_js_1.default)(this._protectedHeader, this._unprotectedHeader, this._sharedUnprotectedHeader)) {\n            throw new errors_js_1.JWEInvalid('JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this._protectedHeader,\n            ...this._unprotectedHeader,\n            ...this._sharedUnprotectedHeader,\n        };\n        (0, validate_crit_js_1.default)(errors_js_1.JWEInvalid, new Map(), options?.crit, this._protectedHeader, joseHeader);\n        if (joseHeader.zip !== undefined) {\n            throw new errors_js_1.JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported.');\n        }\n        const { alg, enc } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new errors_js_1.JWEInvalid('JWE \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        if (typeof enc !== 'string' || !enc) {\n            throw new errors_js_1.JWEInvalid('JWE \"enc\" (Encryption Algorithm) Header Parameter missing or invalid');\n        }\n        let encryptedKey;\n        if (this._cek && (alg === 'dir' || alg === 'ECDH-ES')) {\n            throw new TypeError(`setContentEncryptionKey cannot be called with JWE \"alg\" (Algorithm) Header ${alg}`);\n        }\n        let cek;\n        {\n            let parameters;\n            ({ cek, encryptedKey, parameters } = await (0, encrypt_key_management_js_1.default)(alg, enc, key, this._cek, this._keyManagementParameters));\n            if (parameters) {\n                if (options && private_symbols_js_1.unprotected in options) {\n                    if (!this._unprotectedHeader) {\n                        this.setUnprotectedHeader(parameters);\n                    }\n                    else {\n                        this._unprotectedHeader = { ...this._unprotectedHeader, ...parameters };\n                    }\n                }\n                else if (!this._protectedHeader) {\n                    this.setProtectedHeader(parameters);\n                }\n                else {\n                    this._protectedHeader = { ...this._protectedHeader, ...parameters };\n                }\n            }\n        }\n        let additionalData;\n        let protectedHeader;\n        let aadMember;\n        if (this._protectedHeader) {\n            protectedHeader = buffer_utils_js_1.encoder.encode((0, base64url_js_1.encode)(JSON.stringify(this._protectedHeader)));\n        }\n        else {\n            protectedHeader = buffer_utils_js_1.encoder.encode('');\n        }\n        if (this._aad) {\n            aadMember = (0, base64url_js_1.encode)(this._aad);\n            additionalData = (0, buffer_utils_js_1.concat)(protectedHeader, buffer_utils_js_1.encoder.encode('.'), buffer_utils_js_1.encoder.encode(aadMember));\n        }\n        else {\n            additionalData = protectedHeader;\n        }\n        const { ciphertext, tag, iv } = await (0, encrypt_js_1.default)(enc, this._plaintext, cek, this._iv, additionalData);\n        const jwe = {\n            ciphertext: (0, base64url_js_1.encode)(ciphertext),\n        };\n        if (iv) {\n            jwe.iv = (0, base64url_js_1.encode)(iv);\n        }\n        if (tag) {\n            jwe.tag = (0, base64url_js_1.encode)(tag);\n        }\n        if (encryptedKey) {\n            jwe.encrypted_key = (0, base64url_js_1.encode)(encryptedKey);\n        }\n        if (aadMember) {\n            jwe.aad = aadMember;\n        }\n        if (this._protectedHeader) {\n            jwe.protected = buffer_utils_js_1.decoder.decode(protectedHeader);\n        }\n        if (this._sharedUnprotectedHeader) {\n            jwe.unprotected = this._sharedUnprotectedHeader;\n        }\n        if (this._unprotectedHeader) {\n            jwe.header = this._unprotectedHeader;\n        }\n        return jwe;\n    }\n}\nexports.FlattenedEncrypt = FlattenedEncrypt;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 8589, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8594, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwe/general/encrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GeneralEncrypt = void 0;\nconst encrypt_js_1 = require(\"../flattened/encrypt.js\");\nconst private_symbols_js_1 = require(\"../../lib/private_symbols.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst cek_js_1 = require(\"../../lib/cek.js\");\nconst is_disjoint_js_1 = require(\"../../lib/is_disjoint.js\");\nconst encrypt_key_management_js_1 = require(\"../../lib/encrypt_key_management.js\");\nconst base64url_js_1 = require(\"../../runtime/base64url.js\");\nconst validate_crit_js_1 = require(\"../../lib/validate_crit.js\");\nclass IndividualRecipient {\n    parent;\n    unprotectedHeader;\n    key;\n    options;\n    constructor(enc, key, options) {\n        this.parent = enc;\n        this.key = key;\n        this.options = options;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this.unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this.unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    addRecipient(...args) {\n        return this.parent.addRecipient(...args);\n    }\n    encrypt(...args) {\n        return this.parent.encrypt(...args);\n    }\n    done() {\n        return this.parent;\n    }\n}\nclass GeneralEncrypt {\n    _plaintext;\n    _recipients = [];\n    _protectedHeader;\n    _unprotectedHeader;\n    _aad;\n    constructor(plaintext) {\n        this._plaintext = plaintext;\n    }\n    addRecipient(key, options) {\n        const recipient = new IndividualRecipient(this, key, { crit: options?.crit });\n        this._recipients.push(recipient);\n        return recipient;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setSharedUnprotectedHeader(sharedUnprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setSharedUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = sharedUnprotectedHeader;\n        return this;\n    }\n    setAdditionalAuthenticatedData(aad) {\n        this._aad = aad;\n        return this;\n    }\n    async encrypt() {\n        if (!this._recipients.length) {\n            throw new errors_js_1.JWEInvalid('at least one recipient must be added');\n        }\n        if (this._recipients.length === 1) {\n            const [recipient] = this._recipients;\n            const flattened = await new encrypt_js_1.FlattenedEncrypt(this._plaintext)\n                .setAdditionalAuthenticatedData(this._aad)\n                .setProtectedHeader(this._protectedHeader)\n                .setSharedUnprotectedHeader(this._unprotectedHeader)\n                .setUnprotectedHeader(recipient.unprotectedHeader)\n                .encrypt(recipient.key, { ...recipient.options });\n            const jwe = {\n                ciphertext: flattened.ciphertext,\n                iv: flattened.iv,\n                recipients: [{}],\n                tag: flattened.tag,\n            };\n            if (flattened.aad)\n                jwe.aad = flattened.aad;\n            if (flattened.protected)\n                jwe.protected = flattened.protected;\n            if (flattened.unprotected)\n                jwe.unprotected = flattened.unprotected;\n            if (flattened.encrypted_key)\n                jwe.recipients[0].encrypted_key = flattened.encrypted_key;\n            if (flattened.header)\n                jwe.recipients[0].header = flattened.header;\n            return jwe;\n        }\n        let enc;\n        for (let i = 0; i < this._recipients.length; i++) {\n            const recipient = this._recipients[i];\n            if (!(0, is_disjoint_js_1.default)(this._protectedHeader, this._unprotectedHeader, recipient.unprotectedHeader)) {\n                throw new errors_js_1.JWEInvalid('JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint');\n            }\n            const joseHeader = {\n                ...this._protectedHeader,\n                ...this._unprotectedHeader,\n                ...recipient.unprotectedHeader,\n            };\n            const { alg } = joseHeader;\n            if (typeof alg !== 'string' || !alg) {\n                throw new errors_js_1.JWEInvalid('JWE \"alg\" (Algorithm) Header Parameter missing or invalid');\n            }\n            if (alg === 'dir' || alg === 'ECDH-ES') {\n                throw new errors_js_1.JWEInvalid('\"dir\" and \"ECDH-ES\" alg may only be used with a single recipient');\n            }\n            if (typeof joseHeader.enc !== 'string' || !joseHeader.enc) {\n                throw new errors_js_1.JWEInvalid('JWE \"enc\" (Encryption Algorithm) Header Parameter missing or invalid');\n            }\n            if (!enc) {\n                enc = joseHeader.enc;\n            }\n            else if (enc !== joseHeader.enc) {\n                throw new errors_js_1.JWEInvalid('JWE \"enc\" (Encryption Algorithm) Header Parameter must be the same for all recipients');\n            }\n            (0, validate_crit_js_1.default)(errors_js_1.JWEInvalid, new Map(), recipient.options.crit, this._protectedHeader, joseHeader);\n            if (joseHeader.zip !== undefined) {\n                throw new errors_js_1.JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported.');\n            }\n        }\n        const cek = (0, cek_js_1.default)(enc);\n        const jwe = {\n            ciphertext: '',\n            iv: '',\n            recipients: [],\n            tag: '',\n        };\n        for (let i = 0; i < this._recipients.length; i++) {\n            const recipient = this._recipients[i];\n            const target = {};\n            jwe.recipients.push(target);\n            const joseHeader = {\n                ...this._protectedHeader,\n                ...this._unprotectedHeader,\n                ...recipient.unprotectedHeader,\n            };\n            const p2c = joseHeader.alg.startsWith('PBES2') ? 2048 + i : undefined;\n            if (i === 0) {\n                const flattened = await new encrypt_js_1.FlattenedEncrypt(this._plaintext)\n                    .setAdditionalAuthenticatedData(this._aad)\n                    .setContentEncryptionKey(cek)\n                    .setProtectedHeader(this._protectedHeader)\n                    .setSharedUnprotectedHeader(this._unprotectedHeader)\n                    .setUnprotectedHeader(recipient.unprotectedHeader)\n                    .setKeyManagementParameters({ p2c })\n                    .encrypt(recipient.key, {\n                    ...recipient.options,\n                    [private_symbols_js_1.unprotected]: true,\n                });\n                jwe.ciphertext = flattened.ciphertext;\n                jwe.iv = flattened.iv;\n                jwe.tag = flattened.tag;\n                if (flattened.aad)\n                    jwe.aad = flattened.aad;\n                if (flattened.protected)\n                    jwe.protected = flattened.protected;\n                if (flattened.unprotected)\n                    jwe.unprotected = flattened.unprotected;\n                target.encrypted_key = flattened.encrypted_key;\n                if (flattened.header)\n                    target.header = flattened.header;\n                continue;\n            }\n            const { encryptedKey, parameters } = await (0, encrypt_key_management_js_1.default)(recipient.unprotectedHeader?.alg ||\n                this._protectedHeader?.alg ||\n                this._unprotectedHeader?.alg, enc, recipient.key, cek, { p2c });\n            target.encrypted_key = (0, base64url_js_1.encode)(encryptedKey);\n            if (recipient.unprotectedHeader || parameters)\n                target.header = { ...recipient.unprotectedHeader, ...parameters };\n        }\n        return jwe;\n    }\n}\nexports.GeneralEncrypt = GeneralEncrypt;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 8770, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8775, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/dsa_digest.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = dsaDigest;\nconst errors_js_1 = require(\"../util/errors.js\");\nfunction dsaDigest(alg) {\n    switch (alg) {\n        case 'PS256':\n        case 'RS256':\n        case 'ES256':\n        case 'ES256K':\n            return 'sha256';\n        case 'PS384':\n        case 'RS384':\n        case 'ES384':\n            return 'sha384';\n        case 'PS512':\n        case 'RS512':\n        case 'ES512':\n            return 'sha512';\n        case 'EdDSA':\n            return undefined;\n        default:\n            throw new errors_js_1.JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG;AAClB,MAAM;AACN,SAAS,UAAU,GAAG;IAClB,OAAQ;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACD,OAAO;QACX,KAAK;QACL,KAAK;QACL,KAAK;YACD,OAAO;QACX,KAAK;QACL,KAAK;QACL,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,IAAI,EAAE,IAAI,2DAA2D,CAAC;IACtH;AACJ","ignoreList":[0]}},
    {"offset": {"line": 8802, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8807, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/node_key.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = keyForCrypto;\nconst node_crypto_1 = require(\"node:crypto\");\nconst get_named_curve_js_1 = require(\"./get_named_curve.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst check_key_length_js_1 = require(\"./check_key_length.js\");\nconst ecCurveAlgMap = new Map([\n    ['ES256', 'P-256'],\n    ['ES256K', 'secp256k1'],\n    ['ES384', 'P-384'],\n    ['ES512', 'P-521'],\n]);\nfunction keyForCrypto(alg, key) {\n    let asymmetricKeyType;\n    let asymmetricKeyDetails;\n    let isJWK;\n    if (key instanceof node_crypto_1.KeyObject) {\n        asymmetricKeyType = key.asymmetricKeyType;\n        asymmetricKeyDetails = key.asymmetricKeyDetails;\n    }\n    else {\n        isJWK = true;\n        switch (key.kty) {\n            case 'RSA':\n                asymmetricKeyType = 'rsa';\n                break;\n            case 'EC':\n                asymmetricKeyType = 'ec';\n                break;\n            case 'OKP': {\n                if (key.crv === 'Ed25519') {\n                    asymmetricKeyType = 'ed25519';\n                    break;\n                }\n                if (key.crv === 'Ed448') {\n                    asymmetricKeyType = 'ed448';\n                    break;\n                }\n                throw new TypeError('Invalid key for this operation, its crv must be Ed25519 or Ed448');\n            }\n            default:\n                throw new TypeError('Invalid key for this operation, its kty must be RSA, OKP, or EC');\n        }\n    }\n    let options;\n    switch (alg) {\n        case 'EdDSA':\n            if (!['ed25519', 'ed448'].includes(asymmetricKeyType)) {\n                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448');\n            }\n            break;\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            if (asymmetricKeyType !== 'rsa') {\n                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be rsa');\n            }\n            (0, check_key_length_js_1.default)(key, alg);\n            break;\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            if (asymmetricKeyType === 'rsa-pss') {\n                const { hashAlgorithm, mgf1HashAlgorithm, saltLength } = asymmetricKeyDetails;\n                const length = parseInt(alg.slice(-3), 10);\n                if (hashAlgorithm !== undefined &&\n                    (hashAlgorithm !== `sha${length}` || mgf1HashAlgorithm !== hashAlgorithm)) {\n                    throw new TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of \"alg\" ${alg}`);\n                }\n                if (saltLength !== undefined && saltLength > length >> 3) {\n                    throw new TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of \"alg\" ${alg}`);\n                }\n            }\n            else if (asymmetricKeyType !== 'rsa') {\n                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss');\n            }\n            (0, check_key_length_js_1.default)(key, alg);\n            options = {\n                padding: node_crypto_1.constants.RSA_PKCS1_PSS_PADDING,\n                saltLength: node_crypto_1.constants.RSA_PSS_SALTLEN_DIGEST,\n            };\n            break;\n        case 'ES256':\n        case 'ES256K':\n        case 'ES384':\n        case 'ES512': {\n            if (asymmetricKeyType !== 'ec') {\n                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be ec');\n            }\n            const actual = (0, get_named_curve_js_1.default)(key);\n            const expected = ecCurveAlgMap.get(alg);\n            if (actual !== expected) {\n                throw new TypeError(`Invalid key curve for the algorithm, its curve must be ${expected}, got ${actual}`);\n            }\n            options = { dsaEncoding: 'ieee-p1363' };\n            break;\n        }\n        default:\n            throw new errors_js_1.JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n    if (isJWK) {\n        return { format: 'jwk', key, ...options };\n    }\n    return options ? { ...options, key } : key;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG;AAClB,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,gBAAgB,IAAI,IAAI;IAC1B;QAAC;QAAS;KAAQ;IAClB;QAAC;QAAU;KAAY;IACvB;QAAC;QAAS;KAAQ;IAClB;QAAC;QAAS;KAAQ;CACrB;AACD,SAAS,aAAa,GAAG,EAAE,GAAG;IAC1B,IAAI;IACJ,IAAI;IACJ,IAAI;IACJ,IAAI,eAAe,cAAc,SAAS,EAAE;QACxC,oBAAoB,IAAI,iBAAiB;QACzC,uBAAuB,IAAI,oBAAoB;IACnD,OACK;QACD,QAAQ;QACR,OAAQ,IAAI,GAAG;YACX,KAAK;gBACD,oBAAoB;gBACpB;YACJ,KAAK;gBACD,oBAAoB;gBACpB;YACJ,KAAK;gBAAO;oBACR,IAAI,IAAI,GAAG,KAAK,WAAW;wBACvB,oBAAoB;wBACpB;oBACJ;oBACA,IAAI,IAAI,GAAG,KAAK,SAAS;wBACrB,oBAAoB;wBACpB;oBACJ;oBACA,MAAM,IAAI,UAAU;gBACxB;YACA;gBACI,MAAM,IAAI,UAAU;QAC5B;IACJ;IACA,IAAI;IACJ,OAAQ;QACJ,KAAK;YACD,IAAI,CAAC;gBAAC;gBAAW;aAAQ,CAAC,QAAQ,CAAC,oBAAoB;gBACnD,MAAM,IAAI,UAAU;YACxB;YACA;QACJ,KAAK;QACL,KAAK;QACL,KAAK;YACD,IAAI,sBAAsB,OAAO;gBAC7B,MAAM,IAAI,UAAU;YACxB;YACA,CAAC,GAAG,sBAAsB,OAAO,EAAE,KAAK;YACxC;QACJ,KAAK;QACL,KAAK;QACL,KAAK;YACD,IAAI,sBAAsB,WAAW;gBACjC,MAAM,EAAE,aAAa,EAAE,iBAAiB,EAAE,UAAU,EAAE,GAAG;gBACzD,MAAM,SAAS,SAAS,IAAI,KAAK,CAAC,CAAC,IAAI;gBACvC,IAAI,kBAAkB,aAClB,CAAC,kBAAkB,CAAC,GAAG,EAAE,QAAQ,IAAI,sBAAsB,aAAa,GAAG;oBAC3E,MAAM,IAAI,UAAU,CAAC,6FAA6F,EAAE,KAAK;gBAC7H;gBACA,IAAI,eAAe,aAAa,aAAa,UAAU,GAAG;oBACtD,MAAM,IAAI,UAAU,CAAC,yGAAyG,EAAE,KAAK;gBACzI;YACJ,OACK,IAAI,sBAAsB,OAAO;gBAClC,MAAM,IAAI,UAAU;YACxB;YACA,CAAC,GAAG,sBAAsB,OAAO,EAAE,KAAK;YACxC,UAAU;gBACN,SAAS,cAAc,SAAS,CAAC,qBAAqB;gBACtD,YAAY,cAAc,SAAS,CAAC,sBAAsB;YAC9D;YACA;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YAAS;gBACV,IAAI,sBAAsB,MAAM;oBAC5B,MAAM,IAAI,UAAU;gBACxB;gBACA,MAAM,SAAS,CAAC,GAAG,qBAAqB,OAAO,EAAE;gBACjD,MAAM,WAAW,cAAc,GAAG,CAAC;gBACnC,IAAI,WAAW,UAAU;oBACrB,MAAM,IAAI,UAAU,CAAC,uDAAuD,EAAE,SAAS,MAAM,EAAE,QAAQ;gBAC3G;gBACA,UAAU;oBAAE,aAAa;gBAAa;gBACtC;YACJ;QACA;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,IAAI,EAAE,IAAI,2DAA2D,CAAC;IACtH;IACA,IAAI,OAAO;QACP,OAAO;YAAE,QAAQ;YAAO;YAAK,GAAG,OAAO;QAAC;IAC5C;IACA,OAAO,UAAU;QAAE,GAAG,OAAO;QAAE;IAAI,IAAI;AAC3C","ignoreList":[0]}},
    {"offset": {"line": 8938, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8943, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/hmac_digest.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = hmacDigest;\nconst errors_js_1 = require(\"../util/errors.js\");\nfunction hmacDigest(alg) {\n    switch (alg) {\n        case 'HS256':\n            return 'sha256';\n        case 'HS384':\n            return 'sha384';\n        case 'HS512':\n            return 'sha512';\n        default:\n            throw new errors_js_1.JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG;AAClB,MAAM;AACN,SAAS,WAAW,GAAG;IACnB,OAAQ;QACJ,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC,CAAC,IAAI,EAAE,IAAI,2DAA2D,CAAC;IACtH;AACJ","ignoreList":[0]}},
    {"offset": {"line": 8961, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 8966, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/get_sign_verify_key.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = getSignVerifyKey;\nconst node_crypto_1 = require(\"node:crypto\");\nconst webcrypto_js_1 = require(\"./webcrypto.js\");\nconst crypto_key_js_1 = require(\"../lib/crypto_key.js\");\nconst invalid_key_input_js_1 = require(\"../lib/invalid_key_input.js\");\nconst is_key_like_js_1 = require(\"./is_key_like.js\");\nconst jwk = require(\"../lib/is_jwk.js\");\nfunction getSignVerifyKey(alg, key, usage) {\n    if (key instanceof Uint8Array) {\n        if (!alg.startsWith('HS')) {\n            throw new TypeError((0, invalid_key_input_js_1.default)(key, ...is_key_like_js_1.types));\n        }\n        return (0, node_crypto_1.createSecretKey)(key);\n    }\n    if (key instanceof node_crypto_1.KeyObject) {\n        return key;\n    }\n    if ((0, webcrypto_js_1.isCryptoKey)(key)) {\n        (0, crypto_key_js_1.checkSigCryptoKey)(key, alg, usage);\n        return node_crypto_1.KeyObject.from(key);\n    }\n    if (jwk.isJWK(key)) {\n        if (alg.startsWith('HS')) {\n            return (0, node_crypto_1.createSecretKey)(Buffer.from(key.k, 'base64url'));\n        }\n        return key;\n    }\n    throw new TypeError((0, invalid_key_input_js_1.default)(key, ...is_key_like_js_1.types, 'Uint8Array', 'JSON Web Key'));\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG;AAClB,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,SAAS,iBAAiB,GAAG,EAAE,GAAG,EAAE,KAAK;IACrC,IAAI,eAAe,YAAY;QAC3B,IAAI,CAAC,IAAI,UAAU,CAAC,OAAO;YACvB,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK;QAC1F;QACA,OAAO,CAAC,GAAG,cAAc,eAAe,EAAE;IAC9C;IACA,IAAI,eAAe,cAAc,SAAS,EAAE;QACxC,OAAO;IACX;IACA,IAAI,CAAC,GAAG,eAAe,WAAW,EAAE,MAAM;QACtC,CAAC,GAAG,gBAAgB,iBAAiB,EAAE,KAAK,KAAK;QACjD,OAAO,cAAc,SAAS,CAAC,IAAI,CAAC;IACxC;IACA,IAAI,IAAI,KAAK,CAAC,MAAM;QAChB,IAAI,IAAI,UAAU,CAAC,OAAO;YACtB,OAAO,CAAC,GAAG,cAAc,eAAe,EAAE,OAAO,IAAI,CAAC,IAAI,CAAC,EAAE;QACjE;QACA,OAAO;IACX;IACA,MAAM,IAAI,UAAU,CAAC,GAAG,uBAAuB,OAAO,EAAE,QAAQ,iBAAiB,KAAK,EAAE,cAAc;AAC1G","ignoreList":[0]}},
    {"offset": {"line": 8999, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9004, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/sign.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst crypto = require(\"node:crypto\");\nconst node_util_1 = require(\"node:util\");\nconst dsa_digest_js_1 = require(\"./dsa_digest.js\");\nconst hmac_digest_js_1 = require(\"./hmac_digest.js\");\nconst node_key_js_1 = require(\"./node_key.js\");\nconst get_sign_verify_key_js_1 = require(\"./get_sign_verify_key.js\");\nconst oneShotSign = (0, node_util_1.promisify)(crypto.sign);\nconst sign = async (alg, key, data) => {\n    const k = (0, get_sign_verify_key_js_1.default)(alg, key, 'sign');\n    if (alg.startsWith('HS')) {\n        const hmac = crypto.createHmac((0, hmac_digest_js_1.default)(alg), k);\n        hmac.update(data);\n        return hmac.digest();\n    }\n    return oneShotSign((0, dsa_digest_js_1.default)(alg), data, (0, node_key_js_1.default)(alg, k));\n};\nexports.default = sign;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,cAAc,CAAC,GAAG,YAAY,SAAS,EAAE,OAAO,IAAI;AAC1D,MAAM,OAAO,OAAO,KAAK,KAAK;IAC1B,MAAM,IAAI,CAAC,GAAG,yBAAyB,OAAO,EAAE,KAAK,KAAK;IAC1D,IAAI,IAAI,UAAU,CAAC,OAAO;QACtB,MAAM,OAAO,OAAO,UAAU,CAAC,CAAC,GAAG,iBAAiB,OAAO,EAAE,MAAM;QACnE,KAAK,MAAM,CAAC;QACZ,OAAO,KAAK,MAAM;IACtB;IACA,OAAO,YAAY,CAAC,GAAG,gBAAgB,OAAO,EAAE,MAAM,MAAM,CAAC,GAAG,cAAc,OAAO,EAAE,KAAK;AAChG;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 9025, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9030, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/verify.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst crypto = require(\"node:crypto\");\nconst node_util_1 = require(\"node:util\");\nconst dsa_digest_js_1 = require(\"./dsa_digest.js\");\nconst node_key_js_1 = require(\"./node_key.js\");\nconst sign_js_1 = require(\"./sign.js\");\nconst get_sign_verify_key_js_1 = require(\"./get_sign_verify_key.js\");\nconst oneShotVerify = (0, node_util_1.promisify)(crypto.verify);\nconst verify = async (alg, key, signature, data) => {\n    const k = (0, get_sign_verify_key_js_1.default)(alg, key, 'verify');\n    if (alg.startsWith('HS')) {\n        const expected = await (0, sign_js_1.default)(alg, k, data);\n        const actual = signature;\n        try {\n            return crypto.timingSafeEqual(actual, expected);\n        }\n        catch {\n            return false;\n        }\n    }\n    const algorithm = (0, dsa_digest_js_1.default)(alg);\n    const keyInput = (0, node_key_js_1.default)(alg, k);\n    try {\n        return await oneShotVerify(algorithm, data, keyInput, signature);\n    }\n    catch {\n        return false;\n    }\n};\nexports.default = verify;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,gBAAgB,CAAC,GAAG,YAAY,SAAS,EAAE,OAAO,MAAM;AAC9D,MAAM,SAAS,OAAO,KAAK,KAAK,WAAW;IACvC,MAAM,IAAI,CAAC,GAAG,yBAAyB,OAAO,EAAE,KAAK,KAAK;IAC1D,IAAI,IAAI,UAAU,CAAC,OAAO;QACtB,MAAM,WAAW,MAAM,CAAC,GAAG,UAAU,OAAO,EAAE,KAAK,GAAG;QACtD,MAAM,SAAS;QACf,IAAI;YACA,OAAO,OAAO,eAAe,CAAC,QAAQ;QAC1C,EACA,OAAM;YACF,OAAO;QACX;IACJ;IACA,MAAM,YAAY,CAAC,GAAG,gBAAgB,OAAO,EAAE;IAC/C,MAAM,WAAW,CAAC,GAAG,cAAc,OAAO,EAAE,KAAK;IACjD,IAAI;QACA,OAAO,MAAM,cAAc,WAAW,MAAM,UAAU;IAC1D,EACA,OAAM;QACF,OAAO;IACX;AACJ;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 9061, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9066, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jws/flattened/verify.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.flattenedVerify = flattenedVerify;\nconst base64url_js_1 = require(\"../../runtime/base64url.js\");\nconst verify_js_1 = require(\"../../runtime/verify.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst buffer_utils_js_1 = require(\"../../lib/buffer_utils.js\");\nconst is_disjoint_js_1 = require(\"../../lib/is_disjoint.js\");\nconst is_object_js_1 = require(\"../../lib/is_object.js\");\nconst check_key_type_js_1 = require(\"../../lib/check_key_type.js\");\nconst validate_crit_js_1 = require(\"../../lib/validate_crit.js\");\nconst validate_algorithms_js_1 = require(\"../../lib/validate_algorithms.js\");\nconst is_jwk_js_1 = require(\"../../lib/is_jwk.js\");\nconst import_js_1 = require(\"../../key/import.js\");\nasync function flattenedVerify(jws, key, options) {\n    if (!(0, is_object_js_1.default)(jws)) {\n        throw new errors_js_1.JWSInvalid('Flattened JWS must be an object');\n    }\n    if (jws.protected === undefined && jws.header === undefined) {\n        throw new errors_js_1.JWSInvalid('Flattened JWS must have either of the \"protected\" or \"header\" members');\n    }\n    if (jws.protected !== undefined && typeof jws.protected !== 'string') {\n        throw new errors_js_1.JWSInvalid('JWS Protected Header incorrect type');\n    }\n    if (jws.payload === undefined) {\n        throw new errors_js_1.JWSInvalid('JWS Payload missing');\n    }\n    if (typeof jws.signature !== 'string') {\n        throw new errors_js_1.JWSInvalid('JWS Signature missing or incorrect type');\n    }\n    if (jws.header !== undefined && !(0, is_object_js_1.default)(jws.header)) {\n        throw new errors_js_1.JWSInvalid('JWS Unprotected Header incorrect type');\n    }\n    let parsedProt = {};\n    if (jws.protected) {\n        try {\n            const protectedHeader = (0, base64url_js_1.decode)(jws.protected);\n            parsedProt = JSON.parse(buffer_utils_js_1.decoder.decode(protectedHeader));\n        }\n        catch {\n            throw new errors_js_1.JWSInvalid('JWS Protected Header is invalid');\n        }\n    }\n    if (!(0, is_disjoint_js_1.default)(parsedProt, jws.header)) {\n        throw new errors_js_1.JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jws.header,\n    };\n    const extensions = (0, validate_crit_js_1.default)(errors_js_1.JWSInvalid, new Map([['b64', true]]), options?.crit, parsedProt, joseHeader);\n    let b64 = true;\n    if (extensions.has('b64')) {\n        b64 = parsedProt.b64;\n        if (typeof b64 !== 'boolean') {\n            throw new errors_js_1.JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n        }\n    }\n    const { alg } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new errors_js_1.JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n    }\n    const algorithms = options && (0, validate_algorithms_js_1.default)('algorithms', options.algorithms);\n    if (algorithms && !algorithms.has(alg)) {\n        throw new errors_js_1.JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter value not allowed');\n    }\n    if (b64) {\n        if (typeof jws.payload !== 'string') {\n            throw new errors_js_1.JWSInvalid('JWS Payload must be a string');\n        }\n    }\n    else if (typeof jws.payload !== 'string' && !(jws.payload instanceof Uint8Array)) {\n        throw new errors_js_1.JWSInvalid('JWS Payload must be a string or an Uint8Array instance');\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jws);\n        resolvedKey = true;\n        (0, check_key_type_js_1.checkKeyTypeWithJwk)(alg, key, 'verify');\n        if ((0, is_jwk_js_1.isJWK)(key)) {\n            key = await (0, import_js_1.importJWK)(key, alg);\n        }\n    }\n    else {\n        (0, check_key_type_js_1.checkKeyTypeWithJwk)(alg, key, 'verify');\n    }\n    const data = (0, buffer_utils_js_1.concat)(buffer_utils_js_1.encoder.encode(jws.protected ?? ''), buffer_utils_js_1.encoder.encode('.'), typeof jws.payload === 'string' ? buffer_utils_js_1.encoder.encode(jws.payload) : jws.payload);\n    let signature;\n    try {\n        signature = (0, base64url_js_1.decode)(jws.signature);\n    }\n    catch {\n        throw new errors_js_1.JWSInvalid('Failed to base64url decode the signature');\n    }\n    const verified = await (0, verify_js_1.default)(alg, key, signature, data);\n    if (!verified) {\n        throw new errors_js_1.JWSSignatureVerificationFailed();\n    }\n    let payload;\n    if (b64) {\n        try {\n            payload = (0, base64url_js_1.decode)(jws.payload);\n        }\n        catch {\n            throw new errors_js_1.JWSInvalid('Failed to base64url decode the payload');\n        }\n    }\n    else if (typeof jws.payload === 'string') {\n        payload = buffer_utils_js_1.encoder.encode(jws.payload);\n    }\n    else {\n        payload = jws.payload;\n    }\n    const result = { payload };\n    if (jws.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jws.header !== undefined) {\n        result.unprotectedHeader = jws.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key };\n    }\n    return result;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,eAAe,GAAG;AAC1B,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,gBAAgB,GAAG,EAAE,GAAG,EAAE,OAAO;IAC5C,IAAI,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,MAAM;QACnC,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,IAAI,SAAS,KAAK,aAAa,IAAI,MAAM,KAAK,WAAW;QACzD,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,IAAI,SAAS,KAAK,aAAa,OAAO,IAAI,SAAS,KAAK,UAAU;QAClE,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,IAAI,OAAO,KAAK,WAAW;QAC3B,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,OAAO,IAAI,SAAS,KAAK,UAAU;QACnC,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,IAAI,MAAM,KAAK,aAAa,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,IAAI,MAAM,GAAG;QACtE,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,aAAa,CAAC;IAClB,IAAI,IAAI,SAAS,EAAE;QACf,IAAI;YACA,MAAM,kBAAkB,CAAC,GAAG,eAAe,MAAM,EAAE,IAAI,SAAS;YAChE,aAAa,KAAK,KAAK,CAAC,kBAAkB,OAAO,CAAC,MAAM,CAAC;QAC7D,EACA,OAAM;YACF,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;IACJ;IACA,IAAI,CAAC,CAAC,GAAG,iBAAiB,OAAO,EAAE,YAAY,IAAI,MAAM,GAAG;QACxD,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,aAAa;QACf,GAAG,UAAU;QACb,GAAG,IAAI,MAAM;IACjB;IACA,MAAM,aAAa,CAAC,GAAG,mBAAmB,OAAO,EAAE,YAAY,UAAU,EAAE,IAAI,IAAI;QAAC;YAAC;YAAO;SAAK;KAAC,GAAG,SAAS,MAAM,YAAY;IAChI,IAAI,MAAM;IACV,IAAI,WAAW,GAAG,CAAC,QAAQ;QACvB,MAAM,WAAW,GAAG;QACpB,IAAI,OAAO,QAAQ,WAAW;YAC1B,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;IACJ;IACA,MAAM,EAAE,GAAG,EAAE,GAAG;IAChB,IAAI,OAAO,QAAQ,YAAY,CAAC,KAAK;QACjC,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,aAAa,WAAW,CAAC,GAAG,yBAAyB,OAAO,EAAE,cAAc,QAAQ,UAAU;IACpG,IAAI,cAAc,CAAC,WAAW,GAAG,CAAC,MAAM;QACpC,MAAM,IAAI,YAAY,iBAAiB,CAAC;IAC5C;IACA,IAAI,KAAK;QACL,IAAI,OAAO,IAAI,OAAO,KAAK,UAAU;YACjC,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;IACJ,OACK,IAAI,OAAO,IAAI,OAAO,KAAK,YAAY,CAAC,CAAC,IAAI,OAAO,YAAY,UAAU,GAAG;QAC9E,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,cAAc;IAClB,IAAI,OAAO,QAAQ,YAAY;QAC3B,MAAM,MAAM,IAAI,YAAY;QAC5B,cAAc;QACd,CAAC,GAAG,oBAAoB,mBAAmB,EAAE,KAAK,KAAK;QACvD,IAAI,CAAC,GAAG,YAAY,KAAK,EAAE,MAAM;YAC7B,MAAM,MAAM,CAAC,GAAG,YAAY,SAAS,EAAE,KAAK;QAChD;IACJ,OACK;QACD,CAAC,GAAG,oBAAoB,mBAAmB,EAAE,KAAK,KAAK;IAC3D;IACA,MAAM,OAAO,CAAC,GAAG,kBAAkB,MAAM,EAAE,kBAAkB,OAAO,CAAC,MAAM,CAAC,IAAI,SAAS,IAAI,KAAK,kBAAkB,OAAO,CAAC,MAAM,CAAC,MAAM,OAAO,IAAI,OAAO,KAAK,WAAW,kBAAkB,OAAO,CAAC,MAAM,CAAC,IAAI,OAAO,IAAI,IAAI,OAAO;IACtO,IAAI;IACJ,IAAI;QACA,YAAY,CAAC,GAAG,eAAe,MAAM,EAAE,IAAI,SAAS;IACxD,EACA,OAAM;QACF,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,WAAW,MAAM,CAAC,GAAG,YAAY,OAAO,EAAE,KAAK,KAAK,WAAW;IACrE,IAAI,CAAC,UAAU;QACX,MAAM,IAAI,YAAY,8BAA8B;IACxD;IACA,IAAI;IACJ,IAAI,KAAK;QACL,IAAI;YACA,UAAU,CAAC,GAAG,eAAe,MAAM,EAAE,IAAI,OAAO;QACpD,EACA,OAAM;YACF,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;IACJ,OACK,IAAI,OAAO,IAAI,OAAO,KAAK,UAAU;QACtC,UAAU,kBAAkB,OAAO,CAAC,MAAM,CAAC,IAAI,OAAO;IAC1D,OACK;QACD,UAAU,IAAI,OAAO;IACzB;IACA,MAAM,SAAS;QAAE;IAAQ;IACzB,IAAI,IAAI,SAAS,KAAK,WAAW;QAC7B,OAAO,eAAe,GAAG;IAC7B;IACA,IAAI,IAAI,MAAM,KAAK,WAAW;QAC1B,OAAO,iBAAiB,GAAG,IAAI,MAAM;IACzC;IACA,IAAI,aAAa;QACb,OAAO;YAAE,GAAG,MAAM;YAAE;QAAI;IAC5B;IACA,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 9196, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9201, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jws/compact/verify.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.compactVerify = compactVerify;\nconst verify_js_1 = require(\"../flattened/verify.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst buffer_utils_js_1 = require(\"../../lib/buffer_utils.js\");\nasync function compactVerify(jws, key, options) {\n    if (jws instanceof Uint8Array) {\n        jws = buffer_utils_js_1.decoder.decode(jws);\n    }\n    if (typeof jws !== 'string') {\n        throw new errors_js_1.JWSInvalid('Compact JWS must be a string or Uint8Array');\n    }\n    const { 0: protectedHeader, 1: payload, 2: signature, length } = jws.split('.');\n    if (length !== 3) {\n        throw new errors_js_1.JWSInvalid('Invalid Compact JWS');\n    }\n    const verified = await (0, verify_js_1.flattenedVerify)({ payload, protected: protectedHeader, signature }, key, options);\n    const result = { payload: verified.payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,aAAa,GAAG;AACxB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,cAAc,GAAG,EAAE,GAAG,EAAE,OAAO;IAC1C,IAAI,eAAe,YAAY;QAC3B,MAAM,kBAAkB,OAAO,CAAC,MAAM,CAAC;IAC3C;IACA,IAAI,OAAO,QAAQ,UAAU;QACzB,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,EAAE,GAAG,eAAe,EAAE,GAAG,OAAO,EAAE,GAAG,SAAS,EAAE,MAAM,EAAE,GAAG,IAAI,KAAK,CAAC;IAC3E,IAAI,WAAW,GAAG;QACd,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,WAAW,MAAM,CAAC,GAAG,YAAY,eAAe,EAAE;QAAE;QAAS,WAAW;QAAiB;IAAU,GAAG,KAAK;IACjH,MAAM,SAAS;QAAE,SAAS,SAAS,OAAO;QAAE,iBAAiB,SAAS,eAAe;IAAC;IACtF,IAAI,OAAO,QAAQ,YAAY;QAC3B,OAAO;YAAE,GAAG,MAAM;YAAE,KAAK,SAAS,GAAG;QAAC;IAC1C;IACA,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 9237, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9242, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jws/general/verify.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generalVerify = generalVerify;\nconst verify_js_1 = require(\"../flattened/verify.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst is_object_js_1 = require(\"../../lib/is_object.js\");\nasync function generalVerify(jws, key, options) {\n    if (!(0, is_object_js_1.default)(jws)) {\n        throw new errors_js_1.JWSInvalid('General JWS must be an object');\n    }\n    if (!Array.isArray(jws.signatures) || !jws.signatures.every(is_object_js_1.default)) {\n        throw new errors_js_1.JWSInvalid('JWS Signatures missing or incorrect type');\n    }\n    for (const signature of jws.signatures) {\n        try {\n            return await (0, verify_js_1.flattenedVerify)({\n                header: signature.header,\n                payload: jws.payload,\n                protected: signature.protected,\n                signature: signature.signature,\n            }, key, options);\n        }\n        catch {\n        }\n    }\n    throw new errors_js_1.JWSSignatureVerificationFailed();\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,aAAa,GAAG;AACxB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,cAAc,GAAG,EAAE,GAAG,EAAE,OAAO;IAC1C,IAAI,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,MAAM;QACnC,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,CAAC,MAAM,OAAO,CAAC,IAAI,UAAU,KAAK,CAAC,IAAI,UAAU,CAAC,KAAK,CAAC,eAAe,OAAO,GAAG;QACjF,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,KAAK,MAAM,aAAa,IAAI,UAAU,CAAE;QACpC,IAAI;YACA,OAAO,MAAM,CAAC,GAAG,YAAY,eAAe,EAAE;gBAC1C,QAAQ,UAAU,MAAM;gBACxB,SAAS,IAAI,OAAO;gBACpB,WAAW,UAAU,SAAS;gBAC9B,WAAW,UAAU,SAAS;YAClC,GAAG,KAAK;QACZ,EACA,OAAM,CACN;IACJ;IACA,MAAM,IAAI,YAAY,8BAA8B;AACxD","ignoreList":[0]}},
    {"offset": {"line": 9269, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9274, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/epoch.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = (date) => Math.floor(date.getTime() / 1000);\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG,CAAC,OAAS,KAAK,KAAK,CAAC,KAAK,OAAO,KAAK","ignoreList":[0]}},
    {"offset": {"line": 9279, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9284, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/secs.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\nexports.default = (str) => {\n    const matched = REGEX.exec(str);\n    if (!matched || (matched[4] && matched[1])) {\n        throw new TypeError('Invalid time period format');\n    }\n    const value = parseFloat(matched[2]);\n    const unit = matched[3].toLowerCase();\n    let numericDate;\n    switch (unit) {\n        case 'sec':\n        case 'secs':\n        case 'second':\n        case 'seconds':\n        case 's':\n            numericDate = Math.round(value);\n            break;\n        case 'minute':\n        case 'minutes':\n        case 'min':\n        case 'mins':\n        case 'm':\n            numericDate = Math.round(value * minute);\n            break;\n        case 'hour':\n        case 'hours':\n        case 'hr':\n        case 'hrs':\n        case 'h':\n            numericDate = Math.round(value * hour);\n            break;\n        case 'day':\n        case 'days':\n        case 'd':\n            numericDate = Math.round(value * day);\n            break;\n        case 'week':\n        case 'weeks':\n        case 'w':\n            numericDate = Math.round(value * week);\n            break;\n        default:\n            numericDate = Math.round(value * year);\n            break;\n    }\n    if (matched[1] === '-' || matched[4] === 'ago') {\n        return -numericDate;\n    }\n    return numericDate;\n};\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM,SAAS;AACf,MAAM,OAAO,SAAS;AACtB,MAAM,MAAM,OAAO;AACnB,MAAM,OAAO,MAAM;AACnB,MAAM,OAAO,MAAM;AACnB,MAAM,QAAQ;AACd,QAAQ,OAAO,GAAG,CAAC;IACf,MAAM,UAAU,MAAM,IAAI,CAAC;IAC3B,IAAI,CAAC,WAAY,OAAO,CAAC,EAAE,IAAI,OAAO,CAAC,EAAE,EAAG;QACxC,MAAM,IAAI,UAAU;IACxB;IACA,MAAM,QAAQ,WAAW,OAAO,CAAC,EAAE;IACnC,MAAM,OAAO,OAAO,CAAC,EAAE,CAAC,WAAW;IACnC,IAAI;IACJ,OAAQ;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACD,cAAc,KAAK,KAAK,CAAC;YACzB;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACD,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACD,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;QACJ,KAAK;QACL,KAAK;QACL,KAAK;YACD,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;QACJ,KAAK;QACL,KAAK;QACL,KAAK;YACD,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;QACJ;YACI,cAAc,KAAK,KAAK,CAAC,QAAQ;YACjC;IACR;IACA,IAAI,OAAO,CAAC,EAAE,KAAK,OAAO,OAAO,CAAC,EAAE,KAAK,OAAO;QAC5C,OAAO,CAAC;IACZ;IACA,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 9343, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9348, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/lib/jwt_claims_set.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst errors_js_1 = require(\"../util/errors.js\");\nconst buffer_utils_js_1 = require(\"./buffer_utils.js\");\nconst epoch_js_1 = require(\"./epoch.js\");\nconst secs_js_1 = require(\"./secs.js\");\nconst is_object_js_1 = require(\"./is_object.js\");\nconst normalizeTyp = (value) => value.toLowerCase().replace(/^application\\//, '');\nconst checkAudiencePresence = (audPayload, audOption) => {\n    if (typeof audPayload === 'string') {\n        return audOption.includes(audPayload);\n    }\n    if (Array.isArray(audPayload)) {\n        return audOption.some(Set.prototype.has.bind(new Set(audPayload)));\n    }\n    return false;\n};\nexports.default = (protectedHeader, encodedPayload, options = {}) => {\n    let payload;\n    try {\n        payload = JSON.parse(buffer_utils_js_1.decoder.decode(encodedPayload));\n    }\n    catch {\n    }\n    if (!(0, is_object_js_1.default)(payload)) {\n        throw new errors_js_1.JWTInvalid('JWT Claims Set must be a top-level JSON object');\n    }\n    const { typ } = options;\n    if (typ &&\n        (typeof protectedHeader.typ !== 'string' ||\n            normalizeTyp(protectedHeader.typ) !== normalizeTyp(typ))) {\n        throw new errors_js_1.JWTClaimValidationFailed('unexpected \"typ\" JWT header value', payload, 'typ', 'check_failed');\n    }\n    const { requiredClaims = [], issuer, subject, audience, maxTokenAge } = options;\n    const presenceCheck = [...requiredClaims];\n    if (maxTokenAge !== undefined)\n        presenceCheck.push('iat');\n    if (audience !== undefined)\n        presenceCheck.push('aud');\n    if (subject !== undefined)\n        presenceCheck.push('sub');\n    if (issuer !== undefined)\n        presenceCheck.push('iss');\n    for (const claim of new Set(presenceCheck.reverse())) {\n        if (!(claim in payload)) {\n            throw new errors_js_1.JWTClaimValidationFailed(`missing required \"${claim}\" claim`, payload, claim, 'missing');\n        }\n    }\n    if (issuer &&\n        !(Array.isArray(issuer) ? issuer : [issuer]).includes(payload.iss)) {\n        throw new errors_js_1.JWTClaimValidationFailed('unexpected \"iss\" claim value', payload, 'iss', 'check_failed');\n    }\n    if (subject && payload.sub !== subject) {\n        throw new errors_js_1.JWTClaimValidationFailed('unexpected \"sub\" claim value', payload, 'sub', 'check_failed');\n    }\n    if (audience &&\n        !checkAudiencePresence(payload.aud, typeof audience === 'string' ? [audience] : audience)) {\n        throw new errors_js_1.JWTClaimValidationFailed('unexpected \"aud\" claim value', payload, 'aud', 'check_failed');\n    }\n    let tolerance;\n    switch (typeof options.clockTolerance) {\n        case 'string':\n            tolerance = (0, secs_js_1.default)(options.clockTolerance);\n            break;\n        case 'number':\n            tolerance = options.clockTolerance;\n            break;\n        case 'undefined':\n            tolerance = 0;\n            break;\n        default:\n            throw new TypeError('Invalid clockTolerance option type');\n    }\n    const { currentDate } = options;\n    const now = (0, epoch_js_1.default)(currentDate || new Date());\n    if ((payload.iat !== undefined || maxTokenAge) && typeof payload.iat !== 'number') {\n        throw new errors_js_1.JWTClaimValidationFailed('\"iat\" claim must be a number', payload, 'iat', 'invalid');\n    }\n    if (payload.nbf !== undefined) {\n        if (typeof payload.nbf !== 'number') {\n            throw new errors_js_1.JWTClaimValidationFailed('\"nbf\" claim must be a number', payload, 'nbf', 'invalid');\n        }\n        if (payload.nbf > now + tolerance) {\n            throw new errors_js_1.JWTClaimValidationFailed('\"nbf\" claim timestamp check failed', payload, 'nbf', 'check_failed');\n        }\n    }\n    if (payload.exp !== undefined) {\n        if (typeof payload.exp !== 'number') {\n            throw new errors_js_1.JWTClaimValidationFailed('\"exp\" claim must be a number', payload, 'exp', 'invalid');\n        }\n        if (payload.exp <= now - tolerance) {\n            throw new errors_js_1.JWTExpired('\"exp\" claim timestamp check failed', payload, 'exp', 'check_failed');\n        }\n    }\n    if (maxTokenAge) {\n        const age = now - payload.iat;\n        const max = typeof maxTokenAge === 'number' ? maxTokenAge : (0, secs_js_1.default)(maxTokenAge);\n        if (age - tolerance > max) {\n            throw new errors_js_1.JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', payload, 'iat', 'check_failed');\n        }\n        if (age < 0 - tolerance) {\n            throw new errors_js_1.JWTClaimValidationFailed('\"iat\" claim timestamp check failed (it should be in the past)', payload, 'iat', 'check_failed');\n        }\n    }\n    return payload;\n};\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 9452, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9457, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwt/verify.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.jwtVerify = jwtVerify;\nconst verify_js_1 = require(\"../jws/compact/verify.js\");\nconst jwt_claims_set_js_1 = require(\"../lib/jwt_claims_set.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nasync function jwtVerify(jwt, key, options) {\n    const verified = await (0, verify_js_1.compactVerify)(jwt, key, options);\n    if (verified.protectedHeader.crit?.includes('b64') && verified.protectedHeader.b64 === false) {\n        throw new errors_js_1.JWTInvalid('JWTs MUST NOT use unencoded payload');\n    }\n    const payload = (0, jwt_claims_set_js_1.default)(verified.protectedHeader, verified.payload, options);\n    const result = { payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,SAAS,GAAG;AACpB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,UAAU,GAAG,EAAE,GAAG,EAAE,OAAO;IACtC,MAAM,WAAW,MAAM,CAAC,GAAG,YAAY,aAAa,EAAE,KAAK,KAAK;IAChE,IAAI,SAAS,eAAe,CAAC,IAAI,EAAE,SAAS,UAAU,SAAS,eAAe,CAAC,GAAG,KAAK,OAAO;QAC1F,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,UAAU,CAAC,GAAG,oBAAoB,OAAO,EAAE,SAAS,eAAe,EAAE,SAAS,OAAO,EAAE;IAC7F,MAAM,SAAS;QAAE;QAAS,iBAAiB,SAAS,eAAe;IAAC;IACpE,IAAI,OAAO,QAAQ,YAAY;QAC3B,OAAO;YAAE,GAAG,MAAM;YAAE,KAAK,SAAS,GAAG;QAAC;IAC1C;IACA,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 9483, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9488, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwt/decrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.jwtDecrypt = jwtDecrypt;\nconst decrypt_js_1 = require(\"../jwe/compact/decrypt.js\");\nconst jwt_claims_set_js_1 = require(\"../lib/jwt_claims_set.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nasync function jwtDecrypt(jwt, key, options) {\n    const decrypted = await (0, decrypt_js_1.compactDecrypt)(jwt, key, options);\n    const payload = (0, jwt_claims_set_js_1.default)(decrypted.protectedHeader, decrypted.plaintext, options);\n    const { protectedHeader } = decrypted;\n    if (protectedHeader.iss !== undefined && protectedHeader.iss !== payload.iss) {\n        throw new errors_js_1.JWTClaimValidationFailed('replicated \"iss\" claim header parameter mismatch', payload, 'iss', 'mismatch');\n    }\n    if (protectedHeader.sub !== undefined && protectedHeader.sub !== payload.sub) {\n        throw new errors_js_1.JWTClaimValidationFailed('replicated \"sub\" claim header parameter mismatch', payload, 'sub', 'mismatch');\n    }\n    if (protectedHeader.aud !== undefined &&\n        JSON.stringify(protectedHeader.aud) !== JSON.stringify(payload.aud)) {\n        throw new errors_js_1.JWTClaimValidationFailed('replicated \"aud\" claim header parameter mismatch', payload, 'aud', 'mismatch');\n    }\n    const result = { payload, protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: decrypted.key };\n    }\n    return result;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,UAAU,GAAG;AACrB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,WAAW,GAAG,EAAE,GAAG,EAAE,OAAO;IACvC,MAAM,YAAY,MAAM,CAAC,GAAG,aAAa,cAAc,EAAE,KAAK,KAAK;IACnE,MAAM,UAAU,CAAC,GAAG,oBAAoB,OAAO,EAAE,UAAU,eAAe,EAAE,UAAU,SAAS,EAAE;IACjG,MAAM,EAAE,eAAe,EAAE,GAAG;IAC5B,IAAI,gBAAgB,GAAG,KAAK,aAAa,gBAAgB,GAAG,KAAK,QAAQ,GAAG,EAAE;QAC1E,MAAM,IAAI,YAAY,wBAAwB,CAAC,oDAAoD,SAAS,OAAO;IACvH;IACA,IAAI,gBAAgB,GAAG,KAAK,aAAa,gBAAgB,GAAG,KAAK,QAAQ,GAAG,EAAE;QAC1E,MAAM,IAAI,YAAY,wBAAwB,CAAC,oDAAoD,SAAS,OAAO;IACvH;IACA,IAAI,gBAAgB,GAAG,KAAK,aACxB,KAAK,SAAS,CAAC,gBAAgB,GAAG,MAAM,KAAK,SAAS,CAAC,QAAQ,GAAG,GAAG;QACrE,MAAM,IAAI,YAAY,wBAAwB,CAAC,oDAAoD,SAAS,OAAO;IACvH;IACA,MAAM,SAAS;QAAE;QAAS;IAAgB;IAC1C,IAAI,OAAO,QAAQ,YAAY;QAC3B,OAAO;YAAE,GAAG,MAAM;YAAE,KAAK,UAAU,GAAG;QAAC;IAC3C;IACA,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 9521, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9526, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwe/compact/encrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CompactEncrypt = void 0;\nconst encrypt_js_1 = require(\"../flattened/encrypt.js\");\nclass CompactEncrypt {\n    _flattened;\n    constructor(plaintext) {\n        this._flattened = new encrypt_js_1.FlattenedEncrypt(plaintext);\n    }\n    setContentEncryptionKey(cek) {\n        this._flattened.setContentEncryptionKey(cek);\n        return this;\n    }\n    setInitializationVector(iv) {\n        this._flattened.setInitializationVector(iv);\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        this._flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    setKeyManagementParameters(parameters) {\n        this._flattened.setKeyManagementParameters(parameters);\n        return this;\n    }\n    async encrypt(key, options) {\n        const jwe = await this._flattened.encrypt(key, options);\n        return [jwe.protected, jwe.encrypted_key, jwe.iv, jwe.ciphertext, jwe.tag].join('.');\n    }\n}\nexports.CompactEncrypt = CompactEncrypt;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,cAAc,GAAG,KAAK;AAC9B,MAAM;AACN,MAAM;IACF,WAAW;IACX,YAAY,SAAS,CAAE;QACnB,IAAI,CAAC,UAAU,GAAG,IAAI,aAAa,gBAAgB,CAAC;IACxD;IACA,wBAAwB,GAAG,EAAE;QACzB,IAAI,CAAC,UAAU,CAAC,uBAAuB,CAAC;QACxC,OAAO,IAAI;IACf;IACA,wBAAwB,EAAE,EAAE;QACxB,IAAI,CAAC,UAAU,CAAC,uBAAuB,CAAC;QACxC,OAAO,IAAI;IACf;IACA,mBAAmB,eAAe,EAAE;QAChC,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC;QACnC,OAAO,IAAI;IACf;IACA,2BAA2B,UAAU,EAAE;QACnC,IAAI,CAAC,UAAU,CAAC,0BAA0B,CAAC;QAC3C,OAAO,IAAI;IACf;IACA,MAAM,QAAQ,GAAG,EAAE,OAAO,EAAE;QACxB,MAAM,MAAM,MAAM,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK;QAC/C,OAAO;YAAC,IAAI,SAAS;YAAE,IAAI,aAAa;YAAE,IAAI,EAAE;YAAE,IAAI,UAAU;YAAE,IAAI,GAAG;SAAC,CAAC,IAAI,CAAC;IACpF;AACJ;AACA,QAAQ,cAAc,GAAG","ignoreList":[0]}},
    {"offset": {"line": 9565, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9570, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jws/flattened/sign.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FlattenedSign = void 0;\nconst base64url_js_1 = require(\"../../runtime/base64url.js\");\nconst sign_js_1 = require(\"../../runtime/sign.js\");\nconst is_disjoint_js_1 = require(\"../../lib/is_disjoint.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nconst buffer_utils_js_1 = require(\"../../lib/buffer_utils.js\");\nconst check_key_type_js_1 = require(\"../../lib/check_key_type.js\");\nconst validate_crit_js_1 = require(\"../../lib/validate_crit.js\");\nclass FlattenedSign {\n    _payload;\n    _protectedHeader;\n    _unprotectedHeader;\n    constructor(payload) {\n        if (!(payload instanceof Uint8Array)) {\n            throw new TypeError('payload must be an instance of Uint8Array');\n        }\n        this._payload = payload;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        if (!this._protectedHeader && !this._unprotectedHeader) {\n            throw new errors_js_1.JWSInvalid('either setProtectedHeader or setUnprotectedHeader must be called before #sign()');\n        }\n        if (!(0, is_disjoint_js_1.default)(this._protectedHeader, this._unprotectedHeader)) {\n            throw new errors_js_1.JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this._protectedHeader,\n            ...this._unprotectedHeader,\n        };\n        const extensions = (0, validate_crit_js_1.default)(errors_js_1.JWSInvalid, new Map([['b64', true]]), options?.crit, this._protectedHeader, joseHeader);\n        let b64 = true;\n        if (extensions.has('b64')) {\n            b64 = this._protectedHeader.b64;\n            if (typeof b64 !== 'boolean') {\n                throw new errors_js_1.JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n            }\n        }\n        const { alg } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new errors_js_1.JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        (0, check_key_type_js_1.checkKeyTypeWithJwk)(alg, key, 'sign');\n        let payload = this._payload;\n        if (b64) {\n            payload = buffer_utils_js_1.encoder.encode((0, base64url_js_1.encode)(payload));\n        }\n        let protectedHeader;\n        if (this._protectedHeader) {\n            protectedHeader = buffer_utils_js_1.encoder.encode((0, base64url_js_1.encode)(JSON.stringify(this._protectedHeader)));\n        }\n        else {\n            protectedHeader = buffer_utils_js_1.encoder.encode('');\n        }\n        const data = (0, buffer_utils_js_1.concat)(protectedHeader, buffer_utils_js_1.encoder.encode('.'), payload);\n        const signature = await (0, sign_js_1.default)(alg, key, data);\n        const jws = {\n            signature: (0, base64url_js_1.encode)(signature),\n            payload: '',\n        };\n        if (b64) {\n            jws.payload = buffer_utils_js_1.decoder.decode(payload);\n        }\n        if (this._unprotectedHeader) {\n            jws.header = this._unprotectedHeader;\n        }\n        if (this._protectedHeader) {\n            jws.protected = buffer_utils_js_1.decoder.decode(protectedHeader);\n        }\n        return jws;\n    }\n}\nexports.FlattenedSign = FlattenedSign;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 9664, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9669, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jws/compact/sign.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CompactSign = void 0;\nconst sign_js_1 = require(\"../flattened/sign.js\");\nclass CompactSign {\n    _flattened;\n    constructor(payload) {\n        this._flattened = new sign_js_1.FlattenedSign(payload);\n    }\n    setProtectedHeader(protectedHeader) {\n        this._flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    async sign(key, options) {\n        const jws = await this._flattened.sign(key, options);\n        if (jws.payload === undefined) {\n            throw new TypeError('use the flattened module for creating JWS with b64: false');\n        }\n        return `${jws.protected}.${jws.payload}.${jws.signature}`;\n    }\n}\nexports.CompactSign = CompactSign;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,WAAW,GAAG,KAAK;AAC3B,MAAM;AACN,MAAM;IACF,WAAW;IACX,YAAY,OAAO,CAAE;QACjB,IAAI,CAAC,UAAU,GAAG,IAAI,UAAU,aAAa,CAAC;IAClD;IACA,mBAAmB,eAAe,EAAE;QAChC,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC;QACnC,OAAO,IAAI;IACf;IACA,MAAM,KAAK,GAAG,EAAE,OAAO,EAAE;QACrB,MAAM,MAAM,MAAM,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK;QAC5C,IAAI,IAAI,OAAO,KAAK,WAAW;YAC3B,MAAM,IAAI,UAAU;QACxB;QACA,OAAO,GAAG,IAAI,SAAS,CAAC,CAAC,EAAE,IAAI,OAAO,CAAC,CAAC,EAAE,IAAI,SAAS,EAAE;IAC7D;AACJ;AACA,QAAQ,WAAW,GAAG","ignoreList":[0]}},
    {"offset": {"line": 9693, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9698, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jws/general/sign.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GeneralSign = void 0;\nconst sign_js_1 = require(\"../flattened/sign.js\");\nconst errors_js_1 = require(\"../../util/errors.js\");\nclass IndividualSignature {\n    parent;\n    protectedHeader;\n    unprotectedHeader;\n    options;\n    key;\n    constructor(sig, key, options) {\n        this.parent = sig;\n        this.key = key;\n        this.options = options;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this.protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this.protectedHeader = protectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this.unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this.unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    addSignature(...args) {\n        return this.parent.addSignature(...args);\n    }\n    sign(...args) {\n        return this.parent.sign(...args);\n    }\n    done() {\n        return this.parent;\n    }\n}\nclass GeneralSign {\n    _payload;\n    _signatures = [];\n    constructor(payload) {\n        this._payload = payload;\n    }\n    addSignature(key, options) {\n        const signature = new IndividualSignature(this, key, options);\n        this._signatures.push(signature);\n        return signature;\n    }\n    async sign() {\n        if (!this._signatures.length) {\n            throw new errors_js_1.JWSInvalid('at least one signature must be added');\n        }\n        const jws = {\n            signatures: [],\n            payload: '',\n        };\n        for (let i = 0; i < this._signatures.length; i++) {\n            const signature = this._signatures[i];\n            const flattened = new sign_js_1.FlattenedSign(this._payload);\n            flattened.setProtectedHeader(signature.protectedHeader);\n            flattened.setUnprotectedHeader(signature.unprotectedHeader);\n            const { payload, ...rest } = await flattened.sign(signature.key, signature.options);\n            if (i === 0) {\n                jws.payload = payload;\n            }\n            else if (jws.payload !== payload) {\n                throw new errors_js_1.JWSInvalid('inconsistent use of JWS Unencoded Payload (RFC7797)');\n            }\n            jws.signatures.push(rest);\n        }\n        return jws;\n    }\n}\nexports.GeneralSign = GeneralSign;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,WAAW,GAAG,KAAK;AAC3B,MAAM;AACN,MAAM;AACN,MAAM;IACF,OAAO;IACP,gBAAgB;IAChB,kBAAkB;IAClB,QAAQ;IACR,IAAI;IACJ,YAAY,GAAG,EAAE,GAAG,EAAE,OAAO,CAAE;QAC3B,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,GAAG,GAAG;QACX,IAAI,CAAC,OAAO,GAAG;IACnB;IACA,mBAAmB,eAAe,EAAE;QAChC,IAAI,IAAI,CAAC,eAAe,EAAE;YACtB,MAAM,IAAI,UAAU;QACxB;QACA,IAAI,CAAC,eAAe,GAAG;QACvB,OAAO,IAAI;IACf;IACA,qBAAqB,iBAAiB,EAAE;QACpC,IAAI,IAAI,CAAC,iBAAiB,EAAE;YACxB,MAAM,IAAI,UAAU;QACxB;QACA,IAAI,CAAC,iBAAiB,GAAG;QACzB,OAAO,IAAI;IACf;IACA,aAAa,GAAG,IAAI,EAAE;QAClB,OAAO,IAAI,CAAC,MAAM,CAAC,YAAY,IAAI;IACvC;IACA,KAAK,GAAG,IAAI,EAAE;QACV,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI;IAC/B;IACA,OAAO;QACH,OAAO,IAAI,CAAC,MAAM;IACtB;AACJ;AACA,MAAM;IACF,SAAS;IACT,cAAc,EAAE,CAAC;IACjB,YAAY,OAAO,CAAE;QACjB,IAAI,CAAC,QAAQ,GAAG;IACpB;IACA,aAAa,GAAG,EAAE,OAAO,EAAE;QACvB,MAAM,YAAY,IAAI,oBAAoB,IAAI,EAAE,KAAK;QACrD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;QACtB,OAAO;IACX;IACA,MAAM,OAAO;QACT,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;YAC1B,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;QACA,MAAM,MAAM;YACR,YAAY,EAAE;YACd,SAAS;QACb;QACA,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,IAAK;YAC9C,MAAM,YAAY,IAAI,CAAC,WAAW,CAAC,EAAE;YACrC,MAAM,YAAY,IAAI,UAAU,aAAa,CAAC,IAAI,CAAC,QAAQ;YAC3D,UAAU,kBAAkB,CAAC,UAAU,eAAe;YACtD,UAAU,oBAAoB,CAAC,UAAU,iBAAiB;YAC1D,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,GAAG,MAAM,UAAU,IAAI,CAAC,UAAU,GAAG,EAAE,UAAU,OAAO;YAClF,IAAI,MAAM,GAAG;gBACT,IAAI,OAAO,GAAG;YAClB,OACK,IAAI,IAAI,OAAO,KAAK,SAAS;gBAC9B,MAAM,IAAI,YAAY,UAAU,CAAC;YACrC;YACA,IAAI,UAAU,CAAC,IAAI,CAAC;QACxB;QACA,OAAO;IACX;AACJ;AACA,QAAQ,WAAW,GAAG","ignoreList":[0]}},
    {"offset": {"line": 9776, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9781, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwt/produce.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ProduceJWT = void 0;\nconst epoch_js_1 = require(\"../lib/epoch.js\");\nconst is_object_js_1 = require(\"../lib/is_object.js\");\nconst secs_js_1 = require(\"../lib/secs.js\");\nfunction validateInput(label, input) {\n    if (!Number.isFinite(input)) {\n        throw new TypeError(`Invalid ${label} input`);\n    }\n    return input;\n}\nclass ProduceJWT {\n    _payload;\n    constructor(payload = {}) {\n        if (!(0, is_object_js_1.default)(payload)) {\n            throw new TypeError('JWT Claims Set MUST be an object');\n        }\n        this._payload = payload;\n    }\n    setIssuer(issuer) {\n        this._payload = { ...this._payload, iss: issuer };\n        return this;\n    }\n    setSubject(subject) {\n        this._payload = { ...this._payload, sub: subject };\n        return this;\n    }\n    setAudience(audience) {\n        this._payload = { ...this._payload, aud: audience };\n        return this;\n    }\n    setJti(jwtId) {\n        this._payload = { ...this._payload, jti: jwtId };\n        return this;\n    }\n    setNotBefore(input) {\n        if (typeof input === 'number') {\n            this._payload = { ...this._payload, nbf: validateInput('setNotBefore', input) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, nbf: validateInput('setNotBefore', (0, epoch_js_1.default)(input)) };\n        }\n        else {\n            this._payload = { ...this._payload, nbf: (0, epoch_js_1.default)(new Date()) + (0, secs_js_1.default)(input) };\n        }\n        return this;\n    }\n    setExpirationTime(input) {\n        if (typeof input === 'number') {\n            this._payload = { ...this._payload, exp: validateInput('setExpirationTime', input) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, exp: validateInput('setExpirationTime', (0, epoch_js_1.default)(input)) };\n        }\n        else {\n            this._payload = { ...this._payload, exp: (0, epoch_js_1.default)(new Date()) + (0, secs_js_1.default)(input) };\n        }\n        return this;\n    }\n    setIssuedAt(input) {\n        if (typeof input === 'undefined') {\n            this._payload = { ...this._payload, iat: (0, epoch_js_1.default)(new Date()) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, iat: validateInput('setIssuedAt', (0, epoch_js_1.default)(input)) };\n        }\n        else if (typeof input === 'string') {\n            this._payload = {\n                ...this._payload,\n                iat: validateInput('setIssuedAt', (0, epoch_js_1.default)(new Date()) + (0, secs_js_1.default)(input)),\n            };\n        }\n        else {\n            this._payload = { ...this._payload, iat: validateInput('setIssuedAt', input) };\n        }\n        return this;\n    }\n}\nexports.ProduceJWT = ProduceJWT;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 9895, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9900, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwt/sign.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SignJWT = void 0;\nconst sign_js_1 = require(\"../jws/compact/sign.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst produce_js_1 = require(\"./produce.js\");\nclass SignJWT extends produce_js_1.ProduceJWT {\n    _protectedHeader;\n    setProtectedHeader(protectedHeader) {\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        const sig = new sign_js_1.CompactSign(buffer_utils_js_1.encoder.encode(JSON.stringify(this._payload)));\n        sig.setProtectedHeader(this._protectedHeader);\n        if (Array.isArray(this._protectedHeader?.crit) &&\n            this._protectedHeader.crit.includes('b64') &&\n            this._protectedHeader.b64 === false) {\n            throw new errors_js_1.JWTInvalid('JWTs MUST NOT use unencoded payload');\n        }\n        return sig.sign(key, options);\n    }\n}\nexports.SignJWT = SignJWT;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG,KAAK;AACvB,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,gBAAgB,aAAa,UAAU;IACzC,iBAAiB;IACjB,mBAAmB,eAAe,EAAE;QAChC,IAAI,CAAC,gBAAgB,GAAG;QACxB,OAAO,IAAI;IACf;IACA,MAAM,KAAK,GAAG,EAAE,OAAO,EAAE;QACrB,MAAM,MAAM,IAAI,UAAU,WAAW,CAAC,kBAAkB,OAAO,CAAC,MAAM,CAAC,KAAK,SAAS,CAAC,IAAI,CAAC,QAAQ;QACnG,IAAI,kBAAkB,CAAC,IAAI,CAAC,gBAAgB;QAC5C,IAAI,MAAM,OAAO,CAAC,IAAI,CAAC,gBAAgB,EAAE,SACrC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,QAAQ,CAAC,UACpC,IAAI,CAAC,gBAAgB,CAAC,GAAG,KAAK,OAAO;YACrC,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;QACA,OAAO,IAAI,IAAI,CAAC,KAAK;IACzB;AACJ;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 9925, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 9930, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwt/encrypt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EncryptJWT = void 0;\nconst encrypt_js_1 = require(\"../jwe/compact/encrypt.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst produce_js_1 = require(\"./produce.js\");\nclass EncryptJWT extends produce_js_1.ProduceJWT {\n    _cek;\n    _iv;\n    _keyManagementParameters;\n    _protectedHeader;\n    _replicateIssuerAsHeader;\n    _replicateSubjectAsHeader;\n    _replicateAudienceAsHeader;\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setKeyManagementParameters(parameters) {\n        if (this._keyManagementParameters) {\n            throw new TypeError('setKeyManagementParameters can only be called once');\n        }\n        this._keyManagementParameters = parameters;\n        return this;\n    }\n    setContentEncryptionKey(cek) {\n        if (this._cek) {\n            throw new TypeError('setContentEncryptionKey can only be called once');\n        }\n        this._cek = cek;\n        return this;\n    }\n    setInitializationVector(iv) {\n        if (this._iv) {\n            throw new TypeError('setInitializationVector can only be called once');\n        }\n        this._iv = iv;\n        return this;\n    }\n    replicateIssuerAsHeader() {\n        this._replicateIssuerAsHeader = true;\n        return this;\n    }\n    replicateSubjectAsHeader() {\n        this._replicateSubjectAsHeader = true;\n        return this;\n    }\n    replicateAudienceAsHeader() {\n        this._replicateAudienceAsHeader = true;\n        return this;\n    }\n    async encrypt(key, options) {\n        const enc = new encrypt_js_1.CompactEncrypt(buffer_utils_js_1.encoder.encode(JSON.stringify(this._payload)));\n        if (this._replicateIssuerAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, iss: this._payload.iss };\n        }\n        if (this._replicateSubjectAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, sub: this._payload.sub };\n        }\n        if (this._replicateAudienceAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, aud: this._payload.aud };\n        }\n        enc.setProtectedHeader(this._protectedHeader);\n        if (this._iv) {\n            enc.setInitializationVector(this._iv);\n        }\n        if (this._cek) {\n            enc.setContentEncryptionKey(this._cek);\n        }\n        if (this._keyManagementParameters) {\n            enc.setKeyManagementParameters(this._keyManagementParameters);\n        }\n        return enc.encrypt(key, options);\n    }\n}\nexports.EncryptJWT = EncryptJWT;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,UAAU,GAAG,KAAK;AAC1B,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,mBAAmB,aAAa,UAAU;IAC5C,KAAK;IACL,IAAI;IACJ,yBAAyB;IACzB,iBAAiB;IACjB,yBAAyB;IACzB,0BAA0B;IAC1B,2BAA2B;IAC3B,mBAAmB,eAAe,EAAE;QAChC,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACvB,MAAM,IAAI,UAAU;QACxB;QACA,IAAI,CAAC,gBAAgB,GAAG;QACxB,OAAO,IAAI;IACf;IACA,2BAA2B,UAAU,EAAE;QACnC,IAAI,IAAI,CAAC,wBAAwB,EAAE;YAC/B,MAAM,IAAI,UAAU;QACxB;QACA,IAAI,CAAC,wBAAwB,GAAG;QAChC,OAAO,IAAI;IACf;IACA,wBAAwB,GAAG,EAAE;QACzB,IAAI,IAAI,CAAC,IAAI,EAAE;YACX,MAAM,IAAI,UAAU;QACxB;QACA,IAAI,CAAC,IAAI,GAAG;QACZ,OAAO,IAAI;IACf;IACA,wBAAwB,EAAE,EAAE;QACxB,IAAI,IAAI,CAAC,GAAG,EAAE;YACV,MAAM,IAAI,UAAU;QACxB;QACA,IAAI,CAAC,GAAG,GAAG;QACX,OAAO,IAAI;IACf;IACA,0BAA0B;QACtB,IAAI,CAAC,wBAAwB,GAAG;QAChC,OAAO,IAAI;IACf;IACA,2BAA2B;QACvB,IAAI,CAAC,yBAAyB,GAAG;QACjC,OAAO,IAAI;IACf;IACA,4BAA4B;QACxB,IAAI,CAAC,0BAA0B,GAAG;QAClC,OAAO,IAAI;IACf;IACA,MAAM,QAAQ,GAAG,EAAE,OAAO,EAAE;QACxB,MAAM,MAAM,IAAI,aAAa,cAAc,CAAC,kBAAkB,OAAO,CAAC,MAAM,CAAC,KAAK,SAAS,CAAC,IAAI,CAAC,QAAQ;QACzG,IAAI,IAAI,CAAC,wBAAwB,EAAE;YAC/B,IAAI,CAAC,gBAAgB,GAAG;gBAAE,GAAG,IAAI,CAAC,gBAAgB;gBAAE,KAAK,IAAI,CAAC,QAAQ,CAAC,GAAG;YAAC;QAC/E;QACA,IAAI,IAAI,CAAC,yBAAyB,EAAE;YAChC,IAAI,CAAC,gBAAgB,GAAG;gBAAE,GAAG,IAAI,CAAC,gBAAgB;gBAAE,KAAK,IAAI,CAAC,QAAQ,CAAC,GAAG;YAAC;QAC/E;QACA,IAAI,IAAI,CAAC,0BAA0B,EAAE;YACjC,IAAI,CAAC,gBAAgB,GAAG;gBAAE,GAAG,IAAI,CAAC,gBAAgB;gBAAE,KAAK,IAAI,CAAC,QAAQ,CAAC,GAAG;YAAC;QAC/E;QACA,IAAI,kBAAkB,CAAC,IAAI,CAAC,gBAAgB;QAC5C,IAAI,IAAI,CAAC,GAAG,EAAE;YACV,IAAI,uBAAuB,CAAC,IAAI,CAAC,GAAG;QACxC;QACA,IAAI,IAAI,CAAC,IAAI,EAAE;YACX,IAAI,uBAAuB,CAAC,IAAI,CAAC,IAAI;QACzC;QACA,IAAI,IAAI,CAAC,wBAAwB,EAAE;YAC/B,IAAI,0BAA0B,CAAC,IAAI,CAAC,wBAAwB;QAChE;QACA,OAAO,IAAI,OAAO,CAAC,KAAK;IAC5B;AACJ;AACA,QAAQ,UAAU,GAAG","ignoreList":[0]}},
    {"offset": {"line": 10020, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10025, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwk/thumbprint.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.calculateJwkThumbprint = calculateJwkThumbprint;\nexports.calculateJwkThumbprintUri = calculateJwkThumbprintUri;\nconst digest_js_1 = require(\"../runtime/digest.js\");\nconst base64url_js_1 = require(\"../runtime/base64url.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst is_object_js_1 = require(\"../lib/is_object.js\");\nconst check = (value, description) => {\n    if (typeof value !== 'string' || !value) {\n        throw new errors_js_1.JWKInvalid(`${description} missing or invalid`);\n    }\n};\nasync function calculateJwkThumbprint(jwk, digestAlgorithm) {\n    if (!(0, is_object_js_1.default)(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    digestAlgorithm ??= 'sha256';\n    if (digestAlgorithm !== 'sha256' &&\n        digestAlgorithm !== 'sha384' &&\n        digestAlgorithm !== 'sha512') {\n        throw new TypeError('digestAlgorithm must one of \"sha256\", \"sha384\", or \"sha512\"');\n    }\n    let components;\n    switch (jwk.kty) {\n        case 'EC':\n            check(jwk.crv, '\"crv\" (Curve) Parameter');\n            check(jwk.x, '\"x\" (X Coordinate) Parameter');\n            check(jwk.y, '\"y\" (Y Coordinate) Parameter');\n            components = { crv: jwk.crv, kty: jwk.kty, x: jwk.x, y: jwk.y };\n            break;\n        case 'OKP':\n            check(jwk.crv, '\"crv\" (Subtype of Key Pair) Parameter');\n            check(jwk.x, '\"x\" (Public Key) Parameter');\n            components = { crv: jwk.crv, kty: jwk.kty, x: jwk.x };\n            break;\n        case 'RSA':\n            check(jwk.e, '\"e\" (Exponent) Parameter');\n            check(jwk.n, '\"n\" (Modulus) Parameter');\n            components = { e: jwk.e, kty: jwk.kty, n: jwk.n };\n            break;\n        case 'oct':\n            check(jwk.k, '\"k\" (Key Value) Parameter');\n            components = { k: jwk.k, kty: jwk.kty };\n            break;\n        default:\n            throw new errors_js_1.JOSENotSupported('\"kty\" (Key Type) Parameter missing or unsupported');\n    }\n    const data = buffer_utils_js_1.encoder.encode(JSON.stringify(components));\n    return (0, base64url_js_1.encode)(await (0, digest_js_1.default)(digestAlgorithm, data));\n}\nasync function calculateJwkThumbprintUri(jwk, digestAlgorithm) {\n    digestAlgorithm ??= 'sha256';\n    const thumbprint = await calculateJwkThumbprint(jwk, digestAlgorithm);\n    return `urn:ietf:params:oauth:jwk-thumbprint:sha-${digestAlgorithm.slice(-3)}:${thumbprint}`;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,sBAAsB,GAAG;AACjC,QAAQ,yBAAyB,GAAG;AACpC,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,QAAQ,CAAC,OAAO;IAClB,IAAI,OAAO,UAAU,YAAY,CAAC,OAAO;QACrC,MAAM,IAAI,YAAY,UAAU,CAAC,GAAG,YAAY,mBAAmB,CAAC;IACxE;AACJ;AACA,eAAe,uBAAuB,GAAG,EAAE,eAAe;IACtD,IAAI,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,MAAM;QACnC,MAAM,IAAI,UAAU;IACxB;IACA,oBAAoB;IACpB,IAAI,oBAAoB,YACpB,oBAAoB,YACpB,oBAAoB,UAAU;QAC9B,MAAM,IAAI,UAAU;IACxB;IACA,IAAI;IACJ,OAAQ,IAAI,GAAG;QACX,KAAK;YACD,MAAM,IAAI,GAAG,EAAE;YACf,MAAM,IAAI,CAAC,EAAE;YACb,MAAM,IAAI,CAAC,EAAE;YACb,aAAa;gBAAE,KAAK,IAAI,GAAG;gBAAE,KAAK,IAAI,GAAG;gBAAE,GAAG,IAAI,CAAC;gBAAE,GAAG,IAAI,CAAC;YAAC;YAC9D;QACJ,KAAK;YACD,MAAM,IAAI,GAAG,EAAE;YACf,MAAM,IAAI,CAAC,EAAE;YACb,aAAa;gBAAE,KAAK,IAAI,GAAG;gBAAE,KAAK,IAAI,GAAG;gBAAE,GAAG,IAAI,CAAC;YAAC;YACpD;QACJ,KAAK;YACD,MAAM,IAAI,CAAC,EAAE;YACb,MAAM,IAAI,CAAC,EAAE;YACb,aAAa;gBAAE,GAAG,IAAI,CAAC;gBAAE,KAAK,IAAI,GAAG;gBAAE,GAAG,IAAI,CAAC;YAAC;YAChD;QACJ,KAAK;YACD,MAAM,IAAI,CAAC,EAAE;YACb,aAAa;gBAAE,GAAG,IAAI,CAAC;gBAAE,KAAK,IAAI,GAAG;YAAC;YACtC;QACJ;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC;IAC/C;IACA,MAAM,OAAO,kBAAkB,OAAO,CAAC,MAAM,CAAC,KAAK,SAAS,CAAC;IAC7D,OAAO,CAAC,GAAG,eAAe,MAAM,EAAE,MAAM,CAAC,GAAG,YAAY,OAAO,EAAE,iBAAiB;AACtF;AACA,eAAe,0BAA0B,GAAG,EAAE,eAAe;IACzD,oBAAoB;IACpB,MAAM,aAAa,MAAM,uBAAuB,KAAK;IACrD,OAAO,CAAC,yCAAyC,EAAE,gBAAgB,KAAK,CAAC,CAAC,GAAG,CAAC,EAAE,YAAY;AAChG","ignoreList":[0]}},
    {"offset": {"line": 10098, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10103, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwk/embedded.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EmbeddedJWK = EmbeddedJWK;\nconst import_js_1 = require(\"../key/import.js\");\nconst is_object_js_1 = require(\"../lib/is_object.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nasync function EmbeddedJWK(protectedHeader, token) {\n    const joseHeader = {\n        ...protectedHeader,\n        ...token?.header,\n    };\n    if (!(0, is_object_js_1.default)(joseHeader.jwk)) {\n        throw new errors_js_1.JWSInvalid('\"jwk\" (JSON Web Key) Header Parameter must be a JSON object');\n    }\n    const key = await (0, import_js_1.importJWK)({ ...joseHeader.jwk, ext: true }, joseHeader.alg);\n    if (key instanceof Uint8Array || key.type !== 'public') {\n        throw new errors_js_1.JWSInvalid('\"jwk\" (JSON Web Key) Header Parameter must be a public key');\n    }\n    return key;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,WAAW,GAAG;AACtB,MAAM;AACN,MAAM;AACN,MAAM;AACN,eAAe,YAAY,eAAe,EAAE,KAAK;IAC7C,MAAM,aAAa;QACf,GAAG,eAAe;QAClB,GAAG,OAAO,MAAM;IACpB;IACA,IAAI,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,WAAW,GAAG,GAAG;QAC9C,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,MAAM,MAAM,MAAM,CAAC,GAAG,YAAY,SAAS,EAAE;QAAE,GAAG,WAAW,GAAG;QAAE,KAAK;IAAK,GAAG,WAAW,GAAG;IAC7F,IAAI,eAAe,cAAc,IAAI,IAAI,KAAK,UAAU;QACpD,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 10128, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10133, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwks/local.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createLocalJWKSet = createLocalJWKSet;\nconst import_js_1 = require(\"../key/import.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst is_object_js_1 = require(\"../lib/is_object.js\");\nfunction getKtyFromAlg(alg) {\n    switch (typeof alg === 'string' && alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            return 'RSA';\n        case 'ES':\n            return 'EC';\n        case 'Ed':\n            return 'OKP';\n        default:\n            throw new errors_js_1.JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n    }\n}\nfunction isJWKSLike(jwks) {\n    return (jwks &&\n        typeof jwks === 'object' &&\n        Array.isArray(jwks.keys) &&\n        jwks.keys.every(isJWKLike));\n}\nfunction isJWKLike(key) {\n    return (0, is_object_js_1.default)(key);\n}\nfunction clone(obj) {\n    if (typeof structuredClone === 'function') {\n        return structuredClone(obj);\n    }\n    return JSON.parse(JSON.stringify(obj));\n}\nclass LocalJWKSet {\n    _jwks;\n    _cached = new WeakMap();\n    constructor(jwks) {\n        if (!isJWKSLike(jwks)) {\n            throw new errors_js_1.JWKSInvalid('JSON Web Key Set malformed');\n        }\n        this._jwks = clone(jwks);\n    }\n    async getKey(protectedHeader, token) {\n        const { alg, kid } = { ...protectedHeader, ...token?.header };\n        const kty = getKtyFromAlg(alg);\n        const candidates = this._jwks.keys.filter((jwk) => {\n            let candidate = kty === jwk.kty;\n            if (candidate && typeof kid === 'string') {\n                candidate = kid === jwk.kid;\n            }\n            if (candidate && typeof jwk.alg === 'string') {\n                candidate = alg === jwk.alg;\n            }\n            if (candidate && typeof jwk.use === 'string') {\n                candidate = jwk.use === 'sig';\n            }\n            if (candidate && Array.isArray(jwk.key_ops)) {\n                candidate = jwk.key_ops.includes('verify');\n            }\n            if (candidate && alg === 'EdDSA') {\n                candidate = jwk.crv === 'Ed25519' || jwk.crv === 'Ed448';\n            }\n            if (candidate) {\n                switch (alg) {\n                    case 'ES256':\n                        candidate = jwk.crv === 'P-256';\n                        break;\n                    case 'ES256K':\n                        candidate = jwk.crv === 'secp256k1';\n                        break;\n                    case 'ES384':\n                        candidate = jwk.crv === 'P-384';\n                        break;\n                    case 'ES512':\n                        candidate = jwk.crv === 'P-521';\n                        break;\n                }\n            }\n            return candidate;\n        });\n        const { 0: jwk, length } = candidates;\n        if (length === 0) {\n            throw new errors_js_1.JWKSNoMatchingKey();\n        }\n        if (length !== 1) {\n            const error = new errors_js_1.JWKSMultipleMatchingKeys();\n            const { _cached } = this;\n            error[Symbol.asyncIterator] = async function* () {\n                for (const jwk of candidates) {\n                    try {\n                        yield await importWithAlgCache(_cached, jwk, alg);\n                    }\n                    catch { }\n                }\n            };\n            throw error;\n        }\n        return importWithAlgCache(this._cached, jwk, alg);\n    }\n}\nasync function importWithAlgCache(cache, jwk, alg) {\n    const cached = cache.get(jwk) || cache.set(jwk, {}).get(jwk);\n    if (cached[alg] === undefined) {\n        const key = await (0, import_js_1.importJWK)({ ...jwk, ext: true }, alg);\n        if (key instanceof Uint8Array || key.type !== 'public') {\n            throw new errors_js_1.JWKSInvalid('JSON Web Key Set members must be public keys');\n        }\n        cached[alg] = key;\n    }\n    return cached[alg];\n}\nfunction createLocalJWKSet(jwks) {\n    const set = new LocalJWKSet(jwks);\n    const localJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(localJWKSet, {\n        jwks: {\n            value: () => clone(set._jwks),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return localJWKSet;\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 10262, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10267, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/fetch_jwks.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst http = require(\"node:http\");\nconst https = require(\"node:https\");\nconst node_events_1 = require(\"node:events\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst fetchJwks = async (url, timeout, options) => {\n    let get;\n    switch (url.protocol) {\n        case 'https:':\n            get = https.get;\n            break;\n        case 'http:':\n            get = http.get;\n            break;\n        default:\n            throw new TypeError('Unsupported URL protocol.');\n    }\n    const { agent, headers } = options;\n    const req = get(url.href, {\n        agent,\n        timeout,\n        headers,\n    });\n    const [response] = (await Promise.race([(0, node_events_1.once)(req, 'response'), (0, node_events_1.once)(req, 'timeout')]));\n    if (!response) {\n        req.destroy();\n        throw new errors_js_1.JWKSTimeout();\n    }\n    if (response.statusCode !== 200) {\n        throw new errors_js_1.JOSEError('Expected 200 OK from the JSON Web Key Set HTTP response');\n    }\n    const parts = [];\n    for await (const part of response) {\n        parts.push(part);\n    }\n    try {\n        return JSON.parse(buffer_utils_js_1.decoder.decode((0, buffer_utils_js_1.concat)(...parts)));\n    }\n    catch {\n        throw new errors_js_1.JOSEError('Failed to parse the JSON Web Key Set HTTP response as JSON');\n    }\n};\nexports.default = fetchJwks;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,YAAY,OAAO,KAAK,SAAS;IACnC,IAAI;IACJ,OAAQ,IAAI,QAAQ;QAChB,KAAK;YACD,MAAM,MAAM,GAAG;YACf;QACJ,KAAK;YACD,MAAM,KAAK,GAAG;YACd;QACJ;YACI,MAAM,IAAI,UAAU;IAC5B;IACA,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG;IAC3B,MAAM,MAAM,IAAI,IAAI,IAAI,EAAE;QACtB;QACA;QACA;IACJ;IACA,MAAM,CAAC,SAAS,GAAI,MAAM,QAAQ,IAAI,CAAC;QAAC,CAAC,GAAG,cAAc,IAAI,EAAE,KAAK;QAAa,CAAC,GAAG,cAAc,IAAI,EAAE,KAAK;KAAW;IAC1H,IAAI,CAAC,UAAU;QACX,IAAI,OAAO;QACX,MAAM,IAAI,YAAY,WAAW;IACrC;IACA,IAAI,SAAS,UAAU,KAAK,KAAK;QAC7B,MAAM,IAAI,YAAY,SAAS,CAAC;IACpC;IACA,MAAM,QAAQ,EAAE;IAChB,WAAW,MAAM,QAAQ,SAAU;QAC/B,MAAM,IAAI,CAAC;IACf;IACA,IAAI;QACA,OAAO,KAAK,KAAK,CAAC,kBAAkB,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,kBAAkB,MAAM,KAAK;IACxF,EACA,OAAM;QACF,MAAM,IAAI,YAAY,SAAS,CAAC;IACpC;AACJ;AACA,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 10316, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10321, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwks/remote.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.experimental_jwksCache = exports.jwksCache = void 0;\nexports.createRemoteJWKSet = createRemoteJWKSet;\nconst fetch_jwks_js_1 = require(\"../runtime/fetch_jwks.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst local_js_1 = require(\"./local.js\");\nconst is_object_js_1 = require(\"../lib/is_object.js\");\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v5.9.6';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nexports.jwksCache = Symbol();\nfunction isFreshJwksCache(input, cacheMaxAge) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || Date.now() - input.uat >= cacheMaxAge) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !(0, is_object_js_1.default)(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, is_object_js_1.default)) {\n        return false;\n    }\n    return true;\n}\nclass RemoteJWKSet {\n    _url;\n    _timeoutDuration;\n    _cooldownDuration;\n    _cacheMaxAge;\n    _jwksTimestamp;\n    _pendingFetch;\n    _options;\n    _local;\n    _cache;\n    constructor(url, options) {\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options?.agent, headers: options?.headers };\n        this._timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n        if (options?.[exports.jwksCache] !== undefined) {\n            this._cache = options?.[exports.jwksCache];\n            if (isFreshJwksCache(options?.[exports.jwksCache], this._cacheMaxAge)) {\n                this._jwksTimestamp = this._cache.uat;\n                this._local = (0, local_js_1.createLocalJWKSet)(this._cache.jwks);\n            }\n        }\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._local || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await this._local(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof errors_js_1.JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return this._local(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            this._pendingFetch = undefined;\n        }\n        const headers = new Headers(this._options.headers);\n        if (USER_AGENT && !headers.has('User-Agent')) {\n            headers.set('User-Agent', USER_AGENT);\n            this._options.headers = Object.fromEntries(headers.entries());\n        }\n        this._pendingFetch ||= (0, fetch_jwks_js_1.default)(this._url, this._timeoutDuration, this._options)\n            .then((json) => {\n            this._local = (0, local_js_1.createLocalJWKSet)(json);\n            if (this._cache) {\n                this._cache.uat = Date.now();\n                this._cache.jwks = json;\n            }\n            this._jwksTimestamp = Date.now();\n            this._pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this._pendingFetch = undefined;\n            throw err;\n        });\n        await this._pendingFetch;\n    }\n}\nfunction createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    const remoteJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(remoteJWKSet, {\n        coolingDown: {\n            get: () => set.coolingDown(),\n            enumerable: true,\n            configurable: false,\n        },\n        fresh: {\n            get: () => set.fresh(),\n            enumerable: true,\n            configurable: false,\n        },\n        reload: {\n            value: () => set.reload(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n        reloading: {\n            get: () => !!set._pendingFetch,\n            enumerable: true,\n            configurable: false,\n        },\n        jwks: {\n            value: () => set._local?.jwks(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return remoteJWKSet;\n}\nexports.experimental_jwksCache = exports.jwksCache;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 10464, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10469, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/jwt/unsecured.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.UnsecuredJWT = void 0;\nconst base64url = require(\"../runtime/base64url.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst jwt_claims_set_js_1 = require(\"../lib/jwt_claims_set.js\");\nconst produce_js_1 = require(\"./produce.js\");\nclass UnsecuredJWT extends produce_js_1.ProduceJWT {\n    encode() {\n        const header = base64url.encode(JSON.stringify({ alg: 'none' }));\n        const payload = base64url.encode(JSON.stringify(this._payload));\n        return `${header}.${payload}.`;\n    }\n    static decode(jwt, options) {\n        if (typeof jwt !== 'string') {\n            throw new errors_js_1.JWTInvalid('Unsecured JWT must be a string');\n        }\n        const { 0: encodedHeader, 1: encodedPayload, 2: signature, length } = jwt.split('.');\n        if (length !== 3 || signature !== '') {\n            throw new errors_js_1.JWTInvalid('Invalid Unsecured JWT');\n        }\n        let header;\n        try {\n            header = JSON.parse(buffer_utils_js_1.decoder.decode(base64url.decode(encodedHeader)));\n            if (header.alg !== 'none')\n                throw new Error();\n        }\n        catch {\n            throw new errors_js_1.JWTInvalid('Invalid Unsecured JWT');\n        }\n        const payload = (0, jwt_claims_set_js_1.default)(header, base64url.decode(encodedPayload), options);\n        return { payload, header };\n    }\n}\nexports.UnsecuredJWT = UnsecuredJWT;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,YAAY,GAAG,KAAK;AAC5B,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,qBAAqB,aAAa,UAAU;IAC9C,SAAS;QACL,MAAM,SAAS,UAAU,MAAM,CAAC,KAAK,SAAS,CAAC;YAAE,KAAK;QAAO;QAC7D,MAAM,UAAU,UAAU,MAAM,CAAC,KAAK,SAAS,CAAC,IAAI,CAAC,QAAQ;QAC7D,OAAO,GAAG,OAAO,CAAC,EAAE,QAAQ,CAAC,CAAC;IAClC;IACA,OAAO,OAAO,GAAG,EAAE,OAAO,EAAE;QACxB,IAAI,OAAO,QAAQ,UAAU;YACzB,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;QACA,MAAM,EAAE,GAAG,aAAa,EAAE,GAAG,cAAc,EAAE,GAAG,SAAS,EAAE,MAAM,EAAE,GAAG,IAAI,KAAK,CAAC;QAChF,IAAI,WAAW,KAAK,cAAc,IAAI;YAClC,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;QACA,IAAI;QACJ,IAAI;YACA,SAAS,KAAK,KAAK,CAAC,kBAAkB,OAAO,CAAC,MAAM,CAAC,UAAU,MAAM,CAAC;YACtE,IAAI,OAAO,GAAG,KAAK,QACf,MAAM,IAAI;QAClB,EACA,OAAM;YACF,MAAM,IAAI,YAAY,UAAU,CAAC;QACrC;QACA,MAAM,UAAU,CAAC,GAAG,oBAAoB,OAAO,EAAE,QAAQ,UAAU,MAAM,CAAC,iBAAiB;QAC3F,OAAO;YAAE;YAAS;QAAO;IAC7B;AACJ;AACA,QAAQ,YAAY,GAAG","ignoreList":[0]}},
    {"offset": {"line": 10510, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10515, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/util/base64url.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decode = exports.encode = void 0;\nconst base64url = require(\"../runtime/base64url.js\");\nexports.encode = base64url.encode;\nexports.decode = base64url.decode;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,MAAM,GAAG,QAAQ,MAAM,GAAG,KAAK;AACvC,MAAM;AACN,QAAQ,MAAM,GAAG,UAAU,MAAM;AACjC,QAAQ,MAAM,GAAG,UAAU,MAAM","ignoreList":[0]}},
    {"offset": {"line": 10523, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10528, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/util/decode_protected_header.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decodeProtectedHeader = decodeProtectedHeader;\nconst base64url_js_1 = require(\"./base64url.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst is_object_js_1 = require(\"../lib/is_object.js\");\nfunction decodeProtectedHeader(token) {\n    let protectedB64u;\n    if (typeof token === 'string') {\n        const parts = token.split('.');\n        if (parts.length === 3 || parts.length === 5) {\n            ;\n            [protectedB64u] = parts;\n        }\n    }\n    else if (typeof token === 'object' && token) {\n        if ('protected' in token) {\n            protectedB64u = token.protected;\n        }\n        else {\n            throw new TypeError('Token does not contain a Protected Header');\n        }\n    }\n    try {\n        if (typeof protectedB64u !== 'string' || !protectedB64u) {\n            throw new Error();\n        }\n        const result = JSON.parse(buffer_utils_js_1.decoder.decode((0, base64url_js_1.decode)(protectedB64u)));\n        if (!(0, is_object_js_1.default)(result)) {\n            throw new Error();\n        }\n        return result;\n    }\n    catch {\n        throw new TypeError('Invalid Token or Protected Header formatting');\n    }\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,qBAAqB,GAAG;AAChC,MAAM;AACN,MAAM;AACN,MAAM;AACN,SAAS,sBAAsB,KAAK;IAChC,IAAI;IACJ,IAAI,OAAO,UAAU,UAAU;QAC3B,MAAM,QAAQ,MAAM,KAAK,CAAC;QAC1B,IAAI,MAAM,MAAM,KAAK,KAAK,MAAM,MAAM,KAAK,GAAG;;YAE1C,CAAC,cAAc,GAAG;QACtB;IACJ,OACK,IAAI,OAAO,UAAU,YAAY,OAAO;QACzC,IAAI,eAAe,OAAO;YACtB,gBAAgB,MAAM,SAAS;QACnC,OACK;YACD,MAAM,IAAI,UAAU;QACxB;IACJ;IACA,IAAI;QACA,IAAI,OAAO,kBAAkB,YAAY,CAAC,eAAe;YACrD,MAAM,IAAI;QACd;QACA,MAAM,SAAS,KAAK,KAAK,CAAC,kBAAkB,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,eAAe,MAAM,EAAE;QACtF,IAAI,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,SAAS;YACtC,MAAM,IAAI;QACd;QACA,OAAO;IACX,EACA,OAAM;QACF,MAAM,IAAI,UAAU;IACxB;AACJ","ignoreList":[0]}},
    {"offset": {"line": 10564, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10569, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/util/decode_jwt.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decodeJwt = decodeJwt;\nconst base64url_js_1 = require(\"./base64url.js\");\nconst buffer_utils_js_1 = require(\"../lib/buffer_utils.js\");\nconst is_object_js_1 = require(\"../lib/is_object.js\");\nconst errors_js_1 = require(\"./errors.js\");\nfunction decodeJwt(jwt) {\n    if (typeof jwt !== 'string')\n        throw new errors_js_1.JWTInvalid('JWTs must use Compact JWS serialization, JWT must be a string');\n    const { 1: payload, length } = jwt.split('.');\n    if (length === 5)\n        throw new errors_js_1.JWTInvalid('Only JWTs using Compact JWS serialization can be decoded');\n    if (length !== 3)\n        throw new errors_js_1.JWTInvalid('Invalid JWT');\n    if (!payload)\n        throw new errors_js_1.JWTInvalid('JWTs must contain a payload');\n    let decoded;\n    try {\n        decoded = (0, base64url_js_1.decode)(payload);\n    }\n    catch {\n        throw new errors_js_1.JWTInvalid('Failed to base64url decode the payload');\n    }\n    let result;\n    try {\n        result = JSON.parse(buffer_utils_js_1.decoder.decode(decoded));\n    }\n    catch {\n        throw new errors_js_1.JWTInvalid('Failed to parse the decoded payload as JSON');\n    }\n    if (!(0, is_object_js_1.default)(result))\n        throw new errors_js_1.JWTInvalid('Invalid JWT Claims Set');\n    return result;\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,SAAS,GAAG;AACpB,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,SAAS,UAAU,GAAG;IAClB,IAAI,OAAO,QAAQ,UACf,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC,MAAM,EAAE,GAAG,OAAO,EAAE,MAAM,EAAE,GAAG,IAAI,KAAK,CAAC;IACzC,IAAI,WAAW,GACX,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC,IAAI,WAAW,GACX,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC,IAAI,CAAC,SACD,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC,IAAI;IACJ,IAAI;QACA,UAAU,CAAC,GAAG,eAAe,MAAM,EAAE;IACzC,EACA,OAAM;QACF,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI;IACJ,IAAI;QACA,SAAS,KAAK,KAAK,CAAC,kBAAkB,OAAO,CAAC,MAAM,CAAC;IACzD,EACA,OAAM;QACF,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC;IACA,IAAI,CAAC,CAAC,GAAG,eAAe,OAAO,EAAE,SAC7B,MAAM,IAAI,YAAY,UAAU,CAAC;IACrC,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 10599, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10604, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/generate.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generateSecret = generateSecret;\nexports.generateKeyPair = generateKeyPair;\nconst node_crypto_1 = require(\"node:crypto\");\nconst node_util_1 = require(\"node:util\");\nconst random_js_1 = require(\"./random.js\");\nconst errors_js_1 = require(\"../util/errors.js\");\nconst generate = (0, node_util_1.promisify)(node_crypto_1.generateKeyPair);\nasync function generateSecret(alg, options) {\n    let length;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            length = parseInt(alg.slice(-3), 10);\n            break;\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW':\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW':\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            length = parseInt(alg.slice(1, 4), 10);\n            break;\n        default:\n            throw new errors_js_1.JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n    }\n    return (0, node_crypto_1.createSecretKey)((0, random_js_1.default)(new Uint8Array(length >> 3)));\n}\nasync function generateKeyPair(alg, options) {\n    switch (alg) {\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n        case 'RSA1_5': {\n            const modulusLength = options?.modulusLength ?? 2048;\n            if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n                throw new errors_js_1.JOSENotSupported('Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used');\n            }\n            const keypair = await generate('rsa', {\n                modulusLength,\n                publicExponent: 0x10001,\n            });\n            return keypair;\n        }\n        case 'ES256':\n            return generate('ec', { namedCurve: 'P-256' });\n        case 'ES256K':\n            return generate('ec', { namedCurve: 'secp256k1' });\n        case 'ES384':\n            return generate('ec', { namedCurve: 'P-384' });\n        case 'ES512':\n            return generate('ec', { namedCurve: 'P-521' });\n        case 'EdDSA': {\n            switch (options?.crv) {\n                case undefined:\n                case 'Ed25519':\n                    return generate('ed25519');\n                case 'Ed448':\n                    return generate('ed448');\n                default:\n                    throw new errors_js_1.JOSENotSupported('Invalid or unsupported crv option provided, supported values are Ed25519 and Ed448');\n            }\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            const crv = options?.crv ?? 'P-256';\n            switch (crv) {\n                case undefined:\n                case 'P-256':\n                case 'P-384':\n                case 'P-521':\n                    return generate('ec', { namedCurve: crv });\n                case 'X25519':\n                    return generate('x25519');\n                case 'X448':\n                    return generate('x448');\n                default:\n                    throw new errors_js_1.JOSENotSupported('Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448');\n            }\n        }\n        default:\n            throw new errors_js_1.JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n    }\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,cAAc,GAAG;AACzB,QAAQ,eAAe,GAAG;AAC1B,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,WAAW,CAAC,GAAG,YAAY,SAAS,EAAE,cAAc,eAAe;AACzE,eAAe,eAAe,GAAG,EAAE,OAAO;IACtC,IAAI;IACJ,OAAQ;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACD,SAAS,SAAS,IAAI,KAAK,CAAC,CAAC,IAAI;YACjC;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACD,SAAS,SAAS,IAAI,KAAK,CAAC,GAAG,IAAI;YACnC;QACJ;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC;IAC/C;IACA,OAAO,CAAC,GAAG,cAAc,eAAe,EAAE,CAAC,GAAG,YAAY,OAAO,EAAE,IAAI,WAAW,UAAU;AAChG;AACA,eAAe,gBAAgB,GAAG,EAAE,OAAO;IACvC,OAAQ;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YAAU;gBACX,MAAM,gBAAgB,SAAS,iBAAiB;gBAChD,IAAI,OAAO,kBAAkB,YAAY,gBAAgB,MAAM;oBAC3D,MAAM,IAAI,YAAY,gBAAgB,CAAC;gBAC3C;gBACA,MAAM,UAAU,MAAM,SAAS,OAAO;oBAClC;oBACA,gBAAgB;gBACpB;gBACA,OAAO;YACX;QACA,KAAK;YACD,OAAO,SAAS,MAAM;gBAAE,YAAY;YAAQ;QAChD,KAAK;YACD,OAAO,SAAS,MAAM;gBAAE,YAAY;YAAY;QACpD,KAAK;YACD,OAAO,SAAS,MAAM;gBAAE,YAAY;YAAQ;QAChD,KAAK;YACD,OAAO,SAAS,MAAM;gBAAE,YAAY;YAAQ;QAChD,KAAK;YAAS;gBACV,OAAQ,SAAS;oBACb,KAAK;oBACL,KAAK;wBACD,OAAO,SAAS;oBACpB,KAAK;wBACD,OAAO,SAAS;oBACpB;wBACI,MAAM,IAAI,YAAY,gBAAgB,CAAC;gBAC/C;YACJ;QACA,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YAAkB;gBACnB,MAAM,MAAM,SAAS,OAAO;gBAC5B,OAAQ;oBACJ,KAAK;oBACL,KAAK;oBACL,KAAK;oBACL,KAAK;wBACD,OAAO,SAAS,MAAM;4BAAE,YAAY;wBAAI;oBAC5C,KAAK;wBACD,OAAO,SAAS;oBACpB,KAAK;wBACD,OAAO,SAAS;oBACpB;wBACI,MAAM,IAAI,YAAY,gBAAgB,CAAC;gBAC/C;YACJ;QACA;YACI,MAAM,IAAI,YAAY,gBAAgB,CAAC;IAC/C;AACJ","ignoreList":[0]}},
    {"offset": {"line": 10720, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10725, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/key/generate_key_pair.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generateKeyPair = generateKeyPair;\nconst generate_js_1 = require(\"../runtime/generate.js\");\nasync function generateKeyPair(alg, options) {\n    return (0, generate_js_1.generateKeyPair)(alg, options);\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,eAAe,GAAG;AAC1B,MAAM;AACN,eAAe,gBAAgB,GAAG,EAAE,OAAO;IACvC,OAAO,CAAC,GAAG,cAAc,eAAe,EAAE,KAAK;AACnD","ignoreList":[0]}},
    {"offset": {"line": 10734, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10739, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/key/generate_secret.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generateSecret = generateSecret;\nconst generate_js_1 = require(\"../runtime/generate.js\");\nasync function generateSecret(alg, options) {\n    return (0, generate_js_1.generateSecret)(alg, options);\n}\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,cAAc,GAAG;AACzB,MAAM;AACN,eAAe,eAAe,GAAG,EAAE,OAAO;IACtC,OAAO,CAAC,GAAG,cAAc,cAAc,EAAE,KAAK;AAClD","ignoreList":[0]}},
    {"offset": {"line": 10748, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10753, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/runtime/runtime.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = 'node:crypto';\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,OAAO,GAAG","ignoreList":[0]}},
    {"offset": {"line": 10758, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10763, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/util/runtime.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst runtime_js_1 = require(\"../runtime/runtime.js\");\nexports.default = runtime_js_1.default;\n"],"names":[],"mappings":"AAAA;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,MAAM;AACN,QAAQ,OAAO,GAAG,aAAa,OAAO","ignoreList":[0]}},
    {"offset": {"line": 10769, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 10774, "column": 0}, "map": {"version":3,"sources":["file:///Users/mg/event-horizon/node_modules/jose/dist/node/cjs/index.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cryptoRuntime = exports.base64url = exports.generateSecret = exports.generateKeyPair = exports.errors = exports.decodeJwt = exports.decodeProtectedHeader = exports.importJWK = exports.importX509 = exports.importPKCS8 = exports.importSPKI = exports.exportJWK = exports.exportSPKI = exports.exportPKCS8 = exports.UnsecuredJWT = exports.experimental_jwksCache = exports.jwksCache = exports.createRemoteJWKSet = exports.createLocalJWKSet = exports.EmbeddedJWK = exports.calculateJwkThumbprintUri = exports.calculateJwkThumbprint = exports.EncryptJWT = exports.SignJWT = exports.GeneralSign = exports.FlattenedSign = exports.CompactSign = exports.FlattenedEncrypt = exports.CompactEncrypt = exports.jwtDecrypt = exports.jwtVerify = exports.generalVerify = exports.flattenedVerify = exports.compactVerify = exports.GeneralEncrypt = exports.generalDecrypt = exports.flattenedDecrypt = exports.compactDecrypt = void 0;\nvar decrypt_js_1 = require(\"./jwe/compact/decrypt.js\");\nObject.defineProperty(exports, \"compactDecrypt\", { enumerable: true, get: function () { return decrypt_js_1.compactDecrypt; } });\nvar decrypt_js_2 = require(\"./jwe/flattened/decrypt.js\");\nObject.defineProperty(exports, \"flattenedDecrypt\", { enumerable: true, get: function () { return decrypt_js_2.flattenedDecrypt; } });\nvar decrypt_js_3 = require(\"./jwe/general/decrypt.js\");\nObject.defineProperty(exports, \"generalDecrypt\", { enumerable: true, get: function () { return decrypt_js_3.generalDecrypt; } });\nvar encrypt_js_1 = require(\"./jwe/general/encrypt.js\");\nObject.defineProperty(exports, \"GeneralEncrypt\", { enumerable: true, get: function () { return encrypt_js_1.GeneralEncrypt; } });\nvar verify_js_1 = require(\"./jws/compact/verify.js\");\nObject.defineProperty(exports, \"compactVerify\", { enumerable: true, get: function () { return verify_js_1.compactVerify; } });\nvar verify_js_2 = require(\"./jws/flattened/verify.js\");\nObject.defineProperty(exports, \"flattenedVerify\", { enumerable: true, get: function () { return verify_js_2.flattenedVerify; } });\nvar verify_js_3 = require(\"./jws/general/verify.js\");\nObject.defineProperty(exports, \"generalVerify\", { enumerable: true, get: function () { return verify_js_3.generalVerify; } });\nvar verify_js_4 = require(\"./jwt/verify.js\");\nObject.defineProperty(exports, \"jwtVerify\", { enumerable: true, get: function () { return verify_js_4.jwtVerify; } });\nvar decrypt_js_4 = require(\"./jwt/decrypt.js\");\nObject.defineProperty(exports, \"jwtDecrypt\", { enumerable: true, get: function () { return decrypt_js_4.jwtDecrypt; } });\nvar encrypt_js_2 = require(\"./jwe/compact/encrypt.js\");\nObject.defineProperty(exports, \"CompactEncrypt\", { enumerable: true, get: function () { return encrypt_js_2.CompactEncrypt; } });\nvar encrypt_js_3 = require(\"./jwe/flattened/encrypt.js\");\nObject.defineProperty(exports, \"FlattenedEncrypt\", { enumerable: true, get: function () { return encrypt_js_3.FlattenedEncrypt; } });\nvar sign_js_1 = require(\"./jws/compact/sign.js\");\nObject.defineProperty(exports, \"CompactSign\", { enumerable: true, get: function () { return sign_js_1.CompactSign; } });\nvar sign_js_2 = require(\"./jws/flattened/sign.js\");\nObject.defineProperty(exports, \"FlattenedSign\", { enumerable: true, get: function () { return sign_js_2.FlattenedSign; } });\nvar sign_js_3 = require(\"./jws/general/sign.js\");\nObject.defineProperty(exports, \"GeneralSign\", { enumerable: true, get: function () { return sign_js_3.GeneralSign; } });\nvar sign_js_4 = require(\"./jwt/sign.js\");\nObject.defineProperty(exports, \"SignJWT\", { enumerable: true, get: function () { return sign_js_4.SignJWT; } });\nvar encrypt_js_4 = require(\"./jwt/encrypt.js\");\nObject.defineProperty(exports, \"EncryptJWT\", { enumerable: true, get: function () { return encrypt_js_4.EncryptJWT; } });\nvar thumbprint_js_1 = require(\"./jwk/thumbprint.js\");\nObject.defineProperty(exports, \"calculateJwkThumbprint\", { enumerable: true, get: function () { return thumbprint_js_1.calculateJwkThumbprint; } });\nObject.defineProperty(exports, \"calculateJwkThumbprintUri\", { enumerable: true, get: function () { return thumbprint_js_1.calculateJwkThumbprintUri; } });\nvar embedded_js_1 = require(\"./jwk/embedded.js\");\nObject.defineProperty(exports, \"EmbeddedJWK\", { enumerable: true, get: function () { return embedded_js_1.EmbeddedJWK; } });\nvar local_js_1 = require(\"./jwks/local.js\");\nObject.defineProperty(exports, \"createLocalJWKSet\", { enumerable: true, get: function () { return local_js_1.createLocalJWKSet; } });\nvar remote_js_1 = require(\"./jwks/remote.js\");\nObject.defineProperty(exports, \"createRemoteJWKSet\", { enumerable: true, get: function () { return remote_js_1.createRemoteJWKSet; } });\nObject.defineProperty(exports, \"jwksCache\", { enumerable: true, get: function () { return remote_js_1.jwksCache; } });\nObject.defineProperty(exports, \"experimental_jwksCache\", { enumerable: true, get: function () { return remote_js_1.experimental_jwksCache; } });\nvar unsecured_js_1 = require(\"./jwt/unsecured.js\");\nObject.defineProperty(exports, \"UnsecuredJWT\", { enumerable: true, get: function () { return unsecured_js_1.UnsecuredJWT; } });\nvar export_js_1 = require(\"./key/export.js\");\nObject.defineProperty(exports, \"exportPKCS8\", { enumerable: true, get: function () { return export_js_1.exportPKCS8; } });\nObject.defineProperty(exports, \"exportSPKI\", { enumerable: true, get: function () { return export_js_1.exportSPKI; } });\nObject.defineProperty(exports, \"exportJWK\", { enumerable: true, get: function () { return export_js_1.exportJWK; } });\nvar import_js_1 = require(\"./key/import.js\");\nObject.defineProperty(exports, \"importSPKI\", { enumerable: true, get: function () { return import_js_1.importSPKI; } });\nObject.defineProperty(exports, \"importPKCS8\", { enumerable: true, get: function () { return import_js_1.importPKCS8; } });\nObject.defineProperty(exports, \"importX509\", { enumerable: true, get: function () { return import_js_1.importX509; } });\nObject.defineProperty(exports, \"importJWK\", { enumerable: true, get: function () { return import_js_1.importJWK; } });\nvar decode_protected_header_js_1 = require(\"./util/decode_protected_header.js\");\nObject.defineProperty(exports, \"decodeProtectedHeader\", { enumerable: true, get: function () { return decode_protected_header_js_1.decodeProtectedHeader; } });\nvar decode_jwt_js_1 = require(\"./util/decode_jwt.js\");\nObject.defineProperty(exports, \"decodeJwt\", { enumerable: true, get: function () { return decode_jwt_js_1.decodeJwt; } });\nexports.errors = require(\"./util/errors.js\");\nvar generate_key_pair_js_1 = require(\"./key/generate_key_pair.js\");\nObject.defineProperty(exports, \"generateKeyPair\", { enumerable: true, get: function () { return generate_key_pair_js_1.generateKeyPair; } });\nvar generate_secret_js_1 = require(\"./key/generate_secret.js\");\nObject.defineProperty(exports, \"generateSecret\", { enumerable: true, get: function () { return generate_secret_js_1.generateSecret; } });\nexports.base64url = require(\"./util/base64url.js\");\nvar runtime_js_1 = require(\"./util/runtime.js\");\nObject.defineProperty(exports, \"cryptoRuntime\", { enumerable: true, get: function () { return runtime_js_1.default; } });\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 11025, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11030, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk-jose/src/util.ts"],"sourcesContent":["export function either<T extends string | number | boolean>(\n  a?: T,\n  b?: T,\n): T | undefined {\n  if (a != null && b != null && a !== b) {\n    throw new TypeError(`Expected \"${b}\", got \"${a}\"`)\n  }\n  return a ?? b ?? undefined\n}\n"],"names":[],"mappings":";;;;AAAA,QAAA,MAAA,GAAA,OAQC;AARD,SAAgB,MAAM,CACpB,CAAK,EACL,CAAK;IAEL,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACtC,MAAM,IAAI,SAAS,CAAC,CAAA,UAAA,EAAa,CAAC,CAAA,QAAA,EAAW,CAAC,CAAA,CAAA,CAAG,CAAC,CAAA;IACpD,CAAC;IACD,OAAO,CAAC,IAAI,CAAC,IAAI,SAAS,CAAA;AAC5B,CAAC","ignoreList":[0]}},
    {"offset": {"line": 11041, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11046, "column": 0}, "map": {"version":3,"file":"jose-key.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk-jose/src/jose-key.ts"],"sourcesContent":["import {\n  Jwk,\n  JwkError,\n  JwtCreateError,\n  JwtHeader,\n  JwtPayload,\n  JwtVerifyError,\n  Key,\n  RequiredKey,\n  SignedJwt,\n  VerifyOptions,\n  VerifyResult,\n  jwkValidator,\n  jwtHeaderSchema,\n  jwtPayloadSchema,\n} from '@atproto/jwk'\nimport {\n  SignJWT,\n  errors,\n  exportJWK,\n  generateKeyPair,\n  importJWK,\n  importPKCS8,\n  jwtVerify,\n  type GenerateKeyPairOptions,\n  type GenerateKeyPairResult,\n  type JWK,\n  type JWTVerifyOptions,\n  type KeyLike,\n} from 'jose'\n\nimport { either } from './util'\n\nconst { JOSEError } = errors\n\nexport type Importable = string | KeyLike | Jwk\n\nexport type { GenerateKeyPairOptions, GenerateKeyPairResult }\n\nexport class JoseKey<J extends Jwk = Jwk> extends Key<J> {\n  /**\n   * Some runtimes (e.g. Bun) require an `alg` second argument to be set when\n   * invoking `importJWK`. In order to be compatible with these runtimes, we\n   * provide the following method to ensure the `alg` is always set. We also\n   * take the opportunity to ensure that the `alg` is compatible with this key.\n   */\n  protected async getKeyObj(alg: string) {\n    if (!this.algorithms.includes(alg)) {\n      throw new JwkError(`Key cannot be used with algorithm \"${alg}\"`)\n    }\n    try {\n      return await importJWK(this.jwk as JWK, alg)\n    } catch (cause) {\n      throw new JwkError('Failed to import JWK', undefined, { cause })\n    }\n  }\n\n  async createJwt(header: JwtHeader, payload: JwtPayload): Promise<SignedJwt> {\n    try {\n      const { kid } = header\n      if (kid && kid !== this.kid) {\n        throw new JwtCreateError(\n          `Invalid \"kid\" (${kid}) used to sign with key \"${this.kid}\"`,\n        )\n      }\n\n      const { alg } = header\n      if (!alg) {\n        throw new JwtCreateError('Missing \"alg\" in JWT header')\n      }\n\n      const keyObj = await this.getKeyObj(alg)\n      const jwtBuilder = new SignJWT(payload).setProtectedHeader({\n        ...header,\n        alg,\n        kid: this.kid,\n      })\n\n      const signedJwt = await jwtBuilder.sign(keyObj)\n\n      return signedJwt as SignedJwt\n    } catch (cause) {\n      if (cause instanceof JOSEError) {\n        throw new JwtCreateError(cause.message, cause.code, { cause })\n      } else {\n        throw JwtCreateError.from(cause)\n      }\n    }\n  }\n\n  async verifyJwt<C extends string = never>(\n    token: SignedJwt,\n    options?: VerifyOptions<C>,\n  ): Promise<VerifyResult<C>> {\n    try {\n      const result = await jwtVerify(\n        token,\n        async ({ alg }) => this.getKeyObj(alg),\n        { ...options, algorithms: this.algorithms } as JWTVerifyOptions,\n      )\n\n      // @NOTE if all tokens are signed exclusively through createJwt(), then\n      // there should be no need to parse the payload and headers here. But\n      // since the JWT could have been signed with the same key from somewhere\n      // else, let's parse it to ensure the integrity (and type safety) of the\n      // data.\n      const headerParsed = jwtHeaderSchema.safeParse(result.protectedHeader)\n      if (!headerParsed.success) {\n        throw new JwtVerifyError('Invalid JWT header', undefined, {\n          cause: headerParsed.error,\n        })\n      }\n\n      const payloadParsed = jwtPayloadSchema.safeParse(result.payload)\n      if (!payloadParsed.success) {\n        throw new JwtVerifyError('Invalid JWT payload', undefined, {\n          cause: payloadParsed.error,\n        })\n      }\n\n      return {\n        protectedHeader: headerParsed.data,\n        // \"requiredClaims\" enforced by jwtVerify()\n        payload: payloadParsed.data as RequiredKey<JwtPayload, C>,\n      }\n    } catch (cause) {\n      if (cause instanceof JOSEError) {\n        throw new JwtVerifyError(cause.message, cause.code, { cause })\n      } else {\n        throw JwtVerifyError.from(cause)\n      }\n    }\n  }\n\n  static async generateKeyPair(\n    allowedAlgos: readonly string[] = ['ES256'],\n    options?: GenerateKeyPairOptions,\n  ) {\n    if (!allowedAlgos.length) {\n      throw new JwkError('No algorithms provided for key generation')\n    }\n\n    const errors: unknown[] = []\n    for (const alg of allowedAlgos) {\n      try {\n        return await generateKeyPair(alg, options)\n      } catch (err) {\n        errors.push(err)\n      }\n    }\n\n    throw new JwkError('Failed to generate key pair', undefined, {\n      cause: new AggregateError(errors, 'None of the algorithms worked'),\n    })\n  }\n\n  static async generate(\n    allowedAlgos: string[] = ['ES256'],\n    kid?: string,\n    options?: Omit<GenerateKeyPairOptions, 'extractable'>,\n  ) {\n    const kp = await this.generateKeyPair(allowedAlgos, {\n      ...options,\n      extractable: true,\n    })\n    return this.fromImportable(kp.privateKey, kid)\n  }\n\n  static async fromImportable(\n    input: Importable,\n    kid?: string,\n  ): Promise<JoseKey> {\n    if (typeof input === 'string') {\n      // PKCS8\n      if (input.startsWith('-----')) {\n        // The \"alg\" is only needed in WebCrypto (NodeJS will be fine)\n        return this.fromPKCS8(input, '', kid)\n      }\n\n      // Jwk (string)\n      if (input.startsWith('{')) {\n        return this.fromJWK(input, kid)\n      }\n\n      throw new JwkError('Invalid input')\n    }\n\n    if (typeof input === 'object') {\n      // Jwk\n      if ('kty' in input || 'alg' in input) {\n        return this.fromJWK(input, kid)\n      }\n\n      // KeyLike\n      return this.fromKeyLike(input, kid)\n    }\n\n    throw new JwkError('Invalid input')\n  }\n\n  /**\n   * @see {@link exportJWK}\n   */\n  static async fromKeyLike(\n    keyLike: KeyLike | Uint8Array,\n    kid?: string,\n    alg?: string,\n  ): Promise<JoseKey> {\n    const jwk = await exportJWK(keyLike)\n    if (alg) {\n      if (!jwk.alg) jwk.alg = alg\n      else if (jwk.alg !== alg) throw new JwkError('Invalid \"alg\" in JWK')\n    }\n    return this.fromJWK(jwk, kid)\n  }\n\n  /**\n   * @see {@link importPKCS8}\n   */\n  static async fromPKCS8(\n    pem: string,\n    alg: string,\n    kid?: string,\n  ): Promise<JoseKey> {\n    const keyLike = await importPKCS8(pem, alg, { extractable: true })\n    return this.fromKeyLike(keyLike, kid)\n  }\n\n  static async fromJWK(\n    input: string | Record<string, unknown>,\n    inputKid?: string,\n  ): Promise<JoseKey> {\n    const jwk = typeof input === 'string' ? JSON.parse(input) : input\n    if (!jwk || typeof jwk !== 'object') throw new JwkError('Invalid JWK')\n\n    const kid = either(jwk.kid, inputKid)\n    const use = jwk.use || 'sig'\n\n    return new JoseKey(jwkValidator.parse({ ...jwk, kid, use }))\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 11220, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11225, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk-jose/src/index.ts"],"sourcesContent":["export * from './jose-key.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,wHAAA,SAA6B","ignoreList":[0]}},
    {"offset": {"line": 11249, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11254, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk-webcrypto/src/util.ts"],"sourcesContent":["export type JWSAlgorithm =\n  // HMAC\n  | 'HS256'\n  | 'HS384'\n  | 'HS512'\n  // RSA\n  | 'PS256'\n  | 'PS384'\n  | 'PS512'\n  | 'RS256'\n  | 'RS384'\n  | 'RS512'\n  // EC\n  | 'ES256'\n  | 'ES256K'\n  | 'ES384'\n  | 'ES512'\n  // OKP\n  | 'EdDSA'\n\nexport type SubtleAlgorithm = RsaHashedKeyGenParams | EcKeyGenParams\n\nexport function toSubtleAlgorithm(\n  alg: string,\n  crv?: string,\n  options?: { modulusLength?: number },\n): SubtleAlgorithm {\n  switch (alg) {\n    case 'PS256':\n    case 'PS384':\n    case 'PS512':\n      return {\n        name: 'RSA-PSS',\n        hash: `SHA-${alg.slice(-3) as '256' | '384' | '512'}`,\n        modulusLength: options?.modulusLength ?? 2048,\n        publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n      }\n    case 'RS256':\n    case 'RS384':\n    case 'RS512':\n      return {\n        name: 'RSASSA-PKCS1-v1_5',\n        hash: `SHA-${alg.slice(-3) as '256' | '384' | '512'}`,\n        modulusLength: options?.modulusLength ?? 2048,\n        publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n      }\n    case 'ES256':\n    case 'ES384':\n      return {\n        name: 'ECDSA',\n        namedCurve: `P-${alg.slice(-3) as '256' | '384'}`,\n      }\n    case 'ES512':\n      return {\n        name: 'ECDSA',\n        namedCurve: 'P-521',\n      }\n    default:\n      // https://github.com/w3c/webcrypto/issues/82#issuecomment-849856773\n\n      throw new TypeError(`Unsupported alg \"${alg}\"`)\n  }\n}\n\nexport function fromSubtleAlgorithm(algorithm: KeyAlgorithm): JWSAlgorithm {\n  switch (algorithm.name) {\n    case 'RSA-PSS':\n    case 'RSASSA-PKCS1-v1_5': {\n      const hash = (<RsaHashedKeyAlgorithm>algorithm).hash.name\n      switch (hash) {\n        case 'SHA-256':\n        case 'SHA-384':\n        case 'SHA-512': {\n          const prefix = algorithm.name === 'RSA-PSS' ? 'PS' : 'RS'\n          return `${prefix}${hash.slice(-3) as '256' | '384' | '512'}`\n        }\n        default:\n          throw new TypeError('unsupported RsaHashedKeyAlgorithm hash')\n      }\n    }\n    case 'ECDSA': {\n      const namedCurve = (<EcKeyAlgorithm>algorithm).namedCurve\n      switch (namedCurve) {\n        case 'P-256':\n        case 'P-384':\n        case 'P-512':\n          return `ES${namedCurve.slice(-3) as '256' | '384' | '512'}`\n        case 'P-521':\n          return 'ES512'\n        default:\n          throw new TypeError('unsupported EcKeyAlgorithm namedCurve')\n      }\n    }\n    case 'Ed448':\n    case 'Ed25519':\n      return 'EdDSA'\n    default:\n      // https://github.com/w3c/webcrypto/issues/82#issuecomment-849856773\n\n      throw new TypeError(`Unexpected algorithm \"${algorithm.name}\"`)\n  }\n}\n\nexport function isCryptoKeyPair(\n  v: unknown,\n  extractable?: boolean,\n): v is CryptoKeyPair {\n  return (\n    typeof v === 'object' &&\n    v !== null &&\n    'privateKey' in v &&\n    v.privateKey instanceof CryptoKey &&\n    v.privateKey.type === 'private' &&\n    (extractable == null || v.privateKey.extractable === extractable) &&\n    v.privateKey.usages.includes('sign') &&\n    'publicKey' in v &&\n    v.publicKey instanceof CryptoKey &&\n    v.publicKey.type === 'public' &&\n    v.publicKey.extractable === true &&\n    v.publicKey.usages.includes('verify')\n  )\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 11348, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11353, "column": 0}, "map": {"version":3,"file":"webcrypto-key.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk-webcrypto/src/webcrypto-key.ts"],"sourcesContent":["import { JwkError, jwkSchema } from '@atproto/jwk'\nimport { GenerateKeyPairOptions, JoseKey } from '@atproto/jwk-jose'\nimport z from 'zod'\n\nimport { fromSubtleAlgorithm, isCryptoKeyPair } from './util.js'\n\n// Webcrypto keys are bound to a single algorithm\nexport const jwkWithAlgSchema = z.intersection(\n  jwkSchema,\n  z.object({ alg: z.string() }),\n)\n\nexport type JwkWithAlg = z.infer<typeof jwkWithAlgSchema>\n\nexport class WebcryptoKey<\n  J extends JwkWithAlg = JwkWithAlg,\n> extends JoseKey<J> {\n  // We need to override the static method generate from JoseKey because\n  // the browser needs both the private and public keys\n  static override async generate(\n    allowedAlgos: string[] = ['ES256'],\n    kid: string = crypto.randomUUID(),\n    options?: GenerateKeyPairOptions,\n  ) {\n    const keyPair = await this.generateKeyPair(allowedAlgos, options)\n\n    // Type safety only: in the browser, 'jose' always generates a CryptoKeyPair\n    if (!isCryptoKeyPair(keyPair)) {\n      throw new TypeError('Invalid CryptoKeyPair')\n    }\n\n    return this.fromKeypair(keyPair, kid)\n  }\n\n  static async fromKeypair(cryptoKeyPair: CryptoKeyPair, kid?: string) {\n    // https://datatracker.ietf.org/doc/html/rfc7517\n    // > The \"use\" and \"key_ops\" JWK members SHOULD NOT be used together; [...]\n    // > Applications should specify which of these members they use.\n\n    const {\n      key_ops,\n      use,\n      alg = fromSubtleAlgorithm(cryptoKeyPair.privateKey.algorithm),\n      ...jwk\n    } = await crypto.subtle.exportKey(\n      'jwk',\n      cryptoKeyPair.privateKey.extractable\n        ? cryptoKeyPair.privateKey\n        : cryptoKeyPair.publicKey,\n    )\n\n    if (use && use !== 'sig') {\n      throw new TypeError(`Unsupported JWK use \"${use}\"`)\n    }\n\n    if (key_ops && !key_ops.some((o) => o === 'sign' || o === 'verify')) {\n      // Make sure that \"key_ops\", if present, is compatible with \"use\"\n      throw new TypeError(`Invalid key_ops \"${key_ops}\" for \"sig\" use`)\n    }\n\n    return new WebcryptoKey(\n      jwkWithAlgSchema.parse({ ...jwk, kid, alg, use: 'sig' }),\n      cryptoKeyPair,\n    )\n  }\n\n  constructor(\n    jwk: Readonly<J>,\n    readonly cryptoKeyPair: CryptoKeyPair,\n  ) {\n    super(jwk)\n  }\n\n  get isPrivate() {\n    return true\n  }\n\n  get privateJwk(): Readonly<J> | undefined {\n    if (super.isPrivate) return this.jwk\n    throw new Error('Private Webcrypto Key not exportable')\n  }\n\n  protected override async getKeyObj(alg: string) {\n    if (this.jwk.alg !== alg) {\n      throw new JwkError(`Key cannot be used with algorithm \"${alg}\"`)\n    }\n    return this.cryptoKeyPair.privateKey\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA,MAAA,gCAAkD;AAClD,MAAA,0CAAmE;AACnE,MAAA,QAAA,gCAAmB;AAEnB,MAAA,iCAAgE;AAEhE,iDAAiD;AACpC,QAAA,gBAAgB,GAAG,MAAA,OAAC,CAAC,YAAY,CAC5C,MAAA,SAAS,EACT,MAAA,OAAC,CAAC,MAAM,CAAC;IAAE,GAAG,EAAE,MAAA,OAAC,CAAC,MAAM,EAAE;AAAA,CAAE,CAAC,CAC9B,CAAA;AAID,MAAa,YAEX,SAAQ,WAAA,OAAU;IAClB,sEAAsE;IACtE,qDAAqD;IACrD,MAAM,CAAU,KAAK,CAAC,QAAQ,CAC5B,eAAyB;QAAC,OAAO;KAAC,EAClC,MAAc,MAAM,CAAC,UAAU,EAAE,EACjC,OAAgC,EAAA;QAEhC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE,OAAO,CAAC,CAAA;QAEjE,4EAA4E;QAC5E,IAAI,CAAC,CAAA,GAAA,UAAA,eAAe,EAAC,OAAO,CAAC,EAAE,CAAC;YAC9B,MAAM,IAAI,SAAS,CAAC,uBAAuB,CAAC,CAAA;QAC9C,CAAC;QAED,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,GAAG,CAAC,CAAA;IACvC,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,aAA4B,EAAE,GAAY,EAAA;QACjE,gDAAgD;QAChD,2EAA2E;QAC3E,iEAAiE;QAEjE,MAAM,EACJ,OAAO,EACP,GAAG,EACH,GAAG,GAAG,CAAA,GAAA,UAAA,mBAAmB,EAAC,aAAa,CAAC,UAAU,CAAC,SAAS,CAAC,EAC7D,GAAG,GAAG,EACP,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,SAAS,CAC/B,KAAK,EACL,aAAa,CAAC,UAAU,CAAC,WAAW,GAChC,aAAa,CAAC,UAAU,GACxB,aAAa,CAAC,SAAS,CAC5B,CAAA;QAED,IAAI,GAAG,IAAI,GAAG,KAAK,KAAK,EAAE,CAAC;YACzB,MAAM,IAAI,SAAS,CAAC,CAAA,qBAAA,EAAwB,GAAG,CAAA,CAAA,CAAG,CAAC,CAAA;QACrD,CAAC;QAED,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAG,CAAD,AAAE,KAAK,MAAM,IAAI,CAAC,KAAK,QAAQ,CAAC,EAAE,CAAC;YACpE,iEAAiE;YACjE,MAAM,IAAI,SAAS,CAAC,CAAA,iBAAA,EAAoB,OAAO,CAAA,eAAA,CAAiB,CAAC,CAAA;QACnE,CAAC;QAED,OAAO,IAAI,YAAY,CACrB,QAAA,gBAAgB,CAAC,KAAK,CAAC;YAAE,GAAG,GAAG;YAAE,GAAG;YAAE,GAAG;YAAE,GAAG,EAAE,KAAK;QAAA,CAAE,CAAC,EACxD,aAAa,CACd,CAAA;IACH,CAAC;IAED,YACE,GAAgB,EACP,aAA4B,CAAA;QAErC,KAAK,CAAC,GAAG,CAAC,CAAA;QAFV,OAAA,cAAA,CAAA,IAAA,EAAA,iBAAA;;;;mBAAS,aAAa;WAAe;IAGvC,CAAC;IAED,IAAI,SAAS,GAAA;QACX,OAAO,IAAI,CAAA;IACb,CAAC;IAED,IAAI,UAAU,GAAA;QACZ,IAAI,KAAK,CAAC,SAAS,EAAE,OAAO,IAAI,CAAC,GAAG,CAAA;QACpC,MAAM,IAAI,KAAK,CAAC,sCAAsC,CAAC,CAAA;IACzD,CAAC;IAEkB,KAAK,CAAC,SAAS,CAAC,GAAW,EAAA;QAC5C,IAAI,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK,GAAG,EAAE,CAAC;YACzB,MAAM,IAAI,MAAA,QAAQ,CAAC,CAAA,mCAAA,EAAsC,GAAG,CAAA,CAAA,CAAG,CAAC,CAAA;QAClE,CAAC;QACD,OAAO,IAAI,CAAC,aAAa,CAAC,UAAU,CAAA;IACtC,CAAC;CACF;AA1ED,QAAA,YAAA,GAAA,aA0EC","ignoreList":[0]}},
    {"offset": {"line": 11427, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11432, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/jwk-webcrypto/src/index.ts"],"sourcesContent":["export * from './webcrypto-key.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,kIAAA,SAAkC","ignoreList":[0]}},
    {"offset": {"line": 11456, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11461, "column": 0}, "map": {"version":3,"file":"did-error.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/did/src/did-error.ts"],"sourcesContent":["export class DidError extends Error {\n  constructor(\n    public readonly did: string,\n    message: string,\n    public readonly code: string,\n    public readonly status = 400,\n    cause?: unknown,\n  ) {\n    super(message, { cause })\n  }\n\n  /**\n   * For compatibility with error handlers in common HTTP frameworks.\n   */\n  get statusCode() {\n    return this.status\n  }\n\n  override toString() {\n    return `${this.constructor.name} ${this.code} (${this.did}): ${this.message}`\n  }\n\n  static from(cause: unknown, did: string): DidError {\n    if (cause instanceof DidError) {\n      return cause\n    }\n\n    const message =\n      cause instanceof Error\n        ? cause.message\n        : typeof cause === 'string'\n          ? cause\n          : 'An unknown error occurred'\n\n    const status =\n      (typeof cause?.['statusCode'] === 'number'\n        ? cause['statusCode']\n        : undefined) ??\n      (typeof cause?.['status'] === 'number' ? cause['status'] : undefined)\n\n    return new DidError(did, message, 'did-unknown-error', status, cause)\n  }\n}\n\nexport class InvalidDidError extends DidError {\n  constructor(did: string, message: string, cause?: unknown) {\n    super(did, message, 'did-invalid', 400, cause)\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAa,QAAS,SAAQ,KAAK;IACjC,YACkB,GAAW,EAC3B,OAAe,EACC,IAAY,EACZ,SAAS,GAAG,EAC5B,KAAe,CAAA;QAEf,KAAK,CAAC,OAAO,EAAE;YAAE,KAAK;QAAA,CAAE,CAAC,CAAA;QANzB,OAAA,cAAA,CAAA,IAAA,EAAA,OAAA;;;;mBAAgB,GAAG;WAAQ;QAE3B,OAAA,cAAA,CAAA,IAAA,EAAA,QAAA;;;;mBAAgB,IAAI;WAAQ;QAC5B,OAAA,cAAA,CAAA,IAAA,EAAA,UAAA;;;;mBAAgB,MAAM;WAAM;IAI9B,CAAC;IAED;;OAEG,CACH,IAAI,UAAU,GAAA;QACZ,OAAO,IAAI,CAAC,MAAM,CAAA;IACpB,CAAC;IAEQ,QAAQ,GAAA;QACf,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAA,CAAA,EAAI,IAAI,CAAC,IAAI,CAAA,EAAA,EAAK,IAAI,CAAC,GAAG,CAAA,GAAA,EAAM,IAAI,CAAC,OAAO,EAAE,CAAA;IAC/E,CAAC;IAED,MAAM,CAAC,IAAI,CAAC,KAAc,EAAE,GAAW,EAAA;QACrC,IAAI,KAAK,YAAY,QAAQ,EAAE,CAAC;YAC9B,OAAO,KAAK,CAAA;QACd,CAAC;QAED,MAAM,OAAO,GACX,KAAK,YAAY,KAAK,GAClB,KAAK,CAAC,OAAO,GACb,OAAO,KAAK,KAAK,QAAQ,GACvB,KAAK,GACL,2BAA2B,CAAA;QAEnC,MAAM,MAAM,GACV,CAAC,OAAO,KAAK,EAAE,CAAC,YAAY,CAAC,KAAK,QAAQ,GACtC,KAAK,CAAC,YAAY,CAAC,GACnB,SAAS,CAAC,IACd,CAAC,OAAO,KAAK,EAAE,CAAC,QAAQ,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAA;QAEvE,OAAO,IAAI,QAAQ,CAAC,GAAG,EAAE,OAAO,EAAE,mBAAmB,EAAE,MAAM,EAAE,KAAK,CAAC,CAAA;IACvE,CAAC;CACF;AA1CD,QAAA,QAAA,GAAA,SA0CC;AAED,MAAa,eAAgB,SAAQ,QAAQ;IAC3C,YAAY,GAAW,EAAE,OAAe,EAAE,KAAe,CAAA;QACvD,KAAK,CAAC,GAAG,EAAE,OAAO,EAAE,aAAa,EAAE,GAAG,EAAE,KAAK,CAAC,CAAA;IAChD,CAAC;CACF;AAJD,QAAA,eAAA,GAAA,gBAIC","ignoreList":[0]}},
    {"offset": {"line": 11514, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11519, "column": 0}, "map": {"version":3,"file":"plc.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/did/src/methods/plc.ts"],"sourcesContent":["import { InvalidDidError } from '../did-error.js'\nimport { Did } from '../did.js'\n\nconst DID_PLC_PREFIX = `did:plc:`\nconst DID_PLC_PREFIX_LENGTH = DID_PLC_PREFIX.length\nconst DID_PLC_LENGTH = 32\n\nexport { DID_PLC_PREFIX }\n\nexport function isDidPlc(input: unknown): input is Did<'plc'> {\n  // Optimization: equivalent to try/catch around \"assertDidPlc\"\n  if (typeof input !== 'string') return false\n  if (input.length !== DID_PLC_LENGTH) return false\n  if (!input.startsWith(DID_PLC_PREFIX)) return false\n  for (let i = DID_PLC_PREFIX_LENGTH; i < DID_PLC_LENGTH; i++) {\n    if (!isBase32Char(input.charCodeAt(i))) return false\n  }\n  return true\n}\n\nexport function asDidPlc(input: unknown): Did<'plc'> {\n  assertDidPlc(input)\n  return input\n}\n\nexport function assertDidPlc(input: unknown): asserts input is Did<'plc'> {\n  if (typeof input !== 'string') {\n    throw new InvalidDidError(typeof input, `DID must be a string`)\n  }\n\n  if (input.length !== DID_PLC_LENGTH) {\n    throw new InvalidDidError(\n      input,\n      `did:plc must be ${DID_PLC_LENGTH} characters long`,\n    )\n  }\n\n  if (!input.startsWith(DID_PLC_PREFIX)) {\n    throw new InvalidDidError(input, `Invalid did:plc prefix`)\n  }\n\n  // The following check is not necessary, as the check below is more strict:\n\n  // assertDidMsid(input, DID_PLC_PREFIX.length)\n\n  for (let i = DID_PLC_PREFIX_LENGTH; i < DID_PLC_LENGTH; i++) {\n    if (!isBase32Char(input.charCodeAt(i))) {\n      throw new InvalidDidError(input, `Invalid character at position ${i}`)\n    }\n  }\n}\n\nconst isBase32Char = (c: number): boolean =>\n  (c >= 0x61 && c <= 0x7a) || (c >= 0x32 && c <= 0x37) // [a-z2-7]\n"],"names":[],"mappings":";;;;;AASA,QAAA,QAAA,GAAA,SASC;AAED,QAAA,QAAA,GAAA,SAGC;AAED,QAAA,YAAA,GAAA,aAyBC;AAlDD,MAAA,4CAAiD;AAGjD,MAAM,cAAc,GAAG,CAAA,QAAA,CAAU,CAAA;AAIxB,QAAA,cAAA,GAAA,eAAc;AAHvB,MAAM,qBAAqB,GAAG,cAAc,CAAC,MAAM,CAAA;AACnD,MAAM,cAAc,GAAG,EAAE,CAAA;AAIzB,SAAgB,QAAQ,CAAC,KAAc;IACrC,8DAA8D;IAC9D,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,OAAO,KAAK,CAAA;IAC3C,IAAI,KAAK,CAAC,MAAM,KAAK,cAAc,EAAE,OAAO,KAAK,CAAA;IACjD,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,cAAc,CAAC,EAAE,OAAO,KAAK,CAAA;IACnD,IAAK,IAAI,CAAC,GAAG,qBAAqB,EAAE,CAAC,GAAG,cAAc,EAAE,CAAC,EAAE,CAAE,CAAC;QAC5D,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,KAAK,CAAA;IACtD,CAAC;IACD,OAAO,IAAI,CAAA;AACb,CAAC;AAED,SAAgB,QAAQ,CAAC,KAAc;IACrC,YAAY,CAAC,KAAK,CAAC,CAAA;IACnB,OAAO,KAAK,CAAA;AACd,CAAC;AAED,SAAgB,YAAY,CAAC,KAAc;IACzC,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;QAC9B,MAAM,IAAI,eAAA,eAAe,CAAC,OAAO,KAAK,EAAE,CAAA,oBAAA,CAAsB,CAAC,CAAA;IACjE,CAAC;IAED,IAAI,KAAK,CAAC,MAAM,KAAK,cAAc,EAAE,CAAC;QACpC,MAAM,IAAI,eAAA,eAAe,CACvB,KAAK,EACL,CAAA,gBAAA,EAAmB,cAAc,CAAA,gBAAA,CAAkB,CACpD,CAAA;IACH,CAAC;IAED,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,cAAc,CAAC,EAAE,CAAC;QACtC,MAAM,IAAI,eAAA,eAAe,CAAC,KAAK,EAAE,CAAA,sBAAA,CAAwB,CAAC,CAAA;IAC5D,CAAC;IAED,2EAA2E;IAE3E,8CAA8C;IAE9C,IAAK,IAAI,CAAC,GAAG,qBAAqB,EAAE,CAAC,GAAG,cAAc,EAAE,CAAC,EAAE,CAAE,CAAC;QAC5D,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YACvC,MAAM,IAAI,eAAA,eAAe,CAAC,KAAK,EAAE,CAAA,8BAAA,EAAiC,CAAC,EAAE,CAAC,CAAA;QACxE,CAAC;IACH,CAAC;AACH,CAAC;AAED,MAAM,YAAY,GAAG,CAAC,CAAS,EAAW,CACxC,AAAC,CADyC,AACxC,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI,CAAC,GAAK,CAAD,AAAE,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI,CAAC,CAAA,AAAC,WAAW","ignoreList":[0]}},
    {"offset": {"line": 11566, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11571, "column": 0}, "map": {"version":3,"file":"did.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/did/src/did.ts"],"sourcesContent":["import { z } from 'zod'\nimport { DidError, InvalidDidError } from './did-error.js'\n\nconst DID_PREFIX = 'did:'\nconst DID_PREFIX_LENGTH = DID_PREFIX.length\nexport { DID_PREFIX }\n\n/**\n * Type representation of a Did, with method.\n *\n * ```bnf\n * did                = \"did:\" method-name \":\" method-specific-id\n * method-name        = 1*method-char\n * method-char        = %x61-7A / DIGIT\n * method-specific-id = *( *idchar \":\" ) 1*idchar\n * idchar             = ALPHA / DIGIT / \".\" / \"-\" / \"_\" / pct-encoded\n * pct-encoded        = \"%\" HEXDIG HEXDIG\n * ```\n *\n * @example\n * ```ts\n * type DidWeb = Did<'web'> // `did:web:${string}`\n * type DidCustom = Did<'web' | 'plc'> // `did:${'web' | 'plc'}:${string}`\n * type DidNever = Did<' invalid  '> // never\n * type DidFoo = Did<'foo' | ' invalid  '> // `did:foo:${string}`\n * ```\n *\n * @see {@link https://www.w3.org/TR/did-core/#did-syntax}\n */\nexport type Did<M extends string = string> = `did:${AsDidMethod<M>}:${string}`\n\n/**\n * DID Method\n */\nexport type AsDidMethod<M> = string extends M\n  ? string // can't know...\n  : AsDidMethodInternal<M, ''>\n\ntype AlphanumericChar = DigitChar | LowerAlphaChar\ntype DigitChar = '0' | '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9'\ntype LowerAlphaChar =\n  | 'a'\n  | 'b'\n  | 'c'\n  | 'd'\n  | 'e'\n  | 'f'\n  | 'g'\n  | 'h'\n  | 'i'\n  | 'j'\n  | 'k'\n  | 'l'\n  | 'm'\n  | 'n'\n  | 'o'\n  | 'p'\n  | 'q'\n  | 'r'\n  | 's'\n  | 't'\n  | 'u'\n  | 'v'\n  | 'w'\n  | 'x'\n  | 'y'\n  | 'z'\n\ntype AsDidMethodInternal<\n  S,\n  Acc extends string,\n> = S extends `${infer H}${infer T}`\n  ? H extends AlphanumericChar\n    ? AsDidMethodInternal<T, `${Acc}${H}`>\n    : never\n  : Acc extends ''\n    ? never\n    : Acc\n\n/**\n * DID Method-name check function.\n *\n * Check if the input is a valid DID method name, at the position between\n * `start` (inclusive) and `end` (exclusive).\n */\nexport function assertDidMethod(\n  input: string,\n  start = 0,\n  end = input.length,\n): void {\n  if (\n    !Number.isFinite(end) ||\n    !Number.isFinite(start) ||\n    end < start ||\n    end > input.length\n  ) {\n    throw new TypeError('Invalid start or end position')\n  }\n  if (end === start) {\n    throw new InvalidDidError(input, `Empty method name`)\n  }\n\n  let c: number\n  for (let i = start; i < end; i++) {\n    c = input.charCodeAt(i)\n    if (\n      (c < 0x61 || c > 0x7a) && // a-z\n      (c < 0x30 || c > 0x39) // 0-9\n    ) {\n      throw new InvalidDidError(\n        input,\n        `Invalid character at position ${i} in DID method name`,\n      )\n    }\n  }\n}\n\n/**\n * This method assumes the input is a valid Did\n */\nexport function extractDidMethod<D extends Did>(did: D) {\n  const msidSep = did.indexOf(':', DID_PREFIX_LENGTH)\n  const method = did.slice(DID_PREFIX_LENGTH, msidSep)\n  return method as D extends Did<infer M> ? M : string\n}\n\n/**\n * DID Method-specific identifier check function.\n *\n * Check if the input is a valid DID method-specific identifier, at the position\n * between `start` (inclusive) and `end` (exclusive).\n */\nexport function assertDidMsid(\n  input: string,\n  start = 0,\n  end = input.length,\n): void {\n  if (\n    !Number.isFinite(end) ||\n    !Number.isFinite(start) ||\n    end < start ||\n    end > input.length\n  ) {\n    throw new TypeError('Invalid start or end position')\n  }\n  if (end === start) {\n    throw new InvalidDidError(input, `DID method-specific id must not be empty`)\n  }\n\n  let c: number\n  for (let i = start; i < end; i++) {\n    c = input.charCodeAt(i)\n\n    // Check for frequent chars first\n    if (\n      (c < 0x61 || c > 0x7a) && // a-z\n      (c < 0x41 || c > 0x5a) && // A-Z\n      (c < 0x30 || c > 0x39) && // 0-9\n      c !== 0x2e && // .\n      c !== 0x2d && // -\n      c !== 0x5f // _\n    ) {\n      // Less frequent chars are checked here\n\n      // \":\"\n      if (c === 0x3a) {\n        if (i === end - 1) {\n          throw new InvalidDidError(input, `DID cannot end with \":\"`)\n        }\n        continue\n      }\n\n      // pct-encoded\n      if (c === 0x25) {\n        c = input.charCodeAt(++i)\n        if ((c < 0x30 || c > 0x39) && (c < 0x41 || c > 0x46)) {\n          throw new InvalidDidError(\n            input,\n            `Invalid pct-encoded character at position ${i}`,\n          )\n        }\n\n        c = input.charCodeAt(++i)\n        if ((c < 0x30 || c > 0x39) && (c < 0x41 || c > 0x46)) {\n          throw new InvalidDidError(\n            input,\n            `Invalid pct-encoded character at position ${i}`,\n          )\n        }\n\n        // There must always be 2 HEXDIG after a \"%\"\n        if (i >= end) {\n          throw new InvalidDidError(\n            input,\n            `Incomplete pct-encoded character at position ${i - 2}`,\n          )\n        }\n\n        continue\n      }\n\n      throw new InvalidDidError(\n        input,\n        `Disallowed character in DID at position ${i}`,\n      )\n    }\n  }\n}\n\nexport function assertDid(input: unknown): asserts input is Did {\n  if (typeof input !== 'string') {\n    throw new InvalidDidError(typeof input, `DID must be a string`)\n  }\n\n  const { length } = input\n  if (length > 2048) {\n    throw new InvalidDidError(input, `DID is too long (2048 chars max)`)\n  }\n\n  if (!input.startsWith(DID_PREFIX)) {\n    throw new InvalidDidError(input, `DID requires \"${DID_PREFIX}\" prefix`)\n  }\n\n  const idSep = input.indexOf(':', DID_PREFIX_LENGTH)\n  if (idSep === -1) {\n    throw new InvalidDidError(input, `Missing colon after method name`)\n  }\n\n  assertDidMethod(input, DID_PREFIX_LENGTH, idSep)\n  assertDidMsid(input, idSep + 1, length)\n}\n\nexport function isDid(input: unknown): input is Did {\n  try {\n    assertDid(input)\n    return true\n  } catch (err) {\n    if (err instanceof DidError) {\n      return false\n    }\n\n    // Unexpected TypeError (should never happen)\n    throw err\n  }\n}\n\nexport function asDid(input: unknown): Did {\n  assertDid(input)\n  return input\n}\n\nexport const didSchema = z\n  .string()\n  .superRefine((value: string, ctx: z.RefinementCtx): value is Did => {\n    try {\n      assertDid(value)\n      return true\n    } catch (err) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: err instanceof Error ? err.message : 'Unexpected error',\n      })\n      return false\n    }\n  })\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 11713, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11718, "column": 0}, "map": {"version":3,"file":"web.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/did/src/methods/web.ts"],"sourcesContent":["import { InvalidDidError } from '../did-error.js'\nimport { Did, assertDidMsid } from '../did.js'\n\nexport const DID_WEB_PREFIX = `did:web:` satisfies Did<'web'>\n\n/**\n * This function checks if the input is a valid Web DID, as per DID spec.\n */\nexport function isDidWeb(input: unknown): input is Did<'web'> {\n  // Optimization: make cheap checks first\n  if (typeof input !== 'string') return false\n\n  try {\n    assertDidWeb(input)\n    return true\n  } catch {\n    return false\n  }\n}\n\nexport function asDidWeb(input: unknown): Did<'web'> {\n  assertDidWeb(input)\n  return input\n}\n\nexport function assertDidWeb(input: unknown): asserts input is Did<'web'> {\n  if (typeof input !== 'string') {\n    throw new InvalidDidError(typeof input, `DID must be a string`)\n  }\n\n  void didWebToUrl(input)\n}\n\nexport function didWebToUrl(did: string): URL {\n  if (!did.startsWith(DID_WEB_PREFIX)) {\n    throw new InvalidDidError(did, `did:web must start with ${DID_WEB_PREFIX}`)\n  }\n\n  if (did.charAt(DID_WEB_PREFIX.length) === ':') {\n    throw new InvalidDidError(did, 'did:web MSID must not start with a colon')\n  }\n\n  // Make sure every char is valid (per DID spec)\n  assertDidMsid(did, DID_WEB_PREFIX.length)\n\n  try {\n    const msid = did.slice(DID_WEB_PREFIX.length)\n    const parts = msid.split(':').map(decodeURIComponent)\n    const url = new URL(`https://${parts.join('/')}`)\n    if (url.hostname === 'localhost') {\n      url.protocol = 'http:'\n    }\n    return url\n  } catch (cause) {\n    throw new InvalidDidError(did, 'Invalid Web DID', cause)\n  }\n}\n\nexport function urlToDidWeb(url: URL): Did<'web'> {\n  const path =\n    url.pathname === '/'\n      ? ''\n      : url.pathname.slice(1).split('/').map(encodeURIComponent).join(':')\n\n  return `did:web:${encodeURIComponent(url.host)}${path ? `:${path}` : ''}`\n}\n"],"names":[],"mappings":";;;;;AAQA,QAAA,QAAA,GAAA,SAUC;AAED,QAAA,QAAA,GAAA,SAGC;AAED,QAAA,YAAA,GAAA,aAMC;AAED,QAAA,WAAA,GAAA,YAuBC;AAED,QAAA,WAAA,GAAA,YAOC;AAjED,MAAA,4CAAiD;AACjD,MAAA,gCAA8C;AAEjC,QAAA,cAAc,GAAG,CAAA,QAAA,CAA+B,CAAA;AAE7D;;GAEG,CACH,SAAgB,QAAQ,CAAC,KAAc;IACrC,wCAAwC;IACxC,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,OAAO,KAAK,CAAA;IAE3C,IAAI,CAAC;QACH,YAAY,CAAC,KAAK,CAAC,CAAA;QACnB,OAAO,IAAI,CAAA;IACb,CAAC,CAAC,OAAM,CAAC;QACP,OAAO,KAAK,CAAA;IACd,CAAC;AACH,CAAC;AAED,SAAgB,QAAQ,CAAC,KAAc;IACrC,YAAY,CAAC,KAAK,CAAC,CAAA;IACnB,OAAO,KAAK,CAAA;AACd,CAAC;AAED,SAAgB,YAAY,CAAC,KAAc;IACzC,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;QAC9B,MAAM,IAAI,eAAA,eAAe,CAAC,OAAO,KAAK,EAAE,CAAA,oBAAA,CAAsB,CAAC,CAAA;IACjE,CAAC;IAED,KAAK,WAAW,CAAC,KAAK,CAAC,CAAA;AACzB,CAAC;AAED,SAAgB,WAAW,CAAC,GAAW;IACrC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,QAAA,cAAc,CAAC,EAAE,CAAC;QACpC,MAAM,IAAI,eAAA,eAAe,CAAC,GAAG,EAAE,CAAA,wBAAA,EAA2B,QAAA,cAAc,EAAE,CAAC,CAAA;IAC7E,CAAC;IAED,IAAI,GAAG,CAAC,MAAM,CAAC,QAAA,cAAc,CAAC,MAAM,CAAC,KAAK,GAAG,EAAE,CAAC;QAC9C,MAAM,IAAI,eAAA,eAAe,CAAC,GAAG,EAAE,0CAA0C,CAAC,CAAA;IAC5E,CAAC;IAED,+CAA+C;IAC/C,CAAA,GAAA,SAAA,aAAa,EAAC,GAAG,EAAE,QAAA,cAAc,CAAC,MAAM,CAAC,CAAA;IAEzC,IAAI,CAAC;QACH,MAAM,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,QAAA,cAAc,CAAC,MAAM,CAAC,CAAA;QAC7C,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAA;QACrD,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,CAAA,QAAA,EAAW,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,CAAA;QACjD,IAAI,GAAG,CAAC,QAAQ,KAAK,WAAW,EAAE,CAAC;YACjC,GAAG,CAAC,QAAQ,GAAG,OAAO,CAAA;QACxB,CAAC;QACD,OAAO,GAAG,CAAA;IACZ,CAAC,CAAC,OAAO,KAAK,EAAE,CAAC;QACf,MAAM,IAAI,eAAA,eAAe,CAAC,GAAG,EAAE,iBAAiB,EAAE,KAAK,CAAC,CAAA;IAC1D,CAAC;AACH,CAAC;AAED,SAAgB,WAAW,CAAC,GAAQ;IAClC,MAAM,IAAI,GACR,GAAG,CAAC,QAAQ,KAAK,GAAG,GAChB,EAAE,GACF,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;IAExE,OAAO,CAAA,QAAA,EAAW,kBAAkB,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA,CAAA,EAAI,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,CAAA;AAC3E,CAAC","ignoreList":[0]}},
    {"offset": {"line": 11778, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11783, "column": 0}, "map": {"version":3,"file":"methods.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/did/src/methods.ts"],"sourcesContent":["export * from './methods/plc.js'\nexport * from './methods/web.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,sHAAA,SAAgC;AAChC,sHAAA,SAAgC","ignoreList":[0]}},
    {"offset": {"line": 11808, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11813, "column": 0}, "map": {"version":3,"file":"atproto.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/did/src/atproto.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { InvalidDidError } from './did-error.js'\nimport { Did } from './did.js'\nimport {\n  assertDidPlc,\n  assertDidWeb,\n  DID_PLC_PREFIX,\n  DID_WEB_PREFIX,\n  isDidPlc,\n} from './methods.js'\n\n// This file contains atproto-specific DID validation utilities.\n\nexport type AtprotoIdentityDidMethods = 'plc' | 'web'\nexport type AtprotoDid = Did<AtprotoIdentityDidMethods>\n\nexport const atprotoDidSchema = z\n  .string()\n  .refine(isAtprotoDid, `Atproto only allows \"plc\" and \"web\" DID methods`)\n\nexport function isAtprotoDid(input: unknown): input is AtprotoDid {\n  // Optimized equivalent of:\n  // return isDidPlc(input) || isAtprotoDidWeb(input)\n\n  if (typeof input !== 'string') {\n    return false\n  } else if (input.startsWith(DID_PLC_PREFIX)) {\n    return isDidPlc(input)\n  } else if (input.startsWith(DID_WEB_PREFIX)) {\n    return isAtprotoDidWeb(input)\n  } else {\n    return false\n  }\n}\n\nexport function asAtprotoDid(input: unknown): AtprotoDid {\n  assertAtprotoDid(input)\n  return input\n}\n\nexport function assertAtprotoDid(input: unknown): asserts input is AtprotoDid {\n  if (typeof input !== 'string') {\n    throw new InvalidDidError(typeof input, `DID must be a string`)\n  } else if (input.startsWith(DID_PLC_PREFIX)) {\n    assertDidPlc(input)\n  } else if (input.startsWith(DID_WEB_PREFIX)) {\n    assertAtprotoDidWeb(input)\n  } else {\n    throw new InvalidDidError(\n      input,\n      `Atproto only allows \"plc\" and \"web\" DID methods`,\n    )\n  }\n}\n\nexport function assertAtprotoDidWeb(\n  input: unknown,\n): asserts input is Did<'web'> {\n  assertDidWeb(input)\n\n  if (input.includes(':', DID_WEB_PREFIX.length)) {\n    throw new InvalidDidError(\n      input,\n      `Atproto does not allow path components in Web DIDs`,\n    )\n  }\n\n  if (\n    input.includes('%3A', DID_WEB_PREFIX.length) &&\n    !input.startsWith('did:web:localhost%3A')\n  ) {\n    throw new InvalidDidError(\n      input,\n      `Atproto does not allow port numbers in Web DIDs, except for localhost`,\n    )\n  }\n}\n\n/**\n * @see {@link https://atproto.com/specs/did#blessed-did-methods}\n */\nexport function isAtprotoDidWeb(input: unknown): input is Did<'web'> {\n  try {\n    assertAtprotoDidWeb(input)\n    return true\n  } catch {\n    return false\n  }\n}\n"],"names":[],"mappings":";;;;;AAqBA,QAAA,YAAA,GAAA,aAaC;AAED,QAAA,YAAA,GAAA,aAGC;AAED,QAAA,gBAAA,GAAA,iBAaC;AAED,QAAA,mBAAA,GAAA,oBAqBC;AAKD,QAAA,eAAA,GAAA,gBAOC;AAzFD,MAAA,uBAAuB;AAEvB,MAAA,2CAAgD;AAEhD,MAAA,uCAMqB;AAOR,QAAA,gBAAgB,GAAG,MAAA,CAAC,CAC9B,MAAM,EAAE,CACR,MAAM,CAAC,YAAY,EAAE,CAAA,+CAAA,CAAiD,CAAC,CAAA;AAE1E,SAAgB,YAAY,CAAC,KAAc;IACzC,2BAA2B;IAC3B,mDAAmD;IAEnD,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;QAC9B,OAAO,KAAK,CAAA;IACd,CAAC,MAAM,IAAI,KAAK,CAAC,UAAU,CAAC,aAAA,cAAc,CAAC,EAAE,CAAC;QAC5C,OAAO,CAAA,GAAA,aAAA,QAAQ,EAAC,KAAK,CAAC,CAAA;IACxB,CAAC,MAAM,IAAI,KAAK,CAAC,UAAU,CAAC,aAAA,cAAc,CAAC,EAAE,CAAC;QAC5C,OAAO,eAAe,CAAC,KAAK,CAAC,CAAA;IAC/B,CAAC,MAAM,CAAC;QACN,OAAO,KAAK,CAAA;IACd,CAAC;AACH,CAAC;AAED,SAAgB,YAAY,CAAC,KAAc;IACzC,gBAAgB,CAAC,KAAK,CAAC,CAAA;IACvB,OAAO,KAAK,CAAA;AACd,CAAC;AAED,SAAgB,gBAAgB,CAAC,KAAc;IAC7C,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;QAC9B,MAAM,IAAI,eAAA,eAAe,CAAC,OAAO,KAAK,EAAE,CAAA,oBAAA,CAAsB,CAAC,CAAA;IACjE,CAAC,MAAM,IAAI,KAAK,CAAC,UAAU,CAAC,aAAA,cAAc,CAAC,EAAE,CAAC;QAC5C,CAAA,GAAA,aAAA,YAAY,EAAC,KAAK,CAAC,CAAA;IACrB,CAAC,MAAM,IAAI,KAAK,CAAC,UAAU,CAAC,aAAA,cAAc,CAAC,EAAE,CAAC;QAC5C,mBAAmB,CAAC,KAAK,CAAC,CAAA;IAC5B,CAAC,MAAM,CAAC;QACN,MAAM,IAAI,eAAA,eAAe,CACvB,KAAK,EACL,CAAA,+CAAA,CAAiD,CAClD,CAAA;IACH,CAAC;AACH,CAAC;AAED,SAAgB,mBAAmB,CACjC,KAAc;IAEd,CAAA,GAAA,aAAA,YAAY,EAAC,KAAK,CAAC,CAAA;IAEnB,IAAI,KAAK,CAAC,QAAQ,CAAC,GAAG,EAAE,aAAA,cAAc,CAAC,MAAM,CAAC,EAAE,CAAC;QAC/C,MAAM,IAAI,eAAA,eAAe,CACvB,KAAK,EACL,CAAA,kDAAA,CAAoD,CACrD,CAAA;IACH,CAAC;IAED,IACE,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAE,aAAA,cAAc,CAAC,MAAM,CAAC,IAC5C,CAAC,KAAK,CAAC,UAAU,CAAC,sBAAsB,CAAC,EACzC,CAAC;QACD,MAAM,IAAI,eAAA,eAAe,CACvB,KAAK,EACL,CAAA,qEAAA,CAAuE,CACxE,CAAA;IACH,CAAC;AACH,CAAC;AAED;;GAEG,CACH,SAAgB,eAAe,CAAC,KAAc;IAC5C,IAAI,CAAC;QACH,mBAAmB,CAAC,KAAK,CAAC,CAAA;QAC1B,OAAO,IAAI,CAAA;IACb,CAAC,CAAC,OAAM,CAAC;QACP,OAAO,KAAK,CAAA;IACd,CAAC;AACH,CAAC","ignoreList":[0]}},
    {"offset": {"line": 11874, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 11879, "column": 0}, "map": {"version":3,"file":"did-document.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/did/src/did-document.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { Did, didSchema } from './did.js'\n\n/**\n * RFC3968 compliant URI\n *\n * @see {@link https://www.rfc-editor.org/rfc/rfc3986}\n */\nconst rfc3968UriSchema = z.string().refine((data) => {\n  try {\n    new URL(data)\n    return true\n  } catch {\n    return false\n  }\n}, 'RFC3968 compliant URI')\n\nconst didControllerSchema = z.union([didSchema, z.array(didSchema)])\n\n/**\n * @note this schema might be too permissive\n */\nconst didRelativeUriSchema = z.union([\n  rfc3968UriSchema,\n  z.string().regex(/^#[^#]+$/),\n])\n\nconst didVerificationMethodSchema = z.object({\n  id: didRelativeUriSchema,\n  type: z.string().min(1),\n  controller: didControllerSchema,\n  publicKeyJwk: z.record(z.string(), z.unknown()).optional(),\n  publicKeyMultibase: z.string().optional(),\n})\n\n/**\n * The value of the id property MUST be a URI conforming to [RFC3986]. A\n * conforming producer MUST NOT produce multiple service entries with the same\n * id. A conforming consumer MUST produce an error if it detects multiple\n * service entries with the same id.\n *\n * @note Normally, only rfc3968UriSchema should be allowed here. However, the\n *   did:plc uses relative URI. For this reason, we also allow relative URIs\n *   here.\n */\nconst didServiceIdSchema = didRelativeUriSchema\n\n/**\n * The value of the type property MUST be a string or a set of strings. In order\n * to maximize interoperability, the service type and its associated properties\n * SHOULD be registered in the DID Specification Registries\n * [DID-SPEC-REGISTRIES].\n */\nconst didServiceTypeSchema = z.union([z.string(), z.array(z.string())])\n\n/**\n * The value of the serviceEndpoint property MUST be a string, a map, or a set\n * composed of one or more strings and/or maps. All string values MUST be valid\n * URIs conforming to [RFC3986] and normalized according to the Normalization\n * and Comparison rules in RFC3986 and to any normalization rules in its\n * applicable URI scheme specification.\n */\nconst didServiceEndpointSchema = z.union([\n  rfc3968UriSchema,\n  z.record(z.string(), rfc3968UriSchema),\n  z\n    .array(z.union([rfc3968UriSchema, z.record(z.string(), rfc3968UriSchema)]))\n    .nonempty(),\n])\n\n/**\n * Each service map MUST contain id, type, and serviceEndpoint properties.\n * @see {@link https://www.w3.org/TR/did-core/#services}\n */\nconst didServiceSchema = z.object({\n  id: didServiceIdSchema,\n  type: didServiceTypeSchema,\n  serviceEndpoint: didServiceEndpointSchema,\n})\n\nexport type DidService = z.infer<typeof didServiceSchema>\n\nconst didAuthenticationSchema = z.union([\n  //\n  didRelativeUriSchema,\n  didVerificationMethodSchema,\n])\n\n/**\n * @note This schema is incomplete\n * @see {@link https://www.w3.org/TR/did-core/#production-0}\n */\nexport const didDocumentSchema = z.object({\n  '@context': z.union([\n    z.literal('https://www.w3.org/ns/did/v1'),\n    z\n      .array(z.string().url())\n      .nonempty()\n      .refine((data) => data[0] === 'https://www.w3.org/ns/did/v1', {\n        message: 'First @context must be https://www.w3.org/ns/did/v1',\n      }),\n  ]),\n  id: didSchema,\n  controller: didControllerSchema.optional(),\n  alsoKnownAs: z.array(rfc3968UriSchema).optional(),\n  service: z.array(didServiceSchema).optional(),\n  authentication: z.array(didAuthenticationSchema).optional(),\n  verificationMethod: z\n    .array(z.union([didVerificationMethodSchema, didRelativeUriSchema]))\n    .optional(),\n})\n\nexport type DidDocument<Method extends string = string> = z.infer<\n  typeof didDocumentSchema\n> & { id: Did<Method> }\n\n// @TODO: add other refinements ?\nexport const didDocumentValidator = didDocumentSchema\n  // Ensure that every service id is unique\n  .superRefine(({ id: did, service }, ctx) => {\n    if (service) {\n      const visited = new Set()\n\n      for (let i = 0; i < service.length; i++) {\n        const current = service[i]\n\n        const serviceId = current.id.startsWith('#')\n          ? `${did}${current.id}`\n          : current.id\n\n        if (!visited.has(serviceId)) {\n          visited.add(serviceId)\n        } else {\n          ctx.addIssue({\n            code: z.ZodIssueCode.custom,\n            message: `Duplicate service id (${current.id}) found in the document`,\n            path: ['service', i, 'id'],\n          })\n        }\n      }\n    }\n  })\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB,MAAA,+BAAyC;AAEzC;;;;GAIG,CACH,MAAM,gBAAgB,GAAG,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE;IAClD,IAAI,CAAC;QACH,IAAI,GAAG,CAAC,IAAI,CAAC,CAAA;QACb,OAAO,IAAI,CAAA;IACb,CAAC,CAAC,OAAM,CAAC;QACP,OAAO,KAAK,CAAA;IACd,CAAC;AACH,CAAC,EAAE,uBAAuB,CAAC,CAAA;AAE3B,MAAM,mBAAmB,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IAAC,SAAA,SAAS;IAAE,MAAA,CAAC,CAAC,KAAK,CAAC,SAAA,SAAS,CAAC;CAAC,CAAC,CAAA;AAEpE;;GAEG,CACH,MAAM,oBAAoB,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IACnC,gBAAgB;IAChB,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC;CAC7B,CAAC,CAAA;AAEF,MAAM,2BAA2B,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAC3C,EAAE,EAAE,oBAAoB;IACxB,IAAI,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;IACvB,UAAU,EAAE,mBAAmB;IAC/B,YAAY,EAAE,MAAA,CAAC,CAAC,MAAM,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,EAAE,MAAA,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,QAAQ,EAAE;IAC1D,kBAAkB,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;CAC1C,CAAC,CAAA;AAEF;;;;;;;;;GASG,CACH,MAAM,kBAAkB,GAAG,oBAAoB,CAAA;AAE/C;;;;;GAKG,CACH,MAAM,oBAAoB,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IAAC,MAAA,CAAC,CAAC,MAAM,EAAE;IAAE,MAAA,CAAC,CAAC,KAAK,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC;CAAC,CAAC,CAAA;AAEvE;;;;;;GAMG,CACH,MAAM,wBAAwB,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IACvC,gBAAgB;IAChB,MAAA,CAAC,CAAC,MAAM,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,EAAE,gBAAgB,CAAC;IACtC,MAAA,CAAC,CACE,KAAK,CAAC,MAAA,CAAC,CAAC,KAAK,CAAC;QAAC,gBAAgB;QAAE,MAAA,CAAC,CAAC,MAAM,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,EAAE,gBAAgB,CAAC;KAAC,CAAC,CAAC,CAC1E,QAAQ,EAAE;CACd,CAAC,CAAA;AAEF;;;GAGG,CACH,MAAM,gBAAgB,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAChC,EAAE,EAAE,kBAAkB;IACtB,IAAI,EAAE,oBAAoB;IAC1B,eAAe,EAAE,wBAAwB;CAC1C,CAAC,CAAA;AAIF,MAAM,uBAAuB,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IACtC,EAAE;IACF,oBAAoB;IACpB,2BAA2B;CAC5B,CAAC,CAAA;AAEF;;;GAGG,CACU,QAAA,iBAAiB,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACxC,UAAU,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC;QAClB,MAAA,CAAC,CAAC,OAAO,CAAC,8BAA8B,CAAC;QACzC,MAAA,CAAC,CACE,KAAK,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,CAAC,CACvB,QAAQ,EAAE,CACV,MAAM,CAAC,CAAC,IAAI,EAAE,CAAG,CAAD,GAAK,CAAC,CAAC,CAAC,KAAK,8BAA8B,EAAE;YAC5D,OAAO,EAAE,qDAAqD;SAC/D,CAAC;KACL,CAAC;IACF,EAAE,EAAE,SAAA,SAAS;IACb,UAAU,EAAE,mBAAmB,CAAC,QAAQ,EAAE;IAC1C,WAAW,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,QAAQ,EAAE;IACjD,OAAO,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,QAAQ,EAAE;IAC7C,cAAc,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC,QAAQ,EAAE;IAC3D,kBAAkB,EAAE,MAAA,CAAC,CAClB,KAAK,CAAC,MAAA,CAAC,CAAC,KAAK,CAAC;QAAC,2BAA2B;QAAE,oBAAoB;KAAC,CAAC,CAAC,CACnE,QAAQ,EAAE;CACd,CAAC,CAAA;AAMF,iCAAiC;AACpB,QAAA,oBAAoB,GAAG,QAAA,iBAAiB,AACnD,yCAAyC;CACxC,WAAW,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,OAAO,EAAE,EAAE,GAAG,EAAE,EAAE;IACzC,IAAI,OAAO,EAAE,CAAC;QACZ,MAAM,OAAO,GAAG,IAAI,GAAG,EAAE,CAAA;QAEzB,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;YACxC,MAAM,OAAO,GAAG,OAAO,CAAC,CAAC,CAAC,CAAA;YAE1B,MAAM,SAAS,GAAG,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,GACxC,GAAG,GAAG,GAAG,OAAO,CAAC,EAAE,EAAE,GACrB,OAAO,CAAC,EAAE,CAAA;YAEd,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC;gBAC5B,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA;YACxB,CAAC,MAAM,CAAC;gBACN,GAAG,CAAC,QAAQ,CAAC;oBACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;oBAC3B,OAAO,EAAE,CAAA,sBAAA,EAAyB,OAAO,CAAC,EAAE,CAAA,uBAAA,CAAyB;oBACrE,IAAI,EAAE;wBAAC,SAAS;wBAAE,CAAC;wBAAE,IAAI;qBAAC;iBAC3B,CAAC,CAAA;YACJ,CAAC;QACH,CAAC;IACH,CAAC;AACH,CAAC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 12005, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 12010, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/did/src/index.ts"],"sourcesContent":["export * from './atproto.js'\nexport * from './did-document.js'\nexport * from './did-error.js'\nexport * from './did.js'\nexport * from './methods.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,kHAAA,SAA4B;AAC5B,uHAAA,SAAiC;AACjC,oHAAA,SAA8B;AAC9B,8GAAA,SAAwB;AACxB,kHAAA,SAA4B","ignoreList":[0]}},
    {"offset": {"line": 12038, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 12043, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/lru-cache/src/index.ts"],"sourcesContent":["/**\n * @module LRUCache\n */\n\n// module-private names and types\ntype Perf = { now: () => number }\nconst perf: Perf =\n  typeof performance === 'object' &&\n  performance &&\n  typeof performance.now === 'function'\n    ? performance\n    : Date\n\nconst warned = new Set<string>()\n\n// either a function or a class\ntype ForC = ((...a: any[]) => any) | { new (...a: any[]): any }\n\n/* c8 ignore start */\nconst PROCESS = (\n  typeof process === 'object' && !!process ? process : {}\n) as { [k: string]: any }\n/* c8 ignore start */\n\nconst emitWarning = (\n  msg: string,\n  type: string,\n  code: string,\n  fn: ForC\n) => {\n  typeof PROCESS.emitWarning === 'function'\n    ? PROCESS.emitWarning(msg, type, code, fn)\n    : console.error(`[${code}] ${type}: ${msg}`)\n}\n\nlet AC = globalThis.AbortController\nlet AS = globalThis.AbortSignal\n\n/* c8 ignore start */\nif (typeof AC === 'undefined') {\n  //@ts-ignore\n  AS = class AbortSignal {\n    onabort?: (...a: any[]) => any\n    _onabort: ((...a: any[]) => any)[] = []\n    reason?: any\n    aborted: boolean = false\n    addEventListener(_: string, fn: (...a: any[]) => any) {\n      this._onabort.push(fn)\n    }\n  }\n  //@ts-ignore\n  AC = class AbortController {\n    constructor() {\n      warnACPolyfill()\n    }\n    signal = new AS()\n    abort(reason: any) {\n      if (this.signal.aborted) return\n      //@ts-ignore\n      this.signal.reason = reason\n      //@ts-ignore\n      this.signal.aborted = true\n      //@ts-ignore\n      for (const fn of this.signal._onabort) {\n        fn(reason)\n      }\n      this.signal.onabort?.(reason)\n    }\n  }\n  let printACPolyfillWarning =\n    PROCESS.env?.LRU_CACHE_IGNORE_AC_WARNING !== '1'\n  const warnACPolyfill = () => {\n    if (!printACPolyfillWarning) return\n    printACPolyfillWarning = false\n    emitWarning(\n      'AbortController is not defined. If using lru-cache in ' +\n        'node 14, load an AbortController polyfill from the ' +\n        '`node-abort-controller` package. A minimal polyfill is ' +\n        'provided for use by LRUCache.fetch(), but it should not be ' +\n        'relied upon in other contexts (eg, passing it to other APIs that ' +\n        'use AbortController/AbortSignal might have undesirable effects). ' +\n        'You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.',\n      'NO_ABORT_CONTROLLER',\n      'ENOTSUP',\n      warnACPolyfill\n    )\n  }\n}\n/* c8 ignore stop */\n\nconst shouldWarn = (code: string) => !warned.has(code)\n\nconst TYPE = Symbol('type')\nexport type PosInt = number & { [TYPE]: 'Positive Integer' }\nexport type Index = number & { [TYPE]: 'LRUCache Index' }\n\nconst isPosInt = (n: any): n is PosInt =>\n  n && n === Math.floor(n) && n > 0 && isFinite(n)\n\nexport type UintArray = Uint8Array | Uint16Array | Uint32Array\nexport type NumberArray = UintArray | number[]\n\n/* c8 ignore start */\n// This is a little bit ridiculous, tbh.\n// The maximum array length is 2^32-1 or thereabouts on most JS impls.\n// And well before that point, you're caching the entire world, I mean,\n// that's ~32GB of just integers for the next/prev links, plus whatever\n// else to hold that many keys and values.  Just filling the memory with\n// zeroes at init time is brutal when you get that big.\n// But why not be complete?\n// Maybe in the future, these limits will have expanded.\nconst getUintArray = (max: number) =>\n  !isPosInt(max)\n    ? null\n    : max <= Math.pow(2, 8)\n    ? Uint8Array\n    : max <= Math.pow(2, 16)\n    ? Uint16Array\n    : max <= Math.pow(2, 32)\n    ? Uint32Array\n    : max <= Number.MAX_SAFE_INTEGER\n    ? ZeroArray\n    : null\n/* c8 ignore stop */\n\nclass ZeroArray extends Array<number> {\n  constructor(size: number) {\n    super(size)\n    this.fill(0)\n  }\n}\nexport type { ZeroArray }\nexport type { Stack }\n\nexport type StackLike = Stack | Index[]\nclass Stack {\n  heap: NumberArray\n  length: number\n  // private constructor\n  static #constructing: boolean = false\n  static create(max: number): StackLike {\n    const HeapCls = getUintArray(max)\n    if (!HeapCls) return []\n    Stack.#constructing = true\n    const s = new Stack(max, HeapCls)\n    Stack.#constructing = false\n    return s\n  }\n  constructor(\n    max: number,\n    HeapCls: { new (n: number): NumberArray }\n  ) {\n    /* c8 ignore start */\n    if (!Stack.#constructing) {\n      throw new TypeError('instantiate Stack using Stack.create(n)')\n    }\n    /* c8 ignore stop */\n    this.heap = new HeapCls(max)\n    this.length = 0\n  }\n  push(n: Index) {\n    this.heap[this.length++] = n\n  }\n  pop(): Index {\n    return this.heap[--this.length] as Index\n  }\n}\n\n/**\n * Promise representing an in-progress {@link LRUCache#fetch} call\n */\nexport type BackgroundFetch<V> = Promise<V | undefined> & {\n  __returned: BackgroundFetch<V> | undefined\n  __abortController: AbortController\n  __staleWhileFetching: V | undefined\n}\n\nexport type DisposeTask<K, V> = [\n  value: V,\n  key: K,\n  reason: LRUCache.DisposeReason\n]\n\nexport namespace LRUCache {\n  /**\n   * An integer greater than 0, reflecting the calculated size of items\n   */\n  export type Size = number\n\n  /**\n   * Integer greater than 0, representing some number of milliseconds, or the\n   * time at which a TTL started counting from.\n   */\n  export type Milliseconds = number\n\n  /**\n   * An integer greater than 0, reflecting a number of items\n   */\n  export type Count = number\n\n  /**\n   * The reason why an item was removed from the cache, passed\n   * to the {@link Disposer} methods.\n   *\n   * - `evict`: The item was evicted because it is the least recently used,\n   *   and the cache is full.\n   * - `set`: A new value was set, overwriting the old value being disposed.\n   * - `delete`: The item was explicitly deleted, either by calling\n   *   {@link LRUCache#delete}, {@link LRUCache#clear}, or\n   *   {@link LRUCache#set} with an undefined value.\n   * - `expire`: The item was removed due to exceeding its TTL.\n   * - `fetch`: A {@link OptionsBase#fetchMethod} operation returned\n   *   `undefined` or was aborted, causing the item to be deleted.\n   */\n  export type DisposeReason =\n    | 'evict'\n    | 'set'\n    | 'delete'\n    | 'expire'\n    | 'fetch'\n  /**\n   * A method called upon item removal, passed as the\n   * {@link OptionsBase.dispose} and/or\n   * {@link OptionsBase.disposeAfter} options.\n   */\n  export type Disposer<K, V> = (\n    value: V,\n    key: K,\n    reason: DisposeReason\n  ) => void\n\n  /**\n   * A function that returns the effective calculated size\n   * of an entry in the cache.\n   */\n  export type SizeCalculator<K, V> = (value: V, key: K) => Size\n\n  /**\n   * Options provided to the\n   * {@link OptionsBase.fetchMethod} function.\n   */\n  export interface FetcherOptions<K, V, FC = unknown> {\n    signal: AbortSignal\n    options: FetcherFetchOptions<K, V, FC>\n    /**\n     * Object provided in the {@link FetchOptions.context} option to\n     * {@link LRUCache#fetch}\n     */\n    context: FC\n  }\n\n  /**\n   * Occasionally, it may be useful to track the internal behavior of the\n   * cache, particularly for logging, debugging, or for behavior within the\n   * `fetchMethod`. To do this, you can pass a `status` object to the\n   * {@link LRUCache#fetch}, {@link LRUCache#get}, {@link LRUCache#set},\n   * {@link LRUCache#memo}, and {@link LRUCache#has} methods.\n   *\n   * The `status` option should be a plain JavaScript object. The following\n   * fields will be set on it appropriately, depending on the situation.\n   */\n  export interface Status<V> {\n    /**\n     * The status of a set() operation.\n     *\n     * - add: the item was not found in the cache, and was added\n     * - update: the item was in the cache, with the same value provided\n     * - replace: the item was in the cache, and replaced\n     * - miss: the item was not added to the cache for some reason\n     */\n    set?: 'add' | 'update' | 'replace' | 'miss'\n\n    /**\n     * the ttl stored for the item, or undefined if ttls are not used.\n     */\n    ttl?: Milliseconds\n\n    /**\n     * the start time for the item, or undefined if ttls are not used.\n     */\n    start?: Milliseconds\n\n    /**\n     * The timestamp used for TTL calculation\n     */\n    now?: Milliseconds\n\n    /**\n     * the remaining ttl for the item, or undefined if ttls are not used.\n     */\n    remainingTTL?: Milliseconds\n\n    /**\n     * The calculated size for the item, if sizes are used.\n     */\n    entrySize?: Size\n\n    /**\n     * The total calculated size of the cache, if sizes are used.\n     */\n    totalCalculatedSize?: Size\n\n    /**\n     * A flag indicating that the item was not stored, due to exceeding the\n     * {@link OptionsBase.maxEntrySize}\n     */\n    maxEntrySizeExceeded?: true\n\n    /**\n     * The old value, specified in the case of `set:'update'` or\n     * `set:'replace'`\n     */\n    oldValue?: V\n\n    /**\n     * The results of a {@link LRUCache#has} operation\n     *\n     * - hit: the item was found in the cache\n     * - stale: the item was found in the cache, but is stale\n     * - miss: the item was not found in the cache\n     */\n    has?: 'hit' | 'stale' | 'miss'\n\n    /**\n     * The status of a {@link LRUCache#fetch} operation.\n     * Note that this can change as the underlying fetch() moves through\n     * various states.\n     *\n     * - inflight: there is another fetch() for this key which is in process\n     * - get: there is no {@link OptionsBase.fetchMethod}, so\n     *   {@link LRUCache#get} was called.\n     * - miss: the item is not in cache, and will be fetched.\n     * - hit: the item is in the cache, and was resolved immediately.\n     * - stale: the item is in the cache, but stale.\n     * - refresh: the item is in the cache, and not stale, but\n     *   {@link FetchOptions.forceRefresh} was specified.\n     */\n    fetch?: 'get' | 'inflight' | 'miss' | 'hit' | 'stale' | 'refresh'\n\n    /**\n     * The {@link OptionsBase.fetchMethod} was called\n     */\n    fetchDispatched?: true\n\n    /**\n     * The cached value was updated after a successful call to\n     * {@link OptionsBase.fetchMethod}\n     */\n    fetchUpdated?: true\n\n    /**\n     * The reason for a fetch() rejection.  Either the error raised by the\n     * {@link OptionsBase.fetchMethod}, or the reason for an\n     * AbortSignal.\n     */\n    fetchError?: Error\n\n    /**\n     * The fetch received an abort signal\n     */\n    fetchAborted?: true\n\n    /**\n     * The abort signal received was ignored, and the fetch was allowed to\n     * continue.\n     */\n    fetchAbortIgnored?: true\n\n    /**\n     * The fetchMethod promise resolved successfully\n     */\n    fetchResolved?: true\n\n    /**\n     * The fetchMethod promise was rejected\n     */\n    fetchRejected?: true\n\n    /**\n     * The status of a {@link LRUCache#get} operation.\n     *\n     * - fetching: The item is currently being fetched.  If a previous value\n     *   is present and allowed, that will be returned.\n     * - stale: The item is in the cache, and is stale.\n     * - hit: the item is in the cache\n     * - miss: the item is not in the cache\n     */\n    get?: 'stale' | 'hit' | 'miss'\n\n    /**\n     * A fetch or get operation returned a stale value.\n     */\n    returnedStale?: true\n  }\n\n  /**\n   * options which override the options set in the LRUCache constructor\n   * when calling {@link LRUCache#fetch}.\n   *\n   * This is the union of {@link GetOptions} and {@link SetOptions}, plus\n   * {@link OptionsBase.noDeleteOnFetchRejection},\n   * {@link OptionsBase.allowStaleOnFetchRejection},\n   * {@link FetchOptions.forceRefresh}, and\n   * {@link FetcherOptions.context}\n   *\n   * Any of these may be modified in the {@link OptionsBase.fetchMethod}\n   * function, but the {@link GetOptions} fields will of course have no\n   * effect, as the {@link LRUCache#get} call already happened by the time\n   * the fetchMethod is called.\n   */\n  export interface FetcherFetchOptions<K, V, FC = unknown>\n    extends Pick<\n      OptionsBase<K, V, FC>,\n      | 'allowStale'\n      | 'updateAgeOnGet'\n      | 'noDeleteOnStaleGet'\n      | 'sizeCalculation'\n      | 'ttl'\n      | 'noDisposeOnSet'\n      | 'noUpdateTTL'\n      | 'noDeleteOnFetchRejection'\n      | 'allowStaleOnFetchRejection'\n      | 'ignoreFetchAbort'\n      | 'allowStaleOnFetchAbort'\n    > {\n    status?: Status<V>\n    size?: Size\n  }\n\n  /**\n   * Options that may be passed to the {@link LRUCache#fetch} method.\n   */\n  export interface FetchOptions<K, V, FC>\n    extends FetcherFetchOptions<K, V, FC> {\n    /**\n     * Set to true to force a re-load of the existing data, even if it\n     * is not yet stale.\n     */\n    forceRefresh?: boolean\n    /**\n     * Context provided to the {@link OptionsBase.fetchMethod} as\n     * the {@link FetcherOptions.context} param.\n     *\n     * If the FC type is specified as unknown (the default),\n     * undefined or void, then this is optional.  Otherwise, it will\n     * be required.\n     */\n    context?: FC\n    signal?: AbortSignal\n    status?: Status<V>\n  }\n  /**\n   * Options provided to {@link LRUCache#fetch} when the FC type is something\n   * other than `unknown`, `undefined`, or `void`\n   */\n  export interface FetchOptionsWithContext<K, V, FC>\n    extends FetchOptions<K, V, FC> {\n    context: FC\n  }\n  /**\n   * Options provided to {@link LRUCache#fetch} when the FC type is\n   * `undefined` or `void`\n   */\n  export interface FetchOptionsNoContext<K, V>\n    extends FetchOptions<K, V, undefined> {\n    context?: undefined\n  }\n\n  export interface MemoOptions<K, V, FC = unknown>\n    extends Pick<\n      OptionsBase<K, V, FC>,\n      | 'allowStale'\n      | 'updateAgeOnGet'\n      | 'noDeleteOnStaleGet'\n      | 'sizeCalculation'\n      | 'ttl'\n      | 'noDisposeOnSet'\n      | 'noUpdateTTL'\n      | 'noDeleteOnFetchRejection'\n      | 'allowStaleOnFetchRejection'\n      | 'ignoreFetchAbort'\n      | 'allowStaleOnFetchAbort'\n    > {\n    /**\n     * Set to true to force a re-load of the existing data, even if it\n     * is not yet stale.\n     */\n    forceRefresh?: boolean\n    /**\n     * Context provided to the {@link OptionsBase.memoMethod} as\n     * the {@link MemoizerOptions.context} param.\n     *\n     * If the FC type is specified as unknown (the default),\n     * undefined or void, then this is optional.  Otherwise, it will\n     * be required.\n     */\n    context?: FC\n    status?: Status<V>\n  }\n  /**\n   * Options provided to {@link LRUCache#memo} when the FC type is something\n   * other than `unknown`, `undefined`, or `void`\n   */\n  export interface MemoOptionsWithContext<K, V, FC>\n    extends MemoOptions<K, V, FC> {\n    context: FC\n  }\n  /**\n   * Options provided to {@link LRUCache#memo} when the FC type is\n   * `undefined` or `void`\n   */\n  export interface MemoOptionsNoContext<K, V>\n    extends MemoOptions<K, V, undefined> {\n    context?: undefined\n  }\n\n  /**\n   * Options provided to the\n   * {@link OptionsBase.memoMethod} function.\n   */\n  export interface MemoizerOptions<K, V, FC = unknown> {\n    options: MemoizerMemoOptions<K, V, FC>\n    /**\n     * Object provided in the {@link MemoOptions.context} option to\n     * {@link LRUCache#memo}\n     */\n    context: FC\n  }\n\n  /**\n   * options which override the options set in the LRUCache constructor\n   * when calling {@link LRUCache#memo}.\n   *\n   * This is the union of {@link GetOptions} and {@link SetOptions}, plus\n   * {@link MemoOptions.forceRefresh}, and\n   * {@link MemoerOptions.context}\n   *\n   * Any of these may be modified in the {@link OptionsBase.memoMethod}\n   * function, but the {@link GetOptions} fields will of course have no\n   * effect, as the {@link LRUCache#get} call already happened by the time\n   * the memoMethod is called.\n   */\n  export interface MemoizerMemoOptions<K, V, FC = unknown>\n    extends Pick<\n      OptionsBase<K, V, FC>,\n      | 'allowStale'\n      | 'updateAgeOnGet'\n      | 'noDeleteOnStaleGet'\n      | 'sizeCalculation'\n      | 'ttl'\n      | 'noDisposeOnSet'\n      | 'noUpdateTTL'\n    > {\n    status?: Status<V>\n    size?: Size\n    start?: Milliseconds\n  }\n\n  /**\n   * Options that may be passed to the {@link LRUCache#has} method.\n   */\n  export interface HasOptions<K, V, FC>\n    extends Pick<OptionsBase<K, V, FC>, 'updateAgeOnHas'> {\n    status?: Status<V>\n  }\n\n  /**\n   * Options that may be passed to the {@link LRUCache#get} method.\n   */\n  export interface GetOptions<K, V, FC>\n    extends Pick<\n      OptionsBase<K, V, FC>,\n      'allowStale' | 'updateAgeOnGet' | 'noDeleteOnStaleGet'\n    > {\n    status?: Status<V>\n  }\n\n  /**\n   * Options that may be passed to the {@link LRUCache#peek} method.\n   */\n  export interface PeekOptions<K, V, FC>\n    extends Pick<OptionsBase<K, V, FC>, 'allowStale'> {}\n\n  /**\n   * Options that may be passed to the {@link LRUCache#set} method.\n   */\n  export interface SetOptions<K, V, FC>\n    extends Pick<\n      OptionsBase<K, V, FC>,\n      'sizeCalculation' | 'ttl' | 'noDisposeOnSet' | 'noUpdateTTL'\n    > {\n    /**\n     * If size tracking is enabled, then setting an explicit size\n     * in the {@link LRUCache#set} call will prevent calling the\n     * {@link OptionsBase.sizeCalculation} function.\n     */\n    size?: Size\n    /**\n     * If TTL tracking is enabled, then setting an explicit start\n     * time in the {@link LRUCache#set} call will override the\n     * default time from `performance.now()` or `Date.now()`.\n     *\n     * Note that it must be a valid value for whichever time-tracking\n     * method is in use.\n     */\n    start?: Milliseconds\n    status?: Status<V>\n  }\n\n  /**\n   * The type signature for the {@link OptionsBase.fetchMethod} option.\n   */\n  export type Fetcher<K, V, FC = unknown> = (\n    key: K,\n    staleValue: V | undefined,\n    options: FetcherOptions<K, V, FC>\n  ) => Promise<V | undefined | void> | V | undefined | void\n\n  /**\n   * the type signature for the {@link OptionsBase.memoMethod} option.\n   */\n  export type Memoizer<K, V, FC = unknown> = (\n    key: K,\n    staleValue: V | undefined,\n    options: MemoizerOptions<K, V, FC>\n  ) => V\n\n  /**\n   * Options which may be passed to the {@link LRUCache} constructor.\n   *\n   * Most of these may be overridden in the various options that use\n   * them.\n   *\n   * Despite all being technically optional, the constructor requires that\n   * a cache is at minimum limited by one or more of {@link OptionsBase.max},\n   * {@link OptionsBase.ttl}, or {@link OptionsBase.maxSize}.\n   *\n   * If {@link OptionsBase.ttl} is used alone, then it is strongly advised\n   * (and in fact required by the type definitions here) that the cache\n   * also set {@link OptionsBase.ttlAutopurge}, to prevent potentially\n   * unbounded storage.\n   *\n   * All options are also available on the {@link LRUCache} instance, making\n   * it safe to pass an LRUCache instance as the options argumemnt to\n   * make another empty cache of the same type.\n   *\n   * Some options are marked as read-only, because changing them after\n   * instantiation is not safe. Changing any of the other options will of\n   * course only have an effect on subsequent method calls.\n   */\n  export interface OptionsBase<K, V, FC> {\n    /**\n     * The maximum number of items to store in the cache before evicting\n     * old entries. This is read-only on the {@link LRUCache} instance,\n     * and may not be overridden.\n     *\n     * If set, then storage space will be pre-allocated at construction\n     * time, and the cache will perform significantly faster.\n     *\n     * Note that significantly fewer items may be stored, if\n     * {@link OptionsBase.maxSize} and/or {@link OptionsBase.ttl} are also\n     * set.\n     *\n     * **It is strongly recommended to set a `max` to prevent unbounded growth\n     * of the cache.**\n     */\n    max?: Count\n\n    /**\n     * Max time in milliseconds for items to live in cache before they are\n     * considered stale.  Note that stale items are NOT preemptively removed by\n     * default, and MAY live in the cache, contributing to its LRU max, long\n     * after they have expired, unless {@link OptionsBase.ttlAutopurge} is\n     * set.\n     *\n     * If set to `0` (the default value), then that means \"do not track\n     * TTL\", not \"expire immediately\".\n     *\n     * Also, as this cache is optimized for LRU/MRU operations, some of\n     * the staleness/TTL checks will reduce performance, as they will incur\n     * overhead by deleting items.\n     *\n     * This is not primarily a TTL cache, and does not make strong TTL\n     * guarantees. There is no pre-emptive pruning of expired items, but you\n     * _may_ set a TTL on the cache, and it will treat expired items as missing\n     * when they are fetched, and delete them.\n     *\n     * Optional, but must be a non-negative integer in ms if specified.\n     *\n     * This may be overridden by passing an options object to `cache.set()`.\n     *\n     * At least one of `max`, `maxSize`, or `TTL` is required. This must be a\n     * positive integer if set.\n     *\n     * Even if ttl tracking is enabled, **it is strongly recommended to set a\n     * `max` to prevent unbounded growth of the cache.**\n     *\n     * If ttl tracking is enabled, and `max` and `maxSize` are not set,\n     * and `ttlAutopurge` is not set, then a warning will be emitted\n     * cautioning about the potential for unbounded memory consumption.\n     * (The TypeScript definitions will also discourage this.)\n     */\n    ttl?: Milliseconds\n\n    /**\n     * Minimum amount of time in ms in which to check for staleness.\n     * Defaults to 1, which means that the current time is checked\n     * at most once per millisecond.\n     *\n     * Set to 0 to check the current time every time staleness is tested.\n     * (This reduces performance, and is theoretically unnecessary.)\n     *\n     * Setting this to a higher value will improve performance somewhat\n     * while using ttl tracking, albeit at the expense of keeping stale\n     * items around a bit longer than their TTLs would indicate.\n     *\n     * @default 1\n     */\n    ttlResolution?: Milliseconds\n\n    /**\n     * Preemptively remove stale items from the cache.\n     *\n     * Note that this may *significantly* degrade performance, especially if\n     * the cache is storing a large number of items. It is almost always best\n     * to just leave the stale items in the cache, and let them fall out as new\n     * items are added.\n     *\n     * Note that this means that {@link OptionsBase.allowStale} is a bit\n     * pointless, as stale items will be deleted almost as soon as they\n     * expire.\n     *\n     * Use with caution!\n     */\n    ttlAutopurge?: boolean\n\n    /**\n     * When using time-expiring entries with `ttl`, setting this to `true` will\n     * make each item's age reset to 0 whenever it is retrieved from cache with\n     * {@link LRUCache#get}, causing it to not expire. (It can still fall out\n     * of cache based on recency of use, of course.)\n     *\n     * Has no effect if {@link OptionsBase.ttl} is not set.\n     *\n     * This may be overridden by passing an options object to `cache.get()`.\n     */\n    updateAgeOnGet?: boolean\n\n    /**\n     * When using time-expiring entries with `ttl`, setting this to `true` will\n     * make each item's age reset to 0 whenever its presence in the cache is\n     * checked with {@link LRUCache#has}, causing it to not expire. (It can\n     * still fall out of cache based on recency of use, of course.)\n     *\n     * Has no effect if {@link OptionsBase.ttl} is not set.\n     */\n    updateAgeOnHas?: boolean\n\n    /**\n     * Allow {@link LRUCache#get} and {@link LRUCache#fetch} calls to return\n     * stale data, if available.\n     *\n     * By default, if you set `ttl`, stale items will only be deleted from the\n     * cache when you `get(key)`. That is, it's not preemptively pruning items,\n     * unless {@link OptionsBase.ttlAutopurge} is set.\n     *\n     * If you set `allowStale:true`, it'll return the stale value *as well as*\n     * deleting it. If you don't set this, then it'll return `undefined` when\n     * you try to get a stale entry.\n     *\n     * Note that when a stale entry is fetched, _even if it is returned due to\n     * `allowStale` being set_, it is removed from the cache immediately. You\n     * can suppress this behavior by setting\n     * {@link OptionsBase.noDeleteOnStaleGet}, either in the constructor, or in\n     * the options provided to {@link LRUCache#get}.\n     *\n     * This may be overridden by passing an options object to `cache.get()`.\n     * The `cache.has()` method will always return `false` for stale items.\n     *\n     * Only relevant if a ttl is set.\n     */\n    allowStale?: boolean\n\n    /**\n     * Function that is called on items when they are dropped from the\n     * cache, as `dispose(value, key, reason)`.\n     *\n     * This can be handy if you want to close file descriptors or do\n     * other cleanup tasks when items are no longer stored in the cache.\n     *\n     * **NOTE**: It is called _before_ the item has been fully removed\n     * from the cache, so if you want to put it right back in, you need\n     * to wait until the next tick. If you try to add it back in during\n     * the `dispose()` function call, it will break things in subtle and\n     * weird ways.\n     *\n     * Unlike several other options, this may _not_ be overridden by\n     * passing an option to `set()`, for performance reasons.\n     *\n     * The `reason` will be one of the following strings, corresponding\n     * to the reason for the item's deletion:\n     *\n     * - `evict` Item was evicted to make space for a new addition\n     * - `set` Item was overwritten by a new value\n     * - `expire` Item expired its TTL\n     * - `fetch` Item was deleted due to a failed or aborted fetch, or a\n     *   fetchMethod returning `undefined.\n     * - `delete` Item was removed by explicit `cache.delete(key)`,\n     *   `cache.clear()`, or `cache.set(key, undefined)`.\n     */\n    dispose?: Disposer<K, V>\n\n    /**\n     * The same as {@link OptionsBase.dispose}, but called *after* the entry\n     * is completely removed and the cache is once again in a clean state.\n     *\n     * It is safe to add an item right back into the cache at this point.\n     * However, note that it is *very* easy to inadvertently create infinite\n     * recursion this way.\n     */\n    disposeAfter?: Disposer<K, V>\n\n    /**\n     * Set to true to suppress calling the\n     * {@link OptionsBase.dispose} function if the entry key is\n     * still accessible within the cache.\n     *\n     * This may be overridden by passing an options object to\n     * {@link LRUCache#set}.\n     *\n     * Only relevant if `dispose` or `disposeAfter` are set.\n     */\n    noDisposeOnSet?: boolean\n\n    /**\n     * Boolean flag to tell the cache to not update the TTL when setting a new\n     * value for an existing key (ie, when updating a value rather than\n     * inserting a new value).  Note that the TTL value is _always_ set (if\n     * provided) when adding a new entry into the cache.\n     *\n     * Has no effect if a {@link OptionsBase.ttl} is not set.\n     *\n     * May be passed as an option to {@link LRUCache#set}.\n     */\n    noUpdateTTL?: boolean\n\n    /**\n     * Set to a positive integer to track the sizes of items added to the\n     * cache, and automatically evict items in order to stay below this size.\n     * Note that this may result in fewer than `max` items being stored.\n     *\n     * Attempting to add an item to the cache whose calculated size is greater\n     * that this amount will be a no-op. The item will not be cached, and no\n     * other items will be evicted.\n     *\n     * Optional, must be a positive integer if provided.\n     *\n     * Sets `maxEntrySize` to the same value, unless a different value is\n     * provided for `maxEntrySize`.\n     *\n     * At least one of `max`, `maxSize`, or `TTL` is required. This must be a\n     * positive integer if set.\n     *\n     * Even if size tracking is enabled, **it is strongly recommended to set a\n     * `max` to prevent unbounded growth of the cache.**\n     *\n     * Note also that size tracking can negatively impact performance,\n     * though for most cases, only minimally.\n     */\n    maxSize?: Size\n\n    /**\n     * The maximum allowed size for any single item in the cache.\n     *\n     * If a larger item is passed to {@link LRUCache#set} or returned by a\n     * {@link OptionsBase.fetchMethod} or {@link OptionsBase.memoMethod}, then\n     * it will not be stored in the cache.\n     *\n     * Attempting to add an item whose calculated size is greater than\n     * this amount will not cache the item or evict any old items, but\n     * WILL delete an existing value if one is already present.\n     *\n     * Optional, must be a positive integer if provided. Defaults to\n     * the value of `maxSize` if provided.\n     */\n    maxEntrySize?: Size\n\n    /**\n     * A function that returns a number indicating the item's size.\n     *\n     * Requires {@link OptionsBase.maxSize} to be set.\n     *\n     * If not provided, and {@link OptionsBase.maxSize} or\n     * {@link OptionsBase.maxEntrySize} are set, then all\n     * {@link LRUCache#set} calls **must** provide an explicit\n     * {@link SetOptions.size} or sizeCalculation param.\n     */\n    sizeCalculation?: SizeCalculator<K, V>\n\n    /**\n     * Method that provides the implementation for {@link LRUCache#fetch}\n     *\n     * ```ts\n     * fetchMethod(key, staleValue, { signal, options, context })\n     * ```\n     *\n     * If `fetchMethod` is not provided, then `cache.fetch(key)` is equivalent\n     * to `Promise.resolve(cache.get(key))`.\n     *\n     * If at any time, `signal.aborted` is set to `true`, or if the\n     * `signal.onabort` method is called, or if it emits an `'abort'` event\n     * which you can listen to with `addEventListener`, then that means that\n     * the fetch should be abandoned. This may be passed along to async\n     * functions aware of AbortController/AbortSignal behavior.\n     *\n     * The `fetchMethod` should **only** return `undefined` or a Promise\n     * resolving to `undefined` if the AbortController signaled an `abort`\n     * event. In all other cases, it should return or resolve to a value\n     * suitable for adding to the cache.\n     *\n     * The `options` object is a union of the options that may be provided to\n     * `set()` and `get()`. If they are modified, then that will result in\n     * modifying the settings to `cache.set()` when the value is resolved, and\n     * in the case of\n     * {@link OptionsBase.noDeleteOnFetchRejection} and\n     * {@link OptionsBase.allowStaleOnFetchRejection}, the handling of\n     * `fetchMethod` failures.\n     *\n     * For example, a DNS cache may update the TTL based on the value returned\n     * from a remote DNS server by changing `options.ttl` in the `fetchMethod`.\n     */\n    fetchMethod?: Fetcher<K, V, FC>\n\n    /**\n     * Method that provides the implementation for {@link LRUCache#memo}\n     */\n    memoMethod?: Memoizer<K, V, FC>\n\n    /**\n     * Set to true to suppress the deletion of stale data when a\n     * {@link OptionsBase.fetchMethod} returns a rejected promise.\n     */\n    noDeleteOnFetchRejection?: boolean\n\n    /**\n     * Do not delete stale items when they are retrieved with\n     * {@link LRUCache#get}.\n     *\n     * Note that the `get` return value will still be `undefined`\n     * unless {@link OptionsBase.allowStale} is true.\n     *\n     * When using time-expiring entries with `ttl`, by default stale\n     * items will be removed from the cache when the key is accessed\n     * with `cache.get()`.\n     *\n     * Setting this option will cause stale items to remain in the cache, until\n     * they are explicitly deleted with `cache.delete(key)`, or retrieved with\n     * `noDeleteOnStaleGet` set to `false`.\n     *\n     * This may be overridden by passing an options object to `cache.get()`.\n     *\n     * Only relevant if a ttl is used.\n     */\n    noDeleteOnStaleGet?: boolean\n\n    /**\n     * Set to true to allow returning stale data when a\n     * {@link OptionsBase.fetchMethod} throws an error or returns a rejected\n     * promise.\n     *\n     * This differs from using {@link OptionsBase.allowStale} in that stale\n     * data will ONLY be returned in the case that the {@link LRUCache#fetch}\n     * fails, not any other times.\n     *\n     * If a `fetchMethod` fails, and there is no stale value available, the\n     * `fetch()` will resolve to `undefined`. Ie, all `fetchMethod` errors are\n     * suppressed.\n     *\n     * Implies `noDeleteOnFetchRejection`.\n     *\n     * This may be set in calls to `fetch()`, or defaulted on the constructor,\n     * or overridden by modifying the options object in the `fetchMethod`.\n     */\n    allowStaleOnFetchRejection?: boolean\n\n    /**\n     * Set to true to return a stale value from the cache when the\n     * `AbortSignal` passed to the {@link OptionsBase.fetchMethod} dispatches\n     * an `'abort'` event, whether user-triggered, or due to internal cache\n     * behavior.\n     *\n     * Unless {@link OptionsBase.ignoreFetchAbort} is also set, the underlying\n     * {@link OptionsBase.fetchMethod} will still be considered canceled, and\n     * any value it returns will be ignored and not cached.\n     *\n     * Caveat: since fetches are aborted when a new value is explicitly\n     * set in the cache, this can lead to fetch returning a stale value,\n     * since that was the fallback value _at the moment the `fetch()` was\n     * initiated_, even though the new updated value is now present in\n     * the cache.\n     *\n     * For example:\n     *\n     * ```ts\n     * const cache = new LRUCache<string, any>({\n     *   ttl: 100,\n     *   fetchMethod: async (url, oldValue, { signal }) =>  {\n     *     const res = await fetch(url, { signal })\n     *     return await res.json()\n     *   }\n     * })\n     * cache.set('https://example.com/', { some: 'data' })\n     * // 100ms go by...\n     * const result = cache.fetch('https://example.com/')\n     * cache.set('https://example.com/', { other: 'thing' })\n     * console.log(await result) // { some: 'data' }\n     * console.log(cache.get('https://example.com/')) // { other: 'thing' }\n     * ```\n     */\n    allowStaleOnFetchAbort?: boolean\n\n    /**\n     * Set to true to ignore the `abort` event emitted by the `AbortSignal`\n     * object passed to {@link OptionsBase.fetchMethod}, and still cache the\n     * resulting resolution value, as long as it is not `undefined`.\n     *\n     * When used on its own, this means aborted {@link LRUCache#fetch} calls\n     * are not immediately resolved or rejected when they are aborted, and\n     * instead take the full time to await.\n     *\n     * When used with {@link OptionsBase.allowStaleOnFetchAbort}, aborted\n     * {@link LRUCache#fetch} calls will resolve immediately to their stale\n     * cached value or `undefined`, and will continue to process and eventually\n     * update the cache when they resolve, as long as the resulting value is\n     * not `undefined`, thus supporting a \"return stale on timeout while\n     * refreshing\" mechanism by passing `AbortSignal.timeout(n)` as the signal.\n     *\n     * For example:\n     *\n     * ```ts\n     * const c = new LRUCache({\n     *   ttl: 100,\n     *   ignoreFetchAbort: true,\n     *   allowStaleOnFetchAbort: true,\n     *   fetchMethod: async (key, oldValue, { signal }) => {\n     *     // note: do NOT pass the signal to fetch()!\n     *     // let's say this fetch can take a long time.\n     *     const res = await fetch(`https://slow-backend-server/${key}`)\n     *     return await res.json()\n     *   },\n     * })\n     *\n     * // this will return the stale value after 100ms, while still\n     * // updating in the background for next time.\n     * const val = await c.fetch('key', { signal: AbortSignal.timeout(100) })\n     * ```\n     *\n     * **Note**: regardless of this setting, an `abort` event _is still\n     * emitted on the `AbortSignal` object_, so may result in invalid results\n     * when passed to other underlying APIs that use AbortSignals.\n     *\n     * This may be overridden in the {@link OptionsBase.fetchMethod} or the\n     * call to {@link LRUCache#fetch}.\n     */\n    ignoreFetchAbort?: boolean\n  }\n\n  export interface OptionsMaxLimit<K, V, FC>\n    extends OptionsBase<K, V, FC> {\n    max: Count\n  }\n  export interface OptionsTTLLimit<K, V, FC>\n    extends OptionsBase<K, V, FC> {\n    ttl: Milliseconds\n    ttlAutopurge: boolean\n  }\n  export interface OptionsSizeLimit<K, V, FC>\n    extends OptionsBase<K, V, FC> {\n    maxSize: Size\n  }\n\n  /**\n   * The valid safe options for the {@link LRUCache} constructor\n   */\n  export type Options<K, V, FC> =\n    | OptionsMaxLimit<K, V, FC>\n    | OptionsSizeLimit<K, V, FC>\n    | OptionsTTLLimit<K, V, FC>\n\n  /**\n   * Entry objects used by {@link LRUCache#load} and {@link LRUCache#dump},\n   * and returned by {@link LRUCache#info}.\n   */\n  export interface Entry<V> {\n    value: V\n    ttl?: Milliseconds\n    size?: Size\n    start?: Milliseconds\n  }\n}\n\n/**\n * Default export, the thing you're using this module to get.\n *\n * The `K` and `V` types define the key and value types, respectively. The\n * optional `FC` type defines the type of the `context` object passed to\n * `cache.fetch()` and `cache.memo()`.\n *\n * Keys and values **must not** be `null` or `undefined`.\n *\n * All properties from the options object (with the exception of `max`,\n * `maxSize`, `fetchMethod`, `memoMethod`, `dispose` and `disposeAfter`) are\n * added as normal public members. (The listed options are read-only getters.)\n *\n * Changing any of these will alter the defaults for subsequent method calls.\n */\nexport class LRUCache<K extends {}, V extends {}, FC = unknown>\n  implements Map<K, V>\n{\n  // options that cannot be changed without disaster\n  readonly #max: LRUCache.Count\n  readonly #maxSize: LRUCache.Size\n  readonly #dispose?: LRUCache.Disposer<K, V>\n  readonly #disposeAfter?: LRUCache.Disposer<K, V>\n  readonly #fetchMethod?: LRUCache.Fetcher<K, V, FC>\n  readonly #memoMethod?: LRUCache.Memoizer<K, V, FC>\n\n  /**\n   * {@link LRUCache.OptionsBase.ttl}\n   */\n  ttl: LRUCache.Milliseconds\n\n  /**\n   * {@link LRUCache.OptionsBase.ttlResolution}\n   */\n  ttlResolution: LRUCache.Milliseconds\n  /**\n   * {@link LRUCache.OptionsBase.ttlAutopurge}\n   */\n  ttlAutopurge: boolean\n  /**\n   * {@link LRUCache.OptionsBase.updateAgeOnGet}\n   */\n  updateAgeOnGet: boolean\n  /**\n   * {@link LRUCache.OptionsBase.updateAgeOnHas}\n   */\n  updateAgeOnHas: boolean\n  /**\n   * {@link LRUCache.OptionsBase.allowStale}\n   */\n  allowStale: boolean\n\n  /**\n   * {@link LRUCache.OptionsBase.noDisposeOnSet}\n   */\n  noDisposeOnSet: boolean\n  /**\n   * {@link LRUCache.OptionsBase.noUpdateTTL}\n   */\n  noUpdateTTL: boolean\n  /**\n   * {@link LRUCache.OptionsBase.maxEntrySize}\n   */\n  maxEntrySize: LRUCache.Size\n  /**\n   * {@link LRUCache.OptionsBase.sizeCalculation}\n   */\n  sizeCalculation?: LRUCache.SizeCalculator<K, V>\n  /**\n   * {@link LRUCache.OptionsBase.noDeleteOnFetchRejection}\n   */\n  noDeleteOnFetchRejection: boolean\n  /**\n   * {@link LRUCache.OptionsBase.noDeleteOnStaleGet}\n   */\n  noDeleteOnStaleGet: boolean\n  /**\n   * {@link LRUCache.OptionsBase.allowStaleOnFetchAbort}\n   */\n  allowStaleOnFetchAbort: boolean\n  /**\n   * {@link LRUCache.OptionsBase.allowStaleOnFetchRejection}\n   */\n  allowStaleOnFetchRejection: boolean\n  /**\n   * {@link LRUCache.OptionsBase.ignoreFetchAbort}\n   */\n  ignoreFetchAbort: boolean\n\n  // computed properties\n  #size: LRUCache.Count\n  #calculatedSize: LRUCache.Size\n  #keyMap: Map<K, Index>\n  #keyList: (K | undefined)[]\n  #valList: (V | BackgroundFetch<V> | undefined)[]\n  #next: NumberArray\n  #prev: NumberArray\n  #head: Index\n  #tail: Index\n  #free: StackLike\n  #disposed?: DisposeTask<K, V>[]\n  #sizes?: ZeroArray\n  #starts?: ZeroArray\n  #ttls?: ZeroArray\n\n  #hasDispose: boolean\n  #hasFetchMethod: boolean\n  #hasDisposeAfter: boolean\n\n  /**\n   * Do not call this method unless you need to inspect the\n   * inner workings of the cache.  If anything returned by this\n   * object is modified in any way, strange breakage may occur.\n   *\n   * These fields are private for a reason!\n   *\n   * @internal\n   */\n  static unsafeExposeInternals<\n    K extends {},\n    V extends {},\n    FC extends unknown = unknown\n  >(c: LRUCache<K, V, FC>) {\n    return {\n      // properties\n      starts: c.#starts,\n      ttls: c.#ttls,\n      sizes: c.#sizes,\n      keyMap: c.#keyMap as Map<K, number>,\n      keyList: c.#keyList,\n      valList: c.#valList,\n      next: c.#next,\n      prev: c.#prev,\n      get head() {\n        return c.#head\n      },\n      get tail() {\n        return c.#tail\n      },\n      free: c.#free,\n      // methods\n      isBackgroundFetch: (p: any) => c.#isBackgroundFetch(p),\n      backgroundFetch: (\n        k: K,\n        index: number | undefined,\n        options: LRUCache.FetchOptions<K, V, FC>,\n        context: any\n      ): BackgroundFetch<V> =>\n        c.#backgroundFetch(\n          k,\n          index as Index | undefined,\n          options,\n          context\n        ),\n      moveToTail: (index: number): void =>\n        c.#moveToTail(index as Index),\n      indexes: (options?: { allowStale: boolean }) =>\n        c.#indexes(options),\n      rindexes: (options?: { allowStale: boolean }) =>\n        c.#rindexes(options),\n      isStale: (index: number | undefined) =>\n        c.#isStale(index as Index),\n    }\n  }\n\n  // Protected read-only members\n\n  /**\n   * {@link LRUCache.OptionsBase.max} (read-only)\n   */\n  get max(): LRUCache.Count {\n    return this.#max\n  }\n  /**\n   * {@link LRUCache.OptionsBase.maxSize} (read-only)\n   */\n  get maxSize(): LRUCache.Count {\n    return this.#maxSize\n  }\n  /**\n   * The total computed size of items in the cache (read-only)\n   */\n  get calculatedSize(): LRUCache.Size {\n    return this.#calculatedSize\n  }\n  /**\n   * The number of items stored in the cache (read-only)\n   */\n  get size(): LRUCache.Count {\n    return this.#size\n  }\n  /**\n   * {@link LRUCache.OptionsBase.fetchMethod} (read-only)\n   */\n  get fetchMethod(): LRUCache.Fetcher<K, V, FC> | undefined {\n    return this.#fetchMethod\n  }\n  get memoMethod(): LRUCache.Memoizer<K, V, FC> | undefined {\n    return this.#memoMethod\n  }\n  /**\n   * {@link LRUCache.OptionsBase.dispose} (read-only)\n   */\n  get dispose() {\n    return this.#dispose\n  }\n  /**\n   * {@link LRUCache.OptionsBase.disposeAfter} (read-only)\n   */\n  get disposeAfter() {\n    return this.#disposeAfter\n  }\n\n  constructor(\n    options: LRUCache.Options<K, V, FC> | LRUCache<K, V, FC>\n  ) {\n    const {\n      max = 0,\n      ttl,\n      ttlResolution = 1,\n      ttlAutopurge,\n      updateAgeOnGet,\n      updateAgeOnHas,\n      allowStale,\n      dispose,\n      disposeAfter,\n      noDisposeOnSet,\n      noUpdateTTL,\n      maxSize = 0,\n      maxEntrySize = 0,\n      sizeCalculation,\n      fetchMethod,\n      memoMethod,\n      noDeleteOnFetchRejection,\n      noDeleteOnStaleGet,\n      allowStaleOnFetchRejection,\n      allowStaleOnFetchAbort,\n      ignoreFetchAbort,\n    } = options\n\n    if (max !== 0 && !isPosInt(max)) {\n      throw new TypeError('max option must be a nonnegative integer')\n    }\n\n    const UintArray = max ? getUintArray(max) : Array\n    if (!UintArray) {\n      throw new Error('invalid max value: ' + max)\n    }\n\n    this.#max = max\n    this.#maxSize = maxSize\n    this.maxEntrySize = maxEntrySize || this.#maxSize\n    this.sizeCalculation = sizeCalculation\n    if (this.sizeCalculation) {\n      if (!this.#maxSize && !this.maxEntrySize) {\n        throw new TypeError(\n          'cannot set sizeCalculation without setting maxSize or maxEntrySize'\n        )\n      }\n      if (typeof this.sizeCalculation !== 'function') {\n        throw new TypeError('sizeCalculation set to non-function')\n      }\n    }\n\n    if (\n      memoMethod !== undefined &&\n      typeof memoMethod !== 'function'\n    ) {\n      throw new TypeError('memoMethod must be a function if defined')\n    }\n    this.#memoMethod = memoMethod\n\n    if (\n      fetchMethod !== undefined &&\n      typeof fetchMethod !== 'function'\n    ) {\n      throw new TypeError(\n        'fetchMethod must be a function if specified'\n      )\n    }\n    this.#fetchMethod = fetchMethod\n    this.#hasFetchMethod = !!fetchMethod\n\n    this.#keyMap = new Map()\n    this.#keyList = new Array(max).fill(undefined)\n    this.#valList = new Array(max).fill(undefined)\n    this.#next = new UintArray(max)\n    this.#prev = new UintArray(max)\n    this.#head = 0 as Index\n    this.#tail = 0 as Index\n    this.#free = Stack.create(max)\n    this.#size = 0\n    this.#calculatedSize = 0\n\n    if (typeof dispose === 'function') {\n      this.#dispose = dispose\n    }\n    if (typeof disposeAfter === 'function') {\n      this.#disposeAfter = disposeAfter\n      this.#disposed = []\n    } else {\n      this.#disposeAfter = undefined\n      this.#disposed = undefined\n    }\n    this.#hasDispose = !!this.#dispose\n    this.#hasDisposeAfter = !!this.#disposeAfter\n\n    this.noDisposeOnSet = !!noDisposeOnSet\n    this.noUpdateTTL = !!noUpdateTTL\n    this.noDeleteOnFetchRejection = !!noDeleteOnFetchRejection\n    this.allowStaleOnFetchRejection = !!allowStaleOnFetchRejection\n    this.allowStaleOnFetchAbort = !!allowStaleOnFetchAbort\n    this.ignoreFetchAbort = !!ignoreFetchAbort\n\n    // NB: maxEntrySize is set to maxSize if it's set\n    if (this.maxEntrySize !== 0) {\n      if (this.#maxSize !== 0) {\n        if (!isPosInt(this.#maxSize)) {\n          throw new TypeError(\n            'maxSize must be a positive integer if specified'\n          )\n        }\n      }\n      if (!isPosInt(this.maxEntrySize)) {\n        throw new TypeError(\n          'maxEntrySize must be a positive integer if specified'\n        )\n      }\n      this.#initializeSizeTracking()\n    }\n\n    this.allowStale = !!allowStale\n    this.noDeleteOnStaleGet = !!noDeleteOnStaleGet\n    this.updateAgeOnGet = !!updateAgeOnGet\n    this.updateAgeOnHas = !!updateAgeOnHas\n    this.ttlResolution =\n      isPosInt(ttlResolution) || ttlResolution === 0\n        ? ttlResolution\n        : 1\n    this.ttlAutopurge = !!ttlAutopurge\n    this.ttl = ttl || 0\n    if (this.ttl) {\n      if (!isPosInt(this.ttl)) {\n        throw new TypeError(\n          'ttl must be a positive integer if specified'\n        )\n      }\n      this.#initializeTTLTracking()\n    }\n\n    // do not allow completely unbounded caches\n    if (this.#max === 0 && this.ttl === 0 && this.#maxSize === 0) {\n      throw new TypeError(\n        'At least one of max, maxSize, or ttl is required'\n      )\n    }\n    if (!this.ttlAutopurge && !this.#max && !this.#maxSize) {\n      const code = 'LRU_CACHE_UNBOUNDED'\n      if (shouldWarn(code)) {\n        warned.add(code)\n        const msg =\n          'TTL caching without ttlAutopurge, max, or maxSize can ' +\n          'result in unbounded memory consumption.'\n        emitWarning(msg, 'UnboundedCacheWarning', code, LRUCache)\n      }\n    }\n  }\n\n  /**\n   * Return the number of ms left in the item's TTL. If item is not in cache,\n   * returns `0`. Returns `Infinity` if item is in cache without a defined TTL.\n   */\n  getRemainingTTL(key: K) {\n    return this.#keyMap.has(key) ? Infinity : 0\n  }\n\n  #initializeTTLTracking() {\n    const ttls = new ZeroArray(this.#max)\n    const starts = new ZeroArray(this.#max)\n    this.#ttls = ttls\n    this.#starts = starts\n\n    this.#setItemTTL = (index, ttl, start = perf.now()) => {\n      starts[index] = ttl !== 0 ? start : 0\n      ttls[index] = ttl\n      if (ttl !== 0 && this.ttlAutopurge) {\n        const t = setTimeout(() => {\n          if (this.#isStale(index)) {\n            this.#delete(this.#keyList[index] as K, 'expire')\n          }\n        }, ttl + 1)\n        // unref() not supported on all platforms\n        /* c8 ignore start */\n        if (t.unref) {\n          t.unref()\n        }\n        /* c8 ignore stop */\n      }\n    }\n\n    this.#updateItemAge = index => {\n      starts[index] = ttls[index] !== 0 ? perf.now() : 0\n    }\n\n    this.#statusTTL = (status, index) => {\n      if (ttls[index]) {\n        const ttl = ttls[index]\n        const start = starts[index]\n        /* c8 ignore next */\n        if (!ttl || !start) return\n        status.ttl = ttl\n        status.start = start\n        status.now = cachedNow || getNow()\n        const age = status.now - start\n        status.remainingTTL = ttl - age\n      }\n    }\n\n    // debounce calls to perf.now() to 1s so we're not hitting\n    // that costly call repeatedly.\n    let cachedNow = 0\n    const getNow = () => {\n      const n = perf.now()\n      if (this.ttlResolution > 0) {\n        cachedNow = n\n        const t = setTimeout(\n          () => (cachedNow = 0),\n          this.ttlResolution\n        )\n        // not available on all platforms\n        /* c8 ignore start */\n        if (t.unref) {\n          t.unref()\n        }\n        /* c8 ignore stop */\n      }\n      return n\n    }\n\n    this.getRemainingTTL = key => {\n      const index = this.#keyMap.get(key)\n      if (index === undefined) {\n        return 0\n      }\n      const ttl = ttls[index]\n      const start = starts[index]\n      if (!ttl || !start) {\n        return Infinity\n      }\n      const age = (cachedNow || getNow()) - start\n      return ttl - age\n    }\n\n    this.#isStale = index => {\n      const s = starts[index]\n      const t = ttls[index]\n      return !!t && !!s && (cachedNow || getNow()) - s > t\n    }\n  }\n\n  // conditionally set private methods related to TTL\n  #updateItemAge: (index: Index) => void = () => {}\n  #statusTTL: (status: LRUCache.Status<V>, index: Index) => void =\n    () => {}\n  #setItemTTL: (\n    index: Index,\n    ttl: LRUCache.Milliseconds,\n    start?: LRUCache.Milliseconds\n    // ignore because we never call this if we're not already in TTL mode\n    /* c8 ignore start */\n  ) => void = () => {}\n  /* c8 ignore stop */\n\n  #isStale: (index: Index) => boolean = () => false\n\n  #initializeSizeTracking() {\n    const sizes = new ZeroArray(this.#max)\n    this.#calculatedSize = 0\n    this.#sizes = sizes\n    this.#removeItemSize = index => {\n      this.#calculatedSize -= sizes[index] as number\n      sizes[index] = 0\n    }\n    this.#requireSize = (k, v, size, sizeCalculation) => {\n      // provisionally accept background fetches.\n      // actual value size will be checked when they return.\n      if (this.#isBackgroundFetch(v)) {\n        return 0\n      }\n      if (!isPosInt(size)) {\n        if (sizeCalculation) {\n          if (typeof sizeCalculation !== 'function') {\n            throw new TypeError('sizeCalculation must be a function')\n          }\n          size = sizeCalculation(v, k)\n          if (!isPosInt(size)) {\n            throw new TypeError(\n              'sizeCalculation return invalid (expect positive integer)'\n            )\n          }\n        } else {\n          throw new TypeError(\n            'invalid size value (must be positive integer). ' +\n              'When maxSize or maxEntrySize is used, sizeCalculation ' +\n              'or size must be set.'\n          )\n        }\n      }\n      return size\n    }\n    this.#addItemSize = (\n      index: Index,\n      size: LRUCache.Size,\n      status?: LRUCache.Status<V>\n    ) => {\n      sizes[index] = size\n      if (this.#maxSize) {\n        const maxSize = this.#maxSize - (sizes[index] as number)\n        while (this.#calculatedSize > maxSize) {\n          this.#evict(true)\n        }\n      }\n      this.#calculatedSize += sizes[index] as number\n      if (status) {\n        status.entrySize = size\n        status.totalCalculatedSize = this.#calculatedSize\n      }\n    }\n  }\n\n  #removeItemSize: (index: Index) => void = _i => {}\n  #addItemSize: (\n    index: Index,\n    size: LRUCache.Size,\n    status?: LRUCache.Status<V>\n  ) => void = (_i, _s, _st) => {}\n  #requireSize: (\n    k: K,\n    v: V | BackgroundFetch<V>,\n    size?: LRUCache.Size,\n    sizeCalculation?: LRUCache.SizeCalculator<K, V>\n  ) => LRUCache.Size = (\n    _k: K,\n    _v: V | BackgroundFetch<V>,\n    size?: LRUCache.Size,\n    sizeCalculation?: LRUCache.SizeCalculator<K, V>\n  ) => {\n    if (size || sizeCalculation) {\n      throw new TypeError(\n        'cannot set size without setting maxSize or maxEntrySize on cache'\n      )\n    }\n    return 0\n  };\n\n  *#indexes({ allowStale = this.allowStale } = {}) {\n    if (this.#size) {\n      for (let i = this.#tail; true; ) {\n        if (!this.#isValidIndex(i)) {\n          break\n        }\n        if (allowStale || !this.#isStale(i)) {\n          yield i\n        }\n        if (i === this.#head) {\n          break\n        } else {\n          i = this.#prev[i] as Index\n        }\n      }\n    }\n  }\n\n  *#rindexes({ allowStale = this.allowStale } = {}) {\n    if (this.#size) {\n      for (let i = this.#head; true; ) {\n        if (!this.#isValidIndex(i)) {\n          break\n        }\n        if (allowStale || !this.#isStale(i)) {\n          yield i\n        }\n        if (i === this.#tail) {\n          break\n        } else {\n          i = this.#next[i] as Index\n        }\n      }\n    }\n  }\n\n  #isValidIndex(index: Index) {\n    return (\n      index !== undefined &&\n      this.#keyMap.get(this.#keyList[index] as K) === index\n    )\n  }\n\n  /**\n   * Return a generator yielding `[key, value]` pairs,\n   * in order from most recently used to least recently used.\n   */\n  *entries() {\n    for (const i of this.#indexes()) {\n      if (\n        this.#valList[i] !== undefined &&\n        this.#keyList[i] !== undefined &&\n        !this.#isBackgroundFetch(this.#valList[i])\n      ) {\n        yield [this.#keyList[i], this.#valList[i]] as [K, V]\n      }\n    }\n  }\n\n  /**\n   * Inverse order version of {@link LRUCache.entries}\n   *\n   * Return a generator yielding `[key, value]` pairs,\n   * in order from least recently used to most recently used.\n   */\n  *rentries() {\n    for (const i of this.#rindexes()) {\n      if (\n        this.#valList[i] !== undefined &&\n        this.#keyList[i] !== undefined &&\n        !this.#isBackgroundFetch(this.#valList[i])\n      ) {\n        yield [this.#keyList[i], this.#valList[i]]\n      }\n    }\n  }\n\n  /**\n   * Return a generator yielding the keys in the cache,\n   * in order from most recently used to least recently used.\n   */\n  *keys() {\n    for (const i of this.#indexes()) {\n      const k = this.#keyList[i]\n      if (\n        k !== undefined &&\n        !this.#isBackgroundFetch(this.#valList[i])\n      ) {\n        yield k\n      }\n    }\n  }\n\n  /**\n   * Inverse order version of {@link LRUCache.keys}\n   *\n   * Return a generator yielding the keys in the cache,\n   * in order from least recently used to most recently used.\n   */\n  *rkeys() {\n    for (const i of this.#rindexes()) {\n      const k = this.#keyList[i]\n      if (\n        k !== undefined &&\n        !this.#isBackgroundFetch(this.#valList[i])\n      ) {\n        yield k\n      }\n    }\n  }\n\n  /**\n   * Return a generator yielding the values in the cache,\n   * in order from most recently used to least recently used.\n   */\n  *values() {\n    for (const i of this.#indexes()) {\n      const v = this.#valList[i]\n      if (\n        v !== undefined &&\n        !this.#isBackgroundFetch(this.#valList[i])\n      ) {\n        yield this.#valList[i] as V\n      }\n    }\n  }\n\n  /**\n   * Inverse order version of {@link LRUCache.values}\n   *\n   * Return a generator yielding the values in the cache,\n   * in order from least recently used to most recently used.\n   */\n  *rvalues() {\n    for (const i of this.#rindexes()) {\n      const v = this.#valList[i]\n      if (\n        v !== undefined &&\n        !this.#isBackgroundFetch(this.#valList[i])\n      ) {\n        yield this.#valList[i]\n      }\n    }\n  }\n\n  /**\n   * Iterating over the cache itself yields the same results as\n   * {@link LRUCache.entries}\n   */\n  [Symbol.iterator]() {\n    return this.entries()\n  }\n\n  /**\n   * A String value that is used in the creation of the default string\n   * description of an object. Called by the built-in method\n   * `Object.prototype.toString`.\n   */\n  [Symbol.toStringTag] = 'LRUCache'\n\n  /**\n   * Find a value for which the supplied fn method returns a truthy value,\n   * similar to `Array.find()`. fn is called as `fn(value, key, cache)`.\n   */\n  find(\n    fn: (v: V, k: K, self: LRUCache<K, V, FC>) => boolean,\n    getOptions: LRUCache.GetOptions<K, V, FC> = {}\n  ) {\n    for (const i of this.#indexes()) {\n      const v = this.#valList[i]\n      const value = this.#isBackgroundFetch(v)\n        ? v.__staleWhileFetching\n        : v\n      if (value === undefined) continue\n      if (fn(value, this.#keyList[i] as K, this)) {\n        return this.get(this.#keyList[i] as K, getOptions)\n      }\n    }\n  }\n\n  /**\n   * Call the supplied function on each item in the cache, in order from most\n   * recently used to least recently used.\n   *\n   * `fn` is called as `fn(value, key, cache)`.\n   *\n   * If `thisp` is provided, function will be called in the `this`-context of\n   * the provided object, or the cache if no `thisp` object is provided.\n   *\n   * Does not update age or recenty of use, or iterate over stale values.\n   */\n  forEach(\n    fn: (v: V, k: K, self: LRUCache<K, V, FC>) => any,\n    thisp: any = this\n  ) {\n    for (const i of this.#indexes()) {\n      const v = this.#valList[i]\n      const value = this.#isBackgroundFetch(v)\n        ? v.__staleWhileFetching\n        : v\n      if (value === undefined) continue\n      fn.call(thisp, value, this.#keyList[i] as K, this)\n    }\n  }\n\n  /**\n   * The same as {@link LRUCache.forEach} but items are iterated over in\n   * reverse order.  (ie, less recently used items are iterated over first.)\n   */\n  rforEach(\n    fn: (v: V, k: K, self: LRUCache<K, V, FC>) => any,\n    thisp: any = this\n  ) {\n    for (const i of this.#rindexes()) {\n      const v = this.#valList[i]\n      const value = this.#isBackgroundFetch(v)\n        ? v.__staleWhileFetching\n        : v\n      if (value === undefined) continue\n      fn.call(thisp, value, this.#keyList[i] as K, this)\n    }\n  }\n\n  /**\n   * Delete any stale entries. Returns true if anything was removed,\n   * false otherwise.\n   */\n  purgeStale() {\n    let deleted = false\n    for (const i of this.#rindexes({ allowStale: true })) {\n      if (this.#isStale(i)) {\n        this.#delete(this.#keyList[i] as K, 'expire')\n        deleted = true\n      }\n    }\n    return deleted\n  }\n\n  /**\n   * Get the extended info about a given entry, to get its value, size, and\n   * TTL info simultaneously. Returns `undefined` if the key is not present.\n   *\n   * Unlike {@link LRUCache#dump}, which is designed to be portable and survive\n   * serialization, the `start` value is always the current timestamp, and the\n   * `ttl` is a calculated remaining time to live (negative if expired).\n   *\n   * Always returns stale values, if their info is found in the cache, so be\n   * sure to check for expirations (ie, a negative {@link LRUCache.Entry#ttl})\n   * if relevant.\n   */\n  info(key: K): LRUCache.Entry<V> | undefined {\n    const i = this.#keyMap.get(key)\n    if (i === undefined) return undefined\n    const v = this.#valList[i]\n    const value: V | undefined = this.#isBackgroundFetch(v)\n      ? v.__staleWhileFetching\n      : v\n    if (value === undefined) return undefined\n    const entry: LRUCache.Entry<V> = { value }\n    if (this.#ttls && this.#starts) {\n      const ttl = this.#ttls[i]\n      const start = this.#starts[i]\n      if (ttl && start) {\n        const remain = ttl - (perf.now() - start)\n        entry.ttl = remain\n        entry.start = Date.now()\n      }\n    }\n    if (this.#sizes) {\n      entry.size = this.#sizes[i]\n    }\n    return entry\n  }\n\n  /**\n   * Return an array of [key, {@link LRUCache.Entry}] tuples which can be\n   * passed to {@link LRLUCache#load}.\n   *\n   * The `start` fields are calculated relative to a portable `Date.now()`\n   * timestamp, even if `performance.now()` is available.\n   *\n   * Stale entries are always included in the `dump`, even if\n   * {@link LRUCache.OptionsBase.allowStale} is false.\n   *\n   * Note: this returns an actual array, not a generator, so it can be more\n   * easily passed around.\n   */\n  dump() {\n    const arr: [K, LRUCache.Entry<V>][] = []\n    for (const i of this.#indexes({ allowStale: true })) {\n      const key = this.#keyList[i]\n      const v = this.#valList[i]\n      const value: V | undefined = this.#isBackgroundFetch(v)\n        ? v.__staleWhileFetching\n        : v\n      if (value === undefined || key === undefined) continue\n      const entry: LRUCache.Entry<V> = { value }\n      if (this.#ttls && this.#starts) {\n        entry.ttl = this.#ttls[i]\n        // always dump the start relative to a portable timestamp\n        // it's ok for this to be a bit slow, it's a rare operation.\n        const age = perf.now() - (this.#starts[i] as number)\n        entry.start = Math.floor(Date.now() - age)\n      }\n      if (this.#sizes) {\n        entry.size = this.#sizes[i]\n      }\n      arr.unshift([key, entry])\n    }\n    return arr\n  }\n\n  /**\n   * Reset the cache and load in the items in entries in the order listed.\n   *\n   * The shape of the resulting cache may be different if the same options are\n   * not used in both caches.\n   *\n   * The `start` fields are assumed to be calculated relative to a portable\n   * `Date.now()` timestamp, even if `performance.now()` is available.\n   */\n  load(arr: [K, LRUCache.Entry<V>][]) {\n    this.clear()\n    for (const [key, entry] of arr) {\n      if (entry.start) {\n        // entry.start is a portable timestamp, but we may be using\n        // node's performance.now(), so calculate the offset, so that\n        // we get the intended remaining TTL, no matter how long it's\n        // been on ice.\n        //\n        // it's ok for this to be a bit slow, it's a rare operation.\n        const age = Date.now() - entry.start\n        entry.start = perf.now() - age\n      }\n      this.set(key, entry.value, entry)\n    }\n  }\n\n  /**\n   * Add a value to the cache.\n   *\n   * Note: if `undefined` is specified as a value, this is an alias for\n   * {@link LRUCache#delete}\n   *\n   * Fields on the {@link LRUCache.SetOptions} options param will override\n   * their corresponding values in the constructor options for the scope\n   * of this single `set()` operation.\n   *\n   * If `start` is provided, then that will set the effective start\n   * time for the TTL calculation. Note that this must be a previous\n   * value of `performance.now()` if supported, or a previous value of\n   * `Date.now()` if not.\n   *\n   * Options object may also include `size`, which will prevent\n   * calling the `sizeCalculation` function and just use the specified\n   * number if it is a positive integer, and `noDisposeOnSet` which\n   * will prevent calling a `dispose` function in the case of\n   * overwrites.\n   *\n   * If the `size` (or return value of `sizeCalculation`) for a given\n   * entry is greater than `maxEntrySize`, then the item will not be\n   * added to the cache.\n   *\n   * Will update the recency of the entry.\n   *\n   * If the value is `undefined`, then this is an alias for\n   * `cache.delete(key)`. `undefined` is never stored in the cache.\n   */\n  set(\n    k: K,\n    v: V | BackgroundFetch<V> | undefined,\n    setOptions: LRUCache.SetOptions<K, V, FC> = {}\n  ) {\n    if (v === undefined) {\n      this.delete(k)\n      return this\n    }\n    const {\n      ttl = this.ttl,\n      start,\n      noDisposeOnSet = this.noDisposeOnSet,\n      sizeCalculation = this.sizeCalculation,\n      status,\n    } = setOptions\n    let { noUpdateTTL = this.noUpdateTTL } = setOptions\n\n    const size = this.#requireSize(\n      k,\n      v,\n      setOptions.size || 0,\n      sizeCalculation\n    )\n    // if the item doesn't fit, don't do anything\n    // NB: maxEntrySize set to maxSize by default\n    if (this.maxEntrySize && size > this.maxEntrySize) {\n      if (status) {\n        status.set = 'miss'\n        status.maxEntrySizeExceeded = true\n      }\n      // have to delete, in case something is there already.\n      this.#delete(k, 'set')\n      return this\n    }\n    let index = this.#size === 0 ? undefined : this.#keyMap.get(k)\n    if (index === undefined) {\n      // addition\n      index = (\n        this.#size === 0\n          ? this.#tail\n          : this.#free.length !== 0\n          ? this.#free.pop()\n          : this.#size === this.#max\n          ? this.#evict(false)\n          : this.#size\n      ) as Index\n      this.#keyList[index] = k\n      this.#valList[index] = v\n      this.#keyMap.set(k, index)\n      this.#next[this.#tail] = index\n      this.#prev[index] = this.#tail\n      this.#tail = index\n      this.#size++\n      this.#addItemSize(index, size, status)\n      if (status) status.set = 'add'\n      noUpdateTTL = false\n    } else {\n      // update\n      this.#moveToTail(index)\n      const oldVal = this.#valList[index] as V | BackgroundFetch<V>\n      if (v !== oldVal) {\n        if (this.#hasFetchMethod && this.#isBackgroundFetch(oldVal)) {\n          oldVal.__abortController.abort(new Error('replaced'))\n          const { __staleWhileFetching: s } = oldVal\n          if (s !== undefined && !noDisposeOnSet) {\n            if (this.#hasDispose) {\n              this.#dispose?.(s as V, k, 'set')\n            }\n            if (this.#hasDisposeAfter) {\n              this.#disposed?.push([s as V, k, 'set'])\n            }\n          }\n        } else if (!noDisposeOnSet) {\n          if (this.#hasDispose) {\n            this.#dispose?.(oldVal as V, k, 'set')\n          }\n          if (this.#hasDisposeAfter) {\n            this.#disposed?.push([oldVal as V, k, 'set'])\n          }\n        }\n        this.#removeItemSize(index)\n        this.#addItemSize(index, size, status)\n        this.#valList[index] = v\n        if (status) {\n          status.set = 'replace'\n          const oldValue =\n            oldVal && this.#isBackgroundFetch(oldVal)\n              ? oldVal.__staleWhileFetching\n              : oldVal\n          if (oldValue !== undefined) status.oldValue = oldValue\n        }\n      } else if (status) {\n        status.set = 'update'\n      }\n    }\n    if (ttl !== 0 && !this.#ttls) {\n      this.#initializeTTLTracking()\n    }\n    if (this.#ttls) {\n      if (!noUpdateTTL) {\n        this.#setItemTTL(index, ttl, start)\n      }\n      if (status) this.#statusTTL(status, index)\n    }\n    if (!noDisposeOnSet && this.#hasDisposeAfter && this.#disposed) {\n      const dt = this.#disposed\n      let task: DisposeTask<K, V> | undefined\n      while ((task = dt?.shift())) {\n        this.#disposeAfter?.(...task)\n      }\n    }\n    return this\n  }\n\n  /**\n   * Evict the least recently used item, returning its value or\n   * `undefined` if cache is empty.\n   */\n  pop(): V | undefined {\n    try {\n      while (this.#size) {\n        const val = this.#valList[this.#head]\n        this.#evict(true)\n        if (this.#isBackgroundFetch(val)) {\n          if (val.__staleWhileFetching) {\n            return val.__staleWhileFetching\n          }\n        } else if (val !== undefined) {\n          return val\n        }\n      }\n    } finally {\n      if (this.#hasDisposeAfter && this.#disposed) {\n        const dt = this.#disposed\n        let task: DisposeTask<K, V> | undefined\n        while ((task = dt?.shift())) {\n          this.#disposeAfter?.(...task)\n        }\n      }\n    }\n  }\n\n  #evict(free: boolean) {\n    const head = this.#head\n    const k = this.#keyList[head] as K\n    const v = this.#valList[head] as V\n    if (this.#hasFetchMethod && this.#isBackgroundFetch(v)) {\n      v.__abortController.abort(new Error('evicted'))\n    } else if (this.#hasDispose || this.#hasDisposeAfter) {\n      if (this.#hasDispose) {\n        this.#dispose?.(v, k, 'evict')\n      }\n      if (this.#hasDisposeAfter) {\n        this.#disposed?.push([v, k, 'evict'])\n      }\n    }\n    this.#removeItemSize(head)\n    // if we aren't about to use the index, then null these out\n    if (free) {\n      this.#keyList[head] = undefined\n      this.#valList[head] = undefined\n      this.#free.push(head)\n    }\n    if (this.#size === 1) {\n      this.#head = this.#tail = 0 as Index\n      this.#free.length = 0\n    } else {\n      this.#head = this.#next[head] as Index\n    }\n    this.#keyMap.delete(k)\n    this.#size--\n    return head\n  }\n\n  /**\n   * Check if a key is in the cache, without updating the recency of use.\n   * Will return false if the item is stale, even though it is technically\n   * in the cache.\n   *\n   * Check if a key is in the cache, without updating the recency of\n   * use. Age is updated if {@link LRUCache.OptionsBase.updateAgeOnHas} is set\n   * to `true` in either the options or the constructor.\n   *\n   * Will return `false` if the item is stale, even though it is technically in\n   * the cache. The difference can be determined (if it matters) by using a\n   * `status` argument, and inspecting the `has` field.\n   *\n   * Will not update item age unless\n   * {@link LRUCache.OptionsBase.updateAgeOnHas} is set.\n   */\n  has(k: K, hasOptions: LRUCache.HasOptions<K, V, FC> = {}) {\n    const { updateAgeOnHas = this.updateAgeOnHas, status } =\n      hasOptions\n    const index = this.#keyMap.get(k)\n    if (index !== undefined) {\n      const v = this.#valList[index]\n      if (\n        this.#isBackgroundFetch(v) &&\n        v.__staleWhileFetching === undefined\n      ) {\n        return false\n      }\n      if (!this.#isStale(index)) {\n        if (updateAgeOnHas) {\n          this.#updateItemAge(index)\n        }\n        if (status) {\n          status.has = 'hit'\n          this.#statusTTL(status, index)\n        }\n        return true\n      } else if (status) {\n        status.has = 'stale'\n        this.#statusTTL(status, index)\n      }\n    } else if (status) {\n      status.has = 'miss'\n    }\n    return false\n  }\n\n  /**\n   * Like {@link LRUCache#get} but doesn't update recency or delete stale\n   * items.\n   *\n   * Returns `undefined` if the item is stale, unless\n   * {@link LRUCache.OptionsBase.allowStale} is set.\n   */\n  peek(k: K, peekOptions: LRUCache.PeekOptions<K, V, FC> = {}) {\n    const { allowStale = this.allowStale } = peekOptions\n    const index = this.#keyMap.get(k)\n    if (\n      index === undefined ||\n      (!allowStale && this.#isStale(index))\n    ) {\n      return\n    }\n    const v = this.#valList[index]\n    // either stale and allowed, or forcing a refresh of non-stale value\n    return this.#isBackgroundFetch(v) ? v.__staleWhileFetching : v\n  }\n\n  #backgroundFetch(\n    k: K,\n    index: Index | undefined,\n    options: LRUCache.FetchOptions<K, V, FC>,\n    context: any\n  ): BackgroundFetch<V> {\n    const v = index === undefined ? undefined : this.#valList[index]\n    if (this.#isBackgroundFetch(v)) {\n      return v\n    }\n\n    const ac = new AC()\n    const { signal } = options\n    // when/if our AC signals, then stop listening to theirs.\n    signal?.addEventListener('abort', () => ac.abort(signal.reason), {\n      signal: ac.signal,\n    })\n\n    const fetchOpts = {\n      signal: ac.signal,\n      options,\n      context,\n    }\n\n    const cb = (\n      v: V | undefined,\n      updateCache = false\n    ): V | undefined => {\n      const { aborted } = ac.signal\n      const ignoreAbort = options.ignoreFetchAbort && v !== undefined\n      if (options.status) {\n        if (aborted && !updateCache) {\n          options.status.fetchAborted = true\n          options.status.fetchError = ac.signal.reason\n          if (ignoreAbort) options.status.fetchAbortIgnored = true\n        } else {\n          options.status.fetchResolved = true\n        }\n      }\n      if (aborted && !ignoreAbort && !updateCache) {\n        return fetchFail(ac.signal.reason)\n      }\n      // either we didn't abort, and are still here, or we did, and ignored\n      const bf = p as BackgroundFetch<V>\n      if (this.#valList[index as Index] === p) {\n        if (v === undefined) {\n          if (bf.__staleWhileFetching) {\n            this.#valList[index as Index] = bf.__staleWhileFetching\n          } else {\n            this.#delete(k, 'fetch')\n          }\n        } else {\n          if (options.status) options.status.fetchUpdated = true\n          this.set(k, v, fetchOpts.options)\n        }\n      }\n      return v\n    }\n\n    const eb = (er: any) => {\n      if (options.status) {\n        options.status.fetchRejected = true\n        options.status.fetchError = er\n      }\n      return fetchFail(er)\n    }\n\n    const fetchFail = (er: any): V | undefined => {\n      const { aborted } = ac.signal\n      const allowStaleAborted =\n        aborted && options.allowStaleOnFetchAbort\n      const allowStale =\n        allowStaleAborted || options.allowStaleOnFetchRejection\n      const noDelete = allowStale || options.noDeleteOnFetchRejection\n      const bf = p as BackgroundFetch<V>\n      if (this.#valList[index as Index] === p) {\n        // if we allow stale on fetch rejections, then we need to ensure that\n        // the stale value is not removed from the cache when the fetch fails.\n        const del = !noDelete || bf.__staleWhileFetching === undefined\n        if (del) {\n          this.#delete(k, 'fetch')\n        } else if (!allowStaleAborted) {\n          // still replace the *promise* with the stale value,\n          // since we are done with the promise at this point.\n          // leave it untouched if we're still waiting for an\n          // aborted background fetch that hasn't yet returned.\n          this.#valList[index as Index] = bf.__staleWhileFetching\n        }\n      }\n      if (allowStale) {\n        if (options.status && bf.__staleWhileFetching !== undefined) {\n          options.status.returnedStale = true\n        }\n        return bf.__staleWhileFetching\n      } else if (bf.__returned === bf) {\n        throw er\n      }\n    }\n\n    const pcall = (\n      res: (v: V | undefined) => void,\n      rej: (e: any) => void\n    ) => {\n      const fmp = this.#fetchMethod?.(k, v, fetchOpts)\n      if (fmp && fmp instanceof Promise) {\n        fmp.then(v => res(v === undefined ? undefined : v), rej)\n      }\n      // ignored, we go until we finish, regardless.\n      // defer check until we are actually aborting,\n      // so fetchMethod can override.\n      ac.signal.addEventListener('abort', () => {\n        if (\n          !options.ignoreFetchAbort ||\n          options.allowStaleOnFetchAbort\n        ) {\n          res(undefined)\n          // when it eventually resolves, update the cache.\n          if (options.allowStaleOnFetchAbort) {\n            res = v => cb(v, true)\n          }\n        }\n      })\n    }\n\n    if (options.status) options.status.fetchDispatched = true\n    const p = new Promise(pcall).then(cb, eb)\n    const bf: BackgroundFetch<V> = Object.assign(p, {\n      __abortController: ac,\n      __staleWhileFetching: v,\n      __returned: undefined,\n    })\n\n    if (index === undefined) {\n      // internal, don't expose status.\n      this.set(k, bf, { ...fetchOpts.options, status: undefined })\n      index = this.#keyMap.get(k)\n    } else {\n      this.#valList[index] = bf\n    }\n    return bf\n  }\n\n  #isBackgroundFetch(p: any): p is BackgroundFetch<V> {\n    if (!this.#hasFetchMethod) return false\n    const b = p as BackgroundFetch<V>\n    return (\n      !!b &&\n      b instanceof Promise &&\n      b.hasOwnProperty('__staleWhileFetching') &&\n      b.__abortController instanceof AC\n    )\n  }\n\n  /**\n   * Make an asynchronous cached fetch using the\n   * {@link LRUCache.OptionsBase.fetchMethod} function.\n   *\n   * If the value is in the cache and not stale, then the returned\n   * Promise resolves to the value.\n   *\n   * If not in the cache, or beyond its TTL staleness, then\n   * `fetchMethod(key, staleValue, { options, signal, context })` is\n   * called, and the value returned will be added to the cache once\n   * resolved.\n   *\n   * If called with `allowStale`, and an asynchronous fetch is\n   * currently in progress to reload a stale value, then the former\n   * stale value will be returned.\n   *\n   * If called with `forceRefresh`, then the cached item will be\n   * re-fetched, even if it is not stale. However, if `allowStale` is also\n   * set, then the old value will still be returned. This is useful\n   * in cases where you want to force a reload of a cached value. If\n   * a background fetch is already in progress, then `forceRefresh`\n   * has no effect.\n   *\n   * If multiple fetches for the same key are issued, then they will all be\n   * coalesced into a single call to fetchMethod.\n   *\n   * Note that this means that handling options such as\n   * {@link LRUCache.OptionsBase.allowStaleOnFetchAbort},\n   * {@link LRUCache.FetchOptions.signal},\n   * and {@link LRUCache.OptionsBase.allowStaleOnFetchRejection} will be\n   * determined by the FIRST fetch() call for a given key.\n   *\n   * This is a known (fixable) shortcoming which will be addresed on when\n   * someone complains about it, as the fix would involve added complexity and\n   * may not be worth the costs for this edge case.\n   *\n   * If {@link LRUCache.OptionsBase.fetchMethod} is not specified, then this is\n   * effectively an alias for `Promise.resolve(cache.get(key))`.\n   *\n   * When the fetch method resolves to a value, if the fetch has not\n   * been aborted due to deletion, eviction, or being overwritten,\n   * then it is added to the cache using the options provided.\n   *\n   * If the key is evicted or deleted before the `fetchMethod`\n   * resolves, then the AbortSignal passed to the `fetchMethod` will\n   * receive an `abort` event, and the promise returned by `fetch()`\n   * will reject with the reason for the abort.\n   *\n   * If a `signal` is passed to the `fetch()` call, then aborting the\n   * signal will abort the fetch and cause the `fetch()` promise to\n   * reject with the reason provided.\n   *\n   * **Setting `context`**\n   *\n   * If an `FC` type is set to a type other than `unknown`, `void`, or\n   * `undefined` in the {@link LRUCache} constructor, then all\n   * calls to `cache.fetch()` _must_ provide a `context` option. If\n   * set to `undefined` or `void`, then calls to fetch _must not_\n   * provide a `context` option.\n   *\n   * The `context` param allows you to provide arbitrary data that\n   * might be relevant in the course of fetching the data. It is only\n   * relevant for the course of a single `fetch()` operation, and\n   * discarded afterwards.\n   *\n   * **Note: `fetch()` calls are inflight-unique**\n   *\n   * If you call `fetch()` multiple times with the same key value,\n   * then every call after the first will resolve on the same\n   * promise<sup>1</sup>,\n   * _even if they have different settings that would otherwise change\n   * the behavior of the fetch_, such as `noDeleteOnFetchRejection`\n   * or `ignoreFetchAbort`.\n   *\n   * In most cases, this is not a problem (in fact, only fetching\n   * something once is what you probably want, if you're caching in\n   * the first place). If you are changing the fetch() options\n   * dramatically between runs, there's a good chance that you might\n   * be trying to fit divergent semantics into a single object, and\n   * would be better off with multiple cache instances.\n   *\n   * **1**: Ie, they're not the \"same Promise\", but they resolve at\n   * the same time, because they're both waiting on the same\n   * underlying fetchMethod response.\n   */\n\n  fetch(\n    k: K,\n    fetchOptions: unknown extends FC\n      ? LRUCache.FetchOptions<K, V, FC>\n      : FC extends undefined | void\n      ? LRUCache.FetchOptionsNoContext<K, V>\n      : LRUCache.FetchOptionsWithContext<K, V, FC>\n  ): Promise<undefined | V>\n\n  // this overload not allowed if context is required\n  fetch(\n    k: unknown extends FC\n      ? K\n      : FC extends undefined | void\n      ? K\n      : never,\n    fetchOptions?: unknown extends FC\n      ? LRUCache.FetchOptions<K, V, FC>\n      : FC extends undefined | void\n      ? LRUCache.FetchOptionsNoContext<K, V>\n      : never\n  ): Promise<undefined | V>\n\n  async fetch(\n    k: K,\n    fetchOptions: LRUCache.FetchOptions<K, V, FC> = {}\n  ): Promise<undefined | V> {\n    const {\n      // get options\n      allowStale = this.allowStale,\n      updateAgeOnGet = this.updateAgeOnGet,\n      noDeleteOnStaleGet = this.noDeleteOnStaleGet,\n      // set options\n      ttl = this.ttl,\n      noDisposeOnSet = this.noDisposeOnSet,\n      size = 0,\n      sizeCalculation = this.sizeCalculation,\n      noUpdateTTL = this.noUpdateTTL,\n      // fetch exclusive options\n      noDeleteOnFetchRejection = this.noDeleteOnFetchRejection,\n      allowStaleOnFetchRejection = this.allowStaleOnFetchRejection,\n      ignoreFetchAbort = this.ignoreFetchAbort,\n      allowStaleOnFetchAbort = this.allowStaleOnFetchAbort,\n      context,\n      forceRefresh = false,\n      status,\n      signal,\n    } = fetchOptions\n\n    if (!this.#hasFetchMethod) {\n      if (status) status.fetch = 'get'\n      return this.get(k, {\n        allowStale,\n        updateAgeOnGet,\n        noDeleteOnStaleGet,\n        status,\n      })\n    }\n\n    const options = {\n      allowStale,\n      updateAgeOnGet,\n      noDeleteOnStaleGet,\n      ttl,\n      noDisposeOnSet,\n      size,\n      sizeCalculation,\n      noUpdateTTL,\n      noDeleteOnFetchRejection,\n      allowStaleOnFetchRejection,\n      allowStaleOnFetchAbort,\n      ignoreFetchAbort,\n      status,\n      signal,\n    }\n\n    let index = this.#keyMap.get(k)\n    if (index === undefined) {\n      if (status) status.fetch = 'miss'\n      const p = this.#backgroundFetch(k, index, options, context)\n      return (p.__returned = p)\n    } else {\n      // in cache, maybe already fetching\n      const v = this.#valList[index]\n      if (this.#isBackgroundFetch(v)) {\n        const stale =\n          allowStale && v.__staleWhileFetching !== undefined\n        if (status) {\n          status.fetch = 'inflight'\n          if (stale) status.returnedStale = true\n        }\n        return stale ? v.__staleWhileFetching : (v.__returned = v)\n      }\n\n      // if we force a refresh, that means do NOT serve the cached value,\n      // unless we are already in the process of refreshing the cache.\n      const isStale = this.#isStale(index)\n      if (!forceRefresh && !isStale) {\n        if (status) status.fetch = 'hit'\n        this.#moveToTail(index)\n        if (updateAgeOnGet) {\n          this.#updateItemAge(index)\n        }\n        if (status) this.#statusTTL(status, index)\n        return v\n      }\n\n      // ok, it is stale or a forced refresh, and not already fetching.\n      // refresh the cache.\n      const p = this.#backgroundFetch(k, index, options, context)\n      const hasStale = p.__staleWhileFetching !== undefined\n      const staleVal = hasStale && allowStale\n      if (status) {\n        status.fetch = isStale ? 'stale' : 'refresh'\n        if (staleVal && isStale) status.returnedStale = true\n      }\n      return staleVal ? p.__staleWhileFetching : (p.__returned = p)\n    }\n  }\n\n  /**\n   * In some cases, `cache.fetch()` may resolve to `undefined`, either because\n   * a {@link LRUCache.OptionsBase#fetchMethod} was not provided (turning\n   * `cache.fetch(k)` into just an async wrapper around `cache.get(k)`) or\n   * because `ignoreFetchAbort` was specified (either to the constructor or\n   * in the {@link LRUCache.FetchOptions}). Also, the\n   * {@link OptionsBase.fetchMethod} may return `undefined` or `void`, making\n   * the test even more complicated.\n   *\n   * Because inferring the cases where `undefined` might be returned are so\n   * cumbersome, but testing for `undefined` can also be annoying, this method\n   * can be used, which will reject if `this.fetch()` resolves to undefined.\n   */\n  forceFetch(\n    k: K,\n    fetchOptions: unknown extends FC\n      ? LRUCache.FetchOptions<K, V, FC>\n      : FC extends undefined | void\n      ? LRUCache.FetchOptionsNoContext<K, V>\n      : LRUCache.FetchOptionsWithContext<K, V, FC>\n  ): Promise<V>\n  // this overload not allowed if context is required\n  forceFetch(\n    k: unknown extends FC\n      ? K\n      : FC extends undefined | void\n      ? K\n      : never,\n    fetchOptions?: unknown extends FC\n      ? LRUCache.FetchOptions<K, V, FC>\n      : FC extends undefined | void\n      ? LRUCache.FetchOptionsNoContext<K, V>\n      : never\n  ): Promise<V>\n  async forceFetch(\n    k: K,\n    fetchOptions: LRUCache.FetchOptions<K, V, FC> = {}\n  ): Promise<V> {\n    const v = await this.fetch(\n      k,\n      fetchOptions as unknown extends FC\n        ? LRUCache.FetchOptions<K, V, FC>\n        : FC extends undefined | void\n        ? LRUCache.FetchOptionsNoContext<K, V>\n        : LRUCache.FetchOptionsWithContext<K, V, FC>\n    )\n    if (v === undefined) throw new Error('fetch() returned undefined')\n    return v\n  }\n\n  /**\n   * If the key is found in the cache, then this is equivalent to\n   * {@link LRUCache#get}. If not, in the cache, then calculate the value using\n   * the {@link LRUCache.OptionsBase.memoMethod}, and add it to the cache.\n   *\n   * If an `FC` type is set to a type other than `unknown`, `void`, or\n   * `undefined` in the LRUCache constructor, then all calls to `cache.memo()`\n   * _must_ provide a `context` option. If set to `undefined` or `void`, then\n   * calls to memo _must not_ provide a `context` option.\n   *\n   * The `context` param allows you to provide arbitrary data that might be\n   * relevant in the course of fetching the data. It is only relevant for the\n   * course of a single `memo()` operation, and discarded afterwards.\n   */\n  memo(\n    k: K,\n    memoOptions: unknown extends FC\n      ? LRUCache.MemoOptions<K, V, FC>\n      : FC extends undefined | void\n      ? LRUCache.MemoOptionsNoContext<K, V>\n      : LRUCache.MemoOptionsWithContext<K, V, FC>\n  ): V\n  // this overload not allowed if context is required\n  memo(\n    k: unknown extends FC\n      ? K\n      : FC extends undefined | void\n      ? K\n      : never,\n    memoOptions?: unknown extends FC\n      ? LRUCache.MemoOptions<K, V, FC>\n      : FC extends undefined | void\n      ? LRUCache.MemoOptionsNoContext<K, V>\n      : never\n  ): V\n  memo(k: K, memoOptions: LRUCache.MemoOptions<K, V, FC> = {}) {\n    const memoMethod = this.#memoMethod\n    if (!memoMethod) {\n      throw new Error('no memoMethod provided to constructor')\n    }\n    const { context, forceRefresh, ...options } = memoOptions\n    const v = this.get(k, options)\n    if (!forceRefresh && v !== undefined) return v\n    const vv = memoMethod(k, v, {\n      options,\n      context,\n    } as LRUCache.MemoizerOptions<K, V, FC>)\n    this.set(k, vv, options)\n    return vv\n  }\n\n  /**\n   * Return a value from the cache. Will update the recency of the cache\n   * entry found.\n   *\n   * If the key is not found, get() will return `undefined`.\n   */\n  get(k: K, getOptions: LRUCache.GetOptions<K, V, FC> = {}) {\n    const {\n      allowStale = this.allowStale,\n      updateAgeOnGet = this.updateAgeOnGet,\n      noDeleteOnStaleGet = this.noDeleteOnStaleGet,\n      status,\n    } = getOptions\n    const index = this.#keyMap.get(k)\n    if (index !== undefined) {\n      const value = this.#valList[index]\n      const fetching = this.#isBackgroundFetch(value)\n      if (status) this.#statusTTL(status, index)\n      if (this.#isStale(index)) {\n        if (status) status.get = 'stale'\n        // delete only if not an in-flight background fetch\n        if (!fetching) {\n          if (!noDeleteOnStaleGet) {\n            this.#delete(k, 'expire')\n          }\n          if (status && allowStale) status.returnedStale = true\n          return allowStale ? value : undefined\n        } else {\n          if (\n            status &&\n            allowStale &&\n            value.__staleWhileFetching !== undefined\n          ) {\n            status.returnedStale = true\n          }\n          return allowStale ? value.__staleWhileFetching : undefined\n        }\n      } else {\n        if (status) status.get = 'hit'\n        // if we're currently fetching it, we don't actually have it yet\n        // it's not stale, which means this isn't a staleWhileRefetching.\n        // If it's not stale, and fetching, AND has a __staleWhileFetching\n        // value, then that means the user fetched with {forceRefresh:true},\n        // so it's safe to return that value.\n        if (fetching) {\n          return value.__staleWhileFetching\n        }\n        this.#moveToTail(index)\n        if (updateAgeOnGet) {\n          this.#updateItemAge(index)\n        }\n        return value\n      }\n    } else if (status) {\n      status.get = 'miss'\n    }\n  }\n\n  #connect(p: Index, n: Index) {\n    this.#prev[n] = p\n    this.#next[p] = n\n  }\n\n  #moveToTail(index: Index): void {\n    // if tail already, nothing to do\n    // if head, move head to next[index]\n    // else\n    //   move next[prev[index]] to next[index] (head has no prev)\n    //   move prev[next[index]] to prev[index]\n    // prev[index] = tail\n    // next[tail] = index\n    // tail = index\n    if (index !== this.#tail) {\n      if (index === this.#head) {\n        this.#head = this.#next[index] as Index\n      } else {\n        this.#connect(\n          this.#prev[index] as Index,\n          this.#next[index] as Index\n        )\n      }\n      this.#connect(this.#tail, index)\n      this.#tail = index\n    }\n  }\n\n  /**\n   * Deletes a key out of the cache.\n   *\n   * Returns true if the key was deleted, false otherwise.\n   */\n  delete(k: K) {\n    return this.#delete(k, 'delete')\n  }\n\n  #delete(k: K, reason: LRUCache.DisposeReason) {\n    let deleted = false\n    if (this.#size !== 0) {\n      const index = this.#keyMap.get(k)\n      if (index !== undefined) {\n        deleted = true\n        if (this.#size === 1) {\n          this.#clear(reason)\n        } else {\n          this.#removeItemSize(index)\n          const v = this.#valList[index]\n          if (this.#isBackgroundFetch(v)) {\n            v.__abortController.abort(new Error('deleted'))\n          } else if (this.#hasDispose || this.#hasDisposeAfter) {\n            if (this.#hasDispose) {\n              this.#dispose?.(v as V, k, reason)\n            }\n            if (this.#hasDisposeAfter) {\n              this.#disposed?.push([v as V, k, reason])\n            }\n          }\n          this.#keyMap.delete(k)\n          this.#keyList[index] = undefined\n          this.#valList[index] = undefined\n          if (index === this.#tail) {\n            this.#tail = this.#prev[index] as Index\n          } else if (index === this.#head) {\n            this.#head = this.#next[index] as Index\n          } else {\n            const pi = this.#prev[index] as number\n            this.#next[pi] = this.#next[index] as number\n            const ni = this.#next[index] as number\n            this.#prev[ni] = this.#prev[index] as number\n          }\n          this.#size--\n          this.#free.push(index)\n        }\n      }\n    }\n    if (this.#hasDisposeAfter && this.#disposed?.length) {\n      const dt = this.#disposed\n      let task: DisposeTask<K, V> | undefined\n      while ((task = dt?.shift())) {\n        this.#disposeAfter?.(...task)\n      }\n    }\n    return deleted\n  }\n\n  /**\n   * Clear the cache entirely, throwing away all values.\n   */\n  clear() {\n    return this.#clear('delete')\n  }\n  #clear(reason: LRUCache.DisposeReason) {\n    for (const index of this.#rindexes({ allowStale: true })) {\n      const v = this.#valList[index]\n      if (this.#isBackgroundFetch(v)) {\n        v.__abortController.abort(new Error('deleted'))\n      } else {\n        const k = this.#keyList[index]\n        if (this.#hasDispose) {\n          this.#dispose?.(v as V, k as K, reason)\n        }\n        if (this.#hasDisposeAfter) {\n          this.#disposed?.push([v as V, k as K, reason])\n        }\n      }\n    }\n\n    this.#keyMap.clear()\n    this.#valList.fill(undefined)\n    this.#keyList.fill(undefined)\n    if (this.#ttls && this.#starts) {\n      this.#ttls.fill(0)\n      this.#starts.fill(0)\n    }\n    if (this.#sizes) {\n      this.#sizes.fill(0)\n    }\n    this.#head = 0 as Index\n    this.#tail = 0 as Index\n    this.#free.length = 0\n    this.#calculatedSize = 0\n    this.#size = 0\n    if (this.#hasDisposeAfter && this.#disposed) {\n      const dt = this.#disposed\n      let task: DisposeTask<K, V> | undefined\n      while ((task = dt?.shift())) {\n        this.#disposeAfter?.(...task)\n      }\n    }\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 13444, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13449, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/simple-store-memory/src/util.ts"],"sourcesContent":["const knownSizes = new WeakMap<object, number>()\n\n/**\n * @see {@link https://stackoverflow.com/a/11900218/356537}\n */\nexport function roughSizeOfObject(value: unknown): number {\n  const objectList = new Set()\n  const stack = [value] // This would be more efficient using a circular buffer\n  let bytes = 0\n\n  while (stack.length) {\n    const value = stack.pop()\n\n    // > All objects on the heap start with a shape descriptor, which takes one\n    // > pointer size (usually 4 bytes these days, thanks to \"pointer\n    // > compression\" on 64-bit platforms).\n\n    switch (typeof value) {\n      // Types are ordered by frequency\n      case 'string':\n        // https://stackoverflow.com/a/68791382/356537\n        bytes += 12 + 4 * Math.ceil(value.length / 4)\n        break\n      case 'number':\n        bytes += 12 // Shape descriptor + double\n        break\n      case 'boolean':\n        bytes += 4 // Shape descriptor\n        break\n      case 'object':\n        bytes += 4 // Shape descriptor\n\n        if (value === null) {\n          break\n        }\n\n        if (knownSizes.has(value)) {\n          bytes += knownSizes.get(value)!\n          break\n        }\n\n        if (objectList.has(value)) continue\n        objectList.add(value)\n\n        if (Array.isArray(value)) {\n          bytes += 4\n          stack.push(...value)\n        } else {\n          bytes += 8\n          const keys = Object.getOwnPropertyNames(value)\n          for (let i = 0; i < keys.length; i++) {\n            bytes += 4\n            const key = keys[i]\n            const val = value[key]\n            if (val !== undefined) stack.push(val)\n            stack.push(key)\n          }\n        }\n        break\n      case 'function':\n        bytes += 8 // Shape descriptor + pointer (assuming functions are shared)\n        break\n      case 'symbol':\n        bytes += 8 // Shape descriptor + pointer\n        break\n      case 'bigint':\n        bytes += 16 // Shape descriptor + BigInt\n        break\n    }\n  }\n\n  if (typeof value === 'object' && value !== null) {\n    knownSizes.set(value, bytes)\n  }\n\n  return bytes\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAM,UAAU,GAAG,IAAI,OAAO,EAAkB,CAAA;AAEhD;;GAEG,CACH,SAAgB,iBAAiB,CAAC,KAAc;IAC9C,MAAM,UAAU,GAAG,IAAI,GAAG,EAAE,CAAA;IAC5B,MAAM,KAAK,GAAG;QAAC,KAAK;KAAC,CAAA,CAAC,uDAAuD;IAC7E,IAAI,KAAK,GAAG,CAAC,CAAA;IAEb,MAAO,KAAK,CAAC,MAAM,CAAE,CAAC;QACpB,MAAM,KAAK,GAAG,KAAK,CAAC,GAAG,EAAE,CAAA;QAEzB,2EAA2E;QAC3E,iEAAiE;QACjE,uCAAuC;QAEvC,OAAQ,OAAO,KAAK,EAAE,CAAC;YACrB,iCAAiC;YACjC,KAAK,QAAQ;gBACX,8CAA8C;gBAC9C,KAAK,IAAI,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;gBAC7C,MAAK;YACP,KAAK,QAAQ;gBACX,KAAK,IAAI,EAAE,CAAA,CAAC,4BAA4B;gBACxC,MAAK;YACP,KAAK,SAAS;gBACZ,KAAK,IAAI,CAAC,CAAA,CAAC,mBAAmB;gBAC9B,MAAK;YACP,KAAK,QAAQ;gBACX,KAAK,IAAI,CAAC,CAAA,CAAC,mBAAmB;gBAE9B,IAAI,KAAK,KAAK,IAAI,EAAE,CAAC;oBACnB,MAAK;gBACP,CAAC;gBAED,IAAI,UAAU,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;oBAC1B,KAAK,IAAI,UAAU,CAAC,GAAG,CAAC,KAAK,CAAE,CAAA;oBAC/B,MAAK;gBACP,CAAC;gBAED,IAAI,UAAU,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,SAAQ;gBACnC,UAAU,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;gBAErB,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC;oBACzB,KAAK,IAAI,CAAC,CAAA;oBACV,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,CAAA;gBACtB,CAAC,MAAM,CAAC;oBACN,KAAK,IAAI,CAAC,CAAA;oBACV,MAAM,IAAI,GAAG,MAAM,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAA;oBAC9C,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;wBACrC,KAAK,IAAI,CAAC,CAAA;wBACV,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA;wBACnB,MAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAA;wBACtB,IAAI,GAAG,KAAK,SAAS,EAAE,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;wBACtC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;oBACjB,CAAC;gBACH,CAAC;gBACD,MAAK;YACP,KAAK,UAAU;gBACb,KAAK,IAAI,CAAC,CAAA,CAAC,6DAA6D;gBACxE,MAAK;YACP,KAAK,QAAQ;gBACX,KAAK,IAAI,CAAC,CAAA,CAAC,6BAA6B;gBACxC,MAAK;YACP,KAAK,QAAQ;gBACX,KAAK,IAAI,EAAE,CAAA,CAAC,4BAA4B;gBACxC,MAAK;QACT,CAAC;IACH,CAAC;IAED,IAAI,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,IAAI,EAAE,CAAC;QAChD,UAAU,CAAC,GAAG,CAAC,KAAK,EAAE,KAAK,CAAC,CAAA;IAC9B,CAAC;IAED,OAAO,KAAK,CAAA;AACd,CAAC;AAvED,QAAA,iBAAA,GAAA,kBAuEC","ignoreList":[0]}},
    {"offset": {"line": 13523, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13528, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/simple-store-memory/src/index.ts"],"sourcesContent":["import { SimpleStore, Key, Value } from '@atproto-labs/simple-store'\nimport { LRUCache } from 'lru-cache'\n\nimport { roughSizeOfObject } from './util.js'\n\nexport type SimpleStoreMemoryOptions<K extends Key, V extends Value> = {\n  /**\n   * The maximum number of entries in the cache.\n   */\n  max?: number\n\n  /**\n   * The time-to-live of a cache entry, in milliseconds.\n   */\n  ttl?: number\n\n  /**\n   * Whether to automatically prune expired entries.\n   */\n  ttlAutopurge?: boolean\n\n  /**\n   * The maximum total size of the cache, in units defined by the sizeCalculation\n   * function.\n   *\n   * @default No limit\n   */\n  maxSize?: number\n\n  /**\n   * The maximum size of a single cache entry, in units defined by the\n   * sizeCalculation function.\n   *\n   * @default No limit\n   */\n  maxEntrySize?: number\n\n  /**\n   * A function that returns the size of a value. The size is used to determine\n   * when the cache should be pruned, based on `maxSize`.\n   *\n   * @default The (rough) size in bytes used in memory.\n   */\n  sizeCalculation?: (value: V, key: K) => number\n} & ( // Memory is not infinite, so at least one pruning option is required.\n  | { max: number }\n  | { maxSize: number }\n  | { ttl: number; ttlAutopurge: boolean }\n)\n\n// LRUCache does not allow storing \"null\", so we use a symbol to represent it.\nconst nullSymbol = Symbol('nullItem')\ntype AsLruValue<V extends Value> = V extends null\n  ? typeof nullSymbol\n  : Exclude<V, null>\nconst toLruValue = <V extends Value>(value: V) =>\n  (value === null ? nullSymbol : value) as AsLruValue<V>\nconst fromLruValue = <V extends Value>(value: AsLruValue<V>) =>\n  (value === nullSymbol ? null : value) as V\n\nexport class SimpleStoreMemory<K extends Key, V extends Value>\n  implements SimpleStore<K, V>\n{\n  #cache: LRUCache<K, AsLruValue<V>>\n\n  constructor({ sizeCalculation, ...options }: SimpleStoreMemoryOptions<K, V>) {\n    this.#cache = new LRUCache<K, AsLruValue<V>>({\n      ...options,\n      allowStale: false,\n      updateAgeOnGet: false,\n      updateAgeOnHas: false,\n      sizeCalculation: sizeCalculation\n        ? (value, key) => sizeCalculation(fromLruValue(value), key)\n        : options.maxEntrySize != null || options.maxSize != null\n          ? // maxEntrySize and maxSize require a size calculation function.\n            roughSizeOfObject\n          : undefined,\n    })\n  }\n\n  get(key: K): V | undefined {\n    const value = this.#cache.get(key)\n    if (value === undefined) return undefined\n\n    return fromLruValue(value)\n  }\n\n  set(key: K, value: V): void {\n    this.#cache.set(key, toLruValue(value))\n  }\n\n  del(key: K): void {\n    this.#cache.delete(key)\n  }\n\n  clear(): void {\n    this.#cache.clear()\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AACA,MAAA,mCAAoC;AAEpC,MAAA,iCAA6C;AA+C7C,8EAA8E;AAC9E,MAAM,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC,CAAA;AAIrC,MAAM,UAAU,GAAG,CAAkB,KAAQ,EAAE,CAC5C,CAD8C,CAC/C,GAAM,KAAK,IAAI,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,CAAkB,CAAA;AACxD,MAAM,YAAY,GAAG,CAAkB,KAAoB,EAAE,CAC1D,CAD4D,CAC7D,GAAM,KAAK,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAM,CAAA;AAE5C,MAAa,iBAAiB;IAK5B,YAAY,EAAE,eAAe,EAAE,GAAG,OAAO,EAAkC,CAAA;QAF3E,yBAAA,GAAA,CAAA,IAAA,EAAA,KAAA,GAAkC;QAGhC,uBAAA,IAAI,EAAA,0BAAU,IAAI,YAAA,QAAQ,CAAmB;YAC3C,GAAG,OAAO;YACV,UAAU,EAAE,KAAK;YACjB,cAAc,EAAE,KAAK;YACrB,cAAc,EAAE,KAAK;YACrB,eAAe,EAAE,eAAe,GAC5B,CAAC,KAAK,EAAE,GAAG,EAAE,CAAG,CAAD,cAAgB,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE,GAAG,CAAC,GACzD,OAAO,CAAC,YAAY,IAAI,IAAI,IAAI,OAAO,CAAC,OAAO,IAAI,IAAI,GAErD,UAAA,iBAAiB,GACjB,SAAS;SAChB,CAAC,EAAA,IAAA,CAAA;IACJ,CAAC;IAED,GAAG,CAAC,GAAM,EAAA;QACR,MAAM,KAAK,GAAG,uBAAA,IAAI,EAAA,0BAAA,IAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;QAClC,IAAI,KAAK,KAAK,SAAS,EAAE,OAAO,SAAS,CAAA;QAEzC,OAAO,YAAY,CAAC,KAAK,CAAC,CAAA;IAC5B,CAAC;IAED,GAAG,CAAC,GAAM,EAAE,KAAQ,EAAA;QAClB,uBAAA,IAAI,EAAA,0BAAA,IAAO,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,CAAC,KAAK,CAAC,CAAC,CAAA;IACzC,CAAC;IAED,GAAG,CAAC,GAAM,EAAA;QACR,uBAAA,IAAI,EAAA,0BAAA,IAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;IACzB,CAAC;IAED,KAAK,GAAA;QACH,uBAAA,IAAI,EAAA,0BAAA,IAAO,CAAC,KAAK,EAAE,CAAA;IACrB,CAAC;CACF;AAtCD,QAAA,iBAAA,GAAA,kBAsCC","ignoreList":[0]}},
    {"offset": {"line": 13579, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13584, "column": 0}, "map": {"version":3,"file":"did-cache-memory.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/did-cache-memory.ts"],"sourcesContent":["import { Did, DidDocument } from '@atproto/did'\nimport {\n  SimpleStoreMemory,\n  SimpleStoreMemoryOptions,\n} from '@atproto-labs/simple-store-memory'\n\nimport { DidCache } from './did-cache.js'\n\nconst DEFAULT_TTL = 3600 * 1000 // 1 hour\nconst DEFAULT_MAX_SIZE = 50 * 1024 * 1024 // ~50MB\n\nexport type DidCacheMemoryOptions = SimpleStoreMemoryOptions<Did, DidDocument>\n\nexport class DidCacheMemory\n  extends SimpleStoreMemory<Did, DidDocument>\n  implements DidCache\n{\n  constructor(options?: DidCacheMemoryOptions) {\n    super(\n      options?.max == null\n        ? { ttl: DEFAULT_TTL, maxSize: DEFAULT_MAX_SIZE, ...options }\n        : { ttl: DEFAULT_TTL, ...options },\n    )\n  }\n}\n"],"names":[],"mappings":";;;;;AACA,MAAA,qEAG0C;AAI1C,MAAM,WAAW,GAAG,IAAI,GAAG,IAAI,CAAA,CAAC,SAAS;AACzC,MAAM,gBAAgB,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI,CAAA,CAAC,QAAQ;AAIlD,MAAa,cACX,SAAQ,sBAAA,iBAAmC;IAG3C,YAAY,OAA+B,CAAA;QACzC,KAAK,CACH,OAAO,EAAE,GAAG,IAAI,IAAI,GAChB;YAAE,GAAG,EAAE,WAAW;YAAE,OAAO,EAAE,gBAAgB;YAAE,GAAG,OAAO;QAAA,CAAE,GAC3D;YAAE,GAAG,EAAE,WAAW;YAAE,GAAG,OAAO;QAAA,CAAE,CACrC,CAAA;IACH,CAAC;CACF;AAXD,QAAA,cAAA,GAAA,eAWC","ignoreList":[0]}},
    {"offset": {"line": 13605, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13610, "column": 0}, "map": {"version":3,"file":"cached-getter.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/simple-store/src/cached-getter.ts"],"sourcesContent":["import { Awaitable, SimpleStore, Key, Value } from './simple-store.js'\n\nexport type GetCachedOptions = {\n  signal?: AbortSignal\n\n  /**\n   * Do not use the cache to get the value. Always get a new value from the\n   * getter function.\n   *\n   * @default false\n   */\n  noCache?: boolean\n\n  /**\n   * When getting a value from the cache, allow the value to be returned even if\n   * it is stale.\n   *\n   * Has no effect if the `isStale` option was not provided to the CachedGetter.\n   *\n   * @default true // If the CachedGetter has an isStale option\n   * @default false // If no isStale option was provided to the CachedGetter\n   */\n  allowStale?: boolean\n}\n\nexport type Getter<K, V> = (\n  key: K,\n  options: undefined | GetCachedOptions,\n  storedValue: undefined | V,\n) => Awaitable<V>\n\nexport type CachedGetterOptions<K, V> = {\n  isStale?: (key: K, value: V) => boolean | PromiseLike<boolean>\n  onStoreError?: (err: unknown, key: K, value: V) => void | PromiseLike<void>\n  deleteOnError?: (\n    err: unknown,\n    key: K,\n    value: V,\n  ) => boolean | PromiseLike<boolean>\n}\n\ntype PendingItem<V> = Promise<{ value: V; isFresh: boolean }>\n\nconst returnTrue = () => true\nconst returnFalse = () => false\n\n/**\n * Wrapper utility that uses a store to speed up the retrieval of values from an\n * (expensive) getter function.\n */\nexport class CachedGetter<K extends Key = string, V extends Value = Value> {\n  private pending = new Map<K, PendingItem<V>>()\n\n  constructor(\n    readonly getter: Getter<K, V>,\n    readonly store: SimpleStore<K, V>,\n    readonly options?: Readonly<CachedGetterOptions<K, V>>,\n  ) {}\n\n  async get(key: K, options?: GetCachedOptions): Promise<V> {\n    options?.signal?.throwIfAborted()\n\n    const isStale = this.options?.isStale\n\n    const allowStored: (value: V) => Awaitable<boolean> = options?.noCache\n      ? returnFalse // Never allow stored values to be returned\n      : options?.allowStale || isStale == null\n        ? returnTrue // Always allow stored values to be returned\n        : async (value: V) => !(await isStale(key, value))\n\n    // As long as concurrent requests are made for the same key, only one\n    // request will be made to the cache & getter function at a time. This works\n    // because there is no async operation between the while() loop and the\n    // pending.set() call. Because of the \"single threaded\" nature of\n    // JavaScript, the pending item will be set before the next iteration of the\n    // while loop.\n    let previousExecutionFlow: undefined | PendingItem<V>\n    while ((previousExecutionFlow = this.pending.get(key))) {\n      try {\n        const { isFresh, value } = await previousExecutionFlow\n\n        if (isFresh) return value\n        if (await allowStored(value)) return value\n      } catch {\n        // Ignore errors from previous execution flows (they will have been\n        // propagated by that flow).\n      }\n\n      options?.signal?.throwIfAborted()\n    }\n\n    const currentExecutionFlow: PendingItem<V> = Promise.resolve()\n      .then(async () => {\n        const storedValue = await this.getStored(key, options)\n        if (storedValue !== undefined && (await allowStored(storedValue))) {\n          // Use the stored value as return value for the current execution\n          // flow. Notify other concurrent execution flows (that should be\n          // \"stuck\" in the loop before until this promise resolves) that we got\n          // a value, but that it came from the store (isFresh = false).\n          return { isFresh: false, value: storedValue }\n        }\n\n        return Promise.resolve()\n          .then(async () => (0, this.getter)(key, options, storedValue))\n          .catch(async (err) => {\n            if (storedValue !== undefined) {\n              try {\n                const deleteOnError = this.options?.deleteOnError\n                if (await deleteOnError?.(err, key, storedValue)) {\n                  await this.delStored(key, err)\n                }\n              } catch (error) {\n                throw new AggregateError(\n                  [err, error],\n                  'Error while deleting stored value',\n                )\n              }\n            }\n            throw err\n          })\n          .then(async (value) => {\n            // The value should be stored even is the signal was aborted.\n            await this.setStored(key, value)\n            return { isFresh: true, value }\n          })\n      })\n      .finally(() => {\n        this.pending.delete(key)\n      })\n\n    if (this.pending.has(key)) {\n      // This should never happen. Indeed, there must not be any 'await'\n      // statement between this and the loop iteration check meaning that\n      // this.pending.get returned undefined. It is there to catch bugs that\n      // would occur in future changes to the code.\n      throw new Error('Concurrent request for the same key')\n    }\n\n    this.pending.set(key, currentExecutionFlow)\n\n    const { value } = await currentExecutionFlow\n    return value\n  }\n\n  bind(key: K): (options?: GetCachedOptions) => Promise<V> {\n    return async (options) => this.get(key, options)\n  }\n\n  async getStored(key: K, options?: GetCachedOptions): Promise<V | undefined> {\n    try {\n      return await this.store.get(key, options)\n    } catch (err) {\n      return undefined\n    }\n  }\n\n  async setStored(key: K, value: V): Promise<void> {\n    try {\n      await this.store.set(key, value)\n    } catch (err) {\n      const onStoreError = this.options?.onStoreError\n      await onStoreError?.(err, key, value)\n    }\n  }\n\n  async delStored(key: K, _cause?: unknown): Promise<void> {\n    await this.store.del(key)\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 13743, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13748, "column": 0}, "map": {"version":3,"file":"simple-store.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/simple-store/src/simple-store.ts"],"sourcesContent":["export type Awaitable<V> = V | PromiseLike<V>\n\nexport type Key = string | number\nexport type Value = NonNullable<unknown> | null\n\nexport type GetOptions = { signal?: AbortSignal }\n\nexport interface SimpleStore<K extends Key = string, V extends Value = Value> {\n  /**\n   * @return undefined if the key is not in the store (which is why Value cannot contain \"undefined\").\n   */\n  get: (key: K, options?: GetOptions) => Awaitable<undefined | V>\n  set: (key: K, value: V) => Awaitable<void>\n  del: (key: K) => Awaitable<void>\n  clear?: () => Awaitable<void>\n}\n"],"names":[],"mappings":"","ignoreList":[0]}},
    {"offset": {"line": 13752, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13757, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/simple-store/src/index.ts"],"sourcesContent":["export * from './cached-getter.js'\nexport * from './simple-store.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,sIAAA,SAAkC;AAClC,qIAAA,SAAiC","ignoreList":[0]}},
    {"offset": {"line": 13782, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13787, "column": 0}, "map": {"version":3,"file":"did-cache.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/did-cache.ts"],"sourcesContent":["import { CachedGetter, SimpleStore } from '@atproto-labs/simple-store'\nimport { Did, DidDocument } from '@atproto/did'\n\nimport { DidCacheMemory } from './did-cache-memory.js'\nimport { DidMethod, ResolveDidOptions } from './did-method.js'\nimport { DidResolver, ResolvedDocument } from './did-resolver.js'\n\nexport type { DidMethod, ResolvedDocument, ResolveDidOptions }\n\nexport type DidCache = SimpleStore<Did, DidDocument>\n\nexport type DidResolverCachedOptions = { cache?: DidCache }\n\nexport class DidResolverCached<M extends string = string>\n  implements DidResolver<M>\n{\n  protected readonly getter: CachedGetter<Did, DidDocument>\n  constructor(\n    resolver: DidResolver<M>,\n    cache: DidCache = new DidCacheMemory(),\n  ) {\n    this.getter = new CachedGetter<Did, DidDocument>(\n      (did, options) => resolver.resolve(did, options),\n      cache,\n    )\n  }\n\n  public async resolve<D extends Did>(did: D, options?: ResolveDidOptions) {\n    return this.getter.get(did, options) as Promise<ResolvedDocument<D, M>>\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uDAAsE;AAGtE,MAAA,yDAAsD;AAUtD,MAAa,iBAAiB;IAI5B,YACE,QAAwB,EACxB,QAAkB,IAAI,sBAAA,cAAc,EAAE,CAAA;QAHrB,OAAA,cAAA,CAAA,IAAA,EAAA,UAAA;;;;;WAAsC;QAKvD,IAAI,CAAC,MAAM,GAAG,IAAI,eAAA,YAAY,CAC5B,CAAC,GAAG,EAAE,OAAO,EAAE,CAAG,CAAD,OAAS,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,EAChD,KAAK,CACN,CAAA;IACH,CAAC;IAEM,KAAK,CAAC,OAAO,CAAgB,GAAM,EAAE,OAA2B,EAAA;QACrE,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,CAAoC,CAAA;IACzE,CAAC;CACF;AAjBD,QAAA,iBAAA,GAAA,kBAiBC","ignoreList":[0]}},
    {"offset": {"line": 13809, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13814, "column": 0}, "map": {"version":3,"file":"did-method.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/did-method.ts"],"sourcesContent":["import { Did, DidDocument } from '@atproto/did'\n\nexport type ResolveDidOptions = {\n  signal?: AbortSignal\n  noCache?: boolean\n}\n\nexport interface DidMethod<Method extends string> {\n  resolve: (\n    did: Did<Method>,\n    options?: ResolveDidOptions,\n  ) => DidDocument | PromiseLike<DidDocument>\n}\n\nexport type DidMethods<M extends string> = {\n  [K in M]: DidMethod<K>\n}\n"],"names":[],"mappings":"","ignoreList":[0]}},
    {"offset": {"line": 13818, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13823, "column": 0}, "map": {"version":3,"file":"fetch-error.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/fetch/src/fetch-error.ts"],"sourcesContent":["export abstract class FetchError extends Error {\n  constructor(\n    public readonly statusCode: number,\n    message?: string,\n    options?: ErrorOptions,\n  ) {\n    super(message, options)\n  }\n\n  get expose() {\n    return true\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAsB,UAAW,SAAQ,KAAK;IAC5C,YACkB,UAAkB,EAClC,OAAgB,EAChB,OAAsB,CAAA;QAEtB,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QAJvB,OAAA,cAAA,CAAA,IAAA,EAAA,cAAA;;;;mBAAgB,UAAU;WAAQ;IAKpC,CAAC;IAED,IAAI,MAAM,GAAA;QACR,OAAO,IAAI,CAAA;IACb,CAAC;CACF;AAZD,QAAA,UAAA,GAAA,WAYC","ignoreList":[0]}},
    {"offset": {"line": 13843, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13848, "column": 0}, "map": {"version":3,"file":"fetch.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/fetch/src/fetch.ts"],"sourcesContent":["import { ThisParameterOverride } from './util.js'\n\nexport type FetchContext = void | null | typeof globalThis\n\nexport type FetchBound = (\n  input: string | URL | Request,\n  init?: RequestInit,\n) => Promise<Response>\n\n// NOT using \"typeof globalThis.fetch\" here because \"globalThis.fetch\" does not\n// have a \"this\" parameter, while runtimes do ensure that \"fetch\" is called with\n// the correct \"this\" parameter (either null, undefined, or window).\n\nexport type Fetch<C = FetchContext> = ThisParameterOverride<C, FetchBound>\n\nexport type SimpleFetchBound = (input: Request) => Promise<Response>\nexport type SimpleFetch<C = FetchContext> = ThisParameterOverride<\n  C,\n  SimpleFetchBound\n>\n\nexport function toRequestTransformer<C, O>(\n  requestTransformer: (this: C, input: Request) => O,\n): ThisParameterOverride<\n  C,\n  (input: string | URL | Request, init?: RequestInit) => O\n> {\n  return function (this: C, input, init) {\n    return requestTransformer.call(this, asRequest(input, init))\n  }\n}\n\nexport function asRequest(\n  input: string | URL | Request,\n  init?: RequestInit,\n): Request {\n  if (!init && input instanceof Request) return input\n  return new Request(input, init)\n}\n"],"names":[],"mappings":";;;;AAqBA,QAAA,oBAAA,GAAA,qBASC;AAED,QAAA,SAAA,GAAA,UAMC;AAjBD,SAAgB,oBAAoB,CAClC,kBAAkD;IAKlD,OAAO,SAAmB,KAAK,EAAE,IAAI;QACnC,OAAO,kBAAkB,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAA;IAC9D,CAAC,CAAA;AACH,CAAC;AAED,SAAgB,SAAS,CACvB,KAA6B,EAC7B,IAAkB;IAElB,IAAI,CAAC,IAAI,IAAI,KAAK,YAAY,OAAO,EAAE,OAAO,KAAK,CAAA;IACnD,OAAO,IAAI,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;AACjC,CAAC","ignoreList":[0]}},
    {"offset": {"line": 13863, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 13868, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/fetch/src/util.ts"],"sourcesContent":["// @TODO: Move some of these to a shared package ?\n\nexport type JsonScalar = string | number | boolean | null\nexport type Json = JsonScalar | Json[] | { [key: string]: undefined | Json }\nexport type JsonObject = { [key: string]: Json }\nexport type JsonArray = Json[]\n\nexport type ThisParameterOverride<\n  C,\n  Fn extends (...a: any) => any,\n> = Fn extends (...args: infer P) => infer R\n  ? ((this: C, ...args: P) => R) & {\n      bind(context: C): (...args: P) => R\n    }\n  : never\n\nexport function isIp(hostname: string) {\n  // IPv4\n  if (hostname.match(/^\\d+\\.\\d+\\.\\d+\\.\\d+$/)) return true\n\n  // IPv6\n  if (hostname.startsWith('[') && hostname.endsWith(']')) return true\n\n  return false\n}\n\nconst plainObjectProto = Object.prototype\nexport const ifObject = <V>(v: V) => {\n  if (typeof v === 'object' && v != null && !Array.isArray(v)) {\n    const proto = Object.getPrototypeOf(v)\n    if (proto === null || proto === plainObjectProto) {\n      // eslint-disable-next-line @typescript-eslint/ban-types\n      return v as V extends JsonScalar | JsonArray | Function | symbol\n        ? never\n        : V extends Json\n          ? V\n          : // Plain object are (mostly) safe to access using a string index\n            Record<string, unknown>\n    }\n  }\n\n  return undefined\n}\n\nexport const ifString = <V>(v: V) => (typeof v === 'string' ? v : undefined)\n\nexport class MaxBytesTransformStream extends TransformStream<\n  Uint8Array,\n  Uint8Array\n> {\n  constructor(maxBytes: number) {\n    // Note: negation accounts for invalid value types (NaN, non numbers)\n    if (!(maxBytes >= 0)) {\n      throw new TypeError('maxBytes must be a non-negative number')\n    }\n\n    let bytesRead = 0\n\n    super({\n      transform: (\n        chunk: Uint8Array,\n        ctrl: TransformStreamDefaultController<Uint8Array>,\n      ) => {\n        if ((bytesRead += chunk.length) <= maxBytes) {\n          ctrl.enqueue(chunk)\n        } else {\n          ctrl.error(new Error('Response too large'))\n        }\n      },\n    })\n  }\n}\n\nconst LINE_BREAK = /\\r?\\n/g\nexport function padLines(input: string, pad: string) {\n  if (!input) return input\n  return pad + input.replace(LINE_BREAK, `$&${pad}`)\n}\n\n/**\n * @param [onCancellationError] - Callback that will trigger to asynchronously\n * handle any error that occurs while cancelling the response body. Providing\n * this will speed up the process and avoid potential deadlocks. Defaults to\n * awaiting the cancellation operation. use `\"log\"` to log the error.\n * @see {@link https://undici.nodejs.org/#/?id=garbage-collection}\n * @note awaiting this function's result, when no `onCancellationError` is\n * provided, might result in a dead lock. Indeed, if the response was cloned(),\n * the response.body.cancel() method will not resolve until the other response's\n * body is consumed/cancelled.\n *\n * @example\n * ```ts\n * // Make sure response was not cloned, or that every cloned response was\n * // consumed/cancelled before awaiting this function's result.\n * await cancelBody(response)\n * ```\n * @example\n * ```ts\n * await cancelBody(response, (err) => {\n *   // No biggie, let's just log the error\n *   console.warn('Failed to cancel response body', err)\n * })\n * ```\n * @example\n * ```ts\n * // Will generate an \"unhandledRejection\" if an error occurs while cancelling\n * // the response body. This will likely crash the process.\n * await cancelBody(response, (err) => { throw err })\n * ```\n */\nexport async function cancelBody(\n  body: Body,\n  onCancellationError?: 'log' | ((err: unknown) => void),\n): Promise<void> {\n  if (\n    body.body &&\n    !body.bodyUsed &&\n    !body.body.locked &&\n    // Support for alternative fetch implementations\n    typeof body.body.cancel === 'function'\n  ) {\n    if (typeof onCancellationError === 'function') {\n      void body.body.cancel().catch(onCancellationError)\n    } else if (onCancellationError === 'log') {\n      void body.body.cancel().catch(logCancellationError)\n    } else {\n      await body.body.cancel()\n    }\n  }\n}\n\nexport function logCancellationError(err: unknown): void {\n  console.warn('Failed to cancel response body', err)\n}\n\nexport async function stringifyMessage(input: Body & { headers: Headers }) {\n  try {\n    const headers = stringifyHeaders(input.headers)\n    const payload = await stringifyBody(input)\n    return headers && payload ? `${headers}\\n${payload}` : headers || payload\n  } finally {\n    void cancelBody(input, 'log')\n  }\n}\n\nfunction stringifyHeaders(headers: Headers) {\n  return Array.from(headers)\n    .map(([name, value]) => `${name}: ${value}`)\n    .join('\\n')\n}\n\nasync function stringifyBody(body: Body) {\n  try {\n    const blob = await body.blob()\n    if (blob.type?.startsWith('text/')) {\n      const text = await blob.text()\n      return JSON.stringify(text)\n    }\n\n    if (/application\\/(?:\\w+\\+)?json/.test(blob.type)) {\n      const text = await blob.text()\n      return text.includes('\\n') ? JSON.stringify(JSON.parse(text)) : text\n    }\n\n    return `[Body size: ${blob.size}, type: ${JSON.stringify(blob.type)} ]`\n  } catch {\n    return '[Body could not be read]'\n  }\n}\n\nexport const extractUrl = (input: Request | string | URL) =>\n  typeof input === 'string'\n    ? new URL(input)\n    : input instanceof URL\n      ? input\n      : new URL(input.url)\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 13999, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14004, "column": 0}, "map": {"version":3,"file":"fetch-request.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/fetch/src/fetch-request.ts"],"sourcesContent":["import { FetchError } from './fetch-error.js'\nimport { asRequest } from './fetch.js'\nimport { extractUrl, isIp } from './util.js'\n\nexport class FetchRequestError extends FetchError {\n  constructor(\n    public readonly request: Request,\n    statusCode?: number,\n    message?: string,\n    options?: ErrorOptions,\n  ) {\n    if (statusCode == null || !message) {\n      const info = extractInfo(extractRootCause(options?.cause))\n      statusCode ??= info[0]\n      message ||= info[1]\n    }\n\n    super(statusCode, message, options)\n  }\n\n  get expose() {\n    // A 500 request error means that the request was not made due to an infra,\n    // programming or server side issue. The message should no be exposed to\n    // downstream clients.\n    return this.statusCode !== 500\n  }\n\n  static from(request: Request, cause: unknown): FetchRequestError {\n    if (cause instanceof FetchRequestError) return cause\n    return new FetchRequestError(request, undefined, undefined, { cause })\n  }\n}\n\nfunction extractRootCause(err: unknown): unknown {\n  // Unwrap the Network error from undici (i.e. Node's internal fetch() implementation)\n  // https://github.com/nodejs/undici/blob/3274c975947ce11a08508743df026f73598bfead/lib/web/fetch/index.js#L223-L228\n  if (\n    err instanceof TypeError &&\n    err.message === 'fetch failed' &&\n    err.cause !== undefined\n  ) {\n    return err.cause\n  }\n\n  return err\n}\n\nfunction extractInfo(err: unknown): [statusCode: number, message: string] {\n  if (typeof err === 'string' && err.length > 0) {\n    return [500, err]\n  }\n\n  if (!(err instanceof Error)) {\n    return [500, 'Failed to fetch']\n  }\n\n  // Undici fetch() \"network\" errors\n  switch (err.message) {\n    case 'failed to fetch the data URL':\n      return [400, err.message]\n    case 'unexpected redirect':\n    case 'cors failure':\n    case 'blocked':\n    case 'proxy authentication required':\n      // These cases could be represented either as a 4xx user error (invalid\n      // URL provided), or as a 5xx server error (server didn't behave as\n      // expected).\n      return [502, err.message]\n  }\n\n  // NodeJS errors\n  const code = err['code']\n  if (typeof code === 'string') {\n    switch (true) {\n      case code === 'ENOTFOUND':\n        return [400, 'Invalid hostname']\n      case code === 'ECONNREFUSED':\n        return [502, 'Connection refused']\n      case code === 'DEPTH_ZERO_SELF_SIGNED_CERT':\n        return [502, 'Self-signed certificate']\n      case code.startsWith('ERR_TLS'):\n        return [502, 'TLS error']\n      case code.startsWith('ECONN'):\n        return [502, 'Connection error']\n      default:\n        return [500, `${code} error`]\n    }\n  }\n\n  return [500, err.message]\n}\n\nexport function protocolCheckRequestTransform(protocols: {\n  'about:'?: boolean\n  'blob:'?: boolean\n  'data:'?: boolean\n  'file:'?: boolean\n  'http:'?: boolean | { allowCustomPort: boolean }\n  'https:'?: boolean | { allowCustomPort: boolean }\n}) {\n  return (input: Request | string | URL, init?: RequestInit) => {\n    const { protocol, port } = extractUrl(input)\n\n    const request = asRequest(input, init)\n\n    const config: undefined | boolean | { allowCustomPort?: boolean } =\n      Object.hasOwn(protocols, protocol) ? protocols[protocol] : undefined\n\n    if (!config) {\n      throw new FetchRequestError(\n        request,\n        400,\n        `Forbidden protocol \"${protocol}\"`,\n      )\n    } else if (config === true) {\n      // Safe to proceed\n    } else if (!config['allowCustomPort'] && port !== '') {\n      throw new FetchRequestError(\n        request,\n        400,\n        `Custom ${protocol} ports not allowed`,\n      )\n    }\n\n    return request\n  }\n}\n\nexport function redirectCheckRequestTransform() {\n  return (input: Request | string | URL, init?: RequestInit) => {\n    const request = asRequest(input, init)\n\n    if (request.redirect === 'follow') {\n      throw new FetchRequestError(\n        request,\n        500,\n        'Request redirect must be \"error\" or \"manual\"',\n      )\n    }\n\n    return request\n  }\n}\n\nexport function requireHostHeaderTransform() {\n  return (input: Request | string | URL, init?: RequestInit) => {\n    // Note that fetch() will automatically add the Host header from the URL and\n    // discard any Host header manually set in the request.\n\n    const { protocol, hostname } = extractUrl(input)\n\n    const request = asRequest(input, init)\n\n    // \"Host\" header only makes sense in the context of an HTTP request\n    if (protocol !== 'http:' && protocol !== 'https:') {\n      throw new FetchRequestError(\n        request,\n        400,\n        `\"${protocol}\" requests are not allowed`,\n      )\n    }\n\n    if (!hostname || isIp(hostname)) {\n      throw new FetchRequestError(request, 400, 'Invalid hostname')\n    }\n\n    return request\n  }\n}\n\nexport const DEFAULT_FORBIDDEN_DOMAIN_NAMES = [\n  'example.com',\n  '*.example.com',\n  'example.org',\n  '*.example.org',\n  'example.net',\n  '*.example.net',\n  'googleusercontent.com',\n  '*.googleusercontent.com',\n]\n\nexport function forbiddenDomainNameRequestTransform(\n  denyList: Iterable<string> = DEFAULT_FORBIDDEN_DOMAIN_NAMES,\n) {\n  const denySet = new Set<string>(denyList)\n\n  // Optimization: if no forbidden domain names are provided, we can skip the\n  // check entirely.\n  if (denySet.size === 0) {\n    return asRequest\n  }\n\n  return async (input: Request | string | URL, init?: RequestInit) => {\n    const { hostname } = extractUrl(input)\n\n    const request = asRequest(input, init)\n\n    // Full domain name check\n    if (denySet.has(hostname)) {\n      throw new FetchRequestError(request, 403, 'Forbidden hostname')\n    }\n\n    // Sub domain name check\n    let curDot = hostname.indexOf('.')\n    while (curDot !== -1) {\n      const subdomain = hostname.slice(curDot + 1)\n      if (denySet.has(`*.${subdomain}`)) {\n        throw new FetchRequestError(request, 403, 'Forbidden hostname')\n      }\n      curDot = hostname.indexOf('.', curDot + 1)\n    }\n\n    return request\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 14202, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14207, "column": 0}, "map": {"version":3,"file":"pipe.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/pipe/src/pipe.ts"],"sourcesContent":["import { Transformer } from './transformer.js'\n\ntype PipelineInput<T extends readonly Transformer<any>[]> = T extends [\n  Transformer<infer I, any>,\n  ...any[],\n]\n  ? I\n  : T extends Transformer<infer I, any>[]\n    ? I\n    : never\n\ntype PipelineOutput<T extends readonly Transformer<any>[]> = T extends [\n  ...any[],\n  Transformer<any, infer O>,\n]\n  ? O\n  : T extends Transformer<any, infer O>[]\n    ? O\n    : never\n\ntype Pipeline<\n  F extends readonly Transformer<any>[],\n  Acc extends readonly Transformer<any>[] = [],\n> = F extends [Transformer<infer I, infer O>]\n  ? [...Acc, Transformer<I, O>]\n  : F extends [Transformer<infer A, any>, ...infer Tail]\n    ? Tail extends [Transformer<infer B, any>, ...any[]]\n      ? Pipeline<Tail, [...Acc, Transformer<A, B>]>\n      : Acc\n    : Acc\n\n/**\n * This utility function allows to properly type a pipeline of transformers.\n *\n * @example\n * ```ts\n * // Will be typed as \"(input: string) => Promise<number>\"\n * const parse = pipe(\n *   async (input: string) => JSON.parse(input),\n *   async (input: unknown) => {\n *     if (typeof input === 'number') return input\n *     throw new TypeError('Invalid input')\n *   },\n *   (input: number) => input * 2,\n * )\n * ```\n */\nexport function pipe(): never\nexport function pipe<T extends readonly Transformer<any>[]>(\n  ...pipeline: Pipeline<T> extends T ? T : Pipeline<T>\n): (input: PipelineInput<T>) => Promise<PipelineOutput<T>>\nexport function pipe<T extends readonly Transformer<any>[]>(\n  ...pipeline: Pipeline<T> extends T ? T : Pipeline<T>\n): (input: PipelineInput<T>) => Promise<PipelineOutput<T>> {\n  return pipeline.reduce(pipeTwo)\n}\n\nexport function pipeTwo<I, O, X = unknown>(\n  first: Transformer<I, X>,\n  second: Transformer<X, O>,\n): (input: I) => Promise<O> {\n  return async (input) => second(await first(input))\n}\n"],"names":[],"mappings":";;;;;AAmDA,SAAgB,IAAI,CAClB,GAAG,QAAiD;IAEpD,OAAO,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,CAAA;AACjC,CAAC;AAJD,QAAA,IAAA,GAAA,KAIC;AAED,SAAgB,OAAO,CACrB,KAAwB,EACxB,MAAyB;IAEzB,OAAO,KAAK,EAAE,KAAK,EAAE,CAAG,CAAD,KAAO,CAAC,MAAM,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;AACpD,CAAC;AALD,QAAA,OAAA,GAAA,QAKC","ignoreList":[0]}},
    {"offset": {"line": 14220, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14225, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/pipe/src/index.ts"],"sourcesContent":["export { pipe, pipeTwo } from './pipe.js'\nexport { type Transformer } from './transformer.js'\n"],"names":[],"mappings":";;;;;AAAA,IAAA,iCAAyC;AAAhC,OAAA,cAAA,CAAA,SAAA,QAAA;IAAA,YAAA;IAAA,KAAA;QAAA,OAAA,UAAA,IAAI;IAAA;AAAA,GAAA;AAAE,OAAA,cAAA,CAAA,SAAA,WAAA;IAAA,YAAA;IAAA,KAAA;QAAA,OAAA,UAAA,OAAO;IAAA;AAAA,GAAA","ignoreList":[0]}},
    {"offset": {"line": 14243, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14248, "column": 0}, "map": {"version":3,"file":"transformed-response.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/fetch/src/transformed-response.ts"],"sourcesContent":["export class TransformedResponse extends Response {\n  #response: Response\n\n  constructor(response: Response, transform: TransformStream) {\n    if (!response.body) {\n      throw new TypeError('Response body is not available')\n    }\n    if (response.bodyUsed) {\n      throw new TypeError('Response body is already used')\n    }\n\n    super(response.body.pipeThrough(transform), {\n      status: response.status,\n      statusText: response.statusText,\n      headers: response.headers,\n    })\n\n    this.#response = response\n  }\n\n  /**\n   * Some props can't be set through ResponseInit, so we need to proxy them\n   */\n  get url() {\n    return this.#response.url\n  }\n  get redirected() {\n    return this.#response.redirected\n  }\n  get type() {\n    return this.#response.type\n  }\n  get statusText() {\n    return this.#response.statusText\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA,MAAa,mBAAoB,SAAQ,QAAQ;IAG/C,YAAY,QAAkB,EAAE,SAA0B,CAAA;QACxD,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YACnB,MAAM,IAAI,SAAS,CAAC,gCAAgC,CAAC,CAAA;QACvD,CAAC;QACD,IAAI,QAAQ,CAAC,QAAQ,EAAE,CAAC;YACtB,MAAM,IAAI,SAAS,CAAC,+BAA+B,CAAC,CAAA;QACtD,CAAC;QAED,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,EAAE;YAC1C,MAAM,EAAE,QAAQ,CAAC,MAAM;YACvB,UAAU,EAAE,QAAQ,CAAC,UAAU;YAC/B,OAAO,EAAE,QAAQ,CAAC,OAAO;SAC1B,CAAC,CAAA;QAdJ,8BAAA,GAAA,CAAA,IAAA,EAAA,KAAA,GAAmB;QAgBjB,uBAAA,IAAI,EAAA,+BAAa,QAAQ,EAAA,IAAA,CAAA;IAC3B,CAAC;IAED;;OAEG,CACH,IAAI,GAAG,GAAA;QACL,OAAO,uBAAA,IAAI,EAAA,+BAAA,IAAU,CAAC,GAAG,CAAA;IAC3B,CAAC;IACD,IAAI,UAAU,GAAA;QACZ,OAAO,uBAAA,IAAI,EAAA,+BAAA,IAAU,CAAC,UAAU,CAAA;IAClC,CAAC;IACD,IAAI,IAAI,GAAA;QACN,OAAO,uBAAA,IAAI,EAAA,+BAAA,IAAU,CAAC,IAAI,CAAA;IAC5B,CAAC;IACD,IAAI,UAAU,GAAA;QACZ,OAAO,uBAAA,IAAI,EAAA,+BAAA,IAAU,CAAC,UAAU,CAAA;IAClC,CAAC;CACF;AAnCD,QAAA,mBAAA,GAAA,oBAmCC","ignoreList":[0]}},
    {"offset": {"line": 14298, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14303, "column": 0}, "map": {"version":3,"file":"fetch-response.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/fetch/src/fetch-response.ts"],"sourcesContent":["import { Transformer, pipe } from '@atproto-labs/pipe'\n\n// optional dependency for typing purposes\nimport type { ZodTypeAny, ParseParams, TypeOf } from 'zod'\n\nimport { FetchError } from './fetch-error.js'\nimport { TransformedResponse } from './transformed-response.js'\nimport {\n  Json,\n  MaxBytesTransformStream,\n  cancelBody,\n  ifObject,\n  ifString,\n  logCancellationError,\n} from './util.js'\n\n/**\n * media-type     = type \"/\" subtype *( \";\" parameter )\n * type           = token\n * subtype        = token\n * token          = 1*<any CHAR except CTLs or separators>\n * separators     = \"(\" | \")\" | \"<\" | \">\" | \"@\"\n *                | \",\" | \";\" | \":\" | \"\\\" | <\">\n *                | \"/\" | \"[\" | \"]\" | \"?\" | \"=\"\n *                | \"{\" | \"}\" | SP | HT\n * CTL            = <any US-ASCII control character (octets 0 - 31) and DEL (127)>\n * SP             = <US-ASCII SP, space (32)>\n * HT             = <US-ASCII HT, horizontal-tab (9)>\n * @note The type, subtype, and parameter attribute names are case-insensitive.\n * @see {@link https://datatracker.ietf.org/doc/html/rfc2616#autoid-23}\n */\nconst JSON_MIME = /^application\\/(?:[^()<>@,;:/[\\]\\\\?={} \\t]+\\+)?json$/i\n\nexport type ResponseTransformer = Transformer<Response>\nexport type ResponseMessageGetter = Transformer<Response, string | undefined>\n\nexport class FetchResponseError extends FetchError {\n  constructor(\n    public readonly response: Response,\n    statusCode: number = response.status,\n    message: string = response.statusText,\n    options?: ErrorOptions,\n  ) {\n    super(statusCode, message, options)\n  }\n\n  static async from(\n    response: Response,\n    customMessage: string | ResponseMessageGetter = extractResponseMessage,\n    statusCode = response.status,\n    options?: ErrorOptions,\n  ) {\n    const message =\n      typeof customMessage === 'string'\n        ? customMessage\n        : typeof customMessage === 'function'\n          ? await customMessage(response)\n          : undefined\n\n    return new FetchResponseError(response, statusCode, message, options)\n  }\n}\n\nconst extractResponseMessage: ResponseMessageGetter = async (response) => {\n  const mimeType = extractMime(response)\n  if (!mimeType) return undefined\n\n  try {\n    if (mimeType === 'text/plain') {\n      return await response.text()\n    } else if (JSON_MIME.test(mimeType)) {\n      const json: unknown = await response.json()\n\n      if (typeof json === 'string') return json\n\n      const errorDescription = ifString(ifObject(json)?.['error_description'])\n      if (errorDescription) return errorDescription\n\n      const error = ifString(ifObject(json)?.['error'])\n      if (error) return error\n\n      const message = ifString(ifObject(json)?.['message'])\n      if (message) return message\n    }\n  } catch {\n    // noop\n  }\n\n  return undefined\n}\n\nexport async function peekJson(\n  response: Response,\n  maxSize = Infinity,\n): Promise<undefined | Json> {\n  const type = extractMime(response)\n  if (type !== 'application/json') return undefined\n  checkLength(response, maxSize)\n\n  // 1) Clone the request so we can consume the body\n  const clonedResponse = response.clone()\n\n  // 2) Make sure the request's body is not too large\n  const limitedResponse =\n    response.body && maxSize < Infinity\n      ? new TransformedResponse(\n          clonedResponse,\n          new MaxBytesTransformStream(maxSize),\n        )\n      : // Note: some runtimes (e.g. react-native) don't expose a body property\n        clonedResponse\n\n  // 3) Parse the JSON\n  return limitedResponse.json()\n}\n\nexport function checkLength(response: Response, maxBytes: number) {\n  // Note: negation accounts for invalid value types (NaN, non numbers)\n  if (!(maxBytes >= 0)) {\n    throw new TypeError('maxBytes must be a non-negative number')\n  }\n  const length = extractLength(response)\n  if (length != null && length > maxBytes) {\n    throw new FetchResponseError(response, 502, 'Response too large')\n  }\n  return length\n}\n\nexport function extractLength(response: Response) {\n  const contentLength = response.headers.get('Content-Length')\n  if (contentLength == null) return undefined\n  if (!/^\\d+$/.test(contentLength)) {\n    throw new FetchResponseError(response, 502, 'Invalid Content-Length')\n  }\n  const length = Number(contentLength)\n  if (!Number.isSafeInteger(length)) {\n    throw new FetchResponseError(response, 502, 'Content-Length too large')\n  }\n  return length\n}\n\nexport function extractMime(response: Response) {\n  const contentType = response.headers.get('Content-Type')\n  if (contentType == null) return undefined\n\n  return contentType.split(';', 1)[0]!.trim()\n}\n\n/**\n * If the transformer results in an error, ensure that the response body is\n * consumed as, in some environments (Node ), the response will not\n * automatically be GC'd.\n *\n * @see {@link https://undici.nodejs.org/#/?id=garbage-collection}\n * @param [onCancellationError] - Callback to handle any async body cancelling\n * error. Defaults to logging the error. Do not use `null` if the request is\n * cloned.\n */\nexport function cancelBodyOnError<T>(\n  transformer: Transformer<Response, T>,\n  onCancellationError: null | ((err: unknown) => void) = logCancellationError,\n): (response: Response) => Promise<T> {\n  return async (response) => {\n    try {\n      return await transformer(response)\n    } catch (err) {\n      await cancelBody(response, onCancellationError ?? undefined)\n      throw err\n    }\n  }\n}\n\nexport function fetchOkProcessor(\n  customMessage?: string | ResponseMessageGetter,\n): ResponseTransformer {\n  return cancelBodyOnError((response) => {\n    return fetchOkTransformer(response, customMessage)\n  })\n}\n\nexport async function fetchOkTransformer(\n  response: Response,\n  customMessage?: string | ResponseMessageGetter,\n) {\n  if (response.ok) return response\n  throw await FetchResponseError.from(response, customMessage)\n}\n\nexport function fetchMaxSizeProcessor(maxBytes: number): ResponseTransformer {\n  if (maxBytes === Infinity) return (response) => response\n  if (!Number.isFinite(maxBytes) || maxBytes < 0) {\n    throw new TypeError('maxBytes must be a 0, Infinity or a positive number')\n  }\n  return cancelBodyOnError((response) => {\n    return fetchResponseMaxSizeChecker(response, maxBytes)\n  })\n}\n\nexport function fetchResponseMaxSizeChecker(\n  response: Response,\n  maxBytes: number,\n): Response {\n  if (maxBytes === Infinity) return response\n  checkLength(response, maxBytes)\n\n  // Some engines (react-native ) don't expose a body property. In that case,\n  // we will only rely on the Content-Length header.\n  if (!response.body) return response\n\n  const transform = new MaxBytesTransformStream(maxBytes)\n  return new TransformedResponse(response, transform)\n}\n\nexport type MimeTypeCheckFn = (mimeType: string) => boolean\nexport type MimeTypeCheck = string | RegExp | MimeTypeCheckFn\n\nexport function fetchTypeProcessor(\n  expectedMime: MimeTypeCheck,\n  contentTypeRequired = true,\n): ResponseTransformer {\n  const isExpected: MimeTypeCheckFn =\n    typeof expectedMime === 'string'\n      ? (mimeType) => mimeType === expectedMime\n      : expectedMime instanceof RegExp\n        ? (mimeType) => expectedMime.test(mimeType)\n        : expectedMime\n\n  return cancelBodyOnError((response) => {\n    return fetchResponseTypeChecker(response, isExpected, contentTypeRequired)\n  })\n}\n\nexport async function fetchResponseTypeChecker(\n  response: Response,\n  isExpectedMime: MimeTypeCheckFn,\n  contentTypeRequired = true,\n): Promise<Response> {\n  const mimeType = extractMime(response)\n  if (mimeType) {\n    if (!isExpectedMime(mimeType.toLowerCase())) {\n      throw await FetchResponseError.from(\n        response,\n        `Unexpected response Content-Type (${mimeType})`,\n        502,\n      )\n    }\n  } else if (contentTypeRequired) {\n    throw await FetchResponseError.from(\n      response,\n      'Missing response Content-Type header',\n      502,\n    )\n  }\n\n  return response\n}\n\nexport type ParsedJsonResponse<T = Json> = {\n  response: Response\n  json: T\n}\n\nexport async function fetchResponseJsonTransformer<T = Json>(\n  response: Response,\n): Promise<ParsedJsonResponse<T>> {\n  try {\n    const json = (await response.json()) as T\n    return { response, json }\n  } catch (cause) {\n    throw new FetchResponseError(\n      response,\n      502,\n      'Unable to parse response as JSON',\n      { cause },\n    )\n  }\n}\n\nexport function fetchJsonProcessor<T = Json>(\n  expectedMime: MimeTypeCheck = JSON_MIME,\n  contentTypeRequired = true,\n): Transformer<Response, ParsedJsonResponse<T>> {\n  return pipe(\n    fetchTypeProcessor(expectedMime, contentTypeRequired),\n    cancelBodyOnError(fetchResponseJsonTransformer<T>),\n  )\n}\n\nexport function fetchJsonZodProcessor<S extends ZodTypeAny>(\n  schema: S,\n  params?: Partial<ParseParams>,\n): Transformer<ParsedJsonResponse, TypeOf<S>> {\n  return async (jsonResponse: ParsedJsonResponse): Promise<TypeOf<S>> =>\n    schema.parseAsync(jsonResponse.json, params)\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 14499, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14504, "column": 0}, "map": {"version":3,"file":"fetch-wrap.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/fetch/src/fetch-wrap.ts"],"sourcesContent":["import { FetchRequestError } from './fetch-request.js'\nimport { Fetch, FetchContext, toRequestTransformer } from './fetch.js'\nimport { TransformedResponse } from './transformed-response.js'\nimport { padLines, stringifyMessage } from './util.js'\n\ntype LogFn<Args extends unknown[]> = (...args: Args) => void | PromiseLike<void>\n\nexport function loggedFetch<C = FetchContext>({\n  fetch = globalThis.fetch as Fetch<C>,\n  logRequest = true as boolean | LogFn<[request: Request]>,\n  logResponse = true as boolean | LogFn<[response: Response, request: Request]>,\n  logError = true as boolean | LogFn<[error: unknown, request: Request]>,\n}) {\n  const onRequest =\n    logRequest === true\n      ? async (request) => {\n          const requestMessage = await stringifyMessage(request)\n          console.info(\n            `> ${request.method} ${request.url}\\n${padLines(requestMessage, '  ')}`,\n          )\n        }\n      : logRequest || undefined\n\n  const onResponse =\n    logResponse === true\n      ? async (response) => {\n          const responseMessage = await stringifyMessage(response.clone())\n          console.info(\n            `< HTTP/1.1 ${response.status} ${response.statusText}\\n${padLines(responseMessage, '  ')}`,\n          )\n        }\n      : logResponse || undefined\n\n  const onError =\n    logError === true\n      ? async (error) => {\n          console.error(`< Error:`, error)\n        }\n      : logError || undefined\n\n  if (!onRequest && !onResponse && !onError) return fetch\n\n  return toRequestTransformer(async function (\n    this: C,\n    request,\n  ): Promise<Response> {\n    if (onRequest) await onRequest(request)\n\n    try {\n      const response = await fetch.call(this, request)\n\n      if (onResponse) await onResponse(response, request)\n\n      return response\n    } catch (error) {\n      if (onError) await onError(error, request)\n\n      throw error\n    }\n  })\n}\n\nexport const timedFetch = <C = FetchContext>(\n  timeout = 60e3,\n  fetch: Fetch<C> = globalThis.fetch,\n): Fetch<C> => {\n  if (timeout === Infinity) return fetch\n  if (!Number.isFinite(timeout) || timeout <= 0) {\n    throw new TypeError('Timeout must be positive')\n  }\n  return toRequestTransformer(async function (\n    this: C,\n    request,\n  ): Promise<Response> {\n    const controller = new AbortController()\n    const signal = controller.signal\n\n    const abort = () => {\n      controller.abort()\n    }\n    const cleanup = () => {\n      clearTimeout(timer)\n      request.signal?.removeEventListener('abort', abort)\n    }\n\n    const timer = setTimeout(abort, timeout)\n    if (typeof timer === 'object') timer.unref?.() // only on node\n    request.signal?.addEventListener('abort', abort)\n\n    signal.addEventListener('abort', cleanup)\n\n    const response = await fetch.call(this, request, { signal })\n\n    if (!response.body) {\n      cleanup()\n      return response\n    } else {\n      // Cleanup the timer & event listeners when the body stream is closed\n      const transform = new TransformStream({ flush: cleanup })\n      return new TransformedResponse(response, transform)\n    }\n  })\n}\n\n/**\n * Wraps a fetch function to bind it to a specific context, and wrap any thrown\n * errors into a FetchRequestError.\n *\n * @example\n *\n * ```ts\n * class MyClient {\n *   constructor(private fetch = globalThis.fetch) {}\n *\n *   async get(url: string) {\n *     // This will generate an error, because the context used is not a\n *     // FetchContext (it's a MyClient instance).\n *     return this.fetch(url)\n *   }\n * }\n * ```\n *\n * @example\n *\n * ```ts\n * class MyClient {\n *   private fetch: Fetch<unknown>\n *\n *   constructor(fetch = globalThis.fetch) {\n *     this.fetch = bindFetch(fetch)\n *   }\n *\n *   async get(url: string) {\n *     return this.fetch(url) // no more error\n *   }\n * }\n * ```\n */\nexport function bindFetch<C = FetchContext>(\n  fetch: Fetch<C> = globalThis.fetch,\n  context: C = globalThis as C,\n) {\n  return toRequestTransformer(async (request) => {\n    try {\n      return await fetch.call(context, request)\n    } catch (err) {\n      throw FetchRequestError.from(request, err)\n    }\n  })\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 14617, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14622, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/fetch/src/index.ts"],"sourcesContent":["export * from './fetch-error.js'\nexport * from './fetch-request.js'\nexport * from './fetch-response.js'\nexport * from './fetch-wrap.js'\nexport * from './fetch.js'\nexport * from './util.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,6HAAA,SAAgC;AAChC,+HAAA,SAAkC;AAClC,gIAAA,SAAmC;AACnC,4HAAA,SAA+B;AAC/B,uHAAA,SAA0B;AAC1B,sHAAA,SAAyB","ignoreList":[0]}},
    {"offset": {"line": 14651, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14656, "column": 0}, "map": {"version":3,"file":"did-resolver-base.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/did-resolver-base.ts"],"sourcesContent":["import { FetchRequestError } from '@atproto-labs/fetch'\nimport { Did, DidError, extractDidMethod } from '@atproto/did'\nimport { ZodError } from 'zod'\n\nimport { DidMethod, DidMethods, ResolveDidOptions } from './did-method.js'\nimport { DidResolver, ResolvedDocument } from './did-resolver.js'\n\nexport type { DidMethod, ResolvedDocument, ResolveDidOptions }\n\nexport class DidResolverBase<M extends string = string>\n  implements DidResolver<M>\n{\n  protected readonly methods: Map<string, DidMethod<M>>\n\n  constructor(methods: DidMethods<M>) {\n    this.methods = new Map(Object.entries(methods))\n  }\n\n  async resolve<D extends Did>(\n    did: D,\n    options?: ResolveDidOptions,\n  ): Promise<ResolvedDocument<D, M>> {\n    options?.signal?.throwIfAborted()\n\n    const method = extractDidMethod(did)\n    const resolver = this.methods.get(method)\n    if (!resolver) {\n      throw new DidError(\n        did,\n        `Unsupported DID method`,\n        'did-method-invalid',\n        400,\n      )\n    }\n\n    try {\n      const document = await resolver.resolve(did as Did<M>, options)\n      if (document.id !== did) {\n        throw new DidError(\n          did,\n          `DID document id (${document.id}) does not match DID`,\n          'did-document-id-mismatch',\n          400,\n        )\n      }\n\n      return document as ResolvedDocument<D, M>\n    } catch (err) {\n      if (err instanceof FetchRequestError) {\n        throw new DidError(did, err.message, 'did-fetch-error', 400, err)\n      }\n\n      if (err instanceof ZodError) {\n        throw new DidError(\n          did,\n          err.message,\n          'did-document-format-error',\n          503,\n          err,\n        )\n      }\n\n      throw DidError.from(err, did)\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,yCAAuD;AACvD,MAAA,gCAA8D;AAC9D,MAAA,uBAA8B;AAO9B,MAAa,eAAe;IAK1B,YAAY,OAAsB,CAAA;QAFf,OAAA,cAAA,CAAA,IAAA,EAAA,WAAA;;;;;WAAkC;QAGnD,IAAI,CAAC,OAAO,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAA;IACjD,CAAC;IAED,KAAK,CAAC,OAAO,CACX,GAAM,EACN,OAA2B,EAAA;QAE3B,OAAO,EAAE,MAAM,EAAE,cAAc,EAAE,CAAA;QAEjC,MAAM,MAAM,GAAG,CAAA,GAAA,MAAA,gBAAgB,EAAC,GAAG,CAAC,CAAA;QACpC,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;QACzC,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,MAAM,IAAI,MAAA,QAAQ,CAChB,GAAG,EACH,CAAA,sBAAA,CAAwB,EACxB,oBAAoB,EACpB,GAAG,CACJ,CAAA;QACH,CAAC;QAED,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,QAAQ,CAAC,OAAO,CAAC,GAAa,EAAE,OAAO,CAAC,CAAA;YAC/D,IAAI,QAAQ,CAAC,EAAE,KAAK,GAAG,EAAE,CAAC;gBACxB,MAAM,IAAI,MAAA,QAAQ,CAChB,GAAG,EACH,CAAA,iBAAA,EAAoB,QAAQ,CAAC,EAAE,CAAA,oBAAA,CAAsB,EACrD,0BAA0B,EAC1B,GAAG,CACJ,CAAA;YACH,CAAC;YAED,OAAO,QAAkC,CAAA;QAC3C,CAAC,CAAC,OAAO,GAAG,EAAE,CAAC;YACb,IAAI,GAAG,YAAY,QAAA,iBAAiB,EAAE,CAAC;gBACrC,MAAM,IAAI,MAAA,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,OAAO,EAAE,iBAAiB,EAAE,GAAG,EAAE,GAAG,CAAC,CAAA;YACnE,CAAC;YAED,IAAI,GAAG,YAAY,MAAA,QAAQ,EAAE,CAAC;gBAC5B,MAAM,IAAI,MAAA,QAAQ,CAChB,GAAG,EACH,GAAG,CAAC,OAAO,EACX,2BAA2B,EAC3B,GAAG,EACH,GAAG,CACJ,CAAA;YACH,CAAC;YAED,MAAM,MAAA,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CAAA;QAC/B,CAAC;IACH,CAAC;CACF;AAxDD,QAAA,eAAA,GAAA,gBAwDC","ignoreList":[0]}},
    {"offset": {"line": 14699, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14704, "column": 0}, "map": {"version":3,"file":"plc.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/methods/plc.ts"],"sourcesContent":["import {\n  Fetch,\n  bindFetch,\n  fetchJsonProcessor,\n  fetchJsonZodProcessor,\n  fetchOkProcessor,\n} from '@atproto-labs/fetch'\nimport { pipe } from '@atproto-labs/pipe'\nimport { Did, assertDidPlc, didDocumentValidator } from '@atproto/did'\n\nimport { DidMethod, ResolveDidOptions } from '../did-method.js'\n\nconst fetchSuccessHandler = pipe(\n  fetchOkProcessor(),\n  fetchJsonProcessor(/^application\\/(did\\+ld\\+)?json$/),\n  fetchJsonZodProcessor(didDocumentValidator),\n)\n\nexport type DidPlcMethodOptions = {\n  /**\n   * @default globalThis.fetch\n   */\n  fetch?: Fetch\n\n  /**\n   * @default 'https://plc.directory/'\n   */\n  plcDirectoryUrl?: string | URL\n}\n\nexport class DidPlcMethod implements DidMethod<'plc'> {\n  protected readonly fetch: Fetch<unknown>\n\n  public readonly plcDirectoryUrl: URL\n\n  constructor(options?: DidPlcMethodOptions) {\n    this.plcDirectoryUrl = new URL(\n      options?.plcDirectoryUrl || 'https://plc.directory/',\n    )\n    this.fetch = bindFetch(options?.fetch)\n  }\n\n  async resolve(did: Did<'plc'>, options?: ResolveDidOptions) {\n    // Although the did should start with `did:plc:` (thanks to typings), we\n    // should still check if the msid is valid.\n    assertDidPlc(did)\n\n    const url = new URL(`/${encodeURIComponent(did)}`, this.plcDirectoryUrl)\n\n    return this.fetch(url, {\n      redirect: 'error',\n      headers: { accept: 'application/did+ld+json,application/json' },\n      signal: options?.signal,\n    }).then(fetchSuccessHandler)\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,yCAM4B;AAC5B,MAAA,uCAAyC;AACzC,MAAA,gCAAsE;AAItE,MAAM,mBAAmB,GAAG,CAAA,GAAA,OAAA,IAAI,EAC9B,CAAA,GAAA,QAAA,gBAAgB,GAAE,EAClB,CAAA,GAAA,QAAA,kBAAkB,EAAC,iCAAiC,CAAC,EACrD,CAAA,GAAA,QAAA,qBAAqB,EAAC,MAAA,oBAAoB,CAAC,CAC5C,CAAA;AAcD,MAAa,YAAY;IAKvB,YAAY,OAA6B,CAAA;QAJtB,OAAA,cAAA,CAAA,IAAA,EAAA,SAAA;;;;;WAAqB;QAExB,OAAA,cAAA,CAAA,IAAA,EAAA,mBAAA;;;;;WAAoB;QAGlC,IAAI,CAAC,eAAe,GAAG,IAAI,GAAG,CAC5B,OAAO,EAAE,eAAe,IAAI,wBAAwB,CACrD,CAAA;QACD,IAAI,CAAC,KAAK,GAAG,CAAA,GAAA,QAAA,SAAS,EAAC,OAAO,EAAE,KAAK,CAAC,CAAA;IACxC,CAAC;IAED,KAAK,CAAC,OAAO,CAAC,GAAe,EAAE,OAA2B,EAAA;QACxD,wEAAwE;QACxE,2CAA2C;QAC3C,CAAA,GAAA,MAAA,YAAY,EAAC,GAAG,CAAC,CAAA;QAEjB,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,CAAA,CAAA,EAAI,kBAAkB,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,eAAe,CAAC,CAAA;QAExE,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE;YACrB,QAAQ,EAAE,OAAO;YACjB,OAAO,EAAE;gBAAE,MAAM,EAAE,0CAA0C;YAAA,CAAE;YAC/D,MAAM,EAAE,OAAO,EAAE,MAAM;SACxB,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAA;IAC9B,CAAC;CACF;AAzBD,QAAA,YAAA,GAAA,aAyBC","ignoreList":[0]}},
    {"offset": {"line": 14745, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14750, "column": 0}, "map": {"version":3,"file":"web.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/methods/web.ts"],"sourcesContent":["import {\n  bindFetch,\n  Fetch,\n  fetchJsonProcessor,\n  fetchJsonZodProcessor,\n  fetchOkProcessor,\n} from '@atproto-labs/fetch'\nimport { pipe } from '@atproto-labs/pipe'\nimport { Did, didDocumentValidator, didWebToUrl } from '@atproto/did'\n\nimport { DidMethod, ResolveDidOptions } from '../did-method.js'\n\nconst fetchSuccessHandler = pipe(\n  fetchOkProcessor(),\n  fetchJsonProcessor(/^application\\/(did\\+ld\\+)?json$/),\n  fetchJsonZodProcessor(didDocumentValidator),\n)\n\nexport type DidWebMethodOptions = {\n  fetch?: Fetch\n  /** @default true */\n  allowHttp?: boolean\n}\n\nexport class DidWebMethod implements DidMethod<'web'> {\n  protected readonly fetch: Fetch<unknown>\n  protected readonly allowHttp: boolean\n\n  constructor({\n    fetch = globalThis.fetch,\n    allowHttp = true,\n  }: DidWebMethodOptions = {}) {\n    this.fetch = bindFetch(fetch)\n    this.allowHttp = allowHttp\n  }\n\n  async resolve(did: Did<'web'>, options?: ResolveDidOptions) {\n    const didDocumentUrl = buildDidWebDocumentUrl(did)\n\n    if (!this.allowHttp && didDocumentUrl.protocol === 'http:') {\n      throw new Error(\n        `Cannot resolve DID document for localhost: ${didDocumentUrl}`,\n      )\n    }\n\n    // Note we do not explicitly check for \"localhost\" here. Instead, we rely on\n    // the injected 'fetch' function to handle the URL. If the URL is\n    // \"localhost\", or resolves to a private IP address, the fetch function is\n    // responsible for handling it.\n\n    return this.fetch(didDocumentUrl, {\n      redirect: 'error',\n      headers: { accept: 'application/did+ld+json,application/json' },\n      signal: options?.signal,\n    }).then(fetchSuccessHandler)\n  }\n}\n\n/**\n * @see {@link https://datatracker.ietf.org/doc/html/rfc8615}\n * @see {@link https://w3c-ccg.github.io/did-method-web/#create-register}\n */\nexport function buildDidWebDocumentUrl(did: Did<'web'>) {\n  const url = didWebToUrl(did) // Will throw if the DID is invalid\n\n  // Note: DID cannot end with an `:`, so they cannot end with a `/`. This is\n  // true unless when there is no path at all, in which case the URL constructor\n  // will set the pathname to `/`.\n\n  // https://w3c-ccg.github.io/did-method-web/#read-resolve\n  if (url.pathname === '/') {\n    return new URL(`/.well-known/did.json`, url)\n  } else {\n    return new URL(`${url.pathname}/did.json`, url)\n  }\n}\n"],"names":[],"mappings":";;;;;AA8DA,QAAA,sBAAA,GAAA,uBAaC;AA3ED,MAAA,yCAM4B;AAC5B,MAAA,uCAAyC;AACzC,MAAA,gCAAqE;AAIrE,MAAM,mBAAmB,GAAG,CAAA,GAAA,OAAA,IAAI,EAC9B,CAAA,GAAA,QAAA,gBAAgB,GAAE,EAClB,CAAA,GAAA,QAAA,kBAAkB,EAAC,iCAAiC,CAAC,EACrD,CAAA,GAAA,QAAA,qBAAqB,EAAC,MAAA,oBAAoB,CAAC,CAC5C,CAAA;AAQD,MAAa,YAAY;IAIvB,YAAY,EACV,KAAK,GAAG,UAAU,CAAC,KAAK,EACxB,SAAS,GAAG,IAAI,EAAA,GACO,CAAA,CAAE,CAAA;QANR,OAAA,cAAA,CAAA,IAAA,EAAA,SAAA;;;;;WAAqB;QACrB,OAAA,cAAA,CAAA,IAAA,EAAA,aAAA;;;;;WAAkB;QAMnC,IAAI,CAAC,KAAK,GAAG,CAAA,GAAA,QAAA,SAAS,EAAC,KAAK,CAAC,CAAA;QAC7B,IAAI,CAAC,SAAS,GAAG,SAAS,CAAA;IAC5B,CAAC;IAED,KAAK,CAAC,OAAO,CAAC,GAAe,EAAE,OAA2B,EAAA;QACxD,MAAM,cAAc,GAAG,sBAAsB,CAAC,GAAG,CAAC,CAAA;QAElD,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,cAAc,CAAC,QAAQ,KAAK,OAAO,EAAE,CAAC;YAC3D,MAAM,IAAI,KAAK,CACb,CAAA,2CAAA,EAA8C,cAAc,EAAE,CAC/D,CAAA;QACH,CAAC;QAED,4EAA4E;QAC5E,iEAAiE;QACjE,0EAA0E;QAC1E,+BAA+B;QAE/B,OAAO,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE;YAChC,QAAQ,EAAE,OAAO;YACjB,OAAO,EAAE;gBAAE,MAAM,EAAE,0CAA0C;YAAA,CAAE;YAC/D,MAAM,EAAE,OAAO,EAAE,MAAM;SACxB,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAA;IAC9B,CAAC;CACF;AAhCD,QAAA,YAAA,GAAA,aAgCC;AAED;;;GAGG,CACH,SAAgB,sBAAsB,CAAC,GAAe;IACpD,MAAM,GAAG,GAAG,CAAA,GAAA,MAAA,WAAW,EAAC,GAAG,CAAC,CAAA,CAAC,mCAAmC;IAEhE,2EAA2E;IAC3E,8EAA8E;IAC9E,gCAAgC;IAEhC,yDAAyD;IACzD,IAAI,GAAG,CAAC,QAAQ,KAAK,GAAG,EAAE,CAAC;QACzB,OAAO,IAAI,GAAG,CAAC,CAAA,qBAAA,CAAuB,EAAE,GAAG,CAAC,CAAA;IAC9C,CAAC,MAAM,CAAC;QACN,OAAO,IAAI,GAAG,CAAC,GAAG,GAAG,CAAC,QAAQ,CAAA,SAAA,CAAW,EAAE,GAAG,CAAC,CAAA;IACjD,CAAC;AACH,CAAC","ignoreList":[0]}},
    {"offset": {"line": 14811, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14816, "column": 0}, "map": {"version":3,"file":"did-resolver-common.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/did-resolver-common.ts"],"sourcesContent":["import { DidResolverBase } from './did-resolver-base.js'\nimport { DidPlcMethod, DidPlcMethodOptions } from './methods/plc.js'\nimport { DidWebMethod, DidWebMethodOptions } from './methods/web.js'\nimport { Simplify } from './util.js'\n\nexport type DidResolverCommonOptions = Simplify<\n  DidPlcMethodOptions & DidWebMethodOptions\n>\n\nexport class DidResolverCommon\n  extends DidResolverBase<'plc' | 'web'>\n  implements DidResolverBase<'plc' | 'web'>\n{\n  constructor(options?: DidResolverCommonOptions) {\n    super({\n      plc: new DidPlcMethod(options),\n      web: new DidWebMethod(options),\n    })\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,2DAAwD;AACxD,MAAA,uCAAoE;AACpE,MAAA,uCAAoE;AAOpE,MAAa,iBACX,SAAQ,uBAAA,eAA8B;IAGtC,YAAY,OAAkC,CAAA;QAC5C,KAAK,CAAC;YACJ,GAAG,EAAE,IAAI,SAAA,YAAY,CAAC,OAAO,CAAC;YAC9B,GAAG,EAAE,IAAI,SAAA,YAAY,CAAC,OAAO,CAAC;SAC/B,CAAC,CAAA;IACJ,CAAC;CACF;AAVD,QAAA,iBAAA,GAAA,kBAUC","ignoreList":[0]}},
    {"offset": {"line": 14833, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14838, "column": 0}, "map": {"version":3,"file":"did-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/did-resolver.ts"],"sourcesContent":["import { Did, DidDocument } from '@atproto/did'\n\nimport { ResolveDidOptions } from './did-method.js'\n\nexport type ResolvedDocument<D extends Did, M extends string = string> =\n  D extends Did<infer N>\n    ? DidDocument<N extends string ? M : N extends M ? N : never>\n    : never\n\nexport interface DidResolver<M extends string = string> {\n  resolve<D extends Did>(\n    did: D,\n    options?: ResolveDidOptions,\n  ): Promise<ResolvedDocument<D, M>>\n}\n"],"names":[],"mappings":"","ignoreList":[0]}},
    {"offset": {"line": 14842, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14847, "column": 0}, "map": {"version":3,"file":"methods.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/methods.ts"],"sourcesContent":["export * from './methods/plc.js'\nexport * from './methods/web.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,oIAAA,SAAgC;AAChC,oIAAA,SAAgC","ignoreList":[0]}},
    {"offset": {"line": 14872, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14877, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/util.ts"],"sourcesContent":["export type Simplify<T> = { [K in keyof T]: T[K] } & NonNullable<unknown>\n"],"names":[],"mappings":"","ignoreList":[0]}},
    {"offset": {"line": 14881, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14886, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/did-resolver/src/index.ts"],"sourcesContent":["export * from '@atproto/did'\n\nexport * from './did-cache-memory.js'\nexport * from './did-cache.js'\nexport * from './did-method.js'\nexport * from './did-resolver-common.js'\nexport * from './did-resolver.js'\nexport * from './methods.js'\nexport * from './util.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,gHAAA,SAA4B;AAE5B,yIAAA,SAAqC;AACrC,kIAAA,SAA8B;AAC9B,mIAAA,SAA+B;AAC/B,4IAAA,SAAwC;AACxC,qIAAA,SAAiC;AACjC,gIAAA,SAA4B;AAC5B,6HAAA,SAAyB","ignoreList":[0]}},
    {"offset": {"line": 14917, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14922, "column": 0}, "map": {"version":3,"file":"types.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/handle-resolver/src/types.ts"],"sourcesContent":["import { AtprotoDid, isAtprotoDid } from '@atproto/did'\nexport type { AtprotoDid, AtprotoIdentityDidMethods } from '@atproto/did'\n\nexport type ResolveHandleOptions = {\n  signal?: AbortSignal\n  noCache?: boolean\n}\n\n/**\n * @see {@link https://atproto.com/specs/did#blessed-did-methods}\n */\nexport type ResolvedHandle = null | AtprotoDid\n\n/**\n * @see {@link https://atproto.com/specs/did#blessed-did-methods}\n */\nexport function isResolvedHandle<T>(value: T): value is T & ResolvedHandle {\n  return value === null || isAtprotoDid(value)\n}\n\nexport interface HandleResolver {\n  /**\n   * @returns the DID that corresponds to the given handle, or `null` if no DID\n   * is found. `null` should only be returned if no unexpected behavior occurred\n   * during the resolution process.\n   * @throws Error if the resolution method fails due to an unexpected error, or\n   * if the resolution is aborted ({@link ResolveHandleOptions}).\n   */\n  resolve(\n    handle: string,\n    options?: ResolveHandleOptions,\n  ): Promise<ResolvedHandle>\n}\n"],"names":[],"mappings":";;;;AAgBA,QAAA,gBAAA,GAAA,iBAEC;AAlBD,MAAA,gCAAuD;AAavD;;GAEG,CACH,SAAgB,gBAAgB,CAAI,KAAQ;IAC1C,OAAO,KAAK,KAAK,IAAI,IAAI,CAAA,GAAA,MAAA,YAAY,EAAC,KAAK,CAAC,CAAA;AAC9C,CAAC","ignoreList":[0]}},
    {"offset": {"line": 14933, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 14938, "column": 0}, "map": {"version":3,"file":"app-view-handle-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/handle-resolver/src/app-view-handle-resolver.ts"],"sourcesContent":["import z from 'zod'\n\nimport {\n  HandleResolver,\n  ResolveHandleOptions,\n  ResolvedHandle,\n  isResolvedHandle,\n} from './types.js'\n\nexport const xrpcErrorSchema = z.object({\n  error: z.string(),\n  message: z.string().optional(),\n})\n\nexport type AppViewHandleResolverOptions = {\n  /**\n   * Fetch function to use for HTTP requests. Allows customizing the request\n   * behavior, e.g. adding headers, setting a timeout, mocking, etc.\n   *\n   * @default globalThis.fetch\n   */\n  fetch?: typeof globalThis.fetch\n}\n\nexport class AppViewHandleResolver implements HandleResolver {\n  static from(\n    service: URL | string | HandleResolver,\n    options?: AppViewHandleResolverOptions,\n  ): HandleResolver {\n    if (typeof service === 'string' || service instanceof URL) {\n      return new AppViewHandleResolver(service, options)\n    }\n    return service\n  }\n\n  /**\n   * URL of the atproto lexicon server. This is the base URL where the\n   * `com.atproto.identity.resolveHandle` XRPC method is located.\n   */\n  protected readonly serviceUrl: URL\n  protected readonly fetch: typeof globalThis.fetch\n\n  constructor(service: URL | string, options?: AppViewHandleResolverOptions) {\n    this.serviceUrl = new URL(service)\n    this.fetch = options?.fetch ?? globalThis.fetch\n  }\n\n  public async resolve(\n    handle: string,\n    options?: ResolveHandleOptions,\n  ): Promise<ResolvedHandle> {\n    const url = new URL(\n      '/xrpc/com.atproto.identity.resolveHandle',\n      this.serviceUrl,\n    )\n    url.searchParams.set('handle', handle)\n\n    const response = await this.fetch.call(null, url, {\n      cache: options?.noCache ? 'no-cache' : undefined,\n      signal: options?.signal,\n      redirect: 'error',\n    })\n    const payload = await response.json()\n\n    // The response should either be\n    // - 400 Bad Request with { error: 'InvalidRequest', message: 'Unable to resolve handle' }\n    // - 200 OK with { did: NonNullable<ResolvedHandle> }\n    // Any other response is considered unexpected behavior an should throw an error.\n\n    if (response.status === 400) {\n      const data = xrpcErrorSchema.parse(payload)\n      if (\n        data.error === 'InvalidRequest' &&\n        data.message === 'Unable to resolve handle'\n      ) {\n        return null\n      }\n    }\n\n    if (!response.ok) {\n      throw new TypeError('Invalid response from resolveHandle method')\n    }\n\n    const value: unknown = payload?.did\n\n    if (!isResolvedHandle(value)) {\n      throw new TypeError('Invalid DID returned from resolveHandle method')\n    }\n\n    return value\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA,MAAA,QAAA,gCAAmB;AAEnB,MAAA,mCAKmB;AAEN,QAAA,eAAe,GAAG,MAAA,OAAC,CAAC,MAAM,CAAC;IACtC,KAAK,EAAE,MAAA,OAAC,CAAC,MAAM,EAAE;IACjB,OAAO,EAAE,MAAA,OAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;CAC/B,CAAC,CAAA;AAYF,MAAa,qBAAqB;IAChC,MAAM,CAAC,IAAI,CACT,OAAsC,EACtC,OAAsC,EAAA;QAEtC,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,YAAY,GAAG,EAAE,CAAC;YAC1D,OAAO,IAAI,qBAAqB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QACpD,CAAC;QACD,OAAO,OAAO,CAAA;IAChB,CAAC;IASD,YAAY,OAAqB,EAAE,OAAsC,CAAA;QAPzE;;;WAGG,CACgB,OAAA,cAAA,CAAA,IAAA,EAAA,cAAA;;;;;WAAe;QACf,OAAA,cAAA,CAAA,IAAA,EAAA,SAAA;;;;;WAA8B;QAG/C,IAAI,CAAC,UAAU,GAAG,IAAI,GAAG,CAAC,OAAO,CAAC,CAAA;QAClC,IAAI,CAAC,KAAK,GAAG,OAAO,EAAE,KAAK,IAAI,UAAU,CAAC,KAAK,CAAA;IACjD,CAAC;IAEM,KAAK,CAAC,OAAO,CAClB,MAAc,EACd,OAA8B,EAAA;QAE9B,MAAM,GAAG,GAAG,IAAI,GAAG,CACjB,0CAA0C,EAC1C,IAAI,CAAC,UAAU,CAChB,CAAA;QACD,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAA;QAEtC,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE;YAChD,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,SAAS;YAChD,MAAM,EAAE,OAAO,EAAE,MAAM;YACvB,QAAQ,EAAE,OAAO;SAClB,CAAC,CAAA;QACF,MAAM,OAAO,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAA;QAErC,gCAAgC;QAChC,0FAA0F;QAC1F,qDAAqD;QACrD,iFAAiF;QAEjF,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE,CAAC;YAC5B,MAAM,IAAI,GAAG,QAAA,eAAe,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;YAC3C,IACE,IAAI,CAAC,KAAK,KAAK,gBAAgB,IAC/B,IAAI,CAAC,OAAO,KAAK,0BAA0B,EAC3C,CAAC;gBACD,OAAO,IAAI,CAAA;YACb,CAAC;QACH,CAAC;QAED,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC;YACjB,MAAM,IAAI,SAAS,CAAC,4CAA4C,CAAC,CAAA;QACnE,CAAC;QAED,MAAM,KAAK,GAAY,OAAO,EAAE,GAAG,CAAA;QAEnC,IAAI,CAAC,CAAA,GAAA,WAAA,gBAAgB,EAAC,KAAK,CAAC,EAAE,CAAC;YAC7B,MAAM,IAAI,SAAS,CAAC,gDAAgD,CAAC,CAAA;QACvE,CAAC;QAED,OAAO,KAAK,CAAA;IACd,CAAC;CACF;AAnED,QAAA,qBAAA,GAAA,sBAmEC","ignoreList":[0]}},
    {"offset": {"line": 15010, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15015, "column": 0}, "map": {"version":3,"file":"dns-handle-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/handle-resolver/src/internal-resolvers/dns-handle-resolver.ts"],"sourcesContent":["import { HandleResolver, ResolvedHandle, isResolvedHandle } from '../types'\n\nconst SUBDOMAIN = '_atproto'\nconst PREFIX = 'did='\n\n/**\n * DNS TXT record resolver. Return `null` if the hostname successfully does not\n * resolve to a valid DID. Throw an error if an unexpected error occurs.\n */\nexport type ResolveTxt = (hostname: string) => Promise<null | string[]>\n\nexport class DnsHandleResolver implements HandleResolver {\n  constructor(protected resolveTxt: ResolveTxt) {}\n\n  async resolve(handle: string): Promise<ResolvedHandle> {\n    const results = await this.resolveTxt.call(null, `${SUBDOMAIN}.${handle}`)\n\n    if (!results) return null\n\n    for (let i = 0; i < results.length; i++) {\n      // If the line does not start with \"did=\", skip it\n      if (!results[i].startsWith(PREFIX)) continue\n\n      // Ensure no other entry starting with \"did=\" follows\n      for (let j = i + 1; j < results.length; j++) {\n        if (results[j].startsWith(PREFIX)) return null\n      }\n\n      // Note: No trimming (to be consistent with spec)\n      const did = results[i].slice(PREFIX.length)\n\n      // Invalid DBS record\n      return isResolvedHandle(did) ? did : null\n    }\n\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,8BAA2E;AAE3E,MAAM,SAAS,GAAG,UAAU,CAAA;AAC5B,MAAM,MAAM,GAAG,MAAM,CAAA;AAQrB,MAAa,iBAAiB;IAC5B,YAAsB,UAAsB,CAAA;QAAhC,OAAA,cAAA,CAAA,IAAA,EAAA,cAAA;;;;mBAAU,UAAU;WAAY;IAAG,CAAC;IAEhD,KAAK,CAAC,OAAO,CAAC,MAAc,EAAA;QAC1B,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,SAAS,CAAA,CAAA,EAAI,MAAM,EAAE,CAAC,CAAA;QAE1E,IAAI,CAAC,OAAO,EAAE,OAAO,IAAI,CAAA;QAEzB,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;YACxC,kDAAkD;YAClD,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE,SAAQ;YAE5C,qDAAqD;YACrD,IAAK,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;gBAC5C,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE,OAAO,IAAI,CAAA;YAChD,CAAC;YAED,iDAAiD;YACjD,MAAM,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;YAE3C,qBAAqB;YACrB,OAAO,CAAA,GAAA,QAAA,gBAAgB,EAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAA;QAC3C,CAAC;QAED,OAAO,IAAI,CAAA;IACb,CAAC;CACF;AA1BD,QAAA,iBAAA,GAAA,kBA0BC","ignoreList":[0]}},
    {"offset": {"line": 15051, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15056, "column": 0}, "map": {"version":3,"file":"well-known-handler-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/handle-resolver/src/internal-resolvers/well-known-handler-resolver.ts"],"sourcesContent":["import {\n  HandleResolver,\n  ResolveHandleOptions,\n  ResolvedHandle,\n  isResolvedHandle,\n} from '../types.js'\n\nexport type WellKnownHandleResolverOptions = {\n  /**\n   * Fetch function to use for HTTP requests. Allows customizing the request\n   * behavior, e.g. adding headers, setting a timeout, mocking, etc. The\n   * provided fetch function will be wrapped with a safeFetchWrap function that\n   * adds SSRF protection.\n   *\n   * @default `globalThis.fetch`\n   */\n  fetch?: typeof globalThis.fetch\n}\n\nexport class WellKnownHandleResolver implements HandleResolver {\n  protected readonly fetch: typeof globalThis.fetch\n\n  constructor(options?: WellKnownHandleResolverOptions) {\n    this.fetch = options?.fetch ?? globalThis.fetch\n  }\n\n  public async resolve(\n    handle: string,\n    options?: ResolveHandleOptions,\n  ): Promise<ResolvedHandle> {\n    const url = new URL('/.well-known/atproto-did', `https://${handle}`)\n\n    try {\n      const response = await this.fetch.call(null, url, {\n        cache: options?.noCache ? 'no-cache' : undefined,\n        signal: options?.signal,\n        redirect: 'error',\n      })\n      const text = await response.text()\n      const firstLine = text.split('\\n')[0]!.trim()\n\n      if (isResolvedHandle(firstLine)) return firstLine\n\n      return null\n    } catch (err) {\n      // The the request failed, assume the handle does not resolve to a DID,\n      // unless the failure was due to the signal being aborted.\n      options?.signal?.throwIfAborted()\n\n      return null\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,oCAKoB;AAcpB,MAAa,uBAAuB;IAGlC,YAAY,OAAwC,CAAA;QAFjC,OAAA,cAAA,CAAA,IAAA,EAAA,SAAA;;;;;WAA8B;QAG/C,IAAI,CAAC,KAAK,GAAG,OAAO,EAAE,KAAK,IAAI,UAAU,CAAC,KAAK,CAAA;IACjD,CAAC;IAEM,KAAK,CAAC,OAAO,CAClB,MAAc,EACd,OAA8B,EAAA;QAE9B,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,0BAA0B,EAAE,CAAA,QAAA,EAAW,MAAM,EAAE,CAAC,CAAA;QAEpE,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE;gBAChD,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,SAAS;gBAChD,MAAM,EAAE,OAAO,EAAE,MAAM;gBACvB,QAAQ,EAAE,OAAO;aAClB,CAAC,CAAA;YACF,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAA;YAClC,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAE,CAAC,IAAI,EAAE,CAAA;YAE7C,IAAI,CAAA,GAAA,WAAA,gBAAgB,EAAC,SAAS,CAAC,EAAE,OAAO,SAAS,CAAA;YAEjD,OAAO,IAAI,CAAA;QACb,CAAC,CAAC,OAAO,GAAG,EAAE,CAAC;YACb,uEAAuE;YACvE,0DAA0D;YAC1D,OAAO,EAAE,MAAM,EAAE,cAAc,EAAE,CAAA;YAEjC,OAAO,IAAI,CAAA;QACb,CAAC;IACH,CAAC;CACF;AAjCD,QAAA,uBAAA,GAAA,wBAiCC","ignoreList":[0]}},
    {"offset": {"line": 15093, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15098, "column": 0}, "map": {"version":3,"file":"atproto-handle-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/handle-resolver/src/atproto-handle-resolver.ts"],"sourcesContent":["import {\n  DnsHandleResolver,\n  ResolveTxt,\n} from './internal-resolvers/dns-handle-resolver.js'\nimport {\n  WellKnownHandleResolver,\n  WellKnownHandleResolverOptions,\n} from './internal-resolvers/well-known-handler-resolver.js'\nimport {\n  HandleResolver,\n  ResolveHandleOptions,\n  ResolvedHandle,\n} from './types.js'\n\nexport type { ResolveTxt }\nexport type AtprotoHandleResolverOptions = WellKnownHandleResolverOptions & {\n  resolveTxt: ResolveTxt\n  resolveTxtFallback?: ResolveTxt\n}\n\nconst noop = () => {}\n\n/**\n * Implementation of the official ATPROTO handle resolution strategy.\n * This implementation relies on two primitives:\n * - HTTP Well-Known URI resolution (requires a `fetch()` implementation)\n * - DNS TXT record resolution (requires a `resolveTxt()` function)\n */\nexport class AtprotoHandleResolver implements HandleResolver {\n  private readonly httpResolver: HandleResolver\n  private readonly dnsResolver: HandleResolver\n  private readonly dnsResolverFallback?: HandleResolver\n\n  constructor(options: AtprotoHandleResolverOptions) {\n    this.httpResolver = new WellKnownHandleResolver(options)\n    this.dnsResolver = new DnsHandleResolver(options.resolveTxt)\n    this.dnsResolverFallback = options.resolveTxtFallback\n      ? new DnsHandleResolver(options.resolveTxtFallback)\n      : undefined\n  }\n\n  async resolve(\n    handle: string,\n    options?: ResolveHandleOptions,\n  ): Promise<ResolvedHandle> {\n    options?.signal?.throwIfAborted()\n\n    const abortController = new AbortController()\n    const { signal } = abortController\n    options?.signal?.addEventListener('abort', () => abortController.abort(), {\n      signal,\n    })\n\n    const wrappedOptions = { ...options, signal }\n\n    try {\n      const dnsPromise = this.dnsResolver.resolve(handle, wrappedOptions)\n      const httpPromise = this.httpResolver.resolve(handle, wrappedOptions)\n\n      // Prevent uncaught promise rejection\n      httpPromise.catch(noop)\n\n      const dnsRes = await dnsPromise\n      if (dnsRes) return dnsRes\n\n      signal.throwIfAborted()\n\n      const res = await httpPromise\n      if (res) return res\n\n      signal.throwIfAborted()\n\n      return this.dnsResolverFallback?.resolve(handle, wrappedOptions) ?? null\n    } finally {\n      // Cancel pending requests, and remove \"abort\" listener on incoming signal\n      abortController.abort()\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,kFAGoD;AACpD,MAAA,kGAG4D;AAa5D,MAAM,IAAI,GAAG,GAAG,EAAE,AAAE,CAAC,CAAA;AAErB;;;;;GAKG,CACH,MAAa,qBAAqB;IAKhC,YAAY,OAAqC,CAAA;QAJhC,OAAA,cAAA,CAAA,IAAA,EAAA,gBAAA;;;;;WAA4B;QAC5B,OAAA,cAAA,CAAA,IAAA,EAAA,eAAA;;;;;WAA2B;QAC3B,OAAA,cAAA,CAAA,IAAA,EAAA,uBAAA;;;;;WAAoC;QAGnD,IAAI,CAAC,YAAY,GAAG,IAAI,iCAAA,uBAAuB,CAAC,OAAO,CAAC,CAAA;QACxD,IAAI,CAAC,WAAW,GAAG,IAAI,yBAAA,iBAAiB,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;QAC5D,IAAI,CAAC,mBAAmB,GAAG,OAAO,CAAC,kBAAkB,GACjD,IAAI,yBAAA,iBAAiB,CAAC,OAAO,CAAC,kBAAkB,CAAC,GACjD,SAAS,CAAA;IACf,CAAC;IAED,KAAK,CAAC,OAAO,CACX,MAAc,EACd,OAA8B,EAAA;QAE9B,OAAO,EAAE,MAAM,EAAE,cAAc,EAAE,CAAA;QAEjC,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAA;QAC7C,MAAM,EAAE,MAAM,EAAE,GAAG,eAAe,CAAA;QAClC,OAAO,EAAE,MAAM,EAAE,gBAAgB,CAAC,OAAO,EAAE,GAAG,CAAG,CAAD,cAAgB,CAAC,KAAK,EAAE,EAAE;YACxE,MAAM;SACP,CAAC,CAAA;QAEF,MAAM,cAAc,GAAG;YAAE,GAAG,OAAO;YAAE,MAAM;QAAA,CAAE,CAAA;QAE7C,IAAI,CAAC;YACH,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM,EAAE,cAAc,CAAC,CAAA;YACnE,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,EAAE,cAAc,CAAC,CAAA;YAErE,qCAAqC;YACrC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;YAEvB,MAAM,MAAM,GAAG,MAAM,UAAU,CAAA;YAC/B,IAAI,MAAM,EAAE,OAAO,MAAM,CAAA;YAEzB,MAAM,CAAC,cAAc,EAAE,CAAA;YAEvB,MAAM,GAAG,GAAG,MAAM,WAAW,CAAA;YAC7B,IAAI,GAAG,EAAE,OAAO,GAAG,CAAA;YAEnB,MAAM,CAAC,cAAc,EAAE,CAAA;YAEvB,OAAO,IAAI,CAAC,mBAAmB,EAAE,OAAO,CAAC,MAAM,EAAE,cAAc,CAAC,IAAI,IAAI,CAAA;QAC1E,CAAC,QAAS,CAAC;YACT,0EAA0E;YAC1E,eAAe,CAAC,KAAK,EAAE,CAAA;QACzB,CAAC;IACH,CAAC;CACF;AAlDD,QAAA,qBAAA,GAAA,sBAkDC","ignoreList":[0]}},
    {"offset": {"line": 15165, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15170, "column": 0}, "map": {"version":3,"file":"atproto-doh-handle-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/handle-resolver/src/atproto-doh-handle-resolver.ts"],"sourcesContent":["import {\n  AtprotoHandleResolver,\n  AtprotoHandleResolverOptions,\n} from './atproto-handle-resolver.js'\nimport { HandleResolver } from './types.js'\nimport { ResolveTxt } from './internal-resolvers/dns-handle-resolver.js'\n\nexport type AtprotoDohHandleResolverOptions = Omit<\n  AtprotoHandleResolverOptions,\n  'resolveTxt' | 'resolveTxtFallback'\n> & {\n  dohEndpoint: string | URL\n}\n\nexport class AtprotoDohHandleResolver\n  extends AtprotoHandleResolver\n  implements HandleResolver\n{\n  constructor(options: AtprotoDohHandleResolverOptions) {\n    super({\n      ...options,\n      resolveTxt: dohResolveTxtFactory(options),\n      resolveTxtFallback: undefined,\n    })\n  }\n}\n\n/**\n * Resolver for DNS-over-HTTPS (DoH) handles. Only works with servers supporting\n * Google Flavoured \"application/dns-json\" queries.\n *\n * @see {@link https://developers.google.com/speed/public-dns/docs/doh/json}\n * @see {@link https://developers.cloudflare.com/1.1.1.1/encryption/dns-over-https/make-api-requests/dns-json/}\n * @todo Add support for DoH using application/dns-message (?)\n */\nfunction dohResolveTxtFactory({\n  dohEndpoint,\n  fetch = globalThis.fetch,\n}: AtprotoDohHandleResolverOptions): ResolveTxt {\n  return async (hostname) => {\n    const url = new URL(dohEndpoint)\n    url.searchParams.set('type', 'TXT')\n    url.searchParams.set('name', hostname)\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: { accept: 'application/dns-json' },\n      redirect: 'follow',\n    })\n    try {\n      const contentType = response.headers.get('content-type')?.trim()\n      if (!response.ok) {\n        const message = contentType?.startsWith('text/plain')\n          ? await response.text()\n          : `Failed to resolve ${hostname}`\n        throw new TypeError(message)\n      } else if (contentType?.match(/application\\/(dns-)?json/i) == null) {\n        throw new TypeError('Unexpected response from DoH server')\n      }\n\n      const result = asResult(await response.json())\n      return result.Answer?.filter(isAnswerTxt).map(extractTxtData) ?? null\n    } finally {\n      // Make sure to always cancel the response body as some engines (Node )\n      // do not do this automatically.\n      // https://undici.nodejs.org/#/?id=garbage-collection\n      if (response.bodyUsed === false) {\n        // Handle rejection asynchronously\n        void response.body?.cancel().catch(onCancelError)\n      }\n    }\n  }\n}\n\nfunction onCancelError(err: unknown) {\n  if (!(err instanceof DOMException) || err.name !== 'AbortError') {\n    console.error('An error occurred while cancelling the response body:', err)\n  }\n}\n\ntype Result = { Status: number; Answer?: Answer[] }\nfunction isResult(result: unknown): result is Result {\n  if (typeof result !== 'object' || result === null) return false\n  if (!('Status' in result) || typeof result.Status !== 'number') return false\n  if ('Answer' in result && !isArrayOf(result.Answer, isAnswer)) return false\n  return true\n}\nfunction asResult(result: unknown): Result {\n  if (isResult(result)) return result\n  throw new TypeError('Invalid DoH response')\n}\n\nfunction isArrayOf<T>(\n  value: unknown,\n  predicate: (v: unknown) => v is T,\n): value is T[] {\n  return Array.isArray(value) && value.every(predicate)\n}\n\ntype Answer = { name: string; type: number; data: string; TTL: number }\nfunction isAnswer(answer: unknown): answer is Answer {\n  return (\n    typeof answer === 'object' &&\n    answer !== null &&\n    'name' in answer &&\n    typeof answer.name === 'string' &&\n    'type' in answer &&\n    typeof answer.type === 'number' &&\n    'data' in answer &&\n    typeof answer.data === 'string' &&\n    'TTL' in answer &&\n    typeof answer.TTL === 'number'\n  )\n}\n\ntype AnswerTxt = Answer & { type: 16 }\nfunction isAnswerTxt(answer: Answer): answer is AnswerTxt {\n  return answer.type === 16\n}\n\nfunction extractTxtData(answer: AnswerTxt): string {\n  return answer.data.replace(/^\"|\"$/g, '').replace(/\\\\\"/g, '\"')\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 15253, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15258, "column": 0}, "map": {"version":3,"file":"cached-handle-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/handle-resolver/src/cached-handle-resolver.ts"],"sourcesContent":["import { CachedGetter, SimpleStore } from '@atproto-labs/simple-store'\nimport { SimpleStoreMemory } from '@atproto-labs/simple-store-memory'\nimport {\n  HandleResolver,\n  ResolvedHandle,\n  ResolveHandleOptions,\n} from './types.js'\n\nexport type HandleCache = SimpleStore<string, ResolvedHandle>\n\nexport class CachedHandleResolver implements HandleResolver {\n  private getter: CachedGetter<string, ResolvedHandle>\n\n  constructor(\n    /**\n     * The resolver that will be used to resolve handles.\n     */\n    resolver: HandleResolver,\n    cache: HandleCache = new SimpleStoreMemory<string, ResolvedHandle>({\n      max: 1000,\n      ttl: 10 * 60e3,\n    }),\n  ) {\n    this.getter = new CachedGetter<string, ResolvedHandle>(\n      (handle, options) => resolver.resolve(handle, options),\n      cache,\n    )\n  }\n\n  async resolve(\n    handle: string,\n    options?: ResolveHandleOptions,\n  ): Promise<ResolvedHandle> {\n    return this.getter.get(handle, options)\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uDAAsE;AACtE,MAAA,qEAAqE;AASrE,MAAa,oBAAoB;IAG/B,YACE;;OAEG,CACH,QAAwB,EACxB,QAAqB,IAAI,sBAAA,iBAAiB,CAAyB;QACjE,GAAG,EAAE,IAAI;QACT,GAAG,EAAE,EAAE,GAAG,IAAI;KACf,CAAC,CAAA;QAVI,OAAA,cAAA,CAAA,IAAA,EAAA,UAAA;;;;;WAA4C;QAYlD,IAAI,CAAC,MAAM,GAAG,IAAI,eAAA,YAAY,CAC5B,CAAC,MAAM,EAAE,OAAO,EAAE,CAAG,CAAD,OAAS,CAAC,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,EACtD,KAAK,CACN,CAAA;IACH,CAAC;IAED,KAAK,CAAC,OAAO,CACX,MAAc,EACd,OAA8B,EAAA;QAE9B,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,OAAO,CAAC,CAAA;IACzC,CAAC;CACF;AAzBD,QAAA,oBAAA,GAAA,qBAyBC","ignoreList":[0]}},
    {"offset": {"line": 15285, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15290, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/handle-resolver/src/index.ts"],"sourcesContent":["export * from './types.js'\n\n// Main Handle Resolvers strategies\nexport * from './app-view-handle-resolver.js'\nexport * from './atproto-doh-handle-resolver.js'\nexport * from './atproto-handle-resolver.js'\n\n// Handle Resolver Caching utility\nexport * from './cached-handle-resolver.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,iIAAA,SAA0B;AAE1B,mCAAmC;AACnC,oJAAA,SAA6C;AAC7C,uJAAA,SAAgD;AAChD,mJAAA,SAA4C;AAE5C,kCAAkC;AAClC,kJAAA,SAA2C","ignoreList":[0]}},
    {"offset": {"line": 15320, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15325, "column": 0}, "map": {"version":3,"file":"constants.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/constants.ts"],"sourcesContent":["export const CLIENT_ASSERTION_TYPE_JWT_BEARER =\n  'urn:ietf:params:oauth:client-assertion-type:jwt-bearer'\n"],"names":[],"mappings":";;;;;AAAa,QAAA,gCAAgC,GAC3C,wDAAwD,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15331, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15336, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/util.ts"],"sourcesContent":["export function isHostnameIP(hostname: string) {\n  // IPv4\n  if (hostname.match(/^\\d+\\.\\d+\\.\\d+\\.\\d+$/)) return true\n\n  // IPv6\n  if (hostname.startsWith('[') && hostname.endsWith(']')) return true\n\n  return false\n}\n\nexport type LoopbackHost = 'localhost' | '127.0.0.1' | '[::1]'\n\nexport function isLoopbackHost(host: unknown): host is LoopbackHost {\n  return host === 'localhost' || host === '127.0.0.1' || host === '[::1]'\n}\n\nexport function isLoopbackUrl(input: URL | string): boolean {\n  const url = typeof input === 'string' ? new URL(input) : input\n  return isLoopbackHost(url.hostname)\n}\n\nexport function safeUrl(input: URL | string): URL | null {\n  try {\n    return new URL(input)\n  } catch {\n    return null\n  }\n}\n\nexport function extractUrlPath(url) {\n  // Extracts the path from a URL, without relying on the URL constructor\n  // (because it normalizes the URL)\n  const endOfProtocol = url.startsWith('https://')\n    ? 8\n    : url.startsWith('http://')\n      ? 7\n      : -1\n  if (endOfProtocol === -1) {\n    throw new TypeError('URL must use the \"https:\" or \"http:\" protocol')\n  }\n\n  const hashIdx = url.indexOf('#', endOfProtocol)\n  const questionIdx = url.indexOf('?', endOfProtocol)\n\n  const queryStrIdx =\n    questionIdx !== -1 && (hashIdx === -1 || questionIdx < hashIdx)\n      ? questionIdx\n      : -1\n\n  const pathEnd =\n    hashIdx === -1\n      ? queryStrIdx === -1\n        ? url.length\n        : queryStrIdx\n      : queryStrIdx === -1\n        ? hashIdx\n        : Math.min(hashIdx, queryStrIdx)\n\n  const slashIdx = url.indexOf('/', endOfProtocol)\n\n  const pathStart = slashIdx === -1 || slashIdx > pathEnd ? pathEnd : slashIdx\n\n  if (endOfProtocol === pathStart) {\n    throw new TypeError('URL must contain a host')\n  }\n\n  return url.substring(pathStart, pathEnd)\n}\n"],"names":[],"mappings":";;;;AAAA,QAAA,YAAA,GAAA,aAQC;AAID,QAAA,cAAA,GAAA,eAEC;AAED,QAAA,aAAA,GAAA,cAGC;AAED,QAAA,OAAA,GAAA,QAMC;AAED,QAAA,cAAA,GAAA,eAsCC;AAnED,SAAgB,YAAY,CAAC,QAAgB;IAC3C,OAAO;IACP,IAAI,QAAQ,CAAC,KAAK,CAAC,sBAAsB,CAAC,EAAE,OAAO,IAAI,CAAA;IAEvD,OAAO;IACP,IAAI,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,OAAO,IAAI,CAAA;IAEnE,OAAO,KAAK,CAAA;AACd,CAAC;AAID,SAAgB,cAAc,CAAC,IAAa;IAC1C,OAAO,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,OAAO,CAAA;AACzE,CAAC;AAED,SAAgB,aAAa,CAAC,KAAmB;IAC/C,MAAM,GAAG,GAAG,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAA;IAC9D,OAAO,cAAc,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;AACrC,CAAC;AAED,SAAgB,OAAO,CAAC,KAAmB;IACzC,IAAI,CAAC;QACH,OAAO,IAAI,GAAG,CAAC,KAAK,CAAC,CAAA;IACvB,CAAC,CAAC,OAAM,CAAC;QACP,OAAO,IAAI,CAAA;IACb,CAAC;AACH,CAAC;AAED,SAAgB,cAAc,CAAC,GAAG;IAChC,uEAAuE;IACvE,kCAAkC;IAClC,MAAM,aAAa,GAAG,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,GAC5C,CAAC,GACD,GAAG,CAAC,UAAU,CAAC,SAAS,CAAC,GACvB,CAAC,GACD,CAAC,CAAC,CAAA;IACR,IAAI,aAAa,KAAK,CAAC,CAAC,EAAE,CAAC;QACzB,MAAM,IAAI,SAAS,CAAC,+CAA+C,CAAC,CAAA;IACtE,CAAC;IAED,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,aAAa,CAAC,CAAA;IAC/C,MAAM,WAAW,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,aAAa,CAAC,CAAA;IAEnD,MAAM,WAAW,GACf,WAAW,KAAK,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,CAAC,CAAC,IAAI,WAAW,GAAG,OAAO,CAAC,GAC3D,WAAW,GACX,CAAC,CAAC,CAAA;IAER,MAAM,OAAO,GACX,OAAO,KAAK,CAAC,CAAC,GACV,WAAW,KAAK,CAAC,CAAC,GAChB,GAAG,CAAC,MAAM,GACV,WAAW,GACb,WAAW,KAAK,CAAC,CAAC,GAChB,OAAO,GACP,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,WAAW,CAAC,CAAA;IAEtC,MAAM,QAAQ,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,aAAa,CAAC,CAAA;IAEhD,MAAM,SAAS,GAAG,QAAQ,KAAK,CAAC,CAAC,IAAI,QAAQ,GAAG,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAA;IAE5E,IAAI,aAAa,KAAK,SAAS,EAAE,CAAC;QAChC,MAAM,IAAI,SAAS,CAAC,yBAAyB,CAAC,CAAA;IAChD,CAAC;IAED,OAAO,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,CAAC,CAAA;AAC1C,CAAC","ignoreList":[0]}},
    {"offset": {"line": 15384, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15389, "column": 0}, "map": {"version":3,"file":"uri.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/uri.ts"],"sourcesContent":["import { TypeOf, z, ZodIssueCode } from 'zod'\nimport { isHostnameIP, isLoopbackHost } from './util.js'\n\n/**\n * Valid, but potentially dangerous URL (`data:`, `file:`, `javascript:`, etc.).\n *\n * Any value that matches this schema is safe to parse using `new URL()`.\n */\nexport const dangerousUriSchema = z\n  .string()\n  .refine(\n    (data): data is `${string}:${string}` =>\n      data.includes(':') && URL.canParse(data),\n    {\n      message: 'Invalid URL',\n    },\n  )\n\n/**\n * Valid, but potentially dangerous URL (`data:`, `file:`, `javascript:`, etc.).\n */\nexport type DangerousUrl = TypeOf<typeof dangerousUriSchema>\n\nexport const loopbackUriSchema = dangerousUriSchema.superRefine(\n  (\n    value,\n    ctx,\n  ): value is\n    | `http://[::1]${string}`\n    | `http://localhost${'' | `${':' | '/' | '?' | '#'}${string}`}`\n    | `http://127.0.0.1${'' | `${':' | '/' | '?' | '#'}${string}`}` => {\n    // Loopback url must use the \"http:\" protocol\n    if (!value.startsWith('http://')) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: 'URL must use the \"http:\" protocol',\n      })\n      return false\n    }\n\n    const url = new URL(value)\n\n    if (!isLoopbackHost(url.hostname)) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: 'URL must use \"localhost\", \"127.0.0.1\" or \"[::1]\" as hostname',\n      })\n      return false\n    }\n\n    return true\n  },\n)\n\nexport type LoopbackUri = TypeOf<typeof loopbackUriSchema>\n\nexport const httpsUriSchema = dangerousUriSchema.superRefine(\n  (value, ctx): value is `https://${string}` => {\n    if (!value.startsWith('https://')) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: 'URL must use the \"https:\" protocol',\n      })\n      return false\n    }\n\n    const url = new URL(value)\n\n    // Disallow loopback URLs with the `https:` protocol\n    if (isLoopbackHost(url.hostname)) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: 'https: URL must not use a loopback host',\n      })\n      return false\n    }\n\n    if (isHostnameIP(url.hostname)) {\n      // Hostname is an IP address\n    } else {\n      // Hostname is a domain name\n      if (!url.hostname.includes('.')) {\n        // we don't depend on PSL here, so we only check for a dot\n        ctx.addIssue({\n          code: ZodIssueCode.custom,\n          message: 'Domain name must contain at least two segments',\n        })\n        return false\n      }\n\n      if (url.hostname.endsWith('.local')) {\n        ctx.addIssue({\n          code: ZodIssueCode.custom,\n          message: 'Domain name must not end with \".local\"',\n        })\n        return false\n      }\n    }\n\n    return true\n  },\n)\n\nexport type HttpsUri = TypeOf<typeof httpsUriSchema>\n\nexport const webUriSchema = z\n  .string()\n  .superRefine((value, ctx): value is LoopbackUri | HttpsUri => {\n    // discriminated union of `loopbackUriSchema` and `httpsUriSchema`\n    if (value.startsWith('http://')) {\n      const result = loopbackUriSchema.safeParse(value)\n      if (!result.success) result.error.issues.forEach(ctx.addIssue, ctx)\n      return result.success\n    }\n\n    if (value.startsWith('https://')) {\n      const result = httpsUriSchema.safeParse(value)\n      if (!result.success) result.error.issues.forEach(ctx.addIssue, ctx)\n      return result.success\n    }\n\n    ctx.addIssue({\n      code: ZodIssueCode.custom,\n      message: 'URL must use the \"http:\" or \"https:\" protocol',\n    })\n    return false\n  })\n\nexport type WebUri = TypeOf<typeof webUriSchema>\n\nexport const privateUseUriSchema = dangerousUriSchema.superRefine(\n  (value, ctx): value is `${string}.${string}:/${string}` => {\n    const dotIdx = value.indexOf('.')\n    const colonIdx = value.indexOf(':')\n\n    // Optimization: avoid parsing the URL if the protocol does not contain a \".\"\n    if (dotIdx === -1 || colonIdx === -1 || dotIdx > colonIdx) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message:\n          'Private-use URI scheme requires a \".\" as part of the protocol',\n      })\n      return false\n    }\n\n    const url = new URL(value)\n\n    // Should be covered by the check before, but let's be extra sure\n    if (!url.protocol.includes('.')) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: 'Invalid private-use URI scheme',\n      })\n      return false\n    }\n\n    if (url.hostname) {\n      // https://datatracker.ietf.org/doc/html/rfc8252#section-7.1\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message:\n          'Private-use URI schemes must not include a hostname (only one \"/\" is allowed after the protocol, as per RFC 8252)',\n      })\n      return false\n    }\n\n    return true\n  },\n)\n\nexport type PrivateUseUri = TypeOf<typeof privateUseUriSchema>\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 15509, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15514, "column": 0}, "map": {"version":3,"file":"oauth-client-id.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-client-id.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthClientIdSchema = z.string().min(1)\nexport type OAuthClientId = z.infer<typeof oauthClientIdSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,mBAAmB,GAAG,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15521, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15526, "column": 0}, "map": {"version":3,"file":"oauth-redirect-uri.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-redirect-uri.ts"],"sourcesContent":["import { TypeOf, z, ZodIssueCode } from 'zod'\nimport {\n  httpsUriSchema,\n  LoopbackUri,\n  loopbackUriSchema,\n  privateUseUriSchema,\n} from './uri.js'\n\nexport const oauthLoopbackRedirectURISchema = loopbackUriSchema.superRefine(\n  (value, ctx): value is Exclude<LoopbackUri, `http://localhost${string}`> => {\n    if (value.startsWith('http://localhost')) {\n      // https://datatracker.ietf.org/doc/html/rfc8252#section-8.3\n      //\n      // > While redirect URIs using localhost (i.e.,\n      // > \"http://localhost:{port}/{path}\") function similarly to loopback IP\n      // > redirects described in Section 7.3, the use of localhost is NOT\n      // > RECOMMENDED.  Specifying a redirect URI with the loopback IP literal\n      // > rather than localhost avoids inadvertently listening on network\n      // > interfaces other than the loopback interface.  It is also less\n      // > susceptible to client-side firewalls and misconfigured host name\n      // > resolution on the user's device.\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message:\n          'Use of \"localhost\" hostname is not allowed (RFC 8252), use a loopback IP such as \"127.0.0.1\" instead',\n      })\n      return false\n    }\n\n    return true\n  },\n)\nexport type OAuthLoopbackRedirectURI = TypeOf<\n  typeof oauthLoopbackRedirectURISchema\n>\n\nexport const oauthHttpsRedirectURISchema = httpsUriSchema\nexport type OAuthHttpsRedirectURI = TypeOf<typeof oauthHttpsRedirectURISchema>\n\nexport const oauthPrivateUseRedirectURISchema = privateUseUriSchema\nexport type OAuthPrivateUseRedirectURI = TypeOf<\n  typeof oauthPrivateUseRedirectURISchema\n>\n\nexport const oauthRedirectUriSchema = z.union(\n  [\n    oauthLoopbackRedirectURISchema,\n    oauthHttpsRedirectURISchema,\n    oauthPrivateUseRedirectURISchema,\n  ],\n  {\n    message: `URL must use the \"https:\" or \"http:\" protocol, or a private-use URI scheme (RFC 8252)`,\n  },\n)\n\nexport type OAuthRedirectUri = TypeOf<typeof oauthRedirectUriSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAA6C;AAC7C,MAAA,+BAKiB;AAEJ,QAAA,8BAA8B,GAAG,SAAA,iBAAiB,CAAC,WAAW,CACzE,CAAC,KAAK,EAAE,GAAG,EAA8D,EAAE;IACzE,IAAI,KAAK,CAAC,UAAU,CAAC,kBAAkB,CAAC,EAAE,CAAC;QACzC,4DAA4D;QAC5D,EAAE;QACF,+CAA+C;QAC/C,wEAAwE;QACxE,oEAAoE;QACpE,yEAAyE;QACzE,oEAAoE;QACpE,mEAAmE;QACnE,qEAAqE;QACrE,qCAAqC;QACrC,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,YAAY,CAAC,MAAM;YACzB,OAAO,EACL,sGAAsG;SACzG,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,OAAO,IAAI,CAAA;AACb,CAAC,CACF,CAAA;AAKY,QAAA,2BAA2B,GAAG,SAAA,cAAc,CAAA;AAG5C,QAAA,gCAAgC,GAAG,SAAA,mBAAmB,CAAA;AAKtD,QAAA,sBAAsB,GAAG,MAAA,CAAC,CAAC,KAAK,CAC3C;IACE,QAAA,8BAA8B;IAC9B,QAAA,2BAA2B;IAC3B,QAAA,gCAAgC;CACjC,EACD;IACE,OAAO,EAAE,CAAA,qFAAA,CAAuF;CACjG,CACF,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15562, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15567, "column": 0}, "map": {"version":3,"file":"oauth-scope.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-scope.ts"],"sourcesContent":["import { z } from 'zod'\n\n/**\n * A space separated list of most non-control ASCII characters except backslash\n * and double quote.\n *\n * @see {@link https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-11#section-1.4.1}\n */\nexport const oauthScopeSchema = z\n  .string()\n  // scope       = scope-token *( SP scope-token )\n  // scope-token = 1*( %x21 / %x23-5B / %x5D-7E )\n  .regex(/^[\\x21\\x23-\\x5B\\x5D-\\x7E]+(?: [\\x21\\x23-\\x5B\\x5D-\\x7E]+)*$/)\n\nexport type OAuthScope = z.infer<typeof oauthScopeSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB;;;;;GAKG,CACU,QAAA,gBAAgB,GAAG,MAAA,CAAC,CAC9B,MAAM,EAAE,AACT,gDAAgD;AAChD,+CAA+C;CAC9C,KAAK,CAAC,4DAA4D,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15581, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15586, "column": 0}, "map": {"version":3,"file":"oauth-client-id-loopback.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-client-id-loopback.ts"],"sourcesContent":["import { TypeOf, ZodIssueCode } from 'zod'\nimport { oauthClientIdSchema } from './oauth-client-id.js'\nimport {\n  OAuthLoopbackRedirectURI,\n  oauthLoopbackRedirectURISchema,\n  OAuthRedirectUri,\n} from './oauth-redirect-uri.js'\nimport { OAuthScope, oauthScopeSchema } from './oauth-scope.js'\n\nconst PREFIX = 'http://localhost'\n\nexport const oauthClientIdLoopbackSchema = oauthClientIdSchema.superRefine(\n  (value, ctx): value is `${typeof PREFIX}${'' | '/'}${'' | `?${string}`}` => {\n    try {\n      assertOAuthLoopbackClientId(value)\n      return true\n    } catch (error) {\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message:\n          error instanceof TypeError\n            ? error.message\n            : 'Invalid loopback client ID',\n      })\n      return false\n    }\n  },\n)\n\nexport type OAuthClientIdLoopback = TypeOf<typeof oauthClientIdLoopbackSchema>\n\nexport function isOAuthClientIdLoopback(\n  clientId: string,\n): clientId is OAuthClientIdLoopback {\n  try {\n    parseOAuthLoopbackClientId(clientId)\n    return true\n  } catch {\n    return false\n  }\n}\n\nexport function assertOAuthLoopbackClientId(\n  clientId: string,\n): asserts clientId is OAuthClientIdLoopback {\n  void parseOAuthLoopbackClientId(clientId)\n}\n\n// @TODO: should we turn this into a zod schema? (more coherent error with other\n// validation functions)\nexport function parseOAuthLoopbackClientId(clientId: string): {\n  scope?: OAuthScope\n  redirect_uris?: [OAuthRedirectUri, ...OAuthRedirectUri[]]\n} {\n  if (!clientId.startsWith(PREFIX)) {\n    throw new TypeError(`Loopback ClientID must start with \"${PREFIX}\"`)\n  } else if (clientId.includes('#', PREFIX.length)) {\n    throw new TypeError('Loopback ClientID must not contain a hash component')\n  }\n\n  const queryStringIdx =\n    clientId.length > PREFIX.length && clientId[PREFIX.length] === '/'\n      ? PREFIX.length + 1\n      : PREFIX.length\n\n  if (clientId.length === queryStringIdx) {\n    return {} // no query string to parse\n  }\n\n  if (clientId[queryStringIdx] !== '?') {\n    throw new TypeError('Loopback ClientID must not contain a path component')\n  }\n\n  const searchParams = new URLSearchParams(clientId.slice(queryStringIdx + 1))\n\n  for (const name of searchParams.keys()) {\n    if (name !== 'redirect_uri' && name !== 'scope') {\n      throw new TypeError(`Invalid query parameter \"${name}\" in client ID`)\n    }\n  }\n\n  const scope = searchParams.get('scope') ?? undefined\n  if (scope != null) {\n    if (searchParams.getAll('scope').length > 1) {\n      throw new TypeError(\n        'Loopback ClientID must contain at most one scope query parameter',\n      )\n    } else if (!oauthScopeSchema.safeParse(scope).success) {\n      throw new TypeError('Invalid scope query parameter in client ID')\n    }\n  }\n\n  const redirect_uris = searchParams.has('redirect_uri')\n    ? (searchParams\n        .getAll('redirect_uri')\n        .map((value) => oauthLoopbackRedirectURISchema.parse(value)) as [\n        OAuthLoopbackRedirectURI,\n        ...OAuthLoopbackRedirectURI[],\n      ])\n    : undefined\n\n  return {\n    scope,\n    redirect_uris,\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 15657, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15662, "column": 0}, "map": {"version":3,"file":"atproto-loopback-client-metadata.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/atproto-loopback-client-metadata.ts"],"sourcesContent":["import {\n  OAuthClientIdLoopback,\n  parseOAuthLoopbackClientId,\n} from './oauth-client-id-loopback.js'\nimport { OAuthClientMetadataInput } from './oauth-client-metadata.js'\n\nexport function atprotoLoopbackClientMetadata(\n  clientId: string,\n): OAuthClientMetadataInput & {\n  client_id: OAuthClientIdLoopback\n} {\n  const {\n    scope = 'atproto',\n    redirect_uris = [`http://127.0.0.1/`, `http://[::1]/`],\n  } = parseOAuthLoopbackClientId(clientId)\n\n  return {\n    client_id: clientId as OAuthClientIdLoopback,\n    scope,\n    redirect_uris,\n    client_name: 'Loopback client',\n    response_types: ['code'],\n    grant_types: ['authorization_code', 'refresh_token'],\n    token_endpoint_auth_method: 'none',\n    application_type: 'native',\n    dpop_bound_access_tokens: true,\n  }\n}\n"],"names":[],"mappings":";;;;AAMA,QAAA,6BAAA,GAAA,8BAqBC;AA3BD,MAAA,yEAGsC;AAGtC,SAAgB,6BAA6B,CAC3C,QAAgB;IAIhB,MAAM,EACJ,KAAK,GAAG,SAAS,EACjB,aAAa,GAAG;QAAC,CAAA,iBAAA,CAAmB;QAAE,CAAA,aAAA,CAAe;KAAC,EACvD,GAAG,CAAA,GAAA,8BAAA,0BAA0B,EAAC,QAAQ,CAAC,CAAA;IAExC,OAAO;QACL,SAAS,EAAE,QAAiC;QAC5C,KAAK;QACL,aAAa;QACb,WAAW,EAAE,iBAAiB;QAC9B,cAAc,EAAE;YAAC,MAAM;SAAC;QACxB,WAAW,EAAE;YAAC,oBAAoB;YAAE,eAAe;SAAC;QACpD,0BAA0B,EAAE,MAAM;QAClC,gBAAgB,EAAE,QAAQ;QAC1B,wBAAwB,EAAE,IAAI;KAC/B,CAAA;AACH,CAAC","ignoreList":[0]}},
    {"offset": {"line": 15690, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15695, "column": 0}, "map": {"version":3,"file":"oauth-access-token.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-access-token.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthAccessTokenSchema = z.string().min(1)\nexport type OAuthAccessToken = z.infer<typeof oauthAccessTokenSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,sBAAsB,GAAG,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15702, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15707, "column": 0}, "map": {"version":3,"file":"oauth-authorization-code-grant-token-request.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-authorization-code-grant-token-request.ts"],"sourcesContent":["import { z } from 'zod'\nimport { oauthRedirectUriSchema } from './oauth-redirect-uri.js'\n\nexport const oauthAuthorizationCodeGrantTokenRequestSchema = z.object({\n  grant_type: z.literal('authorization_code'),\n  code: z.string().min(1),\n  redirect_uri: oauthRedirectUriSchema,\n  /** @see {@link https://datatracker.ietf.org/doc/html/rfc7636#section-4.1} */\n  code_verifier: z\n    .string()\n    .min(43)\n    .max(128)\n    .regex(/^[a-zA-Z0-9-._~]+$/)\n    .optional(),\n})\n\nexport type OAuthAuthorizationCodeGrantTokenRequest = z.infer<\n  typeof oauthAuthorizationCodeGrantTokenRequestSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AACvB,MAAA,6DAAgE;AAEnD,QAAA,6CAA6C,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACpE,UAAU,EAAE,MAAA,CAAC,CAAC,OAAO,CAAC,oBAAoB,CAAC;IAC3C,IAAI,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;IACvB,YAAY,EAAE,wBAAA,sBAAsB;IACpC,2EAAA,EAA6E,CAC7E,aAAa,EAAE,MAAA,CAAC,CACb,MAAM,EAAE,CACR,GAAG,CAAC,EAAE,CAAC,CACP,GAAG,CAAC,GAAG,CAAC,CACR,KAAK,CAAC,oBAAoB,CAAC,CAC3B,QAAQ,EAAE;CACd,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15720, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15725, "column": 0}, "map": {"version":3,"file":"oauth-authorization-details.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-authorization-details.ts"],"sourcesContent":["import { z } from 'zod'\nimport { dangerousUriSchema } from './uri.js'\n\n/**\n * @see {@link https://datatracker.ietf.org/doc/html/rfc9396#section-2 | RFC 9396, Section 2}\n */\nexport const oauthAuthorizationDetailSchema = z.object({\n  type: z.string(),\n  /**\n   * An array of strings representing the location of the resource or RS. These\n   * strings are typically URIs identifying the location of the RS.\n   */\n  locations: z.array(dangerousUriSchema).optional(),\n  /**\n   * An array of strings representing the kinds of actions to be taken at the\n   * resource.\n   */\n  actions: z.array(z.string()).optional(),\n  /**\n   * An array of strings representing the kinds of data being requested from the\n   * resource.\n   */\n  datatypes: z.array(z.string()).optional(),\n  /**\n   * A string identifier indicating a specific resource available at the API.\n   */\n  identifier: z.string().optional(),\n  /**\n   * An array of strings representing the types or levels of privilege being\n   * requested at the resource.\n   */\n  privileges: z.array(z.string()).optional(),\n})\n\nexport type OAuthAuthorizationDetail = z.infer<\n  typeof oauthAuthorizationDetailSchema\n>\n\n/**\n * @see {@link https://datatracker.ietf.org/doc/html/rfc9396#section-2 | RFC 9396, Section 2}\n */\nexport const oauthAuthorizationDetailsSchema = z.array(\n  oauthAuthorizationDetailSchema,\n)\n\nexport type OAuthAuthorizationDetails = z.infer<\n  typeof oauthAuthorizationDetailsSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AACvB,MAAA,+BAA6C;AAE7C;;GAEG,CACU,QAAA,8BAA8B,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACrD,IAAI,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE;IAChB;;;OAGG,CACH,SAAS,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,SAAA,kBAAkB,CAAC,CAAC,QAAQ,EAAE;IACjD;;;OAGG,CACH,OAAO,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;IACvC;;;OAGG,CACH,SAAS,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;IACzC;;OAEG,CACH,UAAU,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACjC;;;OAGG,CACH,UAAU,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;CAC3C,CAAC,CAAA;AAMF;;GAEG,CACU,QAAA,+BAA+B,GAAG,MAAA,CAAC,CAAC,KAAK,CACpD,QAAA,8BAA8B,CAC/B,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15759, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15764, "column": 0}, "map": {"version":3,"file":"oauth-authorization-request-jar.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-authorization-request-jar.ts"],"sourcesContent":["import { signedJwtSchema, unsignedJwtSchema } from '@atproto/jwk'\nimport { z } from 'zod'\n\nexport const oauthAuthorizationRequestJarSchema = z.object({\n  /**\n   * AuthorizationRequest inside a JWT:\n   * - \"iat\" is required and **MUST** be less than one minute\n   *\n   * @see {@link https://datatracker.ietf.org/doc/html/rfc9101}\n   */\n  request: z.union([signedJwtSchema, unsignedJwtSchema]),\n})\n\nexport type OAuthAuthorizationRequestJar = z.infer<\n  typeof oauthAuthorizationRequestJarSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,gCAAiE;AACjE,MAAA,uBAAuB;AAEV,QAAA,kCAAkC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACzD;;;;;OAKG,CACH,OAAO,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC;QAAC,MAAA,eAAe;QAAE,MAAA,iBAAiB;KAAC,CAAC;CACvD,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15782, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15787, "column": 0}, "map": {"version":3,"file":"oauth-code-challenge-method.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-code-challenge-method.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthCodeChallengeMethodSchema = z.enum(['S256', 'plain'])\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,8BAA8B,GAAG,MAAA,CAAC,CAAC,IAAI,CAAC;IAAC,MAAM;IAAE,OAAO;CAAC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15797, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15802, "column": 0}, "map": {"version":3,"file":"oauth-response-type.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-response-type.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthResponseTypeSchema = z.enum([\n  // OAuth2 (https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-10#section-4.1.1)\n  'code', // Authorization Code Grant\n  'token', // Implicit Grant\n\n  // OIDC (https://openid.net/specs/oauth-v2-multiple-response-types-1_0.html)\n  'none',\n  'code id_token token',\n  'code id_token',\n  'code token',\n  'id_token token',\n  'id_token',\n])\n\nexport type OAuthResponseType = z.infer<typeof oauthResponseTypeSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,uBAAuB,GAAG,MAAA,CAAC,CAAC,IAAI,CAAC;IAC5C,wFAAwF;IACxF,MAAM,EAAE,2BAA2B;IACnC,OAAO,EAAE,iBAAiB;IAE1B,4EAA4E;IAC5E,MAAM;IACN,qBAAqB;IACrB,eAAe;IACf,YAAY;IACZ,gBAAgB;IAChB,UAAU;CACX,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15820, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15825, "column": 0}, "map": {"version":3,"file":"oidc-claims-parameter.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oidc-claims-parameter.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oidcClaimsParameterSchema = z.enum([\n  // https://openid.net/specs/openid-provider-authentication-policy-extension-1_0.html#rfc.section.5.2\n  // if client metadata \"require_auth_time\" is true, this *must* be provided\n  'auth_time',\n\n  // OIDC\n  'nonce',\n  'acr',\n\n  // OpenID: \"profile\" scope\n  'name',\n  'family_name',\n  'given_name',\n  'middle_name',\n  'nickname',\n  'preferred_username',\n  'gender',\n  'picture',\n  'profile',\n  'website',\n  'birthdate',\n  'zoneinfo',\n  'locale',\n  'updated_at',\n\n  // OpenID: \"email\" scope\n  'email',\n  'email_verified',\n\n  // OpenID: \"phone\" scope\n  'phone_number',\n  'phone_number_verified',\n\n  // OpenID: \"address\" scope\n  'address',\n])\n\nexport type OidcClaimsParameter = z.infer<typeof oidcClaimsParameterSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,yBAAyB,GAAG,MAAA,CAAC,CAAC,IAAI,CAAC;IAC9C,oGAAoG;IACpG,0EAA0E;IAC1E,WAAW;IAEX,OAAO;IACP,OAAO;IACP,KAAK;IAEL,0BAA0B;IAC1B,MAAM;IACN,aAAa;IACb,YAAY;IACZ,aAAa;IACb,UAAU;IACV,oBAAoB;IACpB,QAAQ;IACR,SAAS;IACT,SAAS;IACT,SAAS;IACT,WAAW;IACX,UAAU;IACV,QAAQ;IACR,YAAY;IAEZ,wBAAwB;IACxB,OAAO;IACP,gBAAgB;IAEhB,wBAAwB;IACxB,cAAc;IACd,uBAAuB;IAEvB,0BAA0B;IAC1B,SAAS;CACV,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15862, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15867, "column": 0}, "map": {"version":3,"file":"oidc-claims-properties.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oidc-claims-properties.ts"],"sourcesContent":["import { z } from 'zod'\n\nconst oidcClaimsValueSchema = z.union([z.string(), z.number(), z.boolean()])\n\nexport const oidcClaimsPropertiesSchema = z.object({\n  essential: z.boolean().optional(),\n  value: oidcClaimsValueSchema.optional(),\n  values: z.array(oidcClaimsValueSchema).optional(),\n})\n\nexport type OidcClaimsProperties = z.infer<typeof oidcClaimsPropertiesSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB,MAAM,qBAAqB,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IAAC,MAAA,CAAC,CAAC,MAAM,EAAE;IAAE,MAAA,CAAC,CAAC,MAAM,EAAE;IAAE,MAAA,CAAC,CAAC,OAAO,EAAE;CAAC,CAAC,CAAA;AAE/D,QAAA,0BAA0B,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACjD,SAAS,EAAE,MAAA,CAAC,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE;IACjC,KAAK,EAAE,qBAAqB,CAAC,QAAQ,EAAE;IACvC,MAAM,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC,QAAQ,EAAE;CAClD,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15883, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15888, "column": 0}, "map": {"version":3,"file":"oidc-entity-type.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oidc-entity-type.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oidcEntityTypeSchema = z.enum(['userinfo', 'id_token'])\n\nexport type OidcEntityType = z.infer<typeof oidcEntityTypeSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,oBAAoB,GAAG,MAAA,CAAC,CAAC,IAAI,CAAC;IAAC,UAAU;IAAE,UAAU;CAAC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15898, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15903, "column": 0}, "map": {"version":3,"file":"oauth-authorization-request-parameters.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-authorization-request-parameters.ts"],"sourcesContent":["import { signedJwtSchema } from '@atproto/jwk'\nimport { z } from 'zod'\n\nimport { oauthAuthorizationDetailsSchema } from './oauth-authorization-details.js'\nimport { oauthClientIdSchema } from './oauth-client-id.js'\nimport { oauthCodeChallengeMethodSchema } from './oauth-code-challenge-method.js'\nimport { oauthRedirectUriSchema } from './oauth-redirect-uri.js'\nimport { oauthResponseTypeSchema } from './oauth-response-type.js'\nimport { oauthScopeSchema } from './oauth-scope.js'\nimport { oidcClaimsParameterSchema } from './oidc-claims-parameter.js'\nimport { oidcClaimsPropertiesSchema } from './oidc-claims-properties.js'\nimport { oidcEntityTypeSchema } from './oidc-entity-type.js'\n\n/**\n * @see {@link https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest | OIDC}\n */\nexport const oauthAuthorizationRequestParametersSchema = z.object({\n  client_id: oauthClientIdSchema,\n  state: z.string().optional(),\n  redirect_uri: oauthRedirectUriSchema.optional(),\n  scope: oauthScopeSchema.optional(),\n  response_type: oauthResponseTypeSchema,\n\n  // PKCE\n\n  code_challenge: z.string().optional(),\n  code_challenge_method: oauthCodeChallengeMethodSchema\n    .default('S256')\n    .optional(),\n\n  // DPOP\n\n  // https://datatracker.ietf.org/doc/html/rfc9449#section-12.3\n  dpop_jkt: z.string().optional(),\n\n  // OIDC\n\n  // Default depend on response_type\n  response_mode: z.enum(['query', 'fragment', 'form_post']).optional(),\n\n  nonce: z.string().optional(),\n\n  // Specifies the allowable elapsed time in seconds since the last time the\n  // End-User was actively authenticated by the OP. If the elapsed time is\n  // greater than this value, the OP MUST attempt to actively re-authenticate\n  // the End-User. (The max_age request parameter corresponds to the OpenID 2.0\n  // PAPE [OpenID.PAPE] max_auth_age request parameter.) When max_age is used,\n  // the ID Token returned MUST include an auth_time Claim Value. Note that\n  // max_age=0 is equivalent to prompt=login.\n  max_age: z.number().int().min(0).optional(),\n\n  claims: z\n    .record(\n      oidcEntityTypeSchema,\n      z.record(\n        oidcClaimsParameterSchema,\n        z.union([z.literal(null), oidcClaimsPropertiesSchema]),\n      ),\n    )\n    .optional(),\n\n  // https://openid.net/specs/openid-connect-core-1_0.html#RegistrationParameter\n  // Not supported by this library (yet?)\n  // registration: clientMetadataSchema.optional(),\n\n  login_hint: z.string().min(1).optional(),\n\n  ui_locales: z\n    .string()\n    .regex(/^[a-z]{2}(-[A-Z]{2})?( [a-z]{2}(-[A-Z]{2})?)*$/) // fr-CA fr en\n    .optional(),\n\n  // Previous ID Token, should be provided when prompt=none is used\n  id_token_hint: signedJwtSchema.optional(),\n\n  // Type of UI the AS is displayed on\n  display: z.enum(['page', 'popup', 'touch', 'wap']).optional(),\n\n  /**\n   * - \"none\" will only be allowed if the user already allowed the client on the same device\n   * - \"login\" will force the user to login again, unless he very recently logged in\n   * - \"consent\" will force the user to consent again\n   * - \"select_account\" will force the user to select an account\n   */\n  prompt: z.enum(['none', 'login', 'consent', 'select_account']).optional(),\n\n  // https://datatracker.ietf.org/doc/html/rfc9396\n  authorization_details: oauthAuthorizationDetailsSchema.optional(),\n})\n\n/**\n * @see {oauthAuthorizationRequestParametersSchema}\n */\nexport type OAuthAuthorizationRequestParameters = z.infer<\n  typeof oauthAuthorizationRequestParametersSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,gCAA8C;AAC9C,MAAA,uBAAuB;AAEvB,MAAA,+EAAkF;AAClF,MAAA,uDAA0D;AAC1D,MAAA,+EAAiF;AACjF,MAAA,6DAAgE;AAChE,MAAA,+DAAkE;AAClE,MAAA,+CAAmD;AACnD,MAAA,mEAAsE;AACtE,MAAA,qEAAwE;AACxE,MAAA,yDAA4D;AAE5D;;GAEG,CACU,QAAA,yCAAyC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAChE,SAAS,EAAE,qBAAA,mBAAmB;IAC9B,KAAK,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAC5B,YAAY,EAAE,wBAAA,sBAAsB,CAAC,QAAQ,EAAE;IAC/C,KAAK,EAAE,iBAAA,gBAAgB,CAAC,QAAQ,EAAE;IAClC,aAAa,EAAE,yBAAA,uBAAuB;IAEtC,OAAO;IAEP,cAAc,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACrC,qBAAqB,EAAE,iCAAA,8BAA8B,CAClD,OAAO,CAAC,MAAM,CAAC,CACf,QAAQ,EAAE;IAEb,OAAO;IAEP,6DAA6D;IAC7D,QAAQ,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAE/B,OAAO;IAEP,kCAAkC;IAClC,aAAa,EAAE,MAAA,CAAC,CAAC,IAAI,CAAC;QAAC,OAAO;QAAE,UAAU;QAAE,WAAW;KAAC,CAAC,CAAC,QAAQ,EAAE;IAEpE,KAAK,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAE5B,0EAA0E;IAC1E,wEAAwE;IACxE,2EAA2E;IAC3E,6EAA6E;IAC7E,4EAA4E;IAC5E,yEAAyE;IACzE,2CAA2C;IAC3C,OAAO,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE;IAE3C,MAAM,EAAE,MAAA,CAAC,CACN,MAAM,CACL,sBAAA,oBAAoB,EACpB,MAAA,CAAC,CAAC,MAAM,CACN,2BAAA,yBAAyB,EACzB,MAAA,CAAC,CAAC,KAAK,CAAC;QAAC,MAAA,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;QAAE,4BAAA,0BAA0B;KAAC,CAAC,CACvD,CACF,CACA,QAAQ,EAAE;IAEb,8EAA8E;IAC9E,uCAAuC;IACvC,iDAAiD;IAEjD,UAAU,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE;IAExC,UAAU,EAAE,MAAA,CAAC,CACV,MAAM,EAAE,CACR,KAAK,CAAC,gDAAgD,CAAC,CAAC,cAAc;KACtE,QAAQ,EAAE;IAEb,iEAAiE;IACjE,aAAa,EAAE,MAAA,eAAe,CAAC,QAAQ,EAAE;IAEzC,oCAAoC;IACpC,OAAO,EAAE,MAAA,CAAC,CAAC,IAAI,CAAC;QAAC,MAAM;QAAE,OAAO;QAAE,OAAO;QAAE,KAAK;KAAC,CAAC,CAAC,QAAQ,EAAE;IAE7D;;;;;OAKG,CACH,MAAM,EAAE,MAAA,CAAC,CAAC,IAAI,CAAC;QAAC,MAAM;QAAE,OAAO;QAAE,SAAS;QAAE,gBAAgB;KAAC,CAAC,CAAC,QAAQ,EAAE;IAEzE,gDAAgD;IAChD,qBAAqB,EAAE,iCAAA,+BAA+B,CAAC,QAAQ,EAAE;CAClE,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15982, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 15987, "column": 0}, "map": {"version":3,"file":"oauth-authorization-request-par.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-authorization-request-par.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { oauthAuthorizationRequestJarSchema } from './oauth-authorization-request-jar.js'\nimport { oauthAuthorizationRequestParametersSchema } from './oauth-authorization-request-parameters.js'\n\nexport const oauthAuthorizationRequestParSchema = z.union([\n  oauthAuthorizationRequestParametersSchema,\n  oauthAuthorizationRequestJarSchema,\n])\n\nexport type OAuthAuthorizationRequestPar = z.infer<\n  typeof oauthAuthorizationRequestParSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB,MAAA,uFAAyF;AACzF,MAAA,qGAAuG;AAE1F,QAAA,kCAAkC,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IACxD,4CAAA,yCAAyC;IACzC,qCAAA,kCAAkC;CACnC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 15999, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16004, "column": 0}, "map": {"version":3,"file":"oauth-request-uri.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-request-uri.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthRequestUriSchema = z.string()\n\nexport type OAuthRequestUri = z.infer<typeof oauthRequestUriSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,qBAAqB,GAAG,MAAA,CAAC,CAAC,MAAM,EAAE,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16011, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16016, "column": 0}, "map": {"version":3,"file":"oauth-authorization-request-uri.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-authorization-request-uri.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { oauthRequestUriSchema } from './oauth-request-uri.js'\n\nexport const oauthAuthorizationRequestUriSchema = z.object({\n  request_uri: oauthRequestUriSchema,\n})\n\nexport type OAuthAuthorizationRequestUri = z.infer<\n  typeof oauthAuthorizationRequestUriSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB,MAAA,2DAA8D;AAEjD,QAAA,kCAAkC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACzD,WAAW,EAAE,uBAAA,qBAAqB;CACnC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16026, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16031, "column": 0}, "map": {"version":3,"file":"oauth-authorization-request-query.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-authorization-request-query.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { oauthAuthorizationRequestJarSchema } from './oauth-authorization-request-jar.js'\nimport { oauthAuthorizationRequestParametersSchema } from './oauth-authorization-request-parameters.js'\nimport { oauthAuthorizationRequestUriSchema } from './oauth-authorization-request-uri.js'\n\nexport const oauthAuthorizationRequestQuerySchema = z.union([\n  oauthAuthorizationRequestParametersSchema,\n  oauthAuthorizationRequestJarSchema,\n  oauthAuthorizationRequestUriSchema,\n])\n\nexport type OAuthAuthorizationRequestQuery = z.infer<\n  typeof oauthAuthorizationRequestQuerySchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB,MAAA,uFAAyF;AACzF,MAAA,qGAAuG;AACvG,MAAA,uFAAyF;AAE5E,QAAA,oCAAoC,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IAC1D,4CAAA,yCAAyC;IACzC,qCAAA,kCAAkC;IAClC,qCAAA,kCAAkC;CACnC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16045, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16050, "column": 0}, "map": {"version":3,"file":"oauth-issuer-identifier.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-issuer-identifier.ts"],"sourcesContent":["import { z } from 'zod'\nimport { webUriSchema } from './uri.js'\n\nexport const oauthIssuerIdentifierSchema = webUriSchema.superRefine(\n  (value, ctx) => {\n    // Validate the issuer (MIX-UP attacks)\n\n    if (value.endsWith('/')) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'Issuer URL must not end with a slash',\n      })\n      return false\n    }\n\n    const url = new URL(value)\n\n    if (url.username || url.password) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'Issuer URL must not contain a username or password',\n      })\n      return false\n    }\n\n    if (url.hash || url.search) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'Issuer URL must not contain a query or fragment',\n      })\n      return false\n    }\n\n    const canonicalValue = url.pathname === '/' ? url.origin : url.href\n    if (value !== canonicalValue) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'Issuer URL must be in the canonical form',\n      })\n      return false\n    }\n\n    return true\n  },\n)\n\nexport type OAuthIssuerIdentifier = z.infer<typeof oauthIssuerIdentifierSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AACvB,MAAA,+BAAuC;AAE1B,QAAA,2BAA2B,GAAG,SAAA,YAAY,CAAC,WAAW,CACjE,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;IACb,uCAAuC;IAEvC,IAAI,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;QACxB,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,sCAAsC;SAChD,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,KAAK,CAAC,CAAA;IAE1B,IAAI,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,QAAQ,EAAE,CAAC;QACjC,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,oDAAoD;SAC9D,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,IAAI,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,MAAM,EAAE,CAAC;QAC3B,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,iDAAiD;SAC3D,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,MAAM,cAAc,GAAG,GAAG,CAAC,QAAQ,KAAK,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAA;IACnE,IAAI,KAAK,KAAK,cAAc,EAAE,CAAC;QAC7B,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,0CAA0C;SACpD,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,OAAO,IAAI,CAAA;AACb,CAAC,CACF,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16091, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16096, "column": 0}, "map": {"version":3,"file":"oauth-authorization-server-metadata.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-authorization-server-metadata.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { oauthCodeChallengeMethodSchema } from './oauth-code-challenge-method.js'\nimport { oauthIssuerIdentifierSchema } from './oauth-issuer-identifier.js'\nimport { webUriSchema } from './uri.js'\n\n/**\n * @see {@link https://datatracker.ietf.org/doc/html/rfc8414}\n * @note we do not enforce https: scheme in URIs to support development\n * environments. Make sure to validate the URIs before using it in a production\n * environment.\n */\nexport const oauthAuthorizationServerMetadataSchema = z.object({\n  issuer: oauthIssuerIdentifierSchema,\n\n  claims_supported: z.array(z.string()).optional(),\n  claims_locales_supported: z.array(z.string()).optional(),\n  claims_parameter_supported: z.boolean().optional(),\n  request_parameter_supported: z.boolean().optional(),\n  request_uri_parameter_supported: z.boolean().optional(),\n  require_request_uri_registration: z.boolean().optional(),\n  scopes_supported: z.array(z.string()).optional(),\n  subject_types_supported: z.array(z.string()).optional(),\n  response_types_supported: z.array(z.string()).optional(),\n  response_modes_supported: z.array(z.string()).optional(),\n  grant_types_supported: z.array(z.string()).optional(),\n  code_challenge_methods_supported: z\n    .array(oauthCodeChallengeMethodSchema)\n    .min(1)\n    .optional(),\n  ui_locales_supported: z.array(z.string()).optional(),\n  id_token_signing_alg_values_supported: z.array(z.string()).optional(),\n  display_values_supported: z.array(z.string()).optional(),\n  request_object_signing_alg_values_supported: z.array(z.string()).optional(),\n  authorization_response_iss_parameter_supported: z.boolean().optional(),\n  authorization_details_types_supported: z.array(z.string()).optional(),\n  request_object_encryption_alg_values_supported: z\n    .array(z.string())\n    .optional(),\n  request_object_encryption_enc_values_supported: z\n    .array(z.string())\n    .optional(),\n\n  jwks_uri: webUriSchema.optional(),\n\n  authorization_endpoint: webUriSchema, // .optional(),\n\n  token_endpoint: webUriSchema, // .optional(),\n  token_endpoint_auth_methods_supported: z.array(z.string()).optional(),\n  token_endpoint_auth_signing_alg_values_supported: z\n    .array(z.string())\n    .optional(),\n\n  revocation_endpoint: webUriSchema.optional(),\n  introspection_endpoint: webUriSchema.optional(),\n  pushed_authorization_request_endpoint: webUriSchema.optional(),\n\n  require_pushed_authorization_requests: z.boolean().optional(),\n\n  userinfo_endpoint: webUriSchema.optional(),\n  end_session_endpoint: webUriSchema.optional(),\n  registration_endpoint: webUriSchema.optional(),\n\n  // https://datatracker.ietf.org/doc/html/rfc9449#section-5.1\n  dpop_signing_alg_values_supported: z.array(z.string()).optional(),\n\n  // https://datatracker.ietf.org/doc/html/draft-ietf-oauth-resource-metadata-05#section-4\n  protected_resources: z.array(webUriSchema).optional(),\n\n  // https://drafts.aaronpk.com/draft-parecki-oauth-client-id-metadata-document/draft-parecki-oauth-client-id-metadata-document.html\n  client_id_metadata_document_supported: z.boolean().optional(),\n})\n\nexport type OAuthAuthorizationServerMetadata = z.infer<\n  typeof oauthAuthorizationServerMetadataSchema\n>\n\nexport const oauthAuthorizationServerMetadataValidator =\n  oauthAuthorizationServerMetadataSchema\n    .superRefine((data, ctx) => {\n      if (\n        data.require_pushed_authorization_requests &&\n        !data.pushed_authorization_request_endpoint\n      ) {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message:\n            '\"pushed_authorization_request_endpoint\" required when \"require_pushed_authorization_requests\" is true',\n        })\n      }\n    })\n    .superRefine((data, ctx) => {\n      if (data.response_types_supported) {\n        if (!data.response_types_supported.includes('code')) {\n          ctx.addIssue({\n            code: z.ZodIssueCode.custom,\n            message: 'Response type \"code\" is required',\n          })\n        }\n      }\n    })\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 16168, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16173, "column": 0}, "map": {"version":3,"file":"oauth-client-credentials-grant-token-request.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-client-credentials-grant-token-request.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthClientCredentialsGrantTokenRequestSchema = z.object({\n  grant_type: z.literal('client_credentials'),\n})\n\nexport type OAuthClientCredentialsGrantTokenRequest = z.infer<\n  typeof oauthClientCredentialsGrantTokenRequestSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,6CAA6C,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACpE,UAAU,EAAE,MAAA,CAAC,CAAC,OAAO,CAAC,oBAAoB,CAAC;CAC5C,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16182, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16187, "column": 0}, "map": {"version":3,"file":"oauth-client-credentials.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-client-credentials.ts"],"sourcesContent":["import { z } from 'zod'\nimport { signedJwtSchema } from '@atproto/jwk'\n\nimport { oauthClientIdSchema } from './oauth-client-id.js'\nimport { CLIENT_ASSERTION_TYPE_JWT_BEARER } from './constants.js'\n\nexport const oauthClientCredentialsJwtBearerSchema = z.object({\n  client_id: oauthClientIdSchema,\n  client_assertion_type: z.literal(CLIENT_ASSERTION_TYPE_JWT_BEARER),\n  /**\n   * - \"sub\" the subject MUST be the \"client_id\" of the OAuth client\n   * - \"iat\" is required and MUST be less than one minute\n   * - \"aud\" must containing a value that identifies the authorization server\n   * - The JWT MAY contain a \"jti\" (JWT ID) claim that provides a unique identifier for the token.\n   * - Note that the authorization server may reject JWTs with an \"exp\" claim value that is unreasonably far in the future.\n   *\n   * @see {@link https://datatracker.ietf.org/doc/html/rfc7523#section-3}\n   */\n  client_assertion: signedJwtSchema,\n})\n\nexport type OAuthClientCredentialsJwtBearer = z.infer<\n  typeof oauthClientCredentialsJwtBearerSchema\n>\n\nexport const oauthClientCredentialsSecretPostSchema = z.object({\n  client_id: oauthClientIdSchema,\n  client_secret: z.string(),\n})\n\nexport type OAuthClientCredentialsSecretPost = z.infer<\n  typeof oauthClientCredentialsSecretPostSchema\n>\n\nexport const oauthClientCredentialsNoneSchema = z.object({\n  client_id: oauthClientIdSchema,\n})\n\nexport type OAuthClientCredentialsNone = z.infer<\n  typeof oauthClientCredentialsNoneSchema\n>\n\n//\n\nexport const oauthClientCredentialsSchema = z.union([\n  oauthClientCredentialsJwtBearerSchema,\n  oauthClientCredentialsSecretPostSchema,\n  // Must be last since it is less specific\n  oauthClientCredentialsNoneSchema,\n])\n\nexport type OAuthClientCredentials = z.infer<\n  typeof oauthClientCredentialsSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AACvB,MAAA,gCAA8C;AAE9C,MAAA,uDAA0D;AAC1D,MAAA,2CAAiE;AAEpD,QAAA,qCAAqC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAC5D,SAAS,EAAE,qBAAA,mBAAmB;IAC9B,qBAAqB,EAAE,MAAA,CAAC,CAAC,OAAO,CAAC,eAAA,gCAAgC,CAAC;IAClE;;;;;;;;OAQG,CACH,gBAAgB,EAAE,MAAA,eAAe;CAClC,CAAC,CAAA;AAMW,QAAA,sCAAsC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAC7D,SAAS,EAAE,qBAAA,mBAAmB;IAC9B,aAAa,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE;CAC1B,CAAC,CAAA;AAMW,QAAA,gCAAgC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACvD,SAAS,EAAE,qBAAA,mBAAmB;CAC/B,CAAC,CAAA;AAMF,EAAE;AAEW,QAAA,4BAA4B,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IAClD,QAAA,qCAAqC;IACrC,QAAA,sCAAsC;IACtC,yCAAyC;IACzC,QAAA,gCAAgC;CACjC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16223, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16228, "column": 0}, "map": {"version":3,"file":"oauth-client-id-discoverable.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-client-id-discoverable.ts"],"sourcesContent":["import { TypeOf, z } from 'zod'\nimport { oauthClientIdSchema } from './oauth-client-id.js'\nimport { httpsUriSchema } from './uri.js'\nimport { extractUrlPath, isHostnameIP } from './util.js'\n\n/**\n * @see {@link https://drafts.aaronpk.com/draft-parecki-oauth-client-id-metadata-document/draft-parecki-oauth-client-id-metadata-document.html}\n */\nexport const oauthClientIdDiscoverableSchema = z\n  .intersection(oauthClientIdSchema, httpsUriSchema)\n  .superRefine((value, ctx): value is `https://${string}/${string}` => {\n    const url = new URL(value)\n\n    if (url.username || url.password) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'ClientID must not contain credentials',\n      })\n      return false\n    }\n\n    if (url.hash) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'ClientID must not contain a fragment',\n      })\n      return false\n    }\n\n    if (url.pathname === '/') {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message:\n          'ClientID must contain a path component (e.g. \"/client-metadata.json\")',\n      })\n      return false\n    }\n\n    if (url.pathname.endsWith('/')) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'ClientID path must not end with a trailing slash',\n      })\n      return false\n    }\n\n    if (isHostnameIP(url.hostname)) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'ClientID hostname must not be an IP address',\n      })\n      return false\n    }\n\n    // URL constructor normalizes the URL, so we extract the path manually to\n    // avoid normalization, then compare it to the normalized path to ensure\n    // that the URL does not contain path traversal or other unexpected characters\n    if (extractUrlPath(value) !== url.pathname) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: `ClientID must be in canonical form (\"${url.href}\", got \"${value}\")`,\n      })\n      return false\n    }\n\n    return true\n  })\n\nexport type OAuthClientIdDiscoverable = TypeOf<\n  typeof oauthClientIdDiscoverableSchema\n>\n\nexport function isOAuthClientIdDiscoverable(\n  clientId: string,\n): clientId is OAuthClientIdDiscoverable {\n  return oauthClientIdDiscoverableSchema.safeParse(clientId).success\n}\n\nexport function assertOAuthDiscoverableClientId(\n  value: string,\n): asserts value is OAuthClientIdDiscoverable {\n  void oauthClientIdDiscoverableSchema.parse(value)\n}\n\nexport function parseOAuthDiscoverableClientId(clientId: string): URL {\n  return new URL(oauthClientIdDiscoverableSchema.parse(clientId))\n}\n"],"names":[],"mappings":";;;;;AAwEA,QAAA,2BAAA,GAAA,4BAIC;AAED,QAAA,+BAAA,GAAA,gCAIC;AAED,QAAA,8BAAA,GAAA,+BAEC;AAtFD,MAAA,uBAA+B;AAC/B,MAAA,uDAA0D;AAC1D,MAAA,+BAAyC;AACzC,MAAA,iCAAwD;AAExD;;GAEG,CACU,QAAA,+BAA+B,GAAG,MAAA,CAAC,CAC7C,YAAY,CAAC,qBAAA,mBAAmB,EAAE,SAAA,cAAc,CAAC,CACjD,WAAW,CAAC,CAAC,KAAK,EAAE,GAAG,EAA0C,EAAE;IAClE,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,KAAK,CAAC,CAAA;IAE1B,IAAI,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,QAAQ,EAAE,CAAC;QACjC,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,uCAAuC;SACjD,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,IAAI,GAAG,CAAC,IAAI,EAAE,CAAC;QACb,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,sCAAsC;SAChD,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,IAAI,GAAG,CAAC,QAAQ,KAAK,GAAG,EAAE,CAAC;QACzB,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EACL,uEAAuE;SAC1E,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,IAAI,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;QAC/B,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,kDAAkD;SAC5D,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,IAAI,CAAA,GAAA,UAAA,YAAY,EAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC;QAC/B,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,6CAA6C;SACvD,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,yEAAyE;IACzE,wEAAwE;IACxE,8EAA8E;IAC9E,IAAI,CAAA,GAAA,UAAA,cAAc,EAAC,KAAK,CAAC,KAAK,GAAG,CAAC,QAAQ,EAAE,CAAC;QAC3C,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,MAAA,CAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,OAAO,EAAE,CAAA,qCAAA,EAAwC,GAAG,CAAC,IAAI,CAAA,QAAA,EAAW,KAAK,CAAA,EAAA,CAAI;SAC9E,CAAC,CAAA;QACF,OAAO,KAAK,CAAA;IACd,CAAC;IAED,OAAO,IAAI,CAAA;AACb,CAAC,CAAC,CAAA;AAMJ,SAAgB,2BAA2B,CACzC,QAAgB;IAEhB,OAAO,QAAA,+BAA+B,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAA;AACpE,CAAC;AAED,SAAgB,+BAA+B,CAC7C,KAAa;IAEb,KAAK,QAAA,+BAA+B,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;AACnD,CAAC;AAED,SAAgB,8BAA8B,CAAC,QAAgB;IAC7D,OAAO,IAAI,GAAG,CAAC,QAAA,+BAA+B,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAA;AACjE,CAAC","ignoreList":[0]}},
    {"offset": {"line": 16300, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16305, "column": 0}, "map": {"version":3,"file":"oauth-endpoint-auth-method.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-endpoint-auth-method.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthEndpointAuthMethod = z.enum([\n  'client_secret_basic',\n  'client_secret_jwt',\n  'client_secret_post',\n  'none',\n  'private_key_jwt',\n  'self_signed_tls_client_auth',\n  'tls_client_auth',\n])\n\nexport type OauthEndpointAuthMethod = z.infer<typeof oauthEndpointAuthMethod>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,uBAAuB,GAAG,MAAA,CAAC,CAAC,IAAI,CAAC;IAC5C,qBAAqB;IACrB,mBAAmB;IACnB,oBAAoB;IACpB,MAAM;IACN,iBAAiB;IACjB,6BAA6B;IAC7B,iBAAiB;CAClB,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16320, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16325, "column": 0}, "map": {"version":3,"file":"oauth-grant-type.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-grant-type.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthGrantTypeSchema = z.enum([\n  'authorization_code',\n  'implicit',\n  'refresh_token',\n  'password', // Not part of OAuth 2.1\n  'client_credentials',\n  'urn:ietf:params:oauth:grant-type:jwt-bearer',\n  'urn:ietf:params:oauth:grant-type:saml2-bearer',\n])\n\nexport type OAuthGrantType = z.infer<typeof oauthGrantTypeSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,oBAAoB,GAAG,MAAA,CAAC,CAAC,IAAI,CAAC;IACzC,oBAAoB;IACpB,UAAU;IACV,eAAe;IACf,UAAU,EAAE,wBAAwB;IACpC,oBAAoB;IACpB,6CAA6C;IAC7C,+CAA+C;CAChD,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16340, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16345, "column": 0}, "map": {"version":3,"file":"oauth-client-metadata.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-client-metadata.ts"],"sourcesContent":["import { jwksPubSchema } from '@atproto/jwk'\nimport { z } from 'zod'\n\nimport { oauthClientIdSchema } from './oauth-client-id.js'\nimport { oauthEndpointAuthMethod } from './oauth-endpoint-auth-method.js'\nimport { oauthGrantTypeSchema } from './oauth-grant-type.js'\nimport { oauthRedirectUriSchema } from './oauth-redirect-uri.js'\nimport { oauthResponseTypeSchema } from './oauth-response-type.js'\nimport { oauthScopeSchema } from './oauth-scope.js'\nimport { webUriSchema } from './uri.js'\n\n/**\n * @see {@link https://openid.net/specs/openid-connect-registration-1_0.html}\n * @see {@link https://datatracker.ietf.org/doc/html/rfc7591}\n * @note we do not enforce https: scheme in URIs to support development\n * environments. Make sure to validate the URIs before using it in a production\n * environment.\n */\nexport const oauthClientMetadataSchema = z.object({\n  /**\n   * @note redirect_uris require additional validation\n   */\n  redirect_uris: z.array(oauthRedirectUriSchema).nonempty(),\n  response_types: z\n    .array(oauthResponseTypeSchema)\n    .nonempty()\n    // > If omitted, the default is that the client will use only the \"code\"\n    // > response type.\n    .default(['code']),\n  grant_types: z\n    .array(oauthGrantTypeSchema)\n    .nonempty()\n    // > If omitted, the default behavior is that the client will use only the\n    // > \"authorization_code\" Grant Type.\n    .default(['authorization_code']),\n  scope: oauthScopeSchema.optional(),\n  token_endpoint_auth_method: oauthEndpointAuthMethod\n    .default('none')\n    .optional(),\n  token_endpoint_auth_signing_alg: z.string().optional(),\n  userinfo_signed_response_alg: z.string().optional(),\n  userinfo_encrypted_response_alg: z.string().optional(),\n  jwks_uri: webUriSchema.optional(),\n  jwks: jwksPubSchema.optional(),\n  application_type: z.enum(['web', 'native']).default('web').optional(), // default, per spec, is \"web\"\n  subject_type: z.enum(['public', 'pairwise']).default('public').optional(),\n  request_object_signing_alg: z.string().optional(),\n  id_token_signed_response_alg: z.string().optional(),\n  authorization_signed_response_alg: z.string().default('RS256').optional(),\n  authorization_encrypted_response_enc: z.enum(['A128CBC-HS256']).optional(),\n  authorization_encrypted_response_alg: z.string().optional(),\n  client_id: oauthClientIdSchema.optional(),\n  client_name: z.string().optional(),\n  client_uri: webUriSchema.optional(),\n  policy_uri: webUriSchema.optional(),\n  tos_uri: webUriSchema.optional(),\n  logo_uri: webUriSchema.optional(), // TODO: allow data: uri ?\n\n  /**\n   * Default Maximum Authentication Age. Specifies that the End-User MUST be\n   * actively authenticated if the End-User was authenticated longer ago than\n   * the specified number of seconds. The max_age request parameter overrides\n   * this default value. If omitted, no default Maximum Authentication Age is\n   * specified.\n   */\n  default_max_age: z.number().optional(),\n  require_auth_time: z.boolean().optional(),\n  contacts: z.array(z.string().email()).optional(),\n  tls_client_certificate_bound_access_tokens: z.boolean().optional(),\n\n  // https://datatracker.ietf.org/doc/html/rfc9449#section-5.2\n  dpop_bound_access_tokens: z.boolean().optional(),\n\n  // https://datatracker.ietf.org/doc/html/rfc9396#section-14.5\n  authorization_details_types: z.array(z.string()).optional(),\n})\n\nexport type OAuthClientMetadata = z.infer<typeof oauthClientMetadataSchema>\nexport type OAuthClientMetadataInput = z.input<typeof oauthClientMetadataSchema>\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 16422, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16427, "column": 0}, "map": {"version":3,"file":"oauth-endpoint-name.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-endpoint-name.ts"],"sourcesContent":["export const OAUTH_ENDPOINT_NAMES = [\n  'token',\n  'revocation',\n  'introspection',\n  'pushed_authorization_request',\n] as const\n\nexport type OAuthEndpointName = (typeof OAUTH_ENDPOINT_NAMES)[number]\n"],"names":[],"mappings":";;;;;AAAa,QAAA,oBAAoB,GAAG;IAClC,OAAO;IACP,YAAY;IACZ,eAAe;IACf,8BAA8B;CACtB,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16438, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16443, "column": 0}, "map": {"version":3,"file":"oauth-introspection-response.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-introspection-response.ts"],"sourcesContent":["import { OAuthAuthorizationDetails } from './oauth-authorization-details.js'\nimport { OAuthTokenType } from './oauth-token-type.js'\n\n// https://datatracker.ietf.org/doc/html/rfc7662#section-2.2\nexport type OAuthIntrospectionResponse =\n  | { active: false }\n  | {\n      active: true\n\n      scope?: string\n      client_id?: string\n      username?: string\n      token_type?: OAuthTokenType\n      authorization_details?: OAuthAuthorizationDetails\n\n      aud?: string | [string, ...string[]]\n      exp?: number\n      iat?: number\n      iss?: string\n      jti?: string\n      nbf?: number\n      sub?: string\n    }\n"],"names":[],"mappings":"","ignoreList":[0]}},
    {"offset": {"line": 16447, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16452, "column": 0}, "map": {"version":3,"file":"oauth-par-response.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-par-response.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthParResponseSchema = z.object({\n  request_uri: z.string(),\n  expires_in: z.number().int().positive(),\n})\n\nexport type OAuthParResponse = z.infer<typeof oauthParResponseSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,sBAAsB,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAC7C,WAAW,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE;IACvB,UAAU,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE;CACxC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16462, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16467, "column": 0}, "map": {"version":3,"file":"oauth-password-grant-token-request.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-password-grant-token-request.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthPasswordGrantTokenRequestSchema = z.object({\n  grant_type: z.literal('password'),\n  username: z.string(),\n  password: z.string(),\n})\n\nexport type OAuthPasswordGrantTokenRequest = z.infer<\n  typeof oauthPasswordGrantTokenRequestSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,oCAAoC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAC3D,UAAU,EAAE,MAAA,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC;IACjC,QAAQ,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE;IACpB,QAAQ,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE;CACrB,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16478, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16483, "column": 0}, "map": {"version":3,"file":"oauth-protected-resource-metadata.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-protected-resource-metadata.ts"],"sourcesContent":["import { z } from 'zod'\n\nimport { oauthIssuerIdentifierSchema } from './oauth-issuer-identifier.js'\nimport { webUriSchema } from './uri.js'\n\n/**\n * @see {@link https://datatracker.ietf.org/doc/html/draft-ietf-oauth-resource-metadata-05#name-protected-resource-metadata-r}\n */\nexport const oauthProtectedResourceMetadataSchema = z.object({\n  /**\n   * REQUIRED. The protected resource's resource identifier, which is a URL that\n   * uses the https scheme and has no query or fragment components. Using these\n   * well-known resources is described in Section 3.\n   *\n   * @note This schema allows non https URLs for testing & development purposes.\n   * Make sure to validate the URL before using it in a production environment.\n   */\n  resource: webUriSchema\n    .refine((url) => !url.includes('?'), {\n      message: 'Resource URL must not contain query parameters',\n    })\n    .refine((url) => !url.includes('#'), {\n      message: 'Resource URL must not contain a fragment',\n    }),\n\n  /**\n   * OPTIONAL. JSON array containing a list of OAuth authorization server issuer\n   * identifiers, as defined in [RFC8414], for authorization servers that can be\n   * used with this protected resource. Protected resources MAY choose not to\n   * advertise some supported authorization servers even when this parameter is\n   * used. In some use cases, the set of authorization servers will not be\n   * enumerable, in which case this metadata parameter would not be used.\n   */\n  authorization_servers: z.array(oauthIssuerIdentifierSchema).optional(),\n\n  /**\n   * OPTIONAL. URL of the protected resource's JWK Set [JWK] document. This\n   * contains public keys belonging to the protected resource, such as signing\n   * key(s) that the resource server uses to sign resource responses. This URL\n   * MUST use the https scheme. When both signing and encryption keys are made\n   * available, a use (public key use) parameter value is REQUIRED for all keys\n   * in the referenced JWK Set to indicate each key's intended usage.\n   */\n  jwks_uri: webUriSchema.optional(),\n\n  /**\n   * RECOMMENDED. JSON array containing a list of the OAuth 2.0 [RFC6749] scope\n   * values that are used in authorization requests to request access to this\n   * protected resource. Protected resources MAY choose not to advertise some\n   * scope values supported even when this parameter is used.\n   */\n  scopes_supported: z.array(z.string()).optional(),\n\n  /**\n   * OPTIONAL. JSON array containing a list of the supported methods of sending\n   * an OAuth 2.0 Bearer Token [RFC6750] to the protected resource. Defined\n   * values are [\"header\", \"body\", \"query\"], corresponding to Sections 2.1, 2.2,\n   * and 2.3 of RFC 6750.\n   */\n  bearer_methods_supported: z\n    .array(z.enum(['header', 'body', 'query']))\n    .optional(),\n\n  /**\n   * OPTIONAL. JSON array containing a list of the JWS [JWS] signing algorithms\n   * (alg values) [JWA] supported by the protected resource for signing resource\n   * responses, for instance, as described in [FAPI.MessageSigning]. No default\n   * algorithms are implied if this entry is omitted. The value none MUST NOT be\n   * used.\n   */\n  resource_signing_alg_values_supported: z.array(z.string()).optional(),\n\n  /**\n   * OPTIONAL. URL of a page containing human-readable information that\n   * developers might want or need to know when using the protected resource\n   */\n  resource_documentation: webUriSchema.optional(),\n\n  /**\n   * OPTIONAL. URL that the protected resource provides to read about the\n   * protected resource's requirements on how the client can use the data\n   * provided by the protected resource\n   */\n  resource_policy_uri: webUriSchema.optional(),\n\n  /**\n   * OPTIONAL. URL that the protected resource provides to read about the\n   * protected resource's terms of service\n   */\n  resource_tos_uri: webUriSchema.optional(),\n})\n\nexport type OAuthProtectedResourceMetadata = z.infer<\n  typeof oauthProtectedResourceMetadataSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB,MAAA,uEAA0E;AAC1E,MAAA,+BAAuC;AAEvC;;GAEG,CACU,QAAA,oCAAoC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAC3D;;;;;;;OAOG,CACH,QAAQ,EAAE,SAAA,YAAY,CACnB,MAAM,CAAC,CAAC,GAAG,EAAE,CAAG,CAAD,AAAE,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;QACnC,OAAO,EAAE,gDAAgD;KAC1D,CAAC,CACD,MAAM,CAAC,CAAC,GAAG,EAAE,CAAG,CAAC,AAAF,GAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;QACnC,OAAO,EAAE,0CAA0C;KACpD,CAAC;IAEJ;;;;;;;OAOG,CACH,qBAAqB,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,6BAAA,2BAA2B,CAAC,CAAC,QAAQ,EAAE;IAEtE;;;;;;;OAOG,CACH,QAAQ,EAAE,SAAA,YAAY,CAAC,QAAQ,EAAE;IAEjC;;;;;OAKG,CACH,gBAAgB,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;IAEhD;;;;;OAKG,CACH,wBAAwB,EAAE,MAAA,CAAC,CACxB,KAAK,CAAC,MAAA,CAAC,CAAC,IAAI,CAAC;QAAC,QAAQ;QAAE,MAAM;QAAE,OAAO;KAAC,CAAC,CAAC,CAC1C,QAAQ,EAAE;IAEb;;;;;;OAMG,CACH,qCAAqC,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;IAErE;;;OAGG,CACH,sBAAsB,EAAE,SAAA,YAAY,CAAC,QAAQ,EAAE;IAE/C;;;;OAIG,CACH,mBAAmB,EAAE,SAAA,YAAY,CAAC,QAAQ,EAAE;IAE5C;;;OAGG,CACH,gBAAgB,EAAE,SAAA,YAAY,CAAC,QAAQ,EAAE;CAC1C,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16559, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16564, "column": 0}, "map": {"version":3,"file":"oauth-refresh-token.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-refresh-token.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthRefreshTokenSchema = z.string().min(1)\nexport type OAuthRefreshToken = z.infer<typeof oauthRefreshTokenSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,uBAAuB,GAAG,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16571, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16576, "column": 0}, "map": {"version":3,"file":"oauth-refresh-token-grant-token-request.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-refresh-token-grant-token-request.ts"],"sourcesContent":["import { z } from 'zod'\nimport { oauthRefreshTokenSchema } from './oauth-refresh-token.js'\n\nexport const oauthRefreshTokenGrantTokenRequestSchema = z.object({\n  grant_type: z.literal('refresh_token'),\n  refresh_token: oauthRefreshTokenSchema,\n})\n\nexport type OAuthRefreshTokenGrantTokenRequest = z.infer<\n  typeof oauthRefreshTokenGrantTokenRequestSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AACvB,MAAA,+DAAkE;AAErD,QAAA,wCAAwC,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IAC/D,UAAU,EAAE,MAAA,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC;IACtC,aAAa,EAAE,yBAAA,uBAAuB;CACvC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16587, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16592, "column": 0}, "map": {"version":3,"file":"oauth-response-mode.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-response-mode.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const oauthResponseModeSchema = z.enum([\n  'query',\n  'fragment',\n  'form_post',\n])\n\nexport type OAuthResponseMode = z.infer<typeof oauthResponseModeSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEV,QAAA,uBAAuB,GAAG,MAAA,CAAC,CAAC,IAAI,CAAC;IAC5C,OAAO;IACP,UAAU;IACV,WAAW;CACZ,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16603, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16608, "column": 0}, "map": {"version":3,"file":"oauth-token-identification.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-token-identification.ts"],"sourcesContent":["import { z } from 'zod'\nimport { oauthAccessTokenSchema } from './oauth-access-token.js'\nimport { oauthRefreshTokenSchema } from './oauth-refresh-token.js'\n\nexport const oauthTokenIdentificationSchema = z.object({\n  token: z.union([oauthAccessTokenSchema, oauthRefreshTokenSchema]),\n  token_type_hint: z.enum(['access_token', 'refresh_token']).optional(),\n})\n\nexport type OAuthTokenIdentification = z.infer<\n  typeof oauthTokenIdentificationSchema\n>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AACvB,MAAA,6DAAgE;AAChE,MAAA,+DAAkE;AAErD,QAAA,8BAA8B,GAAG,MAAA,CAAC,CAAC,MAAM,CAAC;IACrD,KAAK,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC;QAAC,wBAAA,sBAAsB;QAAE,yBAAA,uBAAuB;KAAC,CAAC;IACjE,eAAe,EAAE,MAAA,CAAC,CAAC,IAAI,CAAC;QAAC,cAAc;QAAE,eAAe;KAAC,CAAC,CAAC,QAAQ,EAAE;CACtE,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16626, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16631, "column": 0}, "map": {"version":3,"file":"oauth-token-request.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-token-request.ts"],"sourcesContent":["import { z } from 'zod'\nimport { oauthAuthorizationCodeGrantTokenRequestSchema } from './oauth-authorization-code-grant-token-request.js'\nimport { oauthClientCredentialsGrantTokenRequestSchema } from './oauth-client-credentials-grant-token-request.js'\nimport { oauthPasswordGrantTokenRequestSchema } from './oauth-password-grant-token-request.js'\nimport { oauthRefreshTokenGrantTokenRequestSchema } from './oauth-refresh-token-grant-token-request.js'\n\nexport const oauthTokenRequestSchema = z.discriminatedUnion('grant_type', [\n  oauthAuthorizationCodeGrantTokenRequestSchema,\n  oauthRefreshTokenGrantTokenRequestSchema,\n  oauthPasswordGrantTokenRequestSchema,\n  oauthClientCredentialsGrantTokenRequestSchema,\n])\n\nexport type OAuthTokenRequest = z.infer<typeof oauthTokenRequestSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AACvB,MAAA,iHAAiH;AACjH,MAAA,iHAAiH;AACjH,MAAA,6FAA8F;AAC9F,MAAA,uGAAuG;AAE1F,QAAA,uBAAuB,GAAG,MAAA,CAAC,CAAC,kBAAkB,CAAC,YAAY,EAAE;IACxE,kDAAA,6CAA6C;IAC7C,6CAAA,wCAAwC;IACxC,wCAAA,oCAAoC;IACpC,kDAAA,6CAA6C;CAC9C,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16647, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16652, "column": 0}, "map": {"version":3,"file":"oauth-token-type.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-token-type.ts"],"sourcesContent":["import { z } from 'zod'\n\n// Case insensitive input, normalized output\nexport const oauthTokenTypeSchema = z.union([\n  z\n    .string()\n    .regex(/^DPoP$/i)\n    .transform(() => 'DPoP' as const),\n  z\n    .string()\n    .regex(/^Bearer$/i)\n    .transform(() => 'Bearer' as const),\n])\n\nexport type OAuthTokenType = z.infer<typeof oauthTokenTypeSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAAuB;AAEvB,4CAA4C;AAC/B,QAAA,oBAAoB,GAAG,MAAA,CAAC,CAAC,KAAK,CAAC;IAC1C,MAAA,CAAC,CACE,MAAM,EAAE,CACR,KAAK,CAAC,SAAS,CAAC,CAChB,SAAS,CAAC,GAAG,CAAG,CAAD,KAAgB,CAAC;IACnC,MAAA,CAAC,CACE,MAAM,EAAE,CACR,KAAK,CAAC,WAAW,CAAC,CAClB,SAAS,CAAC,GAAG,CAAG,CAAD,OAAkB,CAAC;CACtC,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16663, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16668, "column": 0}, "map": {"version":3,"file":"oauth-token-response.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/oauth-token-response.ts"],"sourcesContent":["import { signedJwtSchema } from '@atproto/jwk'\nimport { z } from 'zod'\n\nimport { oauthAuthorizationDetailsSchema } from './oauth-authorization-details.js'\nimport { oauthTokenTypeSchema } from './oauth-token-type.js'\n\n/**\n * @see {@link https://www.rfc-editor.org/rfc/rfc6749.html#section-5.1 | RFC 6749 (OAuth2), Section 5.1}\n */\nexport const oauthTokenResponseSchema = z\n  .object({\n    // https://www.rfc-editor.org/rfc/rfc6749.html#section-5.1\n    access_token: z.string(),\n    token_type: oauthTokenTypeSchema,\n    scope: z.string().optional(),\n    refresh_token: z.string().optional(),\n    expires_in: z.number().optional(),\n    // https://openid.net/specs/openid-connect-core-1_0.html#TokenResponse\n    id_token: signedJwtSchema.optional(),\n    // https://datatracker.ietf.org/doc/html/rfc9396#name-enriched-authorization-deta\n    authorization_details: oauthAuthorizationDetailsSchema.optional(),\n  })\n  // https://www.rfc-editor.org/rfc/rfc6749.html#section-5.1\n  // > The client MUST ignore unrecognized value names in the response.\n  .passthrough()\n\n/**\n * @see {@link oauthTokenResponseSchema}\n */\nexport type OAuthTokenResponse = z.infer<typeof oauthTokenResponseSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,gCAA8C;AAC9C,MAAA,uBAAuB;AAEvB,MAAA,+EAAkF;AAClF,MAAA,yDAA4D;AAE5D;;GAEG,CACU,QAAA,wBAAwB,GAAG,MAAA,CAAC,CACtC,MAAM,CAAC;IACN,0DAA0D;IAC1D,YAAY,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE;IACxB,UAAU,EAAE,sBAAA,oBAAoB;IAChC,KAAK,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAC5B,aAAa,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACpC,UAAU,EAAE,MAAA,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACjC,sEAAsE;IACtE,QAAQ,EAAE,MAAA,eAAe,CAAC,QAAQ,EAAE;IACpC,iFAAiF;IACjF,qBAAqB,EAAE,iCAAA,+BAA+B,CAAC,QAAQ,EAAE;CAClE,CAAC,AACF,0DAA0D;AAC1D,qEAAqE;CACpE,WAAW,EAAE,CAAA","ignoreList":[0]}},
    {"offset": {"line": 16693, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16698, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-types/src/index.ts"],"sourcesContent":["export * from './constants.js'\nexport * from './uri.js'\nexport * from './util.js'\n\nexport * from './atproto-loopback-client-metadata.js'\nexport * from './oauth-access-token.js'\nexport * from './oauth-authorization-code-grant-token-request.js'\nexport * from './oauth-authorization-details.js'\nexport * from './oauth-authorization-request-jar.js'\nexport * from './oauth-authorization-request-par.js'\nexport * from './oauth-authorization-request-parameters.js'\nexport * from './oauth-authorization-request-query.js'\nexport * from './oauth-authorization-request-uri.js'\nexport * from './oauth-authorization-server-metadata.js'\nexport * from './oauth-client-credentials-grant-token-request.js'\nexport * from './oauth-client-credentials.js'\nexport * from './oauth-client-id-discoverable.js'\nexport * from './oauth-client-id-loopback.js'\nexport * from './oauth-client-id.js'\nexport * from './oauth-client-metadata.js'\nexport * from './oauth-endpoint-auth-method.js'\nexport * from './oauth-endpoint-name.js'\nexport * from './oauth-grant-type.js'\nexport * from './oauth-introspection-response.js'\nexport * from './oauth-issuer-identifier.js'\nexport * from './oauth-par-response.js'\nexport * from './oauth-password-grant-token-request.js'\nexport * from './oauth-protected-resource-metadata.js'\nexport * from './oauth-redirect-uri.js'\nexport * from './oauth-refresh-token-grant-token-request.js'\nexport * from './oauth-refresh-token.js'\nexport * from './oauth-request-uri.js'\nexport * from './oauth-response-mode.js'\nexport * from './oauth-response-type.js'\nexport * from './oauth-scope.js'\nexport * from './oauth-token-identification.js'\nexport * from './oauth-token-request.js'\nexport * from './oauth-token-response.js'\nexport * from './oauth-token-type.js'\nexport * from './oidc-claims-parameter.js'\nexport * from './oidc-claims-properties.js'\nexport * from './oidc-entity-type.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,4HAAA,SAA8B;AAC9B,sHAAA,SAAwB;AACxB,uHAAA,SAAyB;AAEzB,mJAAA,SAAqD;AACrD,qIAAA,SAAuC;AACvC,+JAAA,SAAiE;AACjE,8IAAA,SAAgD;AAChD,kJAAA,SAAoD;AACpD,kJAAA,SAAoD;AACpD,yJAAA,SAA2D;AAC3D,oJAAA,SAAsD;AACtD,kJAAA,SAAoD;AACpD,sJAAA,SAAwD;AACxD,+JAAA,SAAiE;AACjE,2IAAA,SAA6C;AAC7C,+IAAA,SAAiD;AACjD,2IAAA,SAA6C;AAC7C,kIAAA,SAAoC;AACpC,wIAAA,SAA0C;AAC1C,6IAAA,SAA+C;AAC/C,sIAAA,SAAwC;AACxC,mIAAA,SAAqC;AACrC,+IAAA,SAAiD;AACjD,0IAAA,SAA4C;AAC5C,qIAAA,SAAuC;AACvC,qJAAA,SAAuD;AACvD,oJAAA,SAAsD;AACtD,qIAAA,SAAuC;AACvC,0JAAA,SAA4D;AAC5D,sIAAA,SAAwC;AACxC,oIAAA,SAAsC;AACtC,sIAAA,SAAwC;AACxC,sIAAA,SAAwC;AACxC,8HAAA,SAAgC;AAChC,6IAAA,SAA+C;AAC/C,sIAAA,SAAwC;AACxC,uIAAA,SAAyC;AACzC,mIAAA,SAAqC;AACrC,wIAAA,SAA0C;AAC1C,yIAAA,SAA2C;AAC3C,mIAAA,SAAqC","ignoreList":[0]}},
    {"offset": {"line": 16762, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16767, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/util.ts"],"sourcesContent":["export type Awaitable<T> = T | PromiseLike<T>\nexport type Simplify<T> = { [K in keyof T]: T[K] } & NonNullable<unknown>\n\n// @ts-expect-error\nSymbol.dispose ??= Symbol('@@dispose')\n\n/**\n * @todo (?) move to common package\n */\nexport const timeoutSignal = (\n  timeout: number,\n  options?: { signal?: AbortSignal },\n): AbortSignal & Disposable => {\n  if (!Number.isInteger(timeout) || timeout < 0) {\n    throw new TypeError('Expected a positive integer')\n  }\n\n  options?.signal?.throwIfAborted()\n\n  const controller = new AbortController()\n  const { signal } = controller\n\n  options?.signal?.addEventListener(\n    'abort',\n    (reason) => controller.abort(reason),\n    { once: true, signal },\n  )\n\n  const timeoutId = setTimeout(\n    (err) => controller.abort(err),\n    timeout,\n    // create Error here to keep original stack trace\n    new Error('Timeout'),\n  )\n\n  timeoutId?.unref?.() // NodeJS only\n\n  signal.addEventListener('abort', () => clearTimeout(timeoutId), {\n    once: true,\n    signal,\n  })\n\n  Object.defineProperty(signal, Symbol.dispose, {\n    value: () => controller.abort(),\n  })\n\n  return signal as AbortSignal & Disposable\n}\n\nexport function contentMime(headers: Headers): string | undefined {\n  return headers.get('content-type')?.split(';')[0]!.trim()\n}\n\n/**\n * Ponyfill for `CustomEvent` constructor.\n */\nexport const CustomEvent: typeof globalThis.CustomEvent =\n  globalThis.CustomEvent ??\n  (() => {\n    class CustomEvent<T> extends Event {\n      #detail: T | null\n      constructor(type: string, options?: CustomEventInit<T>) {\n        if (!arguments.length) throw new TypeError('type argument is required')\n        super(type, options)\n        this.#detail = options?.detail ?? null\n      }\n      get detail() {\n        return this.#detail\n      }\n    }\n\n    Object.defineProperties(CustomEvent.prototype, {\n      [Symbol.toStringTag]: {\n        writable: false,\n        enumerable: false,\n        configurable: true,\n        value: 'CustomEvent',\n      },\n      detail: {\n        enumerable: true,\n      },\n    })\n\n    return CustomEvent\n  })()\n\nexport class CustomEventTarget<EventDetailMap extends Record<string, unknown>> {\n  readonly eventTarget = new EventTarget()\n\n  addEventListener<T extends Extract<keyof EventDetailMap, string>>(\n    type: T,\n    callback: (event: CustomEvent<EventDetailMap[T]>) => void,\n    options?: AddEventListenerOptions | boolean,\n  ): void {\n    this.eventTarget.addEventListener(type, callback as EventListener, options)\n  }\n\n  removeEventListener<T extends Extract<keyof EventDetailMap, string>>(\n    type: T,\n    callback: (event: CustomEvent<EventDetailMap[T]>) => void,\n    options?: EventListenerOptions | boolean,\n  ): void {\n    this.eventTarget.removeEventListener(\n      type,\n      callback as EventListener,\n      options,\n    )\n  }\n\n  dispatchCustomEvent<T extends Extract<keyof EventDetailMap, string>>(\n    type: T,\n    detail: EventDetailMap[T],\n    init?: EventInit,\n  ): boolean {\n    return this.eventTarget.dispatchEvent(\n      new CustomEvent(type, { ...init, detail }),\n    )\n  }\n}\n\nexport type SpaceSeparatedValue<Value extends string> =\n  | `${Value}`\n  | `${Value} ${string}`\n  | `${string} ${Value}`\n  | `${string} ${Value} ${string}`\n\nexport const includesSpaceSeparatedValue = <Value extends string>(\n  input: string,\n  value: Value,\n): input is SpaceSeparatedValue<Value> => {\n  if (value.length === 0) throw new TypeError('Value cannot be empty')\n  if (value.includes(' ')) throw new TypeError('Value cannot contain spaces')\n\n  // Optimized version of:\n  // return input.split(' ').includes(value)\n\n  const inputLength = input.length\n  const valueLength = value.length\n\n  if (inputLength < valueLength) return false\n\n  let idx = input.indexOf(value)\n  let idxEnd: number\n\n  while (idx !== -1) {\n    idxEnd = idx + valueLength\n\n    if (\n      // at beginning or preceded by space\n      (idx === 0 || input[idx - 1] === ' ') &&\n      // at end or followed by space\n      (idxEnd === inputLength || input[idxEnd] === ' ')\n    ) {\n      return true\n    }\n\n    idx = input.indexOf(value, idxEnd + 1)\n  }\n\n  return false\n}\n\nexport function combineSignals(signals: readonly (AbortSignal | undefined)[]) {\n  const controller = new AbortController()\n\n  const onAbort = function (this: AbortSignal, _event: Event) {\n    const reason = new Error('This operation was aborted', {\n      cause: this.reason,\n    })\n\n    controller.abort(reason)\n  }\n\n  for (const sig of signals) {\n    if (!sig) continue\n\n    if (sig.aborted) {\n      // Remove \"abort\" listener that was added to sig in previous iterations\n      controller.abort()\n\n      throw new Error('One of the signals is already aborted', {\n        cause: sig.reason,\n      })\n    }\n\n    sig.addEventListener('abort', onAbort, { signal: controller.signal })\n  }\n\n  controller[Symbol.dispose] = () => {\n    const reason = new Error('AbortController was disposed')\n\n    controller.abort(reason)\n  }\n\n  return controller as AbortController & Disposable\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 16917, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 16922, "column": 0}, "map": {"version":3,"file":"oauth-authorization-server-metadata-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-authorization-server-metadata-resolver.ts"],"sourcesContent":["import {\n  bindFetch,\n  cancelBody,\n  Fetch,\n  FetchResponseError,\n} from '@atproto-labs/fetch'\nimport {\n  CachedGetter,\n  GetCachedOptions,\n  SimpleStore,\n} from '@atproto-labs/simple-store'\nimport {\n  OAuthAuthorizationServerMetadata,\n  oauthAuthorizationServerMetadataValidator,\n  oauthIssuerIdentifierSchema,\n} from '@atproto/oauth-types'\nimport { contentMime } from './util.js'\n\nexport type { GetCachedOptions, OAuthAuthorizationServerMetadata }\n\nexport type AuthorizationServerMetadataCache = SimpleStore<\n  string,\n  OAuthAuthorizationServerMetadata\n>\n\nexport type OAuthAuthorizationServerMetadataResolverConfig = {\n  allowHttpIssuer?: boolean\n}\n\n/**\n * @see {@link https://datatracker.ietf.org/doc/html/rfc8414}\n */\nexport class OAuthAuthorizationServerMetadataResolver extends CachedGetter<\n  string,\n  OAuthAuthorizationServerMetadata\n> {\n  private readonly fetch: Fetch<unknown>\n  private readonly allowHttpIssuer: boolean\n\n  constructor(\n    cache: AuthorizationServerMetadataCache,\n    fetch?: Fetch,\n    config?: OAuthAuthorizationServerMetadataResolverConfig,\n  ) {\n    super(async (issuer, options) => this.fetchMetadata(issuer, options), cache)\n\n    this.fetch = bindFetch(fetch)\n    this.allowHttpIssuer = config?.allowHttpIssuer === true\n  }\n\n  async get(\n    input: string,\n    options?: GetCachedOptions,\n  ): Promise<OAuthAuthorizationServerMetadata> {\n    const issuer = oauthIssuerIdentifierSchema.parse(input)\n    if (!this.allowHttpIssuer && issuer.startsWith('http:')) {\n      throw new TypeError(\n        'Unsecure issuer URL protocol only allowed in development and test environments',\n      )\n    }\n    return super.get(issuer, options)\n  }\n\n  private async fetchMetadata(\n    issuer: string,\n    options?: GetCachedOptions,\n  ): Promise<OAuthAuthorizationServerMetadata> {\n    const url = new URL(`/.well-known/oauth-authorization-server`, issuer)\n    const request = new Request(url, {\n      headers: { accept: 'application/json' },\n      cache: options?.noCache ? 'no-cache' : undefined,\n      signal: options?.signal,\n      redirect: 'manual', // response must be 200 OK\n    })\n\n    const response = await this.fetch(request)\n\n    // https://datatracker.ietf.org/doc/html/rfc8414#section-3.2\n    if (response.status !== 200) {\n      await cancelBody(response, 'log')\n      throw await FetchResponseError.from(\n        response,\n        `Unexpected status code ${response.status} for \"${url}\"`,\n        undefined,\n        { cause: request },\n      )\n    }\n\n    if (contentMime(response.headers) !== 'application/json') {\n      await cancelBody(response, 'log')\n      throw await FetchResponseError.from(\n        response,\n        `Unexpected content type for \"${url}\"`,\n        undefined,\n        { cause: request },\n      )\n    }\n\n    const metadata = oauthAuthorizationServerMetadataValidator.parse(\n      await response.json(),\n    )\n\n    // Validate the issuer (MIX-UP attacks)\n    // https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics#name-mix-up-attacks\n    // https://datatracker.ietf.org/doc/html/rfc8414#section-2\n    if (metadata.issuer !== issuer) {\n      throw new TypeError(`Invalid issuer ${metadata.issuer}`)\n    }\n\n    // ATPROTO requires client_id_metadata_document\n    // http://drafts.aaronpk.com/draft-parecki-oauth-client-id-metadata-document/draft-parecki-oauth-client-id-metadata-document.html\n    if (metadata.client_id_metadata_document_supported !== true) {\n      throw new TypeError(\n        `Authorization server \"${issuer}\" does not support client_id_metadata_document`,\n      )\n    }\n\n    return metadata\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 16998, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17003, "column": 0}, "map": {"version":3,"file":"oauth-callback-error.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-callback-error.ts"],"sourcesContent":["export class OAuthCallbackError extends Error {\n  static from(err: unknown, params: URLSearchParams, state?: string) {\n    if (err instanceof OAuthCallbackError) return err\n    const message = err instanceof Error ? err.message : undefined\n    return new OAuthCallbackError(params, message, state, err)\n  }\n\n  constructor(\n    public readonly params: URLSearchParams,\n    message = params.get('error_description') || 'OAuth callback error',\n    public readonly state?: string,\n    cause?: unknown,\n  ) {\n    super(message, { cause })\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAa,kBAAmB,SAAQ,KAAK;IAC3C,MAAM,CAAC,IAAI,CAAC,GAAY,EAAE,MAAuB,EAAE,KAAc,EAAA;QAC/D,IAAI,GAAG,YAAY,kBAAkB,EAAE,OAAO,GAAG,CAAA;QACjD,MAAM,OAAO,GAAG,GAAG,YAAY,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAA;QAC9D,OAAO,IAAI,kBAAkB,CAAC,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,CAAC,CAAA;IAC5D,CAAC;IAED,YACkB,MAAuB,EACvC,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,mBAAmB,CAAC,IAAI,sBAAsB,EACnD,KAAc,EAC9B,KAAe,CAAA;QAEf,KAAK,CAAC,OAAO,EAAE;YAAE,KAAK;QAAA,CAAE,CAAC,CAAA;QALzB,OAAA,cAAA,CAAA,IAAA,EAAA,UAAA;;;;mBAAgB,MAAM;WAAiB;QAEvC,OAAA,cAAA,CAAA,IAAA,EAAA,SAAA;;;;mBAAgB,KAAK;WAAS;IAIhC,CAAC;CACF;AAfD,QAAA,kBAAA,GAAA,mBAeC","ignoreList":[0]}},
    {"offset": {"line": 17033, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17038, "column": 0}, "map": {"version":3,"file":"handle.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/handle.ts"],"sourcesContent":["export const INVALID_HANDLE = 'handle.invalid'\n\n// Currently these are registration-time restrictions, not protocol-level\n// restrictions. We have a couple accounts in the wild that we need to clean up\n// before hard-disallow.\n// See also: https://en.wikipedia.org/wiki/Top-level_domain#Reserved_domains\nexport const DISALLOWED_TLDS = [\n  '.local',\n  '.arpa',\n  '.invalid',\n  '.localhost',\n  '.internal',\n  '.example',\n  '.alt',\n  // policy could concievably change on \".onion\" some day\n  '.onion',\n  // NOTE: .test is allowed in testing and devopment. In practical terms\n  // \"should\" \"never\" actually resolve and get registered in production\n]\n\n// Handle constraints, in English:\n//  - must be a possible domain name\n//    - RFC-1035 is commonly referenced, but has been updated. eg, RFC-3696,\n//      section 2. and RFC-3986, section 3. can now have leading numbers (eg,\n//      4chan.org)\n//    - \"labels\" (sub-names) are made of ASCII letters, digits, hyphens\n//    - can not start or end with a hyphen\n//    - TLD (last component) should not start with a digit\n//    - can't end with a hyphen (can end with digit)\n//    - each segment must be between 1 and 63 characters (not including any periods)\n//    - overall length can't be more than 253 characters\n//    - separated by (ASCII) periods; does not start or end with period\n//    - case insensitive\n//    - domains (handles) are equal if they are the same lower-case\n//    - punycode allowed for internationalization\n//  - no whitespace, null bytes, joining chars, etc\n//  - does not validate whether domain or TLD exists, or is a reserved or\n//    special TLD (eg, .onion or .local)\n//  - does not validate punycode\nexport const ensureValidHandle = (handle: string): void => {\n  // check that all chars are boring ASCII\n  if (!/^[a-zA-Z0-9.-]*$/.test(handle)) {\n    throw new InvalidHandleError(\n      'Disallowed characters in handle (ASCII letters, digits, dashes, periods only)',\n    )\n  }\n\n  if (handle.length > 253) {\n    throw new InvalidHandleError('Handle is too long (253 chars max)')\n  }\n  const labels = handle.split('.')\n  if (labels.length < 2) {\n    throw new InvalidHandleError('Handle domain needs at least two parts')\n  }\n  for (let i = 0; i < labels.length; i++) {\n    const l = labels[i]\n    if (l.length < 1) {\n      throw new InvalidHandleError('Handle parts can not be empty')\n    }\n    if (l.length > 63) {\n      throw new InvalidHandleError('Handle part too long (max 63 chars)')\n    }\n    if (l.endsWith('-') || l.startsWith('-')) {\n      throw new InvalidHandleError(\n        'Handle parts can not start or end with hyphens',\n      )\n    }\n    if (i + 1 === labels.length && !/^[a-zA-Z]/.test(l)) {\n      throw new InvalidHandleError(\n        'Handle final component (TLD) must start with ASCII letter',\n      )\n    }\n  }\n}\n\n// simple regex translation of above constraints\nexport const ensureValidHandleRegex = (handle: string): void => {\n  if (\n    !/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/.test(\n      handle,\n    )\n  ) {\n    throw new InvalidHandleError(\"Handle didn't validate via regex\")\n  }\n  if (handle.length > 253) {\n    throw new InvalidHandleError('Handle is too long (253 chars max)')\n  }\n}\n\nexport const normalizeHandle = (handle: string): string => {\n  return handle.toLowerCase()\n}\n\nexport const normalizeAndEnsureValidHandle = (handle: string): string => {\n  const normalized = normalizeHandle(handle)\n  ensureValidHandle(normalized)\n  return normalized\n}\n\nexport const isValidHandle = (handle: string): boolean => {\n  try {\n    ensureValidHandle(handle)\n  } catch (err) {\n    if (err instanceof InvalidHandleError) {\n      return false\n    }\n    throw err\n  }\n\n  return true\n}\n\nexport const isValidTld = (handle: string): boolean => {\n  return !DISALLOWED_TLDS.some((domain) => handle.endsWith(domain))\n}\n\nexport class InvalidHandleError extends Error {}\nexport class ReservedHandleError extends Error {}\nexport class UnsupportedDomainError extends Error {}\nexport class DisallowedDomainError extends Error {}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 17155, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17160, "column": 0}, "map": {"version":3,"file":"did.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/did.ts"],"sourcesContent":["// Human-readable constraints:\n//   - valid W3C DID (https://www.w3.org/TR/did-core/#did-syntax)\n//      - entire URI is ASCII: [a-zA-Z0-9._:%-]\n//      - always starts \"did:\" (lower-case)\n//      - method name is one or more lower-case letters, followed by \":\"\n//      - remaining identifier can have any of the above chars, but can not end in \":\"\n//      - it seems that a bunch of \":\" can be included, and don't need spaces between\n//      - \"%\" is used only for \"percent encoding\" and must be followed by two hex characters (and thus can't end in \"%\")\n//      - query (\"?\") and fragment (\"#\") stuff is defined for \"DID URIs\", but not as part of identifier itself\n//      - \"The current specification does not take a position on the maximum length of a DID\"\n//   - in current atproto, only allowing did:plc and did:web. But not *forcing* this at lexicon layer\n//   - hard length limit of 8KBytes\n//   - not going to validate \"percent encoding\" here\nexport const ensureValidDid = (did: string): void => {\n  if (!did.startsWith('did:')) {\n    throw new InvalidDidError('DID requires \"did:\" prefix')\n  }\n\n  // check that all chars are boring ASCII\n  if (!/^[a-zA-Z0-9._:%-]*$/.test(did)) {\n    throw new InvalidDidError(\n      'Disallowed characters in DID (ASCII letters, digits, and a couple other characters only)',\n    )\n  }\n\n  const { length, 1: method } = did.split(':')\n  if (length < 3) {\n    throw new InvalidDidError(\n      'DID requires prefix, method, and method-specific content',\n    )\n  }\n\n  if (!/^[a-z]+$/.test(method)) {\n    throw new InvalidDidError('DID method must be lower-case letters')\n  }\n\n  if (did.endsWith(':') || did.endsWith('%')) {\n    throw new InvalidDidError('DID can not end with \":\" or \"%\"')\n  }\n\n  if (did.length > 2 * 1024) {\n    throw new InvalidDidError('DID is too long (2048 chars max)')\n  }\n}\n\nexport const ensureValidDidRegex = (did: string): void => {\n  // simple regex to enforce most constraints via just regex and length.\n  // hand wrote this regex based on above constraints\n  if (!/^did:[a-z]+:[a-zA-Z0-9._:%-]*[a-zA-Z0-9._-]$/.test(did)) {\n    throw new InvalidDidError(\"DID didn't validate via regex\")\n  }\n\n  if (did.length > 2 * 1024) {\n    throw new InvalidDidError('DID is too long (2048 chars max)')\n  }\n}\n\nexport class InvalidDidError extends Error {}\n"],"names":[],"mappings":";;;;;AAAA,8BAA8B;AAC9B,iEAAiE;AACjE,+CAA+C;AAC/C,2CAA2C;AAC3C,wEAAwE;AACxE,sFAAsF;AACtF,qFAAqF;AACrF,wHAAwH;AACxH,8GAA8G;AAC9G,6FAA6F;AAC7F,qGAAqG;AACrG,mCAAmC;AACnC,oDAAoD;AAC7C,MAAM,cAAc,GAAG,CAAC,GAAW,EAAQ,EAAE;IAClD,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE,CAAC;QAC5B,MAAM,IAAI,eAAe,CAAC,4BAA4B,CAAC,CAAA;IACzD,CAAC;IAED,wCAAwC;IACxC,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;QACrC,MAAM,IAAI,eAAe,CACvB,0FAA0F,CAC3F,CAAA;IACH,CAAC;IAED,MAAM,EAAE,MAAM,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;IAC5C,IAAI,MAAM,GAAG,CAAC,EAAE,CAAC;QACf,MAAM,IAAI,eAAe,CACvB,0DAA0D,CAC3D,CAAA;IACH,CAAC;IAED,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;QAC7B,MAAM,IAAI,eAAe,CAAC,uCAAuC,CAAC,CAAA;IACpE,CAAC;IAED,IAAI,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;QAC3C,MAAM,IAAI,eAAe,CAAC,iCAAiC,CAAC,CAAA;IAC9D,CAAC;IAED,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,EAAE,CAAC;QAC1B,MAAM,IAAI,eAAe,CAAC,kCAAkC,CAAC,CAAA;IAC/D,CAAC;AACH,CAAC,CAAA;AA9BY,QAAA,cAAc,GAAA,eA8B1B;AAEM,MAAM,mBAAmB,GAAG,CAAC,GAAW,EAAQ,EAAE;IACvD,sEAAsE;IACtE,mDAAmD;IACnD,IAAI,CAAC,8CAA8C,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;QAC9D,MAAM,IAAI,eAAe,CAAC,+BAA+B,CAAC,CAAA;IAC5D,CAAC;IAED,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,EAAE,CAAC;QAC1B,MAAM,IAAI,eAAe,CAAC,kCAAkC,CAAC,CAAA;IAC/D,CAAC;AACH,CAAC,CAAA;AAVY,QAAA,mBAAmB,GAAA,oBAU/B;AAED,MAAa,eAAgB,SAAQ,KAAK;CAAG;AAA7C,QAAA,eAAA,GAAA,gBAA6C","ignoreList":[0]}},
    {"offset": {"line": 17215, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17220, "column": 0}, "map": {"version":3,"file":"nsid.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/nsid.ts"],"sourcesContent":["/*\nGrammar:\n\nalpha     = \"a\" / \"b\" / \"c\" / \"d\" / \"e\" / \"f\" / \"g\" / \"h\" / \"i\" / \"j\" / \"k\" / \"l\" / \"m\" / \"n\" / \"o\" / \"p\" / \"q\" / \"r\" / \"s\" / \"t\" / \"u\" / \"v\" / \"w\" / \"x\" / \"y\" / \"z\" / \"A\" / \"B\" / \"C\" / \"D\" / \"E\" / \"F\" / \"G\" / \"H\" / \"I\" / \"J\" / \"K\" / \"L\" / \"M\" / \"N\" / \"O\" / \"P\" / \"Q\" / \"R\" / \"S\" / \"T\" / \"U\" / \"V\" / \"W\" / \"X\" / \"Y\" / \"Z\"\nnumber    = \"1\" / \"2\" / \"3\" / \"4\" / \"5\" / \"6\" / \"7\" / \"8\" / \"9\" / \"0\"\ndelim     = \".\"\nsegment   = alpha *( alpha / number / \"-\" )\nauthority = segment *( delim segment )\nname      = alpha *( alpha )\nnsid      = authority delim name\n\n*/\n\nexport class NSID {\n  segments: string[] = []\n\n  static parse(nsid: string): NSID {\n    return new NSID(nsid)\n  }\n\n  static create(authority: string, name: string): NSID {\n    const segments = [...authority.split('.').reverse(), name].join('.')\n    return new NSID(segments)\n  }\n\n  static isValid(nsid: string): boolean {\n    try {\n      NSID.parse(nsid)\n      return true\n    } catch (e) {\n      return false\n    }\n  }\n\n  constructor(nsid: string) {\n    ensureValidNsid(nsid)\n    this.segments = nsid.split('.')\n  }\n\n  get authority() {\n    return this.segments\n      .slice(0, this.segments.length - 1)\n      .reverse()\n      .join('.')\n  }\n\n  get name() {\n    return this.segments.at(this.segments.length - 1)\n  }\n\n  toString() {\n    return this.segments.join('.')\n  }\n}\n\n// Human readable constraints on NSID:\n// - a valid domain in reversed notation\n// - followed by an additional period-separated name, which is camel-case letters\nexport const ensureValidNsid = (nsid: string): void => {\n  const toCheck = nsid\n\n  // check that all chars are boring ASCII\n  if (!/^[a-zA-Z0-9.-]*$/.test(toCheck)) {\n    throw new InvalidNsidError(\n      'Disallowed characters in NSID (ASCII letters, digits, dashes, periods only)',\n    )\n  }\n\n  if (toCheck.length > 253 + 1 + 63) {\n    throw new InvalidNsidError('NSID is too long (317 chars max)')\n  }\n  const labels = toCheck.split('.')\n  if (labels.length < 3) {\n    throw new InvalidNsidError('NSID needs at least three parts')\n  }\n  for (let i = 0; i < labels.length; i++) {\n    const l = labels[i]\n    if (l.length < 1) {\n      throw new InvalidNsidError('NSID parts can not be empty')\n    }\n    if (l.length > 63) {\n      throw new InvalidNsidError('NSID part too long (max 63 chars)')\n    }\n    if (l.endsWith('-') || l.startsWith('-')) {\n      throw new InvalidNsidError('NSID parts can not start or end with hyphen')\n    }\n    if (/^[0-9]/.test(l) && i === 0) {\n      throw new InvalidNsidError('NSID first part may not start with a digit')\n    }\n    if (!/^[a-zA-Z]+$/.test(l) && i + 1 === labels.length) {\n      throw new InvalidNsidError('NSID name part must be only letters')\n    }\n  }\n}\n\nexport const ensureValidNsidRegex = (nsid: string): void => {\n  // simple regex to enforce most constraints via just regex and length.\n  // hand wrote this regex based on above constraints\n  if (\n    !/^[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(\\.[a-zA-Z]([a-zA-Z]{0,61}[a-zA-Z])?)$/.test(\n      nsid,\n    )\n  ) {\n    throw new InvalidNsidError(\"NSID didn't validate via regex\")\n  }\n  if (nsid.length > 253 + 1 + 63) {\n    throw new InvalidNsidError('NSID is too long (317 chars max)')\n  }\n}\n\nexport class InvalidNsidError extends Error {}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 17326, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17331, "column": 0}, "map": {"version":3,"file":"aturi_validation.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/aturi_validation.ts"],"sourcesContent":["import { ensureValidHandle, ensureValidHandleRegex } from './handle'\nimport { ensureValidDid, ensureValidDidRegex } from './did'\nimport { ensureValidNsid, ensureValidNsidRegex } from './nsid'\n\n// Human-readable constraints on ATURI:\n//   - following regular URLs, a 8KByte hard total length limit\n//   - follows ATURI docs on website\n//      - all ASCII characters, no whitespace. non-ASCII could be URL-encoded\n//      - starts \"at://\"\n//      - \"authority\" is a valid DID or a valid handle\n//      - optionally, follow \"authority\" with \"/\" and valid NSID as start of path\n//      - optionally, if NSID given, follow that with \"/\" and rkey\n//      - rkey path component can include URL-encoded (\"percent encoded\"), or:\n//          ALPHA / DIGIT / \"-\" / \".\" / \"_\" / \"~\" / \":\" / \"@\" / \"!\" / \"$\" / \"&\" / \"'\" / \"(\" / \")\" / \"*\" / \"+\" / \",\" / \";\" / \"=\"\n//          [a-zA-Z0-9._~:@!$&'\\(\\)*+,;=-]\n//      - rkey must have at least one char\n//      - regardless of path component, a fragment can follow  as \"#\" and then a JSON pointer (RFC-6901)\nexport const ensureValidAtUri = (uri: string) => {\n  // JSON pointer is pretty different from rest of URI, so split that out first\n  const uriParts = uri.split('#')\n  if (uriParts.length > 2) {\n    throw new Error('ATURI can have at most one \"#\", separating fragment out')\n  }\n  const fragmentPart = uriParts[1] || null\n  uri = uriParts[0]\n\n  // check that all chars are boring ASCII\n  if (!/^[a-zA-Z0-9._~:@!$&')(*+,;=%/-]*$/.test(uri)) {\n    throw new Error('Disallowed characters in ATURI (ASCII)')\n  }\n\n  const parts = uri.split('/')\n  if (parts.length >= 3 && (parts[0] !== 'at:' || parts[1].length !== 0)) {\n    throw new Error('ATURI must start with \"at://\"')\n  }\n  if (parts.length < 3) {\n    throw new Error('ATURI requires at least method and authority sections')\n  }\n\n  try {\n    if (parts[2].startsWith('did:')) {\n      ensureValidDid(parts[2])\n    } else {\n      ensureValidHandle(parts[2])\n    }\n  } catch {\n    throw new Error('ATURI authority must be a valid handle or DID')\n  }\n\n  if (parts.length >= 4) {\n    if (parts[3].length === 0) {\n      throw new Error(\n        'ATURI can not have a slash after authority without a path segment',\n      )\n    }\n    try {\n      ensureValidNsid(parts[3])\n    } catch {\n      throw new Error(\n        'ATURI requires first path segment (if supplied) to be valid NSID',\n      )\n    }\n  }\n\n  if (parts.length >= 5) {\n    if (parts[4].length === 0) {\n      throw new Error(\n        'ATURI can not have a slash after collection, unless record key is provided',\n      )\n    }\n    // would validate rkey here, but there are basically no constraints!\n  }\n\n  if (parts.length >= 6) {\n    throw new Error(\n      'ATURI path can have at most two parts, and no trailing slash',\n    )\n  }\n\n  if (uriParts.length >= 2 && fragmentPart == null) {\n    throw new Error('ATURI fragment must be non-empty and start with slash')\n  }\n\n  if (fragmentPart != null) {\n    if (fragmentPart.length === 0 || fragmentPart[0] !== '/') {\n      throw new Error('ATURI fragment must be non-empty and start with slash')\n    }\n    // NOTE: enforcing *some* checks here for sanity. Eg, at least no whitespace\n    if (!/^\\/[a-zA-Z0-9._~:@!$&')(*+,;=%[\\]/-]*$/.test(fragmentPart)) {\n      throw new Error('Disallowed characters in ATURI fragment (ASCII)')\n    }\n  }\n\n  if (uri.length > 8 * 1024) {\n    throw new Error('ATURI is far too long')\n  }\n}\n\nexport const ensureValidAtUriRegex = (uri: string): void => {\n  // simple regex to enforce most constraints via just regex and length.\n  // hand wrote this regex based on above constraints. whew!\n  const aturiRegex =\n    /^at:\\/\\/(?<authority>[a-zA-Z0-9._:%-]+)(\\/(?<collection>[a-zA-Z0-9-.]+)(\\/(?<rkey>[a-zA-Z0-9._~:@!$&%')(*+,;=-]+))?)?(#(?<fragment>\\/[a-zA-Z0-9._~:@!$&%')(*+,;=\\-[\\]/\\\\]*))?$/\n  const rm = uri.match(aturiRegex)\n  if (!rm || !rm.groups) {\n    throw new Error(\"ATURI didn't validate via regex\")\n  }\n  const groups = rm.groups\n\n  try {\n    ensureValidHandleRegex(groups.authority)\n  } catch {\n    try {\n      ensureValidDidRegex(groups.authority)\n    } catch {\n      throw new Error('ATURI authority must be a valid handle or DID')\n    }\n  }\n\n  if (groups.collection) {\n    try {\n      ensureValidNsidRegex(groups.collection)\n    } catch {\n      throw new Error('ATURI collection path segment must be a valid NSID')\n    }\n  }\n\n  if (uri.length > 8 * 1024) {\n    throw new Error('ATURI is far too long')\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 17446, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17451, "column": 0}, "map": {"version":3,"file":"aturi.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/aturi.ts"],"sourcesContent":["export * from './aturi_validation'\n\nexport const ATP_URI_REGEX =\n  // proto-    --did--------------   --name----------------   --path----   --query--   --hash--\n  /^(at:\\/\\/)?((?:did:[a-z0-9:%-]+)|(?:[a-z0-9][a-z0-9.:-]*))(\\/[^?#\\s]*)?(\\?[^#\\s]+)?(#[^\\s]+)?$/i\n//                       --path-----   --query--  --hash--\nconst RELATIVE_REGEX = /^(\\/[^?#\\s]*)?(\\?[^#\\s]+)?(#[^\\s]+)?$/i\n\nexport class AtUri {\n  hash: string\n  host: string\n  pathname: string\n  searchParams: URLSearchParams\n\n  constructor(uri: string, base?: string) {\n    let parsed\n    if (base) {\n      parsed = parse(base)\n      if (!parsed) {\n        throw new Error(`Invalid at uri: ${base}`)\n      }\n      const relativep = parseRelative(uri)\n      if (!relativep) {\n        throw new Error(`Invalid path: ${uri}`)\n      }\n      Object.assign(parsed, relativep)\n    } else {\n      parsed = parse(uri)\n      if (!parsed) {\n        throw new Error(`Invalid at uri: ${uri}`)\n      }\n    }\n\n    this.hash = parsed.hash\n    this.host = parsed.host\n    this.pathname = parsed.pathname\n    this.searchParams = parsed.searchParams\n  }\n\n  static make(handleOrDid: string, collection?: string, rkey?: string) {\n    let str = handleOrDid\n    if (collection) str += '/' + collection\n    if (rkey) str += '/' + rkey\n    return new AtUri(str)\n  }\n\n  get protocol() {\n    return 'at:'\n  }\n\n  get origin() {\n    return `at://${this.host}`\n  }\n\n  get hostname() {\n    return this.host\n  }\n\n  set hostname(v: string) {\n    this.host = v\n  }\n\n  get search() {\n    return this.searchParams.toString()\n  }\n\n  set search(v: string) {\n    this.searchParams = new URLSearchParams(v)\n  }\n\n  get collection() {\n    return this.pathname.split('/').filter(Boolean)[0] || ''\n  }\n\n  set collection(v: string) {\n    const parts = this.pathname.split('/').filter(Boolean)\n    parts[0] = v\n    this.pathname = parts.join('/')\n  }\n\n  get rkey() {\n    return this.pathname.split('/').filter(Boolean)[1] || ''\n  }\n\n  set rkey(v: string) {\n    const parts = this.pathname.split('/').filter(Boolean)\n    if (!parts[0]) parts[0] = 'undefined'\n    parts[1] = v\n    this.pathname = parts.join('/')\n  }\n\n  get href() {\n    return this.toString()\n  }\n\n  toString() {\n    let path = this.pathname || '/'\n    if (!path.startsWith('/')) {\n      path = `/${path}`\n    }\n    let qs = this.searchParams.toString()\n    if (qs && !qs.startsWith('?')) {\n      qs = `?${qs}`\n    }\n    let hash = this.hash\n    if (hash && !hash.startsWith('#')) {\n      hash = `#${hash}`\n    }\n    return `at://${this.host}${path}${qs}${hash}`\n  }\n}\n\nfunction parse(str: string) {\n  const match = ATP_URI_REGEX.exec(str)\n  if (match) {\n    return {\n      hash: match[5] || '',\n      host: match[2] || '',\n      pathname: match[3] || '',\n      searchParams: new URLSearchParams(match[4] || ''),\n    }\n  }\n  return undefined\n}\n\nfunction parseRelative(str: string) {\n  const match = RELATIVE_REGEX.exec(str)\n  if (match) {\n    return {\n      hash: match[3] || '',\n      pathname: match[1] || '',\n      searchParams: new URLSearchParams(match[2] || ''),\n    }\n  }\n  return undefined\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 17612, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17617, "column": 0}, "map": {"version":3,"file":"tid.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/tid.ts"],"sourcesContent":["export const ensureValidTid = (tid: string): void => {\n  if (tid.length !== 13) {\n    throw new InvalidTidError('TID must be 13 characters')\n  }\n  // simple regex to enforce most constraints via just regex and length.\n  if (!/^[234567abcdefghij][234567abcdefghijklmnopqrstuvwxyz]{12}$/.test(tid)) {\n    throw new InvalidTidError('TID syntax not valid (regex)')\n  }\n}\n\nexport const isValidTid = (tid: string): boolean => {\n  try {\n    ensureValidTid(tid)\n  } catch (err) {\n    if (err instanceof InvalidTidError) {\n      return false\n    }\n    throw err\n  }\n\n  return true\n}\n\nexport class InvalidTidError extends Error {}\n"],"names":[],"mappings":";;;;;AAAO,MAAM,cAAc,GAAG,CAAC,GAAW,EAAQ,EAAE;IAClD,IAAI,GAAG,CAAC,MAAM,KAAK,EAAE,EAAE,CAAC;QACtB,MAAM,IAAI,eAAe,CAAC,2BAA2B,CAAC,CAAA;IACxD,CAAC;IACD,sEAAsE;IACtE,IAAI,CAAC,4DAA4D,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;QAC5E,MAAM,IAAI,eAAe,CAAC,8BAA8B,CAAC,CAAA;IAC3D,CAAC;AACH,CAAC,CAAA;AARY,QAAA,cAAc,GAAA,eAQ1B;AAEM,MAAM,UAAU,GAAG,CAAC,GAAW,EAAW,EAAE;IACjD,IAAI,CAAC;QACH,CAAA,GAAA,QAAA,cAAc,EAAC,GAAG,CAAC,CAAA;IACrB,CAAC,CAAC,OAAO,GAAG,EAAE,CAAC;QACb,IAAI,GAAG,YAAY,eAAe,EAAE,CAAC;YACnC,OAAO,KAAK,CAAA;QACd,CAAC;QACD,MAAM,GAAG,CAAA;IACX,CAAC;IAED,OAAO,IAAI,CAAA;AACb,CAAC,CAAA;AAXY,QAAA,UAAU,GAAA,WAWtB;AAED,MAAa,eAAgB,SAAQ,KAAK;CAAG;AAA7C,QAAA,eAAA,GAAA,gBAA6C","ignoreList":[0]}},
    {"offset": {"line": 17647, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17652, "column": 0}, "map": {"version":3,"file":"recordkey.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/recordkey.ts"],"sourcesContent":["export const ensureValidRecordKey = (rkey: string): void => {\n  if (rkey.length > 512 || rkey.length < 1) {\n    throw new InvalidRecordKeyError('record key must be 1 to 512 characters')\n  }\n  // simple regex to enforce most constraints via just regex and length.\n  if (!/^[a-zA-Z0-9_~.:-]{1,512}$/.test(rkey)) {\n    throw new InvalidRecordKeyError('record key syntax not valid (regex)')\n  }\n  if (rkey === '.' || rkey === '..')\n    throw new InvalidRecordKeyError('record key can not be \".\" or \"..\"')\n}\n\nexport const isValidRecordKey = (rkey: string): boolean => {\n  try {\n    ensureValidRecordKey(rkey)\n  } catch (err) {\n    if (err instanceof InvalidRecordKeyError) {\n      return false\n    }\n    throw err\n  }\n\n  return true\n}\n\nexport class InvalidRecordKeyError extends Error {}\n"],"names":[],"mappings":";;;;;AAAO,MAAM,oBAAoB,GAAG,CAAC,IAAY,EAAQ,EAAE;IACzD,IAAI,IAAI,CAAC,MAAM,GAAG,GAAG,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QACzC,MAAM,IAAI,qBAAqB,CAAC,wCAAwC,CAAC,CAAA;IAC3E,CAAC;IACD,sEAAsE;IACtE,IAAI,CAAC,2BAA2B,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;QAC5C,MAAM,IAAI,qBAAqB,CAAC,qCAAqC,CAAC,CAAA;IACxE,CAAC;IACD,IAAI,IAAI,KAAK,GAAG,IAAI,IAAI,KAAK,IAAI,EAC/B,MAAM,IAAI,qBAAqB,CAAC,mCAAmC,CAAC,CAAA;AACxE,CAAC,CAAA;AAVY,QAAA,oBAAoB,GAAA,qBAUhC;AAEM,MAAM,gBAAgB,GAAG,CAAC,IAAY,EAAW,EAAE;IACxD,IAAI,CAAC;QACH,CAAA,GAAA,QAAA,oBAAoB,EAAC,IAAI,CAAC,CAAA;IAC5B,CAAC,CAAC,OAAO,GAAG,EAAE,CAAC;QACb,IAAI,GAAG,YAAY,qBAAqB,EAAE,CAAC;YACzC,OAAO,KAAK,CAAA;QACd,CAAC;QACD,MAAM,GAAG,CAAA;IACX,CAAC;IAED,OAAO,IAAI,CAAA;AACb,CAAC,CAAA;AAXY,QAAA,gBAAgB,GAAA,iBAW5B;AAED,MAAa,qBAAsB,SAAQ,KAAK;CAAG;AAAnD,QAAA,qBAAA,GAAA,sBAAmD","ignoreList":[0]}},
    {"offset": {"line": 17683, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17688, "column": 0}, "map": {"version":3,"file":"datetime.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/datetime.ts"],"sourcesContent":["/* Validates datetime string against atproto Lexicon 'datetime' format.\n * Syntax is described at: https://atproto.com/specs/lexicon#datetime\n */\nexport const ensureValidDatetime = (dtStr: string): void => {\n  const date = new Date(dtStr)\n  // must parse as ISO 8601; this also verifies semantics like month is not 13 or 00\n  if (isNaN(date.getTime())) {\n    throw new InvalidDatetimeError('datetime did not parse as ISO 8601')\n  }\n  if (date.toISOString().startsWith('-')) {\n    throw new InvalidDatetimeError('datetime normalized to a negative time')\n  }\n  // regex and other checks for RFC-3339\n  if (\n    !/^[0-9]{4}-[01][0-9]-[0-3][0-9]T[0-2][0-9]:[0-6][0-9]:[0-6][0-9](.[0-9]{1,20})?(Z|([+-][0-2][0-9]:[0-5][0-9]))$/.test(\n      dtStr,\n    )\n  ) {\n    throw new InvalidDatetimeError(\"datetime didn't validate via regex\")\n  }\n  if (dtStr.length > 64) {\n    throw new InvalidDatetimeError('datetime is too long (64 chars max)')\n  }\n  if (dtStr.endsWith('-00:00')) {\n    throw new InvalidDatetimeError(\n      'datetime can not use \"-00:00\" for UTC timezone',\n    )\n  }\n  if (dtStr.startsWith('000')) {\n    throw new InvalidDatetimeError('datetime so close to year zero not allowed')\n  }\n}\n\n/* Same logic as ensureValidDatetime(), but returns a boolean instead of throwing an exception.\n */\nexport const isValidDatetime = (dtStr: string): boolean => {\n  try {\n    ensureValidDatetime(dtStr)\n  } catch (err) {\n    if (err instanceof InvalidDatetimeError) {\n      return false\n    }\n    throw err\n  }\n\n  return true\n}\n\n/* Takes a flexible datetime string and normalizes representation.\n *\n * This function will work with any valid atproto datetime (eg, anything which isValidDatetime() is true for). It *additionally* is more flexible about accepting datetimes that don't comply to RFC 3339, or are missing timezone information, and normalizing them to a valid datetime.\n *\n * One use-case is a consistent, sortable string. Another is to work with older invalid createdAt datetimes.\n *\n * Successful output will be a valid atproto datetime with millisecond precision (3 sub-second digits) and UTC timezone with trailing 'Z' syntax. Throws `InvalidDatetimeError` if the input string could not be parsed as a datetime, even with permissive parsing.\n *\n * Expected output format: YYYY-MM-DDTHH:mm:ss.sssZ\n */\nexport const normalizeDatetime = (dtStr: string): string => {\n  if (isValidDatetime(dtStr)) {\n    const outStr = new Date(dtStr).toISOString()\n    if (isValidDatetime(outStr)) {\n      return outStr\n    }\n  }\n\n  // check if this permissive datetime is missing a timezone\n  if (!/.*(([+-]\\d\\d:?\\d\\d)|[a-zA-Z])$/.test(dtStr)) {\n    const date = new Date(dtStr + 'Z')\n    if (!isNaN(date.getTime())) {\n      const tzStr = date.toISOString()\n      if (isValidDatetime(tzStr)) {\n        return tzStr\n      }\n    }\n  }\n\n  // finally try parsing as simple datetime\n  const date = new Date(dtStr)\n  if (isNaN(date.getTime())) {\n    throw new InvalidDatetimeError(\n      'datetime did not parse as any timestamp format',\n    )\n  }\n  const isoStr = date.toISOString()\n  if (isValidDatetime(isoStr)) {\n    return isoStr\n  } else {\n    throw new InvalidDatetimeError(\n      'datetime normalized to invalid timestamp string',\n    )\n  }\n}\n\n/* Variant of normalizeDatetime() which always returns a valid datetime strings.\n *\n * If a InvalidDatetimeError is encountered, returns the UNIX epoch time as a UTC datetime (1970-01-01T00:00:00.000Z).\n */\nexport const normalizeDatetimeAlways = (dtStr: string): string => {\n  try {\n    return normalizeDatetime(dtStr)\n  } catch (err) {\n    if (err instanceof InvalidDatetimeError) {\n      return new Date(0).toISOString()\n    }\n    throw err\n  }\n}\n\n/* Indicates a datetime string did not pass full atproto Lexicon datetime string format checks.\n */\nexport class InvalidDatetimeError extends Error {}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 17789, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17794, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/syntax/src/index.ts"],"sourcesContent":["export * from './handle'\nexport * from './did'\nexport * from './nsid'\nexport * from './aturi'\nexport * from './tid'\nexport * from './recordkey'\nexport * from './datetime'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,oHAAA,SAAwB;AACxB,iHAAA,SAAqB;AACrB,kHAAA,SAAsB;AACtB,mHAAA,SAAuB;AACvB,iHAAA,SAAqB;AACrB,uHAAA,SAA2B;AAC3B,sHAAA,SAA0B","ignoreList":[0]}},
    {"offset": {"line": 17824, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17829, "column": 0}, "map": {"version":3,"file":"identity-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/identity-resolver/src/identity-resolver.ts"],"sourcesContent":["import {\n  Did,\n  DidDocument,\n  DidResolver,\n  DidService,\n  ResolveDidOptions,\n} from '@atproto-labs/did-resolver'\nimport {\n  AtprotoIdentityDidMethods,\n  HandleResolver,\n  isResolvedHandle,\n  ResolvedHandle,\n  ResolveHandleOptions,\n} from '@atproto-labs/handle-resolver'\nimport { normalizeAndEnsureValidHandle } from '@atproto/syntax'\n\nexport type ResolvedIdentity = {\n  did: NonNullable<ResolvedHandle>\n  pds: URL\n}\n\nexport type ResolveIdentityOptions = ResolveDidOptions & ResolveHandleOptions\n\nexport class IdentityResolver {\n  constructor(\n    readonly didResolver: DidResolver<AtprotoIdentityDidMethods>,\n    readonly handleResolver: HandleResolver,\n  ) {}\n\n  public async resolve(\n    input: string,\n    options?: ResolveIdentityOptions,\n  ): Promise<ResolvedIdentity> {\n    const document = isResolvedHandle(input)\n      ? await this.getDocumentFromDid(input, options)\n      : await this.getDocumentFromHandle(input, options)\n\n    const service = document.service?.find(\n      isAtprotoPersonalDataServerService<AtprotoIdentityDidMethods>,\n      document,\n    )\n\n    if (!service) {\n      throw new TypeError(\n        `No valid \"AtprotoPersonalDataServer\" service found in \"${document.id}\" DID document`,\n      )\n    }\n\n    return {\n      did: document.id,\n      pds: new URL(service.serviceEndpoint),\n    }\n  }\n\n  public async getDocumentFromDid(\n    did: NonNullable<ResolvedHandle>,\n    options?: ResolveDidOptions,\n  ): Promise<DidDocument<AtprotoIdentityDidMethods>> {\n    return this.didResolver.resolve(did, options)\n  }\n\n  public async getDocumentFromHandle(\n    input: string,\n    options?: ResolveHandleOptions,\n  ): Promise<DidDocument<AtprotoIdentityDidMethods>> {\n    const handle = normalizeAndEnsureValidHandle(input)\n\n    const did = await this.handleResolver.resolve(handle, options)\n\n    if (!did) {\n      throw new TypeError(`Handle \"${handle}\" does not resolve to a DID`)\n    }\n\n    options?.signal?.throwIfAborted()\n\n    // Note: Not using \"return this.resolveDid(did, options)\" to make the extra\n    // check for the handle in the DID document:\n\n    const document = await this.didResolver.resolve(did, options)\n\n    // Ensure that the handle is included in the document\n    if (!document.alsoKnownAs?.includes(`at://${handle}`)) {\n      throw new TypeError(\n        `Did document for \"${did}\" does not include the handle \"${handle}\"`,\n      )\n    }\n\n    return document\n  }\n}\n\nfunction isAtprotoPersonalDataServerService<M extends string>(\n  this: DidDocument<M>,\n  s: DidService,\n): s is {\n  id: '#atproto_pds' | `${Did<M>}#atproto_pds`\n  type: 'AtprotoPersonalDataServer'\n  serviceEndpoint: string\n} {\n  return (\n    typeof s.serviceEndpoint === 'string' &&\n    s.type === 'AtprotoPersonalDataServer' &&\n    (s.id.startsWith('#')\n      ? s.id === '#atproto_pds'\n      : s.id === `${this.id}#atproto_pds`)\n  )\n}\n"],"names":[],"mappings":";;;;;AAOA,MAAA,6DAMsC;AACtC,MAAA,sCAA+D;AAS/D,MAAa,gBAAgB;IAC3B,YACW,WAAmD,EACnD,cAA8B,CAAA;QADvC,OAAA,cAAA,CAAA,IAAA,EAAA,eAAA;;;;mBAAS,WAAW;WAAwC;QAC5D,OAAA,cAAA,CAAA,IAAA,EAAA,kBAAA;;;;mBAAS,cAAc;WAAgB;IACtC,CAAC;IAEG,KAAK,CAAC,OAAO,CAClB,KAAa,EACb,OAAgC,EAAA;QAEhC,MAAM,QAAQ,GAAG,CAAA,GAAA,kBAAA,gBAAgB,EAAC,KAAK,CAAC,GACpC,MAAM,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAE,OAAO,CAAC,GAC7C,MAAM,IAAI,CAAC,qBAAqB,CAAC,KAAK,EAAE,OAAO,CAAC,CAAA;QAEpD,MAAM,OAAO,GAAG,QAAQ,CAAC,OAAO,EAAE,IAAI,CACpC,kCAA6D,CAAA,CAC7D,QAAQ,CACT,CAAA;QAED,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,MAAM,IAAI,SAAS,CACjB,CAAA,uDAAA,EAA0D,QAAQ,CAAC,EAAE,CAAA,cAAA,CAAgB,CACtF,CAAA;QACH,CAAC;QAED,OAAO;YACL,GAAG,EAAE,QAAQ,CAAC,EAAE;YAChB,GAAG,EAAE,IAAI,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC;SACtC,CAAA;IACH,CAAC;IAEM,KAAK,CAAC,kBAAkB,CAC7B,GAAgC,EAChC,OAA2B,EAAA;QAE3B,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;IAC/C,CAAC;IAEM,KAAK,CAAC,qBAAqB,CAChC,KAAa,EACb,OAA8B,EAAA;QAE9B,MAAM,MAAM,GAAG,CAAA,GAAA,SAAA,6BAA6B,EAAC,KAAK,CAAC,CAAA;QAEnD,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,CAAA;QAE9D,IAAI,CAAC,GAAG,EAAE,CAAC;YACT,MAAM,IAAI,SAAS,CAAC,CAAA,QAAA,EAAW,MAAM,CAAA,2BAAA,CAA6B,CAAC,CAAA;QACrE,CAAC;QAED,OAAO,EAAE,MAAM,EAAE,cAAc,EAAE,CAAA;QAEjC,2EAA2E;QAC3E,4CAA4C;QAE5C,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;QAE7D,qDAAqD;QACrD,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAA,KAAA,EAAQ,MAAM,EAAE,CAAC,EAAE,CAAC;YACtD,MAAM,IAAI,SAAS,CACjB,CAAA,kBAAA,EAAqB,GAAG,CAAA,+BAAA,EAAkC,MAAM,CAAA,CAAA,CAAG,CACpE,CAAA;QACH,CAAC;QAED,OAAO,QAAQ,CAAA;IACjB,CAAC;CACF;AAlED,QAAA,gBAAA,GAAA,iBAkEC;AAED,SAAS,kCAAkC,CAEzC,CAAa;IAMb,OAAO,AACL,OAAO,CAAC,CAAC,eAAe,KAAK,QAAQ,IACrC,CAAC,CAAC,IAAI,KAAK,2BAA2B,IACtC,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,GACjB,CAAC,CAAC,EAAE,KAAK,cAAc,GACvB,CAAC,CAAC,EAAE,KAAK,GAAG,IAAI,CAAC,EAAE,CAAA,YAAA,CAAc,CAAC,CACvC,CAAA;AACH,CAAC","ignoreList":[0]}},
    {"offset": {"line": 17886, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17891, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto-labs/identity-resolver/src/index.ts"],"sourcesContent":["export * from './identity-resolver.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,+IAAA,SAAsC","ignoreList":[0]}},
    {"offset": {"line": 17915, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17920, "column": 0}, "map": {"version":3,"file":"constants.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/constants.ts"],"sourcesContent":["/**\n * Per ATProto spec (OpenID uses RS256)\n */\nexport const FALLBACK_ALG = 'ES256'\n"],"names":[],"mappings":";;;;;AAAA;;GAEG,CACU,QAAA,YAAY,GAAG,OAAO,CAAA","ignoreList":[0]}},
    {"offset": {"line": 17928, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17933, "column": 0}, "map": {"version":3,"file":"token-revoked-error.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/errors/token-revoked-error.ts"],"sourcesContent":["export class TokenRevokedError extends Error {\n  constructor(\n    public readonly sub: string,\n    message = `The session for \"${sub}\" was successfully revoked`,\n    options?: { cause?: unknown },\n  ) {\n    super(message, options)\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAa,iBAAkB,SAAQ,KAAK;IAC1C,YACkB,GAAW,EAC3B,OAAO,GAAG,CAAA,iBAAA,EAAoB,GAAG,CAAA,0BAAA,CAA4B,EAC7D,OAA6B,CAAA;QAE7B,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QAJvB,OAAA,cAAA,CAAA,IAAA,EAAA,OAAA;;;;mBAAgB,GAAG;WAAQ;IAK7B,CAAC;CACF;AARD,QAAA,iBAAA,GAAA,kBAQC","ignoreList":[0]}},
    {"offset": {"line": 17950, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 17955, "column": 0}, "map": {"version":3,"file":"oauth-protected-resource-metadata-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-protected-resource-metadata-resolver.ts"],"sourcesContent":["import {\n  Fetch,\n  FetchResponseError,\n  bindFetch,\n  cancelBody,\n} from '@atproto-labs/fetch'\nimport {\n  CachedGetter,\n  GetCachedOptions,\n  SimpleStore,\n} from '@atproto-labs/simple-store'\nimport {\n  OAuthProtectedResourceMetadata,\n  oauthProtectedResourceMetadataSchema,\n} from '@atproto/oauth-types'\nimport { contentMime } from './util.js'\n\nexport type { GetCachedOptions, OAuthProtectedResourceMetadata }\n\nexport type ProtectedResourceMetadataCache = SimpleStore<\n  string,\n  OAuthProtectedResourceMetadata\n>\n\nexport type OAuthProtectedResourceMetadataResolverConfig = {\n  allowHttpResource?: boolean\n}\n\n/**\n * @see {@link https://datatracker.ietf.org/doc/html/draft-ietf-oauth-resource-metadata-05}\n */\nexport class OAuthProtectedResourceMetadataResolver extends CachedGetter<\n  string,\n  OAuthProtectedResourceMetadata\n> {\n  private readonly fetch: Fetch<unknown>\n  private readonly allowHttpResource: boolean\n\n  constructor(\n    cache: ProtectedResourceMetadataCache,\n    fetch: Fetch = globalThis.fetch,\n    config?: OAuthProtectedResourceMetadataResolverConfig,\n  ) {\n    super(async (origin, options) => this.fetchMetadata(origin, options), cache)\n\n    this.fetch = bindFetch(fetch)\n    this.allowHttpResource = config?.allowHttpResource === true\n  }\n\n  async get(\n    resource: string | URL,\n    options?: GetCachedOptions,\n  ): Promise<OAuthProtectedResourceMetadata> {\n    const { protocol, origin } = new URL(resource)\n\n    if (protocol !== 'https:' && protocol !== 'http:') {\n      throw new TypeError(\n        `Invalid protected resource metadata URL protocol: ${protocol}`,\n      )\n    }\n\n    if (protocol === 'http:' && !this.allowHttpResource) {\n      throw new TypeError(\n        `Unsecure resource metadata URL (${protocol}) only allowed in development and test environments`,\n      )\n    }\n\n    return super.get(origin, options)\n  }\n\n  private async fetchMetadata(\n    origin: string,\n    options?: GetCachedOptions,\n  ): Promise<OAuthProtectedResourceMetadata> {\n    const url = new URL(`/.well-known/oauth-protected-resource`, origin)\n    const request = new Request(url, {\n      signal: options?.signal,\n      headers: { accept: 'application/json' },\n      cache: options?.noCache ? 'no-cache' : undefined,\n      redirect: 'manual', // response must be 200 OK\n    })\n\n    const response = await this.fetch(request)\n\n    // https://datatracker.ietf.org/doc/html/draft-ietf-oauth-resource-metadata-05#section-3.2\n    if (response.status !== 200) {\n      await cancelBody(response, 'log')\n      throw await FetchResponseError.from(\n        response,\n        `Unexpected status code ${response.status} for \"${url}\"`,\n        undefined,\n        { cause: request },\n      )\n    }\n\n    if (contentMime(response.headers) !== 'application/json') {\n      await cancelBody(response, 'log')\n      throw await FetchResponseError.from(\n        response,\n        `Unexpected content type for \"${url}\"`,\n        undefined,\n        { cause: request },\n      )\n    }\n\n    const metadata = oauthProtectedResourceMetadataSchema.parse(\n      await response.json(),\n    )\n\n    // https://datatracker.ietf.org/doc/html/draft-ietf-oauth-resource-metadata-05#section-3.3\n    if (metadata.resource !== origin) {\n      throw new TypeError(`Invalid issuer ${metadata.resource}`)\n    }\n\n    return metadata\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 18027, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18032, "column": 0}, "map": {"version":3,"file":"oauth-resolver-error.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-resolver-error.ts"],"sourcesContent":["import { ZodError } from 'zod'\n\nexport class OAuthResolverError extends Error {\n  constructor(message: string, options?: { cause?: unknown }) {\n    super(message, options)\n  }\n\n  static from(cause: unknown, message?: string): OAuthResolverError {\n    if (cause instanceof OAuthResolverError) return cause\n    const validationReason =\n      cause instanceof ZodError\n        ? `${cause.errors[0].path} ${cause.errors[0].message}`\n        : null\n    const fullMessage =\n      (message ?? `Unable to resolve identity`) +\n      (validationReason ? ` (${validationReason})` : '')\n    return new OAuthResolverError(fullMessage, {\n      cause,\n    })\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,uBAA8B;AAE9B,MAAa,kBAAmB,SAAQ,KAAK;IAC3C,YAAY,OAAe,EAAE,OAA6B,CAAA;QACxD,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;IACzB,CAAC;IAED,MAAM,CAAC,IAAI,CAAC,KAAc,EAAE,OAAgB,EAAA;QAC1C,IAAI,KAAK,YAAY,kBAAkB,EAAE,OAAO,KAAK,CAAA;QACrD,MAAM,gBAAgB,GACpB,KAAK,YAAY,MAAA,QAAQ,GACrB,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAA,CAAA,EAAI,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,GACpD,IAAI,CAAA;QACV,MAAM,WAAW,GACf,CAAC,OAAO,IAAI,CAAA,0BAAA,CAA4B,CAAC,GACzC,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAA,EAAA,EAAK,gBAAgB,CAAA,CAAA,CAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAA;QACpD,OAAO,IAAI,kBAAkB,CAAC,WAAW,EAAE;YACzC,KAAK;SACN,CAAC,CAAA;IACJ,CAAC;CACF;AAlBD,QAAA,kBAAA,GAAA,mBAkBC","ignoreList":[0]}},
    {"offset": {"line": 18052, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18057, "column": 0}, "map": {"version":3,"file":"oauth-resolver.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-resolver.ts"],"sourcesContent":["import {\n  IdentityResolver,\n  ResolvedIdentity,\n  ResolveIdentityOptions,\n} from '@atproto-labs/identity-resolver'\nimport {\n  OAuthAuthorizationServerMetadata,\n  oauthIssuerIdentifierSchema,\n} from '@atproto/oauth-types'\n\nimport {\n  GetCachedOptions,\n  OAuthAuthorizationServerMetadataResolver,\n} from './oauth-authorization-server-metadata-resolver.js'\nimport { OAuthProtectedResourceMetadataResolver } from './oauth-protected-resource-metadata-resolver.js'\nimport { OAuthResolverError } from './oauth-resolver-error.js'\n\nexport type { GetCachedOptions }\nexport type ResolveOAuthOptions = GetCachedOptions & ResolveIdentityOptions\n\nexport class OAuthResolver {\n  constructor(\n    readonly identityResolver: IdentityResolver,\n    readonly protectedResourceMetadataResolver: OAuthProtectedResourceMetadataResolver,\n    readonly authorizationServerMetadataResolver: OAuthAuthorizationServerMetadataResolver,\n  ) {}\n\n  /**\n   * @param input - A handle, DID, PDS URL or Entryway URL\n   */\n  public async resolve(\n    input: string,\n    options?: ResolveOAuthOptions,\n  ): Promise<{\n    identity?: ResolvedIdentity\n    metadata: OAuthAuthorizationServerMetadata\n  }> {\n    // Allow using an entryway, or PDS url, directly as login input (e.g.\n    // when the user forgot their handle, or when the handle does not\n    // resolve to a DID)\n    return /^https?:\\/\\//.test(input)\n      ? this.resolveFromService(input, options)\n      : this.resolveFromIdentity(input, options)\n  }\n\n  /**\n   * @note this method can be used to verify if a particular uri supports OAuth\n   * based sign-in (for compatibility with legacy implementation).\n   */\n  public async resolveFromService(\n    input: string,\n    options?: ResolveOAuthOptions,\n  ): Promise<{\n    metadata: OAuthAuthorizationServerMetadata\n  }> {\n    try {\n      // Assume first that input is a PDS URL (as required by ATPROTO)\n      const metadata = await this.getResourceServerMetadata(input, options)\n      return { metadata }\n    } catch (err) {\n      if (!options?.signal?.aborted && err instanceof OAuthResolverError) {\n        try {\n          // Fallback to trying to fetch as an issuer (Entryway)\n          const result = oauthIssuerIdentifierSchema.safeParse(input)\n          if (result.success) {\n            const metadata = await this.getAuthorizationServerMetadata(\n              result.data,\n              options,\n            )\n            return { metadata }\n          }\n        } catch {\n          // Fallback failed, throw original error\n        }\n      }\n\n      throw err\n    }\n  }\n\n  public async resolveFromIdentity(\n    input: string,\n    options?: ResolveOAuthOptions,\n  ): Promise<{\n    identity: ResolvedIdentity\n    metadata: OAuthAuthorizationServerMetadata\n  }> {\n    const identity = await this.resolveIdentity(input, options)\n\n    options?.signal?.throwIfAborted()\n\n    const metadata = await this.getResourceServerMetadata(identity.pds, options)\n\n    return { identity, metadata }\n  }\n\n  public async resolveIdentity(\n    input: string,\n    options?: ResolveIdentityOptions,\n  ): Promise<ResolvedIdentity> {\n    try {\n      return await this.identityResolver.resolve(input, options)\n    } catch (cause) {\n      throw OAuthResolverError.from(\n        cause,\n        `Failed to resolve identity: ${input}`,\n      )\n    }\n  }\n\n  public async getAuthorizationServerMetadata(\n    issuer: string,\n    options?: GetCachedOptions,\n  ): Promise<OAuthAuthorizationServerMetadata> {\n    try {\n      return await this.authorizationServerMetadataResolver.get(issuer, options)\n    } catch (cause) {\n      throw OAuthResolverError.from(\n        cause,\n        `Failed to resolve OAuth server metadata for issuer: ${issuer}`,\n      )\n    }\n  }\n\n  public async getResourceServerMetadata(\n    pdsUrl: string | URL,\n    options?: GetCachedOptions,\n  ) {\n    try {\n      const rsMetadata = await this.protectedResourceMetadataResolver.get(\n        pdsUrl,\n        options,\n      )\n\n      // ATPROTO requires one, and only one, authorization server entry\n      if (rsMetadata.authorization_servers?.length !== 1) {\n        throw new OAuthResolverError(\n          rsMetadata.authorization_servers?.length\n            ? `Unable to determine authorization server for PDS: ${pdsUrl}`\n            : `No authorization servers found for PDS: ${pdsUrl}`,\n        )\n      }\n\n      const issuer = rsMetadata.authorization_servers![0]!\n\n      options?.signal?.throwIfAborted()\n\n      const asMetadata = await this.getAuthorizationServerMetadata(\n        issuer,\n        options,\n      )\n\n      // https://datatracker.ietf.org/doc/html/draft-ietf-oauth-resource-metadata-05#section-4\n      if (asMetadata.protected_resources) {\n        if (!asMetadata.protected_resources.includes(rsMetadata.resource)) {\n          throw new OAuthResolverError(\n            `PDS \"${pdsUrl}\" not protected by issuer \"${issuer}\"`,\n          )\n        }\n      }\n\n      return asMetadata\n    } catch (cause) {\n      throw OAuthResolverError.from(\n        cause,\n        `Failed to resolve OAuth server metadata for resource: ${pdsUrl}`,\n      )\n    }\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 18167, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18172, "column": 0}, "map": {"version":3,"file":"atproto-token-response.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/atproto-token-response.ts"],"sourcesContent":["import { atprotoDidSchema } from '@atproto/did'\nimport { oauthTokenResponseSchema } from '@atproto/oauth-types'\nimport { z, TypeOf } from 'zod'\n\nimport { includesSpaceSeparatedValue, SpaceSeparatedValue } from './util'\n\nexport type AtprotoScope = SpaceSeparatedValue<'atproto'>\nexport const isAtprotoScope = (input: string): input is AtprotoScope =>\n  includesSpaceSeparatedValue(input, 'atproto')\nexport const atprotoScopeSchema = z\n  .string()\n  .refine(isAtprotoScope, 'The \"atproto\" scope is required')\n\nexport const atprotoTokenResponseSchema = oauthTokenResponseSchema.extend({\n  token_type: z.literal('DPoP'),\n  sub: atprotoDidSchema,\n  scope: atprotoScopeSchema,\n  // OpenID is not compatible with atproto identities\n  id_token: z.never().optional(),\n})\n\nexport type AtprotoTokenResponse = TypeOf<typeof atprotoTokenResponseSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,gCAA+C;AAC/C,MAAA,gDAA+D;AAC/D,MAAA,uBAA+B;AAE/B,MAAA,2BAAyE;AAGlE,MAAM,cAAc,GAAG,CAAC,KAAa,EAAyB,CACnE,CADqE,AACrE,GAAA,OAAA,2BAA2B,EAAC,KAAK,EAAE,SAAS,CAAC,CAAA;AADlC,QAAA,cAAc,GAAA,eACoB;AAClC,QAAA,kBAAkB,GAAG,MAAA,CAAC,CAChC,MAAM,EAAE,CACR,MAAM,CAAC,QAAA,cAAc,EAAE,iCAAiC,CAAC,CAAA;AAE/C,QAAA,0BAA0B,GAAG,cAAA,wBAAwB,CAAC,MAAM,CAAC;IACxE,UAAU,EAAE,MAAA,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;IAC7B,GAAG,EAAE,MAAA,gBAAgB;IACrB,KAAK,EAAE,QAAA,kBAAkB;IACzB,mDAAmD;IACnD,QAAQ,EAAE,MAAA,CAAC,CAAC,KAAK,EAAE,CAAC,QAAQ,EAAE;CAC/B,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 18191, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18196, "column": 0}, "map": {"version":3,"file":"token-refresh-error.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/errors/token-refresh-error.ts"],"sourcesContent":["export class TokenRefreshError extends Error {\n  constructor(\n    public readonly sub: string,\n    message: string,\n    options?: { cause?: unknown },\n  ) {\n    super(message, options)\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAa,iBAAkB,SAAQ,KAAK;IAC1C,YACkB,GAAW,EAC3B,OAAe,EACf,OAA6B,CAAA;QAE7B,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QAJvB,OAAA,cAAA,CAAA,IAAA,EAAA,OAAA;;;;mBAAgB,GAAG;WAAQ;IAK7B,CAAC;CACF;AARD,QAAA,iBAAA,GAAA,kBAQC","ignoreList":[0]}},
    {"offset": {"line": 18213, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18218, "column": 0}, "map": {"version":3,"file":"fetch-dpop.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/fetch-dpop.ts"],"sourcesContent":["import { Fetch, FetchContext, cancelBody, peekJson } from '@atproto-labs/fetch'\nimport { SimpleStore } from '@atproto-labs/simple-store'\nimport { Key } from '@atproto/jwk'\nimport { base64url } from 'multiformats/bases/base64'\n\n// \"undefined\" in non https environments or environments without crypto\nconst subtle = globalThis.crypto?.subtle as SubtleCrypto | undefined\n\nconst ReadableStream = globalThis.ReadableStream as\n  | typeof globalThis.ReadableStream\n  | undefined\n\nexport type DpopFetchWrapperOptions<C = FetchContext> = {\n  key: Key\n  iss: string\n  nonces: SimpleStore<string, string>\n  supportedAlgs?: string[]\n  sha256?: (input: string) => Promise<string>\n\n  /**\n   * Is the intended server an authorization server (true) or a resource server\n   * (false)? Setting this may allow to avoid parsing the response body to\n   * determine the dpop-nonce.\n   *\n   * @default undefined\n   */\n  isAuthServer?: boolean\n  fetch?: Fetch<C>\n}\n\nexport function dpopFetchWrapper<C = FetchContext>({\n  key,\n  iss,\n  supportedAlgs,\n  nonces,\n  sha256 = typeof subtle !== 'undefined' ? subtleSha256 : undefined,\n  isAuthServer,\n  fetch = globalThis.fetch,\n}: DpopFetchWrapperOptions<C>): Fetch<C> {\n  if (!sha256) {\n    throw new TypeError(\n      `crypto.subtle is not available in this environment. Please provide a sha256 function.`,\n    )\n  }\n\n  const alg = negotiateAlg(key, supportedAlgs)\n\n  return async function (this: C, input, init) {\n    if (!key.algorithms.includes(alg)) {\n      throw new TypeError(`Key does not support the algorithm ${alg}`)\n    }\n\n    const request: Request =\n      init == null && input instanceof Request\n        ? input\n        : new Request(input, init)\n\n    const authorizationHeader = request.headers.get('Authorization')\n    const ath = authorizationHeader?.startsWith('DPoP ')\n      ? await sha256(authorizationHeader.slice(5))\n      : undefined\n\n    const { method, url } = request\n    const { origin } = new URL(url)\n\n    let initNonce: string | undefined\n    try {\n      initNonce = await nonces.get(origin)\n    } catch {\n      // Ignore get errors, we will just not send a nonce\n    }\n\n    const initProof = await buildProof(\n      key,\n      alg,\n      iss,\n      method,\n      url,\n      initNonce,\n      ath,\n    )\n    request.headers.set('DPoP', initProof)\n\n    const initResponse = await fetch.call(this, request)\n\n    // Make sure the response body is consumed. Either by the caller (when the\n    // response is returned), of if an error is thrown (catch block).\n\n    const nextNonce = initResponse.headers.get('DPoP-Nonce')\n    if (!nextNonce || nextNonce === initNonce) {\n      // No nonce was returned or it is the same as the one we sent. No need to\n      // update the nonce store, or retry the request.\n      return initResponse\n    }\n\n    // Store the fresh nonce for future requests\n    try {\n      await nonces.set(origin, nextNonce)\n    } catch {\n      // Ignore set errors\n    }\n\n    const shouldRetry = await isUseDpopNonceError(initResponse, isAuthServer)\n    if (!shouldRetry) {\n      // Not a \"use_dpop_nonce\" error, so there is no need to retry\n      return initResponse\n    }\n\n    // If the input stream was already consumed, we cannot retry the request. A\n    // solution would be to clone() the request but that would bufferize the\n    // entire stream in memory which can lead to memory starvation. Instead, we\n    // will return the original response and let the calling code handle retries.\n\n    if (input === request) {\n      // The input request body was consumed. We cannot retry the request.\n      return initResponse\n    }\n\n    if (ReadableStream && init?.body instanceof ReadableStream) {\n      // The init body was consumed. We cannot retry the request.\n      return initResponse\n    }\n\n    // We will now retry the request with the fresh nonce.\n\n    // The initial response body must be consumed (see cancelBody's doc).\n    await cancelBody(initResponse, 'log')\n\n    const nextProof = await buildProof(\n      key,\n      alg,\n      iss,\n      method,\n      url,\n      nextNonce,\n      ath,\n    )\n    const nextRequest = new Request(input, init)\n    nextRequest.headers.set('DPoP', nextProof)\n\n    return fetch.call(this, nextRequest)\n  }\n}\n\nasync function buildProof(\n  key: Key,\n  alg: string,\n  iss: string,\n  htm: string,\n  htu: string,\n  nonce?: string,\n  ath?: string,\n) {\n  if (!key.bareJwk) {\n    throw new Error('Only asymmetric keys can be used as DPoP proofs')\n  }\n\n  const now = Math.floor(Date.now() / 1e3)\n\n  return key.createJwt(\n    // https://datatracker.ietf.org/doc/html/rfc9449#section-4.2\n    {\n      alg,\n      typ: 'dpop+jwt',\n      jwk: key.bareJwk,\n    },\n    {\n      iss,\n      iat: now,\n      // Any collision will cause the request to be rejected by the server. no biggie.\n      jti: Math.random().toString(36).slice(2),\n      htm,\n      htu,\n      nonce,\n      ath,\n    },\n  )\n}\n\nasync function isUseDpopNonceError(\n  response: Response,\n  isAuthServer?: boolean,\n): Promise<boolean> {\n  // https://datatracker.ietf.org/doc/html/rfc6750#section-3\n  // https://datatracker.ietf.org/doc/html/rfc9449#name-resource-server-provided-no\n  if (isAuthServer === undefined || isAuthServer === false) {\n    if (response.status === 401) {\n      const wwwAuth = response.headers.get('WWW-Authenticate')\n      if (wwwAuth?.startsWith('DPoP')) {\n        return wwwAuth.includes('error=\"use_dpop_nonce\"')\n      }\n    }\n  }\n\n  // https://datatracker.ietf.org/doc/html/rfc9449#name-authorization-server-provid\n  if (isAuthServer === undefined || isAuthServer === true) {\n    if (response.status === 400) {\n      try {\n        const json = await peekJson(response, 10 * 1024)\n        return typeof json === 'object' && json?.['error'] === 'use_dpop_nonce'\n      } catch {\n        // Response too big (to be \"use_dpop_nonce\" error) or invalid JSON\n        return false\n      }\n    }\n  }\n\n  return false\n}\n\nfunction negotiateAlg(key: Key, supportedAlgs: string[] | undefined): string {\n  if (supportedAlgs) {\n    // Use order of supportedAlgs as preference\n    const alg = supportedAlgs.find((a) => key.algorithms.includes(a))\n    if (alg) return alg\n  } else {\n    const [alg] = key.algorithms\n    if (alg) return alg\n  }\n\n  throw new Error('Key does not match any alg supported by the server')\n}\n\nasync function subtleSha256(input: string): Promise<string> {\n  if (subtle == null) {\n    throw new Error(\n      `crypto.subtle is not available in this environment. Please provide a sha256 function.`,\n    )\n  }\n\n  const bytes = new TextEncoder().encode(input)\n  const digest = await subtle.digest('SHA-256', bytes)\n  const digestBytes = new Uint8Array(digest)\n  return base64url.baseEncode(digestBytes)\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 18357, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18362, "column": 0}, "map": {"version":3,"file":"oauth-response-error.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-response-error.ts"],"sourcesContent":["import { Json, ifString, ifObject } from '@atproto-labs/fetch'\n\nexport class OAuthResponseError extends Error {\n  readonly error?: string\n  readonly errorDescription?: string\n\n  constructor(\n    public readonly response: Response,\n    public readonly payload: Json,\n  ) {\n    const error = ifString(ifObject(payload)?.['error'])\n    const errorDescription = ifString(ifObject(payload)?.['error_description'])\n\n    const messageError = error ? `\"${error}\"` : 'unknown'\n    const messageDesc = errorDescription ? `: ${errorDescription}` : ''\n    const message = `OAuth ${messageError} error${messageDesc}`\n\n    super(message)\n\n    this.error = error\n    this.errorDescription = errorDescription\n  }\n\n  get status() {\n    return this.response.status\n  }\n\n  get headers() {\n    return this.response.headers\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAA,yCAA8D;AAE9D,MAAa,kBAAmB,SAAQ,KAAK;IAI3C,YACkB,QAAkB,EAClB,OAAa,CAAA;QAE7B,MAAM,KAAK,GAAG,CAAA,GAAA,QAAA,QAAQ,EAAC,CAAA,GAAA,QAAA,QAAQ,EAAC,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,CAAA;QACpD,MAAM,gBAAgB,GAAG,CAAA,GAAA,QAAA,QAAQ,EAAC,CAAA,GAAA,QAAA,QAAQ,EAAC,OAAO,CAAC,EAAE,CAAC,mBAAmB,CAAC,CAAC,CAAA;QAE3E,MAAM,YAAY,GAAG,KAAK,CAAC,CAAC,CAAC,CAAA,CAAA,EAAI,KAAK,CAAA,CAAA,CAAG,CAAC,CAAC,CAAC,SAAS,CAAA;QACrD,MAAM,WAAW,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAA,EAAA,EAAK,gBAAgB,EAAE,CAAC,CAAC,CAAC,EAAE,CAAA;QACnE,MAAM,OAAO,GAAG,CAAA,MAAA,EAAS,YAAY,CAAA,MAAA,EAAS,WAAW,EAAE,CAAA;QAE3D,KAAK,CAAC,OAAO,CAAC,CAAA;QAVd,OAAA,cAAA,CAAA,IAAA,EAAA,YAAA;;;;mBAAgB,QAAQ;WAAU;QAClC,OAAA,cAAA,CAAA,IAAA,EAAA,WAAA;;;;mBAAgB,OAAO;WAAM;QALtB,OAAA,cAAA,CAAA,IAAA,EAAA,SAAA;;;;;WAAc;QACd,OAAA,cAAA,CAAA,IAAA,EAAA,oBAAA;;;;;WAAyB;QAehC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;QAClB,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAA;IAC1C,CAAC;IAED,IAAI,MAAM,GAAA;QACR,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAA;IAC7B,CAAC;IAED,IAAI,OAAO,GAAA;QACT,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAA;IAC9B,CAAC;CACF;AA5BD,QAAA,kBAAA,GAAA,mBA4BC","ignoreList":[0]}},
    {"offset": {"line": 18411, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18416, "column": 0}, "map": {"version":3,"file":"oauth-server-agent.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-server-agent.ts"],"sourcesContent":["import { Fetch, Json, bindFetch, fetchJsonProcessor } from '@atproto-labs/fetch'\nimport { SimpleStore } from '@atproto-labs/simple-store'\nimport { AtprotoDid } from '@atproto/did'\nimport { Key, Keyset } from '@atproto/jwk'\nimport {\n  CLIENT_ASSERTION_TYPE_JWT_BEARER,\n  OAuthAuthorizationRequestPar,\n  OAuthAuthorizationServerMetadata,\n  OAuthClientCredentials,\n  OAuthEndpointName,\n  OAuthParResponse,\n  OAuthTokenRequest,\n  oauthParResponseSchema,\n} from '@atproto/oauth-types'\n\nimport {\n  AtprotoScope,\n  AtprotoTokenResponse,\n  atprotoTokenResponseSchema,\n} from './atproto-token-response.js'\nimport { FALLBACK_ALG } from './constants.js'\nimport { TokenRefreshError } from './errors/token-refresh-error.js'\nimport { dpopFetchWrapper } from './fetch-dpop.js'\nimport { OAuthResolver } from './oauth-resolver.js'\nimport { OAuthResponseError } from './oauth-response-error.js'\nimport { Runtime } from './runtime.js'\nimport { ClientMetadata } from './types.js'\nimport { timeoutSignal } from './util.js'\n\nexport type TokenSet = {\n  iss: string\n  sub: AtprotoDid\n  aud: string\n  scope: AtprotoScope\n\n  refresh_token?: string\n  access_token: string\n  token_type: 'DPoP'\n  /** ISO Date */\n  expires_at?: string\n}\n\nexport type DpopNonceCache = SimpleStore<string, string>\n\nexport class OAuthServerAgent {\n  protected dpopFetch: Fetch<unknown>\n\n  constructor(\n    readonly dpopKey: Key,\n    readonly serverMetadata: OAuthAuthorizationServerMetadata,\n    readonly clientMetadata: ClientMetadata,\n    readonly dpopNonces: DpopNonceCache,\n    readonly oauthResolver: OAuthResolver,\n    readonly runtime: Runtime,\n    readonly keyset?: Keyset,\n    fetch?: Fetch,\n  ) {\n    this.dpopFetch = dpopFetchWrapper<void>({\n      fetch: bindFetch(fetch),\n      iss: clientMetadata.client_id,\n      key: dpopKey,\n      supportedAlgs: serverMetadata.dpop_signing_alg_values_supported,\n      sha256: async (v) => runtime.sha256(v),\n      nonces: dpopNonces,\n      isAuthServer: true,\n    })\n  }\n\n  get issuer() {\n    return this.serverMetadata.issuer\n  }\n\n  async revoke(token: string) {\n    try {\n      await this.request('revocation', { token })\n    } catch {\n      // Don't care\n    }\n  }\n\n  async exchangeCode(code: string, codeVerifier?: string): Promise<TokenSet> {\n    const now = Date.now()\n\n    const tokenResponse = await this.request('token', {\n      grant_type: 'authorization_code',\n      redirect_uri: this.clientMetadata.redirect_uris[0]!,\n      code,\n      code_verifier: codeVerifier,\n    })\n\n    try {\n      // /!\\ IMPORTANT /!\\\n      //\n      // The tokenResponse MUST always be valid before the \"sub\" it contains\n      // can be trusted (see Atproto's OAuth spec for details).\n      const aud = await this.verifyIssuer(tokenResponse.sub)\n\n      return {\n        aud,\n        sub: tokenResponse.sub,\n        iss: this.issuer,\n\n        scope: tokenResponse.scope,\n        refresh_token: tokenResponse.refresh_token,\n        access_token: tokenResponse.access_token,\n        token_type: tokenResponse.token_type,\n\n        expires_at:\n          typeof tokenResponse.expires_in === 'number'\n            ? new Date(now + tokenResponse.expires_in * 1000).toISOString()\n            : undefined,\n      }\n    } catch (err) {\n      await this.revoke(tokenResponse.access_token)\n\n      throw err\n    }\n  }\n\n  async refresh(tokenSet: TokenSet): Promise<TokenSet> {\n    if (!tokenSet.refresh_token) {\n      throw new TokenRefreshError(tokenSet.sub, 'No refresh token available')\n    }\n\n    // /!\\ IMPORTANT /!\\\n    //\n    // The \"sub\" MUST be a DID, whose issuer authority is indeed the server we\n    // are trying to obtain credentials from. Note that we are doing this\n    // *before* we actually try to refresh the token:\n    // 1) To avoid unnecessary refresh\n    // 2) So that the refresh is the last async operation, ensuring as few\n    //    async operations happen before the result gets a chance to be stored.\n    const aud = await this.verifyIssuer(tokenSet.sub)\n\n    const now = Date.now()\n\n    const tokenResponse = await this.request('token', {\n      grant_type: 'refresh_token',\n      refresh_token: tokenSet.refresh_token,\n    })\n\n    return {\n      aud,\n      sub: tokenSet.sub,\n      iss: this.issuer,\n\n      scope: tokenResponse.scope,\n      refresh_token: tokenResponse.refresh_token,\n      access_token: tokenResponse.access_token,\n      token_type: tokenResponse.token_type,\n\n      expires_at:\n        typeof tokenResponse.expires_in === 'number'\n          ? new Date(now + tokenResponse.expires_in * 1000).toISOString()\n          : undefined,\n    }\n  }\n\n  /**\n   * VERY IMPORTANT ! Always call this to process token responses.\n   *\n   * Whenever an OAuth token response is received, we **MUST** verify that the\n   * \"sub\" is a DID, whose issuer authority is indeed the server we just\n   * obtained credentials from. This check is a critical step to actually be\n   * able to use the \"sub\" (DID) as being the actual user's identifier.\n   *\n   * @returns The user's PDS URL (the resource server for the user)\n   */\n  protected async verifyIssuer(sub: AtprotoDid) {\n    using signal = timeoutSignal(10e3)\n\n    const resolved = await this.oauthResolver.resolveFromIdentity(sub, {\n      noCache: true,\n      allowStale: false,\n      signal,\n    })\n\n    if (this.issuer !== resolved.metadata.issuer) {\n      // Best case scenario; the user switched PDS. Worst case scenario; a bad\n      // actor is trying to impersonate a user. In any case, we must not allow\n      // this token to be used.\n      throw new TypeError('Issuer mismatch')\n    }\n\n    return resolved.identity.pds.href\n  }\n\n  async request<Endpoint extends OAuthEndpointName>(\n    endpoint: Endpoint,\n    payload: Endpoint extends 'token'\n      ? OAuthTokenRequest\n      : Endpoint extends 'pushed_authorization_request'\n        ? OAuthAuthorizationRequestPar\n        : Record<string, unknown>,\n  ): Promise<\n    Endpoint extends 'token'\n      ? AtprotoTokenResponse\n      : Endpoint extends 'pushed_authorization_request'\n        ? OAuthParResponse\n        : Json\n  >\n  async request(\n    endpoint: OAuthEndpointName,\n    payload: Record<string, unknown>,\n  ): Promise<unknown> {\n    const url = this.serverMetadata[`${endpoint}_endpoint`]\n    if (!url) throw new Error(`No ${endpoint} endpoint available`)\n\n    const auth = await this.buildClientAuth(endpoint)\n\n    const { response, json } = await this.dpopFetch(url, {\n      method: 'POST',\n      headers: { ...auth.headers, 'Content-Type': 'application/json' },\n      body: JSON.stringify({ ...payload, ...auth.payload }),\n    }).then(fetchJsonProcessor())\n\n    if (response.ok) {\n      switch (endpoint) {\n        case 'token':\n          return atprotoTokenResponseSchema.parse(json)\n        case 'pushed_authorization_request':\n          return oauthParResponseSchema.parse(json)\n        default:\n          return json\n      }\n    } else {\n      throw new OAuthResponseError(response, json)\n    }\n  }\n\n  async buildClientAuth(endpoint: OAuthEndpointName): Promise<{\n    headers?: Record<string, string>\n    payload: OAuthClientCredentials\n  }> {\n    const methodSupported =\n      this.serverMetadata[`token_endpoint_auth_methods_supported`]\n\n    const method = this.clientMetadata[`token_endpoint_auth_method`]\n\n    if (\n      method === 'private_key_jwt' ||\n      (this.keyset &&\n        !method &&\n        (methodSupported?.includes('private_key_jwt') ?? false))\n    ) {\n      if (!this.keyset) throw new Error('No keyset available')\n\n      try {\n        const alg =\n          this.serverMetadata[\n            `token_endpoint_auth_signing_alg_values_supported`\n          ] ?? FALLBACK_ALG\n\n        // If jwks is defined, make sure to only sign using a key that exists in\n        // the jwks. If jwks_uri is defined, we can't be sure that the key we're\n        // looking for is in there so we will just assume it is.\n        const kid = this.clientMetadata.jwks?.keys\n          .map(({ kid }) => kid)\n          .filter((v): v is string => typeof v === 'string')\n\n        return {\n          payload: {\n            client_id: this.clientMetadata.client_id,\n            client_assertion_type: CLIENT_ASSERTION_TYPE_JWT_BEARER,\n            client_assertion: await this.keyset.createJwt(\n              { alg, kid },\n              {\n                iss: this.clientMetadata.client_id,\n                sub: this.clientMetadata.client_id,\n                aud: this.serverMetadata.issuer,\n                jti: await this.runtime.generateNonce(),\n                iat: Math.floor(Date.now() / 1000),\n              },\n            ),\n          },\n        }\n      } catch (err) {\n        if (method === 'private_key_jwt') throw err\n\n        // Else try next method\n      }\n    }\n\n    if (\n      method === 'none' ||\n      (!method && (methodSupported?.includes('none') ?? true))\n    ) {\n      return {\n        payload: {\n          client_id: this.clientMetadata.client_id,\n        },\n      }\n    }\n\n    throw new Error(`Unsupported ${endpoint} authentication method`)\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 18730, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18735, "column": 0}, "map": {"version":3,"file":"oauth-server-factory.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-server-factory.ts"],"sourcesContent":["import { Fetch } from '@atproto-labs/fetch'\nimport { Key, Keyset } from '@atproto/jwk'\nimport { OAuthAuthorizationServerMetadata } from '@atproto/oauth-types'\n\nimport { GetCachedOptions } from './oauth-authorization-server-metadata-resolver.js'\nimport { OAuthResolver } from './oauth-resolver.js'\nimport { DpopNonceCache, OAuthServerAgent } from './oauth-server-agent.js'\nimport { Runtime } from './runtime.js'\nimport { ClientMetadata } from './types.js'\n\nexport class OAuthServerFactory {\n  constructor(\n    readonly clientMetadata: ClientMetadata,\n    readonly runtime: Runtime,\n    readonly resolver: OAuthResolver,\n    readonly fetch: Fetch,\n    readonly keyset: Keyset | undefined,\n    readonly dpopNonceCache: DpopNonceCache,\n  ) {}\n\n  async fromIssuer(issuer: string, dpopKey: Key, options?: GetCachedOptions) {\n    const serverMetadata = await this.resolver.getAuthorizationServerMetadata(\n      issuer,\n      options,\n    )\n    return this.fromMetadata(serverMetadata, dpopKey)\n  }\n\n  async fromMetadata(\n    serverMetadata: OAuthAuthorizationServerMetadata,\n    dpopKey: Key,\n  ) {\n    return new OAuthServerAgent(\n      dpopKey,\n      serverMetadata,\n      this.clientMetadata,\n      this.dpopNonceCache,\n      this.resolver,\n      this.runtime,\n      this.keyset,\n      this.fetch,\n    )\n  }\n}\n"],"names":[],"mappings":";;;;;AAMA,MAAA,6DAA0E;AAI1E,MAAa,kBAAkB;IAC7B,YACW,cAA8B,EAC9B,OAAgB,EAChB,QAAuB,EACvB,KAAY,EACZ,MAA0B,EAC1B,cAA8B,CAAA;QALvC,OAAA,cAAA,CAAA,IAAA,EAAA,kBAAA;;;;mBAAS,cAAc;WAAgB;QACvC,OAAA,cAAA,CAAA,IAAA,EAAA,WAAA;;;;mBAAS,OAAO;WAAS;QACzB,OAAA,cAAA,CAAA,IAAA,EAAA,YAAA;;;;mBAAS,QAAQ;WAAe;QAChC,OAAA,cAAA,CAAA,IAAA,EAAA,SAAA;;;;mBAAS,KAAK;WAAO;QACrB,OAAA,cAAA,CAAA,IAAA,EAAA,UAAA;;;;mBAAS,MAAM;WAAoB;QACnC,OAAA,cAAA,CAAA,IAAA,EAAA,kBAAA;;;;mBAAS,cAAc;WAAgB;IACtC,CAAC;IAEJ,KAAK,CAAC,UAAU,CAAC,MAAc,EAAE,OAAY,EAAE,OAA0B,EAAA;QACvE,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,8BAA8B,CACvE,MAAM,EACN,OAAO,CACR,CAAA;QACD,OAAO,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE,OAAO,CAAC,CAAA;IACnD,CAAC;IAED,KAAK,CAAC,YAAY,CAChB,cAAgD,EAChD,OAAY,EAAA;QAEZ,OAAO,IAAI,wBAAA,gBAAgB,CACzB,OAAO,EACP,cAAc,EACd,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,KAAK,CACX,CAAA;IACH,CAAC;CACF;AAjCD,QAAA,kBAAA,GAAA,mBAiCC","ignoreList":[0]}},
    {"offset": {"line": 18789, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18794, "column": 0}, "map": {"version":3,"file":"token-invalid-error.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/errors/token-invalid-error.ts"],"sourcesContent":["export class TokenInvalidError extends Error {\n  constructor(\n    public readonly sub: string,\n    message = `The session for \"${sub}\" is invalid`,\n    options?: { cause?: unknown },\n  ) {\n    super(message, options)\n  }\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAa,iBAAkB,SAAQ,KAAK;IAC1C,YACkB,GAAW,EAC3B,OAAO,GAAG,CAAA,iBAAA,EAAoB,GAAG,CAAA,YAAA,CAAc,EAC/C,OAA6B,CAAA;QAE7B,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QAJvB,OAAA,cAAA,CAAA,IAAA,EAAA,OAAA;;;;mBAAgB,GAAG;WAAQ;IAK7B,CAAC;CACF;AARD,QAAA,iBAAA,GAAA,kBAQC","ignoreList":[0]}},
    {"offset": {"line": 18811, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18816, "column": 0}, "map": {"version":3,"file":"oauth-session.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-session.ts"],"sourcesContent":["import { bindFetch, Fetch } from '@atproto-labs/fetch'\nimport { AtprotoDid } from '@atproto/did'\nimport { OAuthAuthorizationServerMetadata } from '@atproto/oauth-types'\n\nimport { AtprotoScope } from './atproto-token-response.js'\nimport { TokenInvalidError } from './errors/token-invalid-error.js'\nimport { TokenRevokedError } from './errors/token-revoked-error.js'\nimport { dpopFetchWrapper } from './fetch-dpop.js'\nimport { OAuthServerAgent, TokenSet } from './oauth-server-agent.js'\nimport { SessionGetter } from './session-getter.js'\n\nconst ReadableStream = globalThis.ReadableStream as\n  | typeof globalThis.ReadableStream\n  | undefined\n\nexport type TokenInfo = {\n  expiresAt?: Date\n  expired?: boolean\n  scope: AtprotoScope\n  iss: string\n  aud: string\n  sub: AtprotoDid\n}\n\nexport class OAuthSession {\n  protected dpopFetch: Fetch<unknown>\n\n  constructor(\n    public readonly server: OAuthServerAgent,\n    public readonly sub: AtprotoDid,\n    private readonly sessionGetter: SessionGetter,\n    fetch: Fetch = globalThis.fetch,\n  ) {\n    this.dpopFetch = dpopFetchWrapper<void>({\n      fetch: bindFetch(fetch),\n      iss: server.clientMetadata.client_id,\n      key: server.dpopKey,\n      supportedAlgs: server.serverMetadata.dpop_signing_alg_values_supported,\n      sha256: async (v) => server.runtime.sha256(v),\n      nonces: server.dpopNonces,\n      isAuthServer: false,\n    })\n  }\n\n  get did(): AtprotoDid {\n    return this.sub\n  }\n\n  get serverMetadata(): Readonly<OAuthAuthorizationServerMetadata> {\n    return this.server.serverMetadata\n  }\n\n  /**\n   * @param refresh When `true`, the credentials will be refreshed even if they\n   * are not expired. When `false`, the credentials will not be refreshed even\n   * if they are expired. When `undefined`, the credentials will be refreshed\n   * if, and only if, they are (about to be) expired. Defaults to `undefined`.\n   */\n  protected async getTokenSet(refresh: boolean | 'auto'): Promise<TokenSet> {\n    const { tokenSet } = await this.sessionGetter.get(this.sub, {\n      noCache: refresh === true,\n      allowStale: refresh === false,\n    })\n\n    return tokenSet\n  }\n\n  async getTokenInfo(refresh: boolean | 'auto' = 'auto'): Promise<TokenInfo> {\n    const tokenSet = await this.getTokenSet(refresh)\n    const expiresAt =\n      tokenSet.expires_at == null ? undefined : new Date(tokenSet.expires_at)\n\n    return {\n      expiresAt,\n      get expired() {\n        return expiresAt == null\n          ? undefined\n          : expiresAt.getTime() < Date.now() - 5e3\n      },\n      scope: tokenSet.scope,\n      iss: tokenSet.iss,\n      aud: tokenSet.aud,\n      sub: tokenSet.sub,\n    }\n  }\n\n  async signOut(): Promise<void> {\n    try {\n      const tokenSet = await this.getTokenSet(false)\n      await this.server.revoke(tokenSet.access_token)\n    } finally {\n      await this.sessionGetter.delStored(\n        this.sub,\n        new TokenRevokedError(this.sub),\n      )\n    }\n  }\n\n  async fetchHandler(pathname: string, init?: RequestInit): Promise<Response> {\n    // This will try and refresh the token if it is known to be expired\n    const tokenSet = await this.getTokenSet('auto')\n\n    const initialUrl = new URL(pathname, tokenSet.aud)\n    const initialAuth = `${tokenSet.token_type} ${tokenSet.access_token}`\n\n    const headers = new Headers(init?.headers)\n    headers.set('Authorization', initialAuth)\n\n    const initialResponse = await this.dpopFetch(initialUrl, {\n      ...init,\n      headers,\n    })\n\n    // If the token is not expired, we don't need to refresh it\n    if (!isInvalidTokenResponse(initialResponse)) {\n      return initialResponse\n    }\n\n    let tokenSetFresh: TokenSet\n    try {\n      // Force a refresh\n      tokenSetFresh = await this.getTokenSet(true)\n    } catch (err) {\n      return initialResponse\n    }\n\n    // The stream was already consumed. We cannot retry the request. A solution\n    // would be to tee() the input stream but that would bufferize the entire\n    // stream in memory which can lead to memory starvation. Instead, we will\n    // return the original response and let the calling code handle retries.\n    if (ReadableStream && init?.body instanceof ReadableStream) {\n      return initialResponse\n    }\n\n    const finalAuth = `${tokenSetFresh.token_type} ${tokenSetFresh.access_token}`\n    const finalUrl = new URL(pathname, tokenSetFresh.aud)\n\n    headers.set('Authorization', finalAuth)\n\n    const finalResponse = await this.dpopFetch(finalUrl, { ...init, headers })\n\n    // The token was successfully refreshed, but is still not accepted by the\n    // resource server. This might be due to the resource server not accepting\n    // credentials from the authorization server (e.g. because some migration\n    // occurred). Any ways, there is no point in keeping the session.\n    if (isInvalidTokenResponse(finalResponse)) {\n      // TODO: Is there a \"softer\" way to handle this, e.g. by marking the\n      // session as \"expired\" in the session store, allowing the user to trigger\n      // a new login (using login_hint)?\n      await this.sessionGetter.delStored(\n        this.sub,\n        new TokenInvalidError(this.sub),\n      )\n    }\n\n    return finalResponse\n  }\n}\n\n/**\n * @see {@link https://datatracker.ietf.org/doc/html/rfc6750#section-3}\n * @see {@link https://datatracker.ietf.org/doc/html/rfc9449#name-resource-server-provided-no}\n */\nfunction isInvalidTokenResponse(response: Response) {\n  if (response.status !== 401) return false\n  const wwwAuth = response.headers.get('WWW-Authenticate')\n  return (\n    wwwAuth != null &&\n    (wwwAuth.startsWith('Bearer ') || wwwAuth.startsWith('DPoP ')) &&\n    wwwAuth.includes('error=\"invalid_token\"')\n  )\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 18960, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18965, "column": 0}, "map": {"version":3,"file":"lock.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/lock.ts"],"sourcesContent":["import { RuntimeLock } from './runtime-implementation.js'\n\nconst locks = new Map<unknown, Promise<void>>()\n\nfunction acquireLocalLock(name: unknown): Promise<() => void> {\n  return new Promise((resolveAcquire) => {\n    const prev = locks.get(name) ?? Promise.resolve()\n    const next = prev.then(() => {\n      return new Promise<void>((resolveRelease) => {\n        const release = () => {\n          // Only delete the lock if it is still the current one\n          if (locks.get(name) === next) locks.delete(name)\n\n          resolveRelease()\n        }\n\n        resolveAcquire(release)\n      })\n    })\n\n    locks.set(name, next)\n  })\n}\n\nexport const requestLocalLock: RuntimeLock = (name, fn) => {\n  return acquireLocalLock(name).then(async (release) => {\n    try {\n      return await fn()\n    } finally {\n      release()\n    }\n  })\n}\n"],"names":[],"mappings":";;;;;AAEA,MAAM,KAAK,GAAG,IAAI,GAAG,EAA0B,CAAA;AAE/C,SAAS,gBAAgB,CAAC,IAAa;IACrC,OAAO,IAAI,OAAO,CAAC,CAAC,cAAc,EAAE,EAAE;QACpC,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,OAAO,EAAE,CAAA;QACjD,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE;YAC1B,OAAO,IAAI,OAAO,CAAO,CAAC,cAAc,EAAE,EAAE;gBAC1C,MAAM,OAAO,GAAG,GAAG,EAAE;oBACnB,sDAAsD;oBACtD,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,IAAI,EAAE,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;oBAEhD,cAAc,EAAE,CAAA;gBAClB,CAAC,CAAA;gBAED,cAAc,CAAC,OAAO,CAAC,CAAA;YACzB,CAAC,CAAC,CAAA;QACJ,CAAC,CAAC,CAAA;QAEF,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;IACvB,CAAC,CAAC,CAAA;AACJ,CAAC;AAEM,MAAM,gBAAgB,GAAgB,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE;IACxD,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE;QACnD,IAAI,CAAC;YACH,OAAO,MAAM,EAAE,EAAE,CAAA;QACnB,CAAC,QAAS,CAAC;YACT,OAAO,EAAE,CAAA;QACX,CAAC;IACH,CAAC,CAAC,CAAA;AACJ,CAAC,CAAA;AARY,QAAA,gBAAgB,GAAA,iBAQ5B","ignoreList":[0]}},
    {"offset": {"line": 18997, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19002, "column": 0}, "map": {"version":3,"file":"runtime.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/runtime.ts"],"sourcesContent":["import { Key } from '@atproto/jwk'\nimport { base64url } from 'multiformats/bases/base64'\n\nimport { requestLocalLock } from './lock.js'\nimport { RuntimeImplementation, RuntimeLock } from './runtime-implementation.js'\n\nexport class Runtime {\n  readonly hasImplementationLock: boolean\n  readonly usingLock: RuntimeLock\n\n  constructor(protected implementation: RuntimeImplementation) {\n    const { requestLock } = implementation\n\n    this.hasImplementationLock = requestLock != null\n    this.usingLock =\n      requestLock?.bind(implementation) ||\n      // Falling back to a local lock\n      requestLocalLock\n  }\n\n  public async generateKey(algs: string[]): Promise<Key> {\n    const algsSorted = Array.from(algs).sort(compareAlgos)\n    return this.implementation.createKey(algsSorted)\n  }\n\n  public async sha256(text: string): Promise<string> {\n    const bytes = new TextEncoder().encode(text)\n    const digest = await this.implementation.digest(bytes, { name: 'sha256' })\n    return base64url.baseEncode(digest)\n  }\n\n  public async generateNonce(length = 16): Promise<string> {\n    const bytes = await this.implementation.getRandomValues(length)\n    return base64url.baseEncode(bytes)\n  }\n\n  public async generatePKCE(byteLength?: number) {\n    const verifier = await this.generateVerifier(byteLength)\n    return {\n      verifier,\n      challenge: await this.sha256(verifier),\n      method: 'S256' as const,\n    }\n  }\n\n  public async calculateJwkThumbprint(jwk) {\n    const components = extractJktComponents(jwk)\n    const data = JSON.stringify(components)\n    return this.sha256(data)\n  }\n\n  /**\n   * @see {@link https://datatracker.ietf.org/doc/html/rfc7636#section-4.1}\n   * @note It is RECOMMENDED that the output of a suitable random number generator\n   * be used to create a 32-octet sequence. The octet sequence is then\n   * base64url-encoded to produce a 43-octet URL safe string to use as the code\n   * verifier.\n   */\n  protected async generateVerifier(byteLength = 32) {\n    if (byteLength < 32 || byteLength > 96) {\n      throw new TypeError('Invalid code_verifier length')\n    }\n    const bytes = await this.implementation.getRandomValues(byteLength)\n    return base64url.baseEncode(bytes)\n  }\n}\n\nfunction extractJktComponents(jwk) {\n  const get = (field) => {\n    const value = jwk[field]\n    if (typeof value !== 'string' || !value) {\n      throw new TypeError(`\"${field}\" Parameter missing or invalid`)\n    }\n    return value\n  }\n\n  switch (jwk.kty) {\n    case 'EC':\n      return { crv: get('crv'), kty: get('kty'), x: get('x'), y: get('y') }\n    case 'OKP':\n      return { crv: get('crv'), kty: get('kty'), x: get('x') }\n    case 'RSA':\n      return { e: get('e'), kty: get('kty'), n: get('n') }\n    case 'oct':\n      return { k: get('k'), kty: get('kty') }\n    default:\n      throw new TypeError('\"kty\" (Key Type) Parameter missing or unsupported')\n  }\n}\n\n/**\n * 256K > ES (256 > 384 > 512) > PS (256 > 384 > 512) > RS (256 > 384 > 512) > other (in original order)\n */\nfunction compareAlgos(a: string, b: string): number {\n  if (a === 'ES256K') return -1\n  if (b === 'ES256K') return 1\n\n  for (const prefix of ['ES', 'PS', 'RS']) {\n    if (a.startsWith(prefix)) {\n      if (b.startsWith(prefix)) {\n        const aLen = parseInt(a.slice(2, 5))\n        const bLen = parseInt(b.slice(2, 5))\n\n        // Prefer shorter key lengths\n        return aLen - bLen\n      }\n      return -1\n    } else if (b.startsWith(prefix)) {\n      return 1\n    }\n  }\n\n  // Don't know how to compare, keep original order\n  return 0\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 19139, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19144, "column": 0}, "map": {"version":3,"file":"session-getter.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/session-getter.ts"],"sourcesContent":["import {\n  CachedGetter,\n  GetCachedOptions,\n  SimpleStore,\n} from '@atproto-labs/simple-store'\nimport { AtprotoDid } from '@atproto/did'\nimport { Key } from '@atproto/jwk'\n\nimport { TokenInvalidError } from './errors/token-invalid-error.js'\nimport { TokenRefreshError } from './errors/token-refresh-error.js'\nimport { TokenRevokedError } from './errors/token-revoked-error.js'\nimport { OAuthResponseError } from './oauth-response-error.js'\nimport { TokenSet } from './oauth-server-agent.js'\nimport { OAuthServerFactory } from './oauth-server-factory.js'\nimport { Runtime } from './runtime.js'\nimport { combineSignals, CustomEventTarget, timeoutSignal } from './util.js'\n\nexport type Session = {\n  dpopKey: Key\n  tokenSet: TokenSet\n}\n\nexport type SessionStore = SimpleStore<string, Session>\n\nexport type SessionEventMap = {\n  updated: {\n    sub: string\n  } & Session\n  deleted: {\n    sub: string\n    cause: TokenRefreshError | TokenRevokedError | TokenInvalidError | unknown\n  }\n}\n\nexport type SessionEventListener<\n  T extends keyof SessionEventMap = keyof SessionEventMap,\n> = (event: CustomEvent<SessionEventMap[T]>) => void\n\n/**\n * There are several advantages to wrapping the sessionStore in a (single)\n * CachedGetter, the main of which is that the cached getter will ensure that at\n * most one fresh call is ever being made. Another advantage, is that it\n * contains the logic for reading from the cache which, if the cache is based on\n * localStorage/indexedDB, will sync across multiple tabs (for a given sub).\n */\nexport class SessionGetter extends CachedGetter<AtprotoDid, Session> {\n  private readonly eventTarget = new CustomEventTarget<SessionEventMap>()\n\n  constructor(\n    sessionStore: SessionStore,\n    serverFactory: OAuthServerFactory,\n    private readonly runtime: Runtime,\n  ) {\n    super(\n      async (sub, options, storedSession): Promise<Session> => {\n        // There needs to be a previous session to be able to refresh. If\n        // storedSession is undefined, it means that the store does not contain\n        // a session for the given sub.\n        if (storedSession === undefined) {\n          // Because the session is not in the store, this.delStored() method\n          // will not be called by the CachedGetter class (because there is\n          // nothing to delete). This would typically happen if there is no\n          // synchronization mechanism between instances of this class. Let's\n          // make sure an event is dispatched here if this occurs.\n          const msg = 'The session was deleted by another process'\n          const cause = new TokenRefreshError(sub, msg)\n          this.dispatchEvent('deleted', { sub, cause })\n          throw cause\n        }\n\n        // From this point forward, throwing a TokenRefreshError will result in\n        // this.delStored() being called, resulting in an event being\n        // dispatched, even if the session was removed from the store through a\n        // concurrent access (which, normally, should not happen if a proper\n        // runtime lock was provided).\n\n        const { dpopKey, tokenSet } = storedSession\n\n        if (sub !== tokenSet.sub) {\n          // Fool-proofing (e.g. against invalid session storage)\n          throw new TokenRefreshError(sub, 'Stored session sub mismatch')\n        }\n\n        if (!tokenSet.refresh_token) {\n          throw new TokenRefreshError(sub, 'No refresh token available')\n        }\n\n        // Since refresh tokens can only be used once, we might run into\n        // concurrency issues if multiple instances (e.g. browser tabs) are\n        // trying to refresh the same token simultaneously. The chances of this\n        // happening when multiple instances are started simultaneously is\n        // reduced by randomizing the expiry time (see isStale() below). The\n        // best solution is to use a mutex/lock to ensure that only one instance\n        // is refreshing the token at a time (runtime.usingLock) but that is not\n        // always possible. If no lock implementation is provided, we will use\n        // the store to check if a concurrent refresh occurred.\n\n        const server = await serverFactory.fromIssuer(tokenSet.iss, dpopKey)\n\n        // Because refresh tokens can only be used once, we must not use the\n        // \"signal\" to abort the refresh, or throw any abort error beyond this\n        // point. Any thrown error beyond this point will prevent the\n        // TokenGetter from obtaining, and storing, the new token set,\n        // effectively rendering the currently saved session unusable.\n        options?.signal?.throwIfAborted()\n\n        try {\n          const newTokenSet = await server.refresh(tokenSet)\n\n          if (sub !== newTokenSet.sub) {\n            // The server returned another sub. Was the tokenSet manipulated?\n            throw new TokenRefreshError(sub, 'Token set sub mismatch')\n          }\n\n          return { dpopKey, tokenSet: newTokenSet }\n        } catch (cause) {\n          // If the refresh token is invalid, let's try to recover from\n          // concurrency issues, or make sure the session is deleted by throwing\n          // a TokenRefreshError.\n          if (\n            cause instanceof OAuthResponseError &&\n            cause.status === 400 &&\n            cause.error === 'invalid_grant'\n          ) {\n            // In case there is no lock implementation in the runtime, we will\n            // wait for a short time to give the other concurrent instances a\n            // chance to finish their refreshing of the token. If a concurrent\n            // refresh did occur, we will pretend that this one succeeded.\n            if (!runtime.hasImplementationLock) {\n              await new Promise((r) => setTimeout(r, 1000))\n\n              const stored = await this.getStored(sub)\n              if (stored === undefined) {\n                // A concurrent refresh occurred and caused the session to be\n                // deleted (for a reason we can't know at this point).\n\n                // Using a distinct error message mainly for debugging\n                // purposes. Also, throwing a TokenRefreshError to trigger\n                // deletion through the deleteOnError callback.\n                const msg = 'The session was deleted by another process'\n                throw new TokenRefreshError(sub, msg, { cause })\n              } else if (\n                stored.tokenSet.access_token !== tokenSet.access_token ||\n                stored.tokenSet.refresh_token !== tokenSet.refresh_token\n              ) {\n                // A concurrent refresh occurred. Pretend this one succeeded.\n                return stored\n              } else {\n                // There were no concurrent refresh. The token is (likely)\n                // simply no longer valid.\n              }\n            }\n\n            // Make sure the session gets deleted from the store\n            const msg = cause.errorDescription ?? 'The session was revoked'\n            throw new TokenRefreshError(sub, msg, { cause })\n          }\n\n          throw cause\n        }\n      },\n      sessionStore,\n      {\n        isStale: (sub, { tokenSet }) => {\n          return (\n            tokenSet.expires_at != null &&\n            new Date(tokenSet.expires_at).getTime() <\n              Date.now() +\n                // Add some lee way to ensure the token is not expired when it\n                // reaches the server.\n                10e3 +\n                // Add some randomness to reduce the chances of multiple\n                // instances trying to refresh the token at the same.\n                30e3 * Math.random()\n          )\n        },\n        onStoreError: async (err, sub, { tokenSet, dpopKey }) => {\n          // If the token data cannot be stored, let's revoke it\n          const server = await serverFactory.fromIssuer(tokenSet.iss, dpopKey)\n          await server.revoke(tokenSet.refresh_token ?? tokenSet.access_token)\n          throw err\n        },\n        deleteOnError: async (err) =>\n          // Optimization: More likely to happen first\n          err instanceof TokenRefreshError ||\n          err instanceof TokenRevokedError ||\n          err instanceof TokenInvalidError,\n      },\n    )\n  }\n\n  addEventListener<T extends keyof SessionEventMap>(\n    type: T,\n    callback: SessionEventListener<T>,\n    options?: AddEventListenerOptions | boolean,\n  ) {\n    this.eventTarget.addEventListener(type, callback, options)\n  }\n\n  removeEventListener<T extends keyof SessionEventMap>(\n    type: T,\n    callback: SessionEventListener<T>,\n    options?: EventListenerOptions | boolean,\n  ) {\n    this.eventTarget.removeEventListener(type, callback, options)\n  }\n\n  dispatchEvent<T extends keyof SessionEventMap>(\n    type: T,\n    detail: SessionEventMap[T],\n  ): boolean {\n    return this.eventTarget.dispatchCustomEvent(type, detail)\n  }\n\n  async setStored(sub: string, session: Session) {\n    // Prevent tampering with the stored value\n    if (sub !== session.tokenSet.sub) {\n      throw new TypeError('Token set does not match the expected sub')\n    }\n    await super.setStored(sub, session)\n    this.dispatchEvent('updated', { sub, ...session })\n  }\n\n  override async delStored(sub: AtprotoDid, cause?: unknown): Promise<void> {\n    await super.delStored(sub, cause)\n    this.dispatchEvent('deleted', { sub, cause })\n  }\n\n  /**\n   * @param refresh When `true`, the credentials will be refreshed even if they\n   * are not expired. When `false`, the credentials will not be refreshed even\n   * if they are expired. When `undefined`, the credentials will be refreshed\n   * if, and only if, they are (about to be) expired. Defaults to `undefined`.\n   */\n  async getSession(sub: AtprotoDid, refresh?: boolean) {\n    return this.get(sub, {\n      noCache: refresh === true,\n      allowStale: refresh === false,\n    })\n  }\n\n  async get(sub: AtprotoDid, options?: GetCachedOptions): Promise<Session> {\n    const session = await this.runtime.usingLock(\n      `@atproto-oauth-client-${sub}`,\n      async () => {\n        // Make sure, even if there is no signal in the options, that the\n        // request will be cancelled after at most 30 seconds.\n        using signal = timeoutSignal(30e3, options)\n\n        using abortController = combineSignals([options?.signal, signal])\n\n        return await super.get(sub, {\n          ...options,\n          signal: abortController.signal,\n        })\n      },\n    )\n\n    if (sub !== session.tokenSet.sub) {\n      // Fool-proofing (e.g. against invalid session storage)\n      throw new Error('Token set does not match the expected sub')\n    }\n\n    return session\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 19424, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19429, "column": 0}, "map": {"version":3,"file":"types.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/types.ts"],"sourcesContent":["import {\n  oauthClientIdLoopbackSchema,\n  OAuthAuthorizationRequestParameters,\n  oauthClientIdDiscoverableSchema,\n  oauthClientMetadataSchema,\n} from '@atproto/oauth-types'\nimport { TypeOf, z } from 'zod'\n\nimport { Simplify } from './util.js'\n\n// Note: These types are not prefixed with `OAuth` because they are not specific\n// to OAuth. They are specific to this packages. OAuth specific types are in\n// `@atproto/oauth-types`.\n\nexport type AuthorizeOptions = Simplify<\n  Omit<\n    OAuthAuthorizationRequestParameters,\n    | 'client_id'\n    | 'response_mode'\n    | 'response_type'\n    | 'login_hint'\n    | 'code_challenge'\n    | 'code_challenge_method'\n  > & {\n    signal?: AbortSignal\n  }\n>\n\nexport const clientMetadataSchema = oauthClientMetadataSchema.extend({\n  client_id: z.union([\n    oauthClientIdDiscoverableSchema,\n    oauthClientIdLoopbackSchema,\n  ]),\n})\n\nexport type ClientMetadata = TypeOf<typeof clientMetadataSchema>\n"],"names":[],"mappings":";;;;;AAAA,MAAA,gDAK6B;AAC7B,MAAA,uBAA+B;AAsBlB,QAAA,oBAAoB,GAAG,cAAA,yBAAyB,CAAC,MAAM,CAAC;IACnE,SAAS,EAAE,MAAA,CAAC,CAAC,KAAK,CAAC;QACjB,cAAA,+BAA+B;QAC/B,cAAA,2BAA2B;KAC5B,CAAC;CACH,CAAC,CAAA","ignoreList":[0]}},
    {"offset": {"line": 19442, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19447, "column": 0}, "map": {"version":3,"file":"validate-client-metadata.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/validate-client-metadata.ts"],"sourcesContent":["import { Keyset } from '@atproto/jwk'\nimport {\n  OAuthClientMetadataInput,\n  assertOAuthDiscoverableClientId,\n  assertOAuthLoopbackClientId,\n} from '@atproto/oauth-types'\n\nimport { ClientMetadata, clientMetadataSchema } from './types.js'\n\nconst TOKEN_ENDPOINT_AUTH_METHOD = `token_endpoint_auth_method`\nconst TOKEN_ENDPOINT_AUTH_SIGNING_ALG = `token_endpoint_auth_signing_alg`\n\nexport function validateClientMetadata(\n  input: OAuthClientMetadataInput,\n  keyset?: Keyset,\n): ClientMetadata {\n  if (input.jwks) {\n    if (!keyset) {\n      throw new TypeError(`Keyset must not be provided when jwks is provided`)\n    }\n    for (const key of input.jwks.keys) {\n      if (!key.kid) {\n        throw new TypeError(`Key must have a \"kid\" property`)\n      } else if (!keyset.has(key.kid)) {\n        throw new TypeError(`Key with kid \"${key.kid}\" not found in keyset`)\n      }\n    }\n  }\n\n  // Allow to pass a keyset and omit the jwks/jwks_uri properties\n  if (!input.jwks && !input.jwks_uri && keyset?.size) {\n    input = { ...input, jwks: keyset.toJSON() }\n  }\n\n  const metadata = clientMetadataSchema.parse(input)\n\n  // Validate client ID\n  if (metadata.client_id.startsWith('http:')) {\n    assertOAuthLoopbackClientId(metadata.client_id)\n  } else {\n    assertOAuthDiscoverableClientId(metadata.client_id)\n  }\n\n  const scopes = metadata.scope?.split(' ')\n  if (!scopes?.includes('atproto')) {\n    throw new TypeError(`Client metadata must include the \"atproto\" scope`)\n  }\n\n  if (!metadata.response_types.includes('code')) {\n    throw new TypeError(`\"response_types\" must include \"code\"`)\n  }\n\n  if (!metadata.grant_types.includes('authorization_code')) {\n    throw new TypeError(`\"grant_types\" must include \"authorization_code\"`)\n  }\n\n  const method = metadata[TOKEN_ENDPOINT_AUTH_METHOD]\n  switch (method) {\n    case undefined:\n      throw new TypeError(`${TOKEN_ENDPOINT_AUTH_METHOD} must be provided`)\n    case 'none':\n      if (metadata[TOKEN_ENDPOINT_AUTH_SIGNING_ALG]) {\n        throw new TypeError(\n          `${TOKEN_ENDPOINT_AUTH_SIGNING_ALG} must not be provided when ${TOKEN_ENDPOINT_AUTH_METHOD} is \"${method}\"`,\n        )\n      }\n      break\n    case 'private_key_jwt':\n      if (!keyset?.size) {\n        throw new TypeError(\n          `A non-empty keyset must be provided when ${TOKEN_ENDPOINT_AUTH_METHOD} is \"${method}\"`,\n        )\n      }\n      if (!metadata[TOKEN_ENDPOINT_AUTH_SIGNING_ALG]) {\n        throw new TypeError(\n          `${TOKEN_ENDPOINT_AUTH_SIGNING_ALG} must be provided when ${TOKEN_ENDPOINT_AUTH_METHOD} is \"${method}\"`,\n        )\n      }\n      break\n    default:\n      throw new TypeError(\n        `Invalid \"token_endpoint_auth_method\" value: ${method}`,\n      )\n  }\n\n  return metadata\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 19515, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19520, "column": 0}, "map": {"version":3,"file":"oauth-client.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/oauth-client.ts"],"sourcesContent":["import {\n  assertAtprotoDid,\n  AtprotoDid,\n  DidCache,\n  DidResolverCached,\n  DidResolverCommon,\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  type DidResolverCommonOptions,\n} from '@atproto-labs/did-resolver'\nimport { Fetch } from '@atproto-labs/fetch'\nimport {\n  AppViewHandleResolver,\n  CachedHandleResolver,\n  HandleCache,\n  HandleResolver,\n} from '@atproto-labs/handle-resolver'\nimport { IdentityResolver } from '@atproto-labs/identity-resolver'\nimport { SimpleStoreMemory } from '@atproto-labs/simple-store-memory'\nimport { Key, Keyset } from '@atproto/jwk'\nimport {\n  OAuthAuthorizationRequestParameters,\n  OAuthClientIdDiscoverable,\n  OAuthClientMetadata,\n  OAuthClientMetadataInput,\n  oauthClientMetadataSchema,\n  OAuthResponseMode,\n} from '@atproto/oauth-types'\n\nimport { FALLBACK_ALG } from './constants.js'\nimport { TokenRevokedError } from './errors/token-revoked-error.js'\nimport {\n  AuthorizationServerMetadataCache,\n  OAuthAuthorizationServerMetadataResolver,\n} from './oauth-authorization-server-metadata-resolver.js'\nimport { OAuthCallbackError } from './oauth-callback-error.js'\nimport {\n  OAuthProtectedResourceMetadataResolver,\n  ProtectedResourceMetadataCache,\n} from './oauth-protected-resource-metadata-resolver.js'\nimport { OAuthResolver } from './oauth-resolver.js'\nimport { DpopNonceCache, OAuthServerAgent } from './oauth-server-agent.js'\nimport { OAuthServerFactory } from './oauth-server-factory.js'\nimport { OAuthSession } from './oauth-session.js'\nimport { RuntimeImplementation } from './runtime-implementation.js'\nimport { Runtime } from './runtime.js'\nimport {\n  SessionEventMap,\n  SessionGetter,\n  SessionStore,\n} from './session-getter.js'\nimport { InternalStateData, StateStore } from './state-store.js'\nimport { AuthorizeOptions, ClientMetadata } from './types.js'\nimport { CustomEventTarget } from './util.js'\nimport { validateClientMetadata } from './validate-client-metadata.js'\n\n// Export all types needed to construct OAuthClientOptions\nexport type {\n  AuthorizationServerMetadataCache,\n  DidCache,\n  DpopNonceCache,\n  Fetch,\n  HandleCache,\n  HandleResolver,\n  InternalStateData,\n  Key,\n  Keyset,\n  OAuthClientMetadata,\n  OAuthClientMetadataInput,\n  OAuthResponseMode,\n  ProtectedResourceMetadataCache,\n  RuntimeImplementation,\n  SessionStore,\n  StateStore,\n}\n\nexport type OAuthClientOptions = {\n  // Config\n  responseMode: OAuthResponseMode\n  clientMetadata: Readonly<OAuthClientMetadataInput>\n  keyset?: Keyset | Iterable<Key | undefined | null | false>\n  /**\n   * Determines if the client will allow communicating with the OAuth Servers\n   * (Authorization & Resource), or to retrieve \"did:web\" documents, over\n   * unsafe HTTP connections. It is recommended to set this to `true` only for\n   * development purposes.\n   *\n   * @note This does not affect the identity resolution mechanism, which will\n   * allow HTTP connections to the PLC Directory (if the provided directory url\n   * is \"http:\" based).\n   * @default false\n   * @see {@link OAuthProtectedResourceMetadataResolver.allowHttpResource}\n   * @see {@link OAuthAuthorizationServerMetadataResolver.allowHttpIssuer}\n   * @see {@link DidResolverCommonOptions.allowHttp}\n   */\n  allowHttp?: boolean\n\n  // Stores\n  stateStore: StateStore\n  sessionStore: SessionStore\n  didCache?: DidCache\n  handleCache?: HandleCache\n  authorizationServerMetadataCache?: AuthorizationServerMetadataCache\n  protectedResourceMetadataCache?: ProtectedResourceMetadataCache\n  dpopNonceCache?: DpopNonceCache\n\n  // Services\n  handleResolver: HandleResolver | URL | string\n  plcDirectoryUrl?: URL | string\n  runtimeImplementation: RuntimeImplementation\n  fetch?: Fetch\n}\n\nexport type OAuthClientEventMap = SessionEventMap\n\nexport type OAuthClientFetchMetadataOptions = {\n  clientId: OAuthClientIdDiscoverable\n  fetch?: Fetch\n  signal?: AbortSignal\n}\n\nexport class OAuthClient extends CustomEventTarget<OAuthClientEventMap> {\n  static async fetchMetadata({\n    clientId,\n    fetch = globalThis.fetch,\n    signal,\n  }: OAuthClientFetchMetadataOptions) {\n    signal?.throwIfAborted()\n\n    const request = new Request(clientId, {\n      redirect: 'error',\n      signal: signal,\n    })\n    const response = await fetch(request)\n\n    if (response.status !== 200) {\n      response.body?.cancel?.()\n      throw new TypeError(`Failed to fetch client metadata: ${response.status}`)\n    }\n\n    // https://drafts.aaronpk.com/draft-parecki-oauth-client-id-metadata-document/draft-parecki-oauth-client-id-metadata-document.html#section-4.1\n    const mime = response.headers.get('content-type')?.split(';')[0].trim()\n    if (mime !== 'application/json') {\n      response.body?.cancel?.()\n      throw new TypeError(`Invalid client metadata content type: ${mime}`)\n    }\n\n    const json: unknown = await response.json()\n\n    signal?.throwIfAborted()\n\n    return oauthClientMetadataSchema.parse(json)\n  }\n\n  // Config\n  readonly clientMetadata: ClientMetadata\n  readonly responseMode: OAuthResponseMode\n  readonly keyset?: Keyset\n\n  // Services\n  readonly runtime: Runtime\n  readonly fetch: Fetch\n  readonly oauthResolver: OAuthResolver\n  readonly serverFactory: OAuthServerFactory\n\n  // Stores\n  protected readonly sessionGetter: SessionGetter\n  protected readonly stateStore: StateStore\n\n  constructor({\n    fetch = globalThis.fetch,\n    allowHttp = false,\n\n    stateStore,\n    sessionStore,\n\n    didCache = undefined,\n    dpopNonceCache = new SimpleStoreMemory({ ttl: 60e3, max: 100 }),\n    handleCache = undefined,\n    authorizationServerMetadataCache = new SimpleStoreMemory({\n      ttl: 60e3,\n      max: 100,\n    }),\n    protectedResourceMetadataCache = new SimpleStoreMemory({\n      ttl: 60e3,\n      max: 100,\n    }),\n\n    responseMode,\n    clientMetadata,\n    handleResolver,\n    plcDirectoryUrl,\n    runtimeImplementation,\n    keyset,\n  }: OAuthClientOptions) {\n    super()\n\n    this.keyset = keyset\n      ? keyset instanceof Keyset\n        ? keyset\n        : new Keyset(keyset)\n      : undefined\n    this.clientMetadata = validateClientMetadata(clientMetadata, this.keyset)\n    this.responseMode = responseMode\n\n    this.runtime = new Runtime(runtimeImplementation)\n    this.fetch = fetch\n    this.oauthResolver = new OAuthResolver(\n      new IdentityResolver(\n        new DidResolverCached(\n          new DidResolverCommon({ fetch, plcDirectoryUrl, allowHttp }),\n          didCache,\n        ),\n        new CachedHandleResolver(\n          AppViewHandleResolver.from(handleResolver, { fetch }),\n          handleCache,\n        ),\n      ),\n      new OAuthProtectedResourceMetadataResolver(\n        protectedResourceMetadataCache,\n        fetch,\n        { allowHttpResource: allowHttp },\n      ),\n      new OAuthAuthorizationServerMetadataResolver(\n        authorizationServerMetadataCache,\n        fetch,\n        { allowHttpIssuer: allowHttp },\n      ),\n    )\n    this.serverFactory = new OAuthServerFactory(\n      this.clientMetadata,\n      this.runtime,\n      this.oauthResolver,\n      this.fetch,\n      this.keyset,\n      dpopNonceCache,\n    )\n\n    this.sessionGetter = new SessionGetter(\n      sessionStore,\n      this.serverFactory,\n      this.runtime,\n    )\n    this.stateStore = stateStore\n\n    // Proxy sessionGetter events\n    for (const type of ['deleted', 'updated'] as const) {\n      this.sessionGetter.addEventListener(type, (event) => {\n        if (!this.dispatchCustomEvent(type, event.detail)) {\n          event.preventDefault()\n        }\n      })\n    }\n  }\n\n  // Exposed as public API for convenience\n  get identityResolver() {\n    return this.oauthResolver.identityResolver\n  }\n\n  // Exposed as public API for convenience\n  get didResolver() {\n    return this.identityResolver.didResolver\n  }\n\n  // Exposed as public API for convenience\n  get handleResolver() {\n    return this.identityResolver.handleResolver\n  }\n\n  get jwks() {\n    return this.keyset?.publicJwks ?? ({ keys: [] as const } as const)\n  }\n\n  async authorize(\n    input: string,\n    { signal, ...options }: AuthorizeOptions = {},\n  ): Promise<URL> {\n    const redirectUri =\n      options?.redirect_uri ?? this.clientMetadata.redirect_uris[0]\n    if (!this.clientMetadata.redirect_uris.includes(redirectUri)) {\n      // The server will enforce this, but let's catch it early\n      throw new TypeError('Invalid redirect_uri')\n    }\n\n    const { identity, metadata } = await this.oauthResolver.resolve(input, {\n      signal,\n    })\n\n    const pkce = await this.runtime.generatePKCE()\n    const dpopKey = await this.runtime.generateKey(\n      metadata.dpop_signing_alg_values_supported || [FALLBACK_ALG],\n    )\n\n    const state = await this.runtime.generateNonce()\n\n    await this.stateStore.set(state, {\n      iss: metadata.issuer,\n      dpopKey,\n      verifier: pkce.verifier,\n      appState: options?.state,\n    })\n\n    const parameters: OAuthAuthorizationRequestParameters = {\n      ...options,\n\n      client_id: this.clientMetadata.client_id,\n      redirect_uri: redirectUri,\n      code_challenge: pkce.challenge,\n      code_challenge_method: pkce.method,\n      state,\n      login_hint: identity\n        ? input // If input is a handle or a DID, use it as a login_hint\n        : undefined,\n      response_mode: this.responseMode,\n      response_type: 'code' as const,\n      scope: options?.scope ?? this.clientMetadata.scope,\n    }\n\n    const authorizationUrl = new URL(metadata.authorization_endpoint)\n\n    // Since the user will be redirected to the authorization_endpoint url using\n    // a browser, we need to make sure that the url is valid.\n    if (\n      authorizationUrl.protocol !== 'https:' &&\n      authorizationUrl.protocol !== 'http:'\n    ) {\n      throw new TypeError(\n        `Invalid authorization endpoint protocol: ${authorizationUrl.protocol}`,\n      )\n    }\n\n    if (metadata.pushed_authorization_request_endpoint) {\n      const server = await this.serverFactory.fromMetadata(metadata, dpopKey)\n      const parResponse = await server.request(\n        'pushed_authorization_request',\n        parameters,\n      )\n\n      authorizationUrl.searchParams.set(\n        'client_id',\n        this.clientMetadata.client_id,\n      )\n      authorizationUrl.searchParams.set('request_uri', parResponse.request_uri)\n      return authorizationUrl\n    } else if (metadata.require_pushed_authorization_requests) {\n      throw new Error(\n        'Server requires pushed authorization requests (PAR) but no PAR endpoint is available',\n      )\n    } else {\n      for (const [key, value] of Object.entries(parameters)) {\n        if (value) authorizationUrl.searchParams.set(key, String(value))\n      }\n\n      // Length of the URL that will be sent to the server\n      const urlLength =\n        authorizationUrl.pathname.length + authorizationUrl.search.length\n      if (urlLength < 2048) {\n        return authorizationUrl\n      } else if (!metadata.pushed_authorization_request_endpoint) {\n        throw new Error('Login URL too long')\n      }\n    }\n\n    throw new Error(\n      'Server does not support pushed authorization requests (PAR)',\n    )\n  }\n\n  /**\n   * This method allows the client to proactively revoke the request_uri it\n   * created through PAR.\n   */\n  async abortRequest(authorizeUrl: URL) {\n    const requestUri = authorizeUrl.searchParams.get('request_uri')\n    if (!requestUri) return\n\n    // @NOTE This is not implemented here because, 1) the request server should\n    // invalidate the request_uri after some delay anyways, and 2) I am not sure\n    // that the revocation endpoint is even supposed to support this (and I\n    // don't want to spend the time checking now).\n\n    // @TODO investigate actual necessity & feasibility of this feature\n  }\n\n  async callback(params: URLSearchParams): Promise<{\n    session: OAuthSession\n    state: string | null\n  }> {\n    const responseJwt = params.get('response')\n    if (responseJwt != null) {\n      // https://openid.net/specs/oauth-v2-jarm.html\n      throw new OAuthCallbackError(params, 'JARM not supported')\n    }\n\n    const issuerParam = params.get('iss')\n    const stateParam = params.get('state')\n    const errorParam = params.get('error')\n    const codeParam = params.get('code')\n\n    if (!stateParam) {\n      throw new OAuthCallbackError(params, 'Missing \"state\" parameter')\n    }\n    const stateData = await this.stateStore.get(stateParam)\n    if (stateData) {\n      // Prevent any kind of replay\n      await this.stateStore.del(stateParam)\n    } else {\n      throw new OAuthCallbackError(\n        params,\n        `Unknown authorization session \"${stateParam}\"`,\n      )\n    }\n\n    try {\n      if (errorParam != null) {\n        throw new OAuthCallbackError(params, undefined, stateData.appState)\n      }\n\n      if (!codeParam) {\n        throw new OAuthCallbackError(\n          params,\n          'Missing \"code\" query param',\n          stateData.appState,\n        )\n      }\n\n      const server = await this.serverFactory.fromIssuer(\n        stateData.iss,\n        stateData.dpopKey,\n      )\n\n      if (issuerParam != null) {\n        if (!server.issuer) {\n          throw new OAuthCallbackError(\n            params,\n            'Issuer not found in metadata',\n            stateData.appState,\n          )\n        }\n        if (server.issuer !== issuerParam) {\n          throw new OAuthCallbackError(\n            params,\n            'Issuer mismatch',\n            stateData.appState,\n          )\n        }\n      } else if (\n        server.serverMetadata.authorization_response_iss_parameter_supported\n      ) {\n        throw new OAuthCallbackError(\n          params,\n          'iss missing from the response',\n          stateData.appState,\n        )\n      }\n\n      const tokenSet = await server.exchangeCode(codeParam, stateData.verifier)\n      try {\n        await this.sessionGetter.setStored(tokenSet.sub, {\n          dpopKey: stateData.dpopKey,\n          tokenSet,\n        })\n\n        const session = this.createSession(server, tokenSet.sub)\n\n        return { session, state: stateData.appState ?? null }\n      } catch (err) {\n        await server.revoke(tokenSet.refresh_token || tokenSet.access_token)\n\n        throw err\n      }\n    } catch (err) {\n      // Make sure, whatever the underlying error, that the appState is\n      // available in the calling code\n      throw OAuthCallbackError.from(err, params, stateData.appState)\n    }\n  }\n\n  /**\n   * Load a stored session. This will refresh the token only if needed (about to\n   * expire) by default.\n   *\n   * @param refresh See {@link SessionGetter.getSession}\n   */\n  async restore(\n    sub: string,\n    refresh: boolean | 'auto' = 'auto',\n  ): Promise<OAuthSession> {\n    // sub arg is lightly typed for convenience of library user\n    assertAtprotoDid(sub)\n\n    const { dpopKey, tokenSet } = await this.sessionGetter.get(sub, {\n      noCache: refresh === true,\n      allowStale: refresh === false,\n    })\n\n    const server = await this.serverFactory.fromIssuer(tokenSet.iss, dpopKey, {\n      noCache: refresh === true,\n      allowStale: refresh === false,\n    })\n\n    return this.createSession(server, sub)\n  }\n\n  async revoke(sub: string) {\n    // sub arg is lightly typed for convenience of library user\n    assertAtprotoDid(sub)\n\n    const { dpopKey, tokenSet } = await this.sessionGetter.get(sub, {\n      allowStale: true,\n    })\n\n    // NOT using `;(await this.restore(sub, false)).signOut()` because we want\n    // the tokens to be deleted even if it was not possible to fetch the issuer\n    // data.\n    try {\n      const server = await this.serverFactory.fromIssuer(tokenSet.iss, dpopKey)\n      await server.revoke(tokenSet.access_token)\n    } finally {\n      await this.sessionGetter.delStored(sub, new TokenRevokedError(sub))\n    }\n  }\n\n  protected createSession(\n    server: OAuthServerAgent,\n    sub: AtprotoDid,\n  ): OAuthSession {\n    return new OAuthSession(server, sub, this.sessionGetter, this.fetch)\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 19852, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19857, "column": 0}, "map": {"version":3,"file":"runtime-implementation.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/runtime-implementation.ts"],"sourcesContent":["import { Key } from '@atproto/jwk'\nimport { Awaitable } from './util.js'\n\nexport type { Key }\nexport type RuntimeKeyFactory = (algs: string[]) => Key | PromiseLike<Key>\n\nexport type RuntimeRandomValues = (length: number) => Awaitable<Uint8Array>\n\nexport type DigestAlgorithm = { name: 'sha256' | 'sha384' | 'sha512' }\nexport type RuntimeDigest = (\n  data: Uint8Array,\n  alg: DigestAlgorithm,\n) => Awaitable<Uint8Array>\n\nexport type RuntimeLock = <T>(\n  name: string,\n  fn: () => Awaitable<T>,\n) => Awaitable<T>\n\nexport interface RuntimeImplementation {\n  createKey: RuntimeKeyFactory\n  getRandomValues: RuntimeRandomValues\n  digest: RuntimeDigest\n  requestLock?: RuntimeLock\n}\n"],"names":[],"mappings":"","ignoreList":[0]}},
    {"offset": {"line": 19861, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19866, "column": 0}, "map": {"version":3,"file":"state-store.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/state-store.ts"],"sourcesContent":["import { SimpleStore } from '@atproto-labs/simple-store'\nimport { Key } from '@atproto/jwk'\n\nexport type InternalStateData = {\n  iss: string\n  dpopKey: Key\n  verifier?: string\n  appState?: string\n}\n\nexport type StateStore = SimpleStore<string, InternalStateData>\n"],"names":[],"mappings":"","ignoreList":[0]}},
    {"offset": {"line": 19870, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19875, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client/src/index.ts"],"sourcesContent":["export * from '@atproto-labs/did-resolver'\nexport {\n  FetchError,\n  FetchRequestError,\n  FetchResponseError,\n} from '@atproto-labs/fetch'\nexport * from '@atproto-labs/handle-resolver'\n\nexport * from '@atproto/did'\nexport * from '@atproto/oauth-types'\n\nexport * from './oauth-authorization-server-metadata-resolver.js'\nexport * from './oauth-callback-error.js'\nexport * from './oauth-client.js'\nexport * from './oauth-protected-resource-metadata-resolver.js'\nexport * from './oauth-resolver-error.js'\nexport * from './oauth-response-error.js'\nexport * from './oauth-server-agent.js'\nexport * from './oauth-server-factory.js'\nexport * from './oauth-session.js'\nexport * from './runtime-implementation.js'\nexport * from './session-getter.js'\nexport * from './state-store.js'\nexport * from './types.js'\n\nexport * from './errors/token-invalid-error.js'\nexport * from './errors/token-refresh-error.js'\nexport * from './errors/token-revoked-error.js'\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,8HAAA,SAA0C;AAC1C,IAAA,yCAI4B;AAH1B,OAAA,cAAA,CAAA,SAAA,cAAA;IAAA,YAAA;IAAA,KAAA;QAAA,OAAA,QAAA,UAAU;IAAA;AAAA,GAAA;AACV,OAAA,cAAA,CAAA,SAAA,qBAAA;IAAA,YAAA;IAAA,KAAA;QAAA,OAAA,QAAA,iBAAiB;IAAA;AAAA,GAAA;AACjB,OAAA,cAAA,CAAA,SAAA,sBAAA;IAAA,YAAA;IAAA,KAAA;QAAA,OAAA,QAAA,kBAAkB;IAAA;AAAA,GAAA;AAEpB,iIAAA,SAA6C;AAE7C,gHAAA,SAA4B;AAC5B,wHAAA,SAAoC;AAEpC,gKAAA,SAAiE;AACjE,wIAAA,SAAyC;AACzC,gIAAA,SAAiC;AACjC,8JAAA,SAA+D;AAC/D,wIAAA,SAAyC;AACzC,wIAAA,SAAyC;AACzC,sIAAA,SAAuC;AACvC,wIAAA,SAAyC;AACzC,iIAAA,SAAkC;AAClC,0IAAA,SAA2C;AAC3C,kIAAA,SAAmC;AACnC,+HAAA,SAAgC;AAChC,yHAAA,SAA0B;AAE1B,8IAAA,SAA+C;AAC/C,8IAAA,SAA+C;AAC/C,8IAAA,SAA+C","ignoreList":[0]}},
    {"offset": {"line": 19938, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19943, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/indexed-db/util.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/indexed-db/util.ts"],"names":[],"mappings":";;;;AAAA,QAAA,aAAA,GAAA,cAmBC;AAED,QAAA,SAAA,GAAA,UAIC;AAzBD,SAAgB,aAAa,CAC3B,OAAsB,EACtB,SAA8B,EAC9B,OAA+B;IAE/B,MAAM,OAAO,GAAG,GAAG,EAAE;QACnB,OAAO,CAAC,mBAAmB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAA;QAC/C,OAAO,CAAC,mBAAmB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;IAC7C,CAAC,CAAA;IACD,MAAM,OAAO,GAAG,GAAG,EAAE;QACnB,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QACzB,OAAO,EAAE,CAAA;IACX,CAAC,CAAA;IACD,MAAM,KAAK,GAAG,GAAG,EAAE;QACjB,OAAO,CAAC,OAAO,CAAC,KAAK,IAAI,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAA;QACpD,OAAO,EAAE,CAAA;IACX,CAAC,CAAA;IACD,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAA;IAC5C,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;AAC1C,CAAC;AAED,SAAgB,SAAS,CAAI,OAAsB;IACjD,OAAO,IAAI,OAAO,CAAI,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QACxC,aAAa,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC,CAAA;IACzC,CAAC,CAAC,CAAA;AACJ,CAAC","ignoreList":[0]}},
    {"offset": {"line": 19970, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19975, "column": 0}, "map": {"version":3,"file":"db-index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/indexed-db/db-index.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/indexed-db/db-index.ts"],"names":[],"mappings":";;;;;AACA,MAAA,iCAAqC;AAErC,MAAa,OAAO;IAClB,YAAoB,QAAkB,CAAA;QAA1B,OAAA,cAAA,CAAA,IAAA,EAAA,YAAA;;;;mBAAQ,QAAQ;WAAU;IAAG,CAAC;IAE1C,KAAK,CAAC,KAAiC,EAAA;QACrC,OAAO,CAAA,GAAA,UAAA,SAAS,EAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;IAC9C,CAAC;IAED,GAAG,CAAC,KAAgC,EAAA;QAClC,OAAO,CAAA,GAAA,UAAA,SAAS,EAAS,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAA;IACpD,CAAC;IAED,MAAM,CAAC,KAAgC,EAAA;QACrC,OAAO,CAAA,GAAA,UAAA,SAAS,EAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAA;IAC/C,CAAC;IAED,MAAM,CAAC,KAAwC,EAAE,KAAc,EAAA;QAC7D,OAAO,CAAA,GAAA,UAAA,SAAS,EAAW,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAA;IAChE,CAAC;IAED,UAAU,CAAC,KAAwC,EAAE,KAAc,EAAA;QACjE,OAAO,CAAA,GAAA,UAAA,SAAS,EAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAA;IAC1D,CAAC;IAED,SAAS,CAAC,KAAwC,EAAA;QAChD,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;YACrC,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAA;YAC9C,MAAM,CAAC,SAAS,GAAG,SAAU,KAAK;gBAChC,MAAM,MAAM,GAAI,KAAa,CAAC,MAAM,CAAC,MAA4B,CAAA;gBACjE,IAAI,MAAM,EAAE,CAAC;oBACX,MAAM,CAAC,MAAM,EAAE,CAAA;oBACf,MAAM,CAAC,QAAQ,EAAE,CAAA;gBACnB,CAAC,MAAM,CAAC;oBACN,OAAO,EAAE,CAAA;gBACX,CAAC;YACH,CAAC,CAAA;YACD,MAAM,CAAC,OAAO,GAAG,SAAU,KAAK;gBAC9B,MAAM,CAAE,KAAK,CAAC,MAAc,EAAE,KAAK,IAAI,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAA;YACvE,CAAC,CAAA;QACH,CAAC,CAAC,CAAA;IACJ,CAAC;CACF;AAxCD,QAAA,OAAA,GAAA,QAwCC","ignoreList":[0]}},
    {"offset": {"line": 20024, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20029, "column": 0}, "map": {"version":3,"file":"db-object-store.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/indexed-db/db-object-store.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/indexed-db/db-object-store.ts"],"names":[],"mappings":";;;;;AAAA,MAAA,yCAAuC;AAEvC,MAAA,iCAAqC;AAErC,MAAa,aAAa;IACxB,YAAoB,WAA2B,CAAA;QAAnC,OAAA,cAAA,CAAA,IAAA,EAAA,eAAA;;;;mBAAQ,WAAW;WAAgB;IAAG,CAAC;IAEnD,IAAI,IAAI,GAAA;QACN,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAA;IAC9B,CAAC;IAED,KAAK,CAAC,IAAY,EAAA;QAChB,OAAO,IAAI,cAAA,OAAO,CAAS,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAA;IAC1D,CAAC;IAED,GAAG,CAAC,GAA8B,EAAA;QAChC,OAAO,CAAA,GAAA,UAAA,SAAS,EAAS,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAA;IACrD,CAAC;IAED,MAAM,CAAC,KAAgC,EAAA;QACrC,OAAO,CAAA,GAAA,UAAA,SAAS,EAA0B,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAA;IAC3E,CAAC;IAED,MAAM,CAAC,KAAwC,EAAE,KAAc,EAAA;QAC7D,OAAO,CAAA,GAAA,UAAA,SAAS,EAAW,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAA;IACnE,CAAC;IAED,UAAU,CAAC,KAAwC,EAAE,KAAc,EAAA;QACjE,OAAO,CAAA,GAAA,UAAA,SAAS,EAAgB,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAA;IAC5E,CAAC;IAED,GAAG,CAAC,KAAa,EAAE,GAAiB,EAAA;QAClC,OAAO,CAAA,GAAA,UAAA,SAAS,EAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAA;IACpD,CAAC;IAED,GAAG,CAAC,KAAa,EAAE,GAAiB,EAAA;QAClC,OAAO,CAAA,GAAA,UAAA,SAAS,EAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAA;IACpD,CAAC;IAED,MAAM,CAAC,GAA8B,EAAA;QACnC,OAAO,CAAA,GAAA,UAAA,SAAS,EAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAA;IAChD,CAAC;IAED,KAAK,GAAA;QACH,OAAO,CAAA,GAAA,UAAA,SAAS,EAAC,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC,CAAA;IAC5C,CAAC;CACF;AA1CD,QAAA,aAAA,GAAA,cA0CC","ignoreList":[0]}},
    {"offset": {"line": 20077, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20082, "column": 0}, "map": {"version":3,"file":"db-transaction.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/indexed-db/db-transaction.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/indexed-db/db-transaction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA,MAAA,uDAAoD;AAGpD,MAAa,aAAa;IAKxB,YAAY,EAAkB,CAAA;QAF9B,kBAAA,GAAA,CAAA,IAAA,EAAA,KAAA,GAA0B;QAGxB,uBAAA,IAAI,EAAA,mBAAO,EAAE,EAAA,IAAA,CAAA;QAEb,MAAM,OAAO,GAAG,GAAG,EAAE;YACnB,OAAO,EAAE,CAAA;QACX,CAAC,CAAA;QACD,MAAM,UAAU,GAAG,GAAG,EAAE;YACtB,OAAO,EAAE,CAAA;QACX,CAAC,CAAA;QACD,MAAM,OAAO,GAAG,GAAG,EAAE;YACnB,uBAAA,IAAI,EAAA,mBAAO,IAAI,EAAA,IAAA,CAAA;YACf,EAAE,CAAC,mBAAmB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;YACxC,EAAE,CAAC,mBAAmB,CAAC,UAAU,EAAE,UAAU,CAAC,CAAA;QAChD,CAAC,CAAA;QACD,EAAE,CAAC,gBAAgB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;QACrC,EAAE,CAAC,gBAAgB,CAAC,UAAU,EAAE,UAAU,CAAC,CAAA;IAC7C,CAAC;IAED,IAAc,EAAE,GAAA;QACd,IAAI,CAAC,uBAAA,IAAI,EAAA,mBAAA,IAAI,EAAE,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAA;QAC3D,OAAO,uBAAA,IAAI,EAAA,mBAAA,IAAI,CAAA;IACjB,CAAC;IAED,KAAK,CAAC,KAAK,GAAA;QACT,MAAM,EAAE,EAAE,EAAE,GAAG,IAAI,CAAA;QACnB,uBAAA,IAAI,EAAA,mBAAO,IAAI,EAAA,IAAA,CAAA;QACf,EAAE,CAAC,KAAK,EAAE,CAAA;IACZ,CAAC;IAED,KAAK,CAAC,MAAM,GAAA;QACV,MAAM,EAAE,EAAE,EAAE,GAAG,IAAI,CAAA;QACnB,uBAAA,IAAI,EAAA,mBAAO,IAAI,EAAA,IAAA,CAAA;QACf,EAAE,CAAC,MAAM,EAAE,EAAE,CAAA;IACf,CAAC;IAED,WAAW,CAAkC,IAAO,EAAA;QAClD,MAAM,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAA;QACvC,OAAO,IAAI,qBAAA,aAAa,CAAY,KAAK,CAAC,CAAA;IAC5C,CAAC;IAED,CAAA,CAAA,oBAAA,IAAA,WAAC,MAAM,CAAC,OAAO,EAAC,GAAA;QACd,IAAI,uBAAA,IAAI,EAAA,mBAAA,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,CAAA;IAC7B,CAAC;CACF;AAhDD,QAAA,aAAA,GAAA,cAgDC","ignoreList":[0]}},
    {"offset": {"line": 20141, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20146, "column": 0}, "map": {"version":3,"file":"db.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/indexed-db/db.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/indexed-db/db.ts"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 20257, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20262, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/indexed-db/index.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/indexed-db/index.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAEA,yIAAA,SAAuB;AACvB,+IAAA,SAA6B;AAC7B,sJAAA,SAAoC;AACpC,qJAAA,SAAmC","ignoreList":[0]}},
    {"offset": {"line": 20290, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20295, "column": 0}, "map": {"version":3,"file":"browser-oauth-database.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/browser-oauth-database.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/browser-oauth-database.ts"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 20475, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20480, "column": 0}, "map": {"version":3,"file":"browser-runtime-implementation.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/browser-runtime-implementation.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/browser-runtime-implementation.ts"],"names":[],"mappings":";;;;;AAAA,MAAA,oDAAqD;AAQrD;;GAEG,CACH,MAAM,iBAAiB,GAA4B,SAAS,CAAC,KAAK,EAAE,OAAO,GACvE,CAAI,IAAY,EAAE,EAA4B,EAAc,CAC1D,CAD4D,QACnD,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE;QAAE,IAAI,EAAE,WAAW;IAAA,CAAE,EAAE,KAAK,IAAI,CAAG,CAAD,CAAG,EAAE,CAAC,GACxE,SAAS,CAAA;AAEb,MAAa,4BAA4B;IAGvC,aAAA;QAFA,OAAA,cAAA,CAAA,IAAA,EAAA,eAAA;;;;mBAAc,iBAAiB;WAAA;QAG7B,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,CAAC;YAClD,MAAM,IAAI,KAAK,CACb,iHAAiH,CAClH,CAAA;QACH,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACtB,wEAAwE;YACxE,yEAAyE;YACzE,qBAAqB;YACrB,OAAO,CAAC,IAAI,CACV,2EAA2E,CAC5E,CAAA;QACH,CAAC;IACH,CAAC;IAED,KAAK,CAAC,SAAS,CAAC,IAAc,EAAA;QAC5B,OAAO,gBAAA,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAA;IACpC,CAAC;IAED,eAAe,CAAC,UAAkB,EAAA;QAChC,OAAO,MAAM,CAAC,eAAe,CAAC,IAAI,UAAU,CAAC,UAAU,CAAC,CAAC,CAAA;IAC3D,CAAC;IAED,KAAK,CAAC,MAAM,CACV,IAAgB,EAChB,EAAE,IAAI,EAAmB,EAAA;QAEzB,OAAQ,IAAI,EAAE,CAAC;YACb,KAAK,QAAQ,CAAC;YACd,KAAK,QAAQ,CAAC;YACd,KAAK,QAAQ,CAAC;gBAAC,CAAC;oBACd,MAAM,GAAG,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA,IAAA,EAAO,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAA;oBACpE,OAAO,IAAI,UAAU,CAAC,GAAG,CAAC,CAAA;gBAC5B,CAAC;YACD;gBACE,MAAM,IAAI,KAAK,CAAC,CAAA,8BAAA,EAAiC,IAAI,EAAE,CAAC,CAAA;QAC5D,CAAC;IACH,CAAC;CACF;AA3CD,QAAA,4BAAA,GAAA,6BA2CC","ignoreList":[0]}},
    {"offset": {"line": 20530, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20535, "column": 0}, "map": {"version":3,"file":"errors.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/errors.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/errors.ts"],"names":[],"mappings":";;;;;AAAA;;;GAGG,CACH,MAAa,iCAAkC,SAAQ,KAAK;IAE1D,aAAA;QACE,KAAK,CAAC,gDAAgD,CAAC,CAAA;QAFzD,OAAA,cAAA,CAAA,IAAA,EAAA,QAAA;;;;mBAAO,kCAAkC;WAAA;IAGzC,CAAC;CACF;AALD,QAAA,iCAAA,GAAA,kCAKC","ignoreList":[0]}},
    {"offset": {"line": 20555, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20560, "column": 0}, "map": {"version":3,"file":"util.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/util.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/util.ts"],"names":[],"mappings":";;;;AAeA,QAAA,qBAAA,GAAA,sBAiBC;AAhCD,MAAA,gDAAqD;AASrD;;;;;GAKG,CACH,SAAgB,qBAAqB,CACnC,QAIC,EACD,SAAS,GAAG,WAAW;IAEvB,IAAI,CAAC,CAAA,GAAA,cAAA,cAAc,EAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;QACvC,MAAM,IAAI,SAAS,CAAC,CAAA,8BAAA,EAAiC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAA;IAC3E,CAAC;IAED,MAAM,WAAW,GAAG,CAAA,OAAA,EAAU,QAAQ,CAAC,QAAQ,KAAK,WAAW,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,QAAQ,GAAG,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA,CAAA,EAAI,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,QAAQ,EAAE,CAAA;IAE7M,OAAO,CAAA,gBAAA,EACL,QAAQ,CAAC,QAAQ,KAAK,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,QAC5C,CAAA,cAAA,EAAiB,kBAAkB,CAAC,WAAW,CAAC,EAAE,CAAA;AACpD,CAAC","ignoreList":[0]}},
    {"offset": {"line": 20578, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20583, "column": 0}, "map": {"version":3,"file":"browser-oauth-client.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/browser-oauth-client.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/browser-oauth-client.ts"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 20913, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 20918, "column": 0}, "map": {"version":3,"file":"index.js","sources":["file:///Users/mg/event-horizon/node_modules/%40atproto/oauth-client-browser/src/index.ts"],"sourcesContent":["unable to read source [project]/node_modules/@atproto/oauth-client-browser/src/index.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAEA,0HAAA,SAAsC;AACtC,yHAAA,SAAqC;AAErC,gJAAA,SAAyC;AACzC,kIAAA,SAA2B;AAC3B,IAAA,iCAAiD;AAAxC,OAAA,cAAA,CAAA,SAAA,yBAAA;IAAA,YAAA;IAAA,KAAA;QAAA,OAAA,UAAA,qBAAqB;IAAA;AAAA,GAAA","ignoreList":[0]}},
    {"offset": {"line": 20954, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}